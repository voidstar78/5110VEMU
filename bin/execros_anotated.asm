;; IBM 5110 PALM
; **********************************************************************
; *** Disassembled code of the IBM 5110 model 1 Executable ROS       ***
; *** Disassembly and comments copyright by Christian Corti          ***
; *** Version 24.03.2008                                             ***
; **********************************************************************

; **********************************************************************
; *** BEGIN OF ROS PART 1
; **********************************************************************

0000	000A		DW $000A		; R0L0
0002	0000		DW $0000		; R1L0

; ----------------------------------------------------------------------

0004	2868		MOVE R8, $D0
0006	12BF		CTRL $2, #$BF		; switch to meta-interpreter
0008	2056		JMP ($00AC)

; ----------------------------------------------------------------------

			; Clear all memory
			; (Memory parity check seems to be disabled)
			; This will also clear all registers from R4L0
			; to R15L3!

000A	1FFF		CTRL $F, #$FF		; Reset all devices
000C	0204		MOVE R2, R0
000E	8208		LBI R2, #$08		; R2 <- $0008
0010	0324		MOVE R3, R2
0012	8300		LBI R3, #$00		; R3 <- $0000
0014	5321		MOVE (R2)+, R3
0016	012C		MHL R1, R2
0018	0126		OR R1, R2
001A	C103		SZ R1
001C	F009		BRA $0014		; Loop

			; Size installed memory in increments of 8 kbytes
			
001E	8F1F		LBI R15, #$1F
0020	0FFD		MLH R15, R15
0022	8FFF		LBI R15, #$FF		; start with last address $1FFF

			; If there is no memory at the location pointed
			; to by R15, a read will return $FF instead of $00
0024	61F8		MOVB R1, (R15)
0026	C10C		SNS R1
0028	A00D		BRA $0038		; no memory here

			; Next memory location (increment by $2000)
002A	05F4		MOVE R5, R15
002C	01FC		MHL R1, R15
002E	A11F		ADD R1, #$20
0030	0F1D		MLH R15, R1

0032	81FF		LBI R1, #$FF
0034	C517		SBSH R5, R1		; done
0036	F013		BRA $0024		; Loop

0038	10FB		CTRL $0, #$FB		; Toggle level 0
003A	1FFF		CTRL $F, #$FF		; Reset all devices

			; Put $FFFF (halt code) in R7L0
			; R7 remains unaltered during bring up diagnostic
003C	0771		DEC R7, R7		; R7 <- $FFFF

			; Test RWS locations $0020-$05FF
003E	8420		LBI R4, #$20		; R4 <- $0020 (start address)
0040	8606		LBI R6, #$06		; R6 <- $0006 (high end address)
0042	8104		LBI R1, #$04
0044	011D		MLH R1, R1
0046	81C4		LBI R1, #$C4
0048	0203		INC2 R2, R0
004A	0014		RET R1			; test memory

			; Put 0000, 1111, 2222, ... into locations $0080-00BF
			; This is an aid to locate the registers in display
			; register mode
004C	0E34		MOVE R14, R3
004E	8E80		LBI R14, #$80		; R14 <- $0080
0050	8DC0		LBI R13, #$C0		; R13 <- $00C0
0052	0F34		MOVE R15, R3		; R15 <- $0000
0054	5FE1		MOVE (R14)+, R15
0056	CF0C		SNS R15
0058	8FEF		LBI R15, #$EF
005A	AF10		ADD R15, #$11
005C	0FFD		MLH R15, R15
005E	CED2		SE R14, R13
0060	F00D		BRA $0054		; -> -$0E(R0)

0062	351F		MOVE $3E, R5		; last RWS address
0064	8502		LBI R5, #$02
0066	055D		MLH R5, R5
0068	8500		LBI R5, #$00
006A	351E		MOVE $3C, R5		; begin of display

			; Clear display
006C	8F40		LBI R15, #' '
006E	0FFD		MLH R15, R15
0070	8D06		LBI R13, #$06
0072	5F51		MOVE (R5)+, R15
0074	C5D7		SBSH R5, R13
0076	F005		BRA $0072		; -> -$06(R0)

			; --- Test A ---
			; Bus In bit test
			
0078	251E		MOVE R5, $3C
007A	81C1		LBI R1, #'A'
007C	7150		MOVB (R5)+, R1
007E	8FFF		LBI R15, #$FF
0080	00FE		GETB R15, $0
0082	CF04		SS R15
0084	0000		HALT

			; --- Test B ---
			; Bus Out bit test
			
0086	81C2		LBI R1, #'B'
0088	7150		MOVB (R5)+, R1
008A	1FAA		CTRL $F, #$AA
008C	1FD5		CTRL $F, #$D5

			; --- Test C ---
			; Op Code test
			
008E	81C3		LBI R1, #'C'
0090	7150		MOVB (R5)+, R1
0092	351E		MOVE $3C, R5

0094	8A02		LBI R10, #$02
0096	A003		BRA $009C		; $04(R0)

0098	8AFF		LBI R10, #$FF
009A	2350		MOVE R3, $A0
009C	3A1D		MOVE $3A, R10
009E	331C		MOVE $38, R3
00A0	8402		LBI R4, #$02
00A2	044D		MLH R4, R4
00A4	8440		LBI R4, #$40
00A6	8BD6		LBI R11, #$D6
00A8	7B40		MOVB (R4)+, R11
00AA	8BC3		LBI R11, #'C'
00AC	7B42		MOVB (R4)+++, R11
00AE	341B		MOVE $36, R4

00B0	8100		LBI R1, #$00
00B2	011D		MLH R1, R1		; R0=0000
00B4	0310		DEC2 R3, R1		; R3=FFFE
00B6	E03D		ROR R3			; R3=FF7F
00B8	A382		ADD R3, #$83		; R3=0002
00BA	7331		MOVB (R3)++, R3		; R1=0200,R3=0004
00BC	0211		DEC R2, R1		; R2=01FF
00BE	6433		MOVB R4, (R3)++++	; R4=0001,R3=0008
00C0	E04D		ROR R4			; R4=0080
00C2	0436		OR R4, R3		; R4=0088
00C4	D533		MOVE R5, (R3)++		; R5=0088,R3=000C
00C6	F57F		SUB R5, #$80		; R5=0008
00C8	5534		MOVE (R3)~, R5		; R6=0008,R3=000B
00CA	0563		INC2 R5, R6		; R5=000A
00CC	6736		MOVB R7, (R3)---	; R7=000A,R3=0008
00CE	D837		MOVE R8, (R3)--		; R8=0088,R3=0004
00D0	5838		MOVE (R3), R8		; R2=0088
00D2	0277		XOR R2, R7		; R2=0082
00D4	D938		MOVE R9, (R3)		; R9=0082
00D6	B707		SET R7, #$07		; R7=000F
00D8	0738		ADD R7, R3		; R7=0013
00DA	6A78		MOVB R10, (R7)		; R10=0082
00DC	E05F		SWAP R5			; R5=00A0
00DE	0A59		SUB R10, R5		; R10=FFE2
00E0	5A38		MOVE (R3), R10		; R2=FFE2
00E2	02AA		ADDH R2, R10		; R2=01E1
00E4	E02E		ROR3 R2			; R2=013C
00E6	D938		MOVE R9, (R3)		; R9=013C
00E8	E09C		SHR R9			; R9=0196
00EA	099B		ADDH2 R9, R9		; R9=FF97
00EC	6B78		MOVB R11, (R7)		; R11=0097
00EE	089C		MHL R8, R9		; R8=00FF
00F0	985A		CLR R8, #$5A		; R8=00A5
00F2	0B85		AND R11, R8		; R11=0085
00F4	E0BC		SHR R11			; R11=0042
00F6	330C		MOVE $18, R3		; R12=0004
00F8	FC02		SUB R12, #$03		; R12=0001
00FA	2D07		MOVE R13, $0E		; R13=0013
00FC	0ED4		MOVE R14, R13		; R14=0013
00FE	0EC8		ADD R14, R12		; R14=0014
0100	0EB8		ADD R14, R11		; R14=0056
0102	0F04		MOVE R15, R0		; R15=0104
0104	8F56		LBI R15, #$56		; R15=0156
0106	CEFA		SNE R14, R15
0108	CEF2		SE R14, R15
010A	0000		HALT
010C	CEF1		SLT R14, R15
010E	CEF9		SGE R14, R15
0110	F001		BRA $0110		; -> -$02(R0)
0112	CEF8		SGT R14, R15
0114	CEF0		SLE R14, R15
0116	F001		BRA $0116		; -> -$02(R0)
0118	CE03		SZ R14
011A	CE0B		SNZ R14
011C	0000		HALT
011E	CE04		SS R14
0120	CE0C		SNS R14
0122	0000		HALT
0124	CEFD		SNBS R14, R15
0126	CEF5		SBS R14, R15
0128	0000		HALT
012A	CE5E		SNBC R14, R5
012C	CE56		SBC R14, R5
012E	0000		HALT
0130	CEC7		SBSH R14, R12
0132	CECF		SNBSH R14, R12
0134	0000		HALT
0136	241B		MOVE R4, $36
0138	2B1C		MOVE R11, $38
013A	AB00		ADD R11, #$01
013C	3B1C		MOVE $38, R11
013E	7B48		MOVB (R4), R11
0140	2A1D		MOVE R10, $3A
0142	CA0C		SNS R10
0144	F095		BRA $00B0		; -> -$96(R0)

0146	FA00		SUB R10, #$01
0148	3A1D		MOVE $3A, R10
014A	CA03		SZ R10
014C	F09D		BRA $00B0		; -> -$9E(R0)

014E	8300		LBI R3, #$00
0150	8B40		LBI R11, #$40
0152	0BBD		MLH R11, R11
0154	5B47		MOVE (R4)--, R11
0156	5B48		MOVE (R4), R11

			; --- Test D ---
			; RWS and ROS Switching Test
			
0158	8BC4		LBI R11, #'D'
015A	251E		MOVE R5, $3C
015C	7B50		MOVB (R5)+, R11
015E	8101		LBI R1, #$01
0160	011D		MLH R1, R1
0162	816E		LBI R1, #$6E
0164	8210		LBI R2, #$10
0166	022D		MLH R2, R2
0168	827B		LBI R2, #$7B
016A	5218		MOVE (R1), R2
016C	107B		CTRL $0, #$7B
016E	0000		HALT

			; --- Test E ---
			; Interrupt 1, 2, 3 Tests
			
0170	8BC5		LBI R11, #'E'
0172	7B50		MOVB (R5)+, R11
0174	8F05		LBI R15, #$05
0176	0FFD		MLH R15, R15
0178	8F36		LBI R15, #$36
017A	3F10		MOVE $20, R15
017C	AF03		ADD R15, #$04
017E	3F20		MOVE $40, R15
0180	AF25		ADD R15, #$26
0182	3F30		MOVE $60, R15
0184	105F		CTRL $0, #$5F

			; --- Test F ---
			; Device Address Test
			; This test does a GETB for every device address,
			; errors cause a machine checks (i.e. device address
			; or parity error).
			
0186	8BC6		LBI R11, #'F'
0188	7B50		MOVB (R5)+, R11
018A	0E34		MOVE R14, R3
018C	8BC4		LBI R11, #'D'
018E	7B40		MOVB (R4)+, R11
0190	8BC1		LBI R11, #'A'
0192	7B42		MOVB (R4)+++, R11

0194	8AF0		LBI R10, #'0'
0196	8DFA		LBI R13, #$FA
0198	A003		BRA $019E		; $04(R0)

			; next device
019A	AE03		ADD R14, #$04		; jump increment
019C	AA00		ADD R10, #$01		; next digit

019E	CADA		SNE R10, R13
01A0	8AC1		LBI R10, #'A'		; hex digits after '9'
01A2	7A48		MOVB (R4), R10

01A4	8FFF		LBI R15, #$FF
01A6	00E8		ADD R0, R14		; jump to device to test
01A8	00FE		GETB R15, $0
01AA	F011		BRA $019A
01AC	01FE		GETB R15, $1
01AE	F015		BRA $019A
01B0	02FE		GETB R15, $2
01B2	F019		BRA $019A
01B4	03FE		GETB R15, $3
01B6	F01D		BRA $019A
01B8	04FE		GETB R15, $4
01BA	F021		BRA $019A
01BC	05FE		GETB R15, $5
01BE	F025		BRA $019A
01C0	06FE		GETB R15, $6
01C2	F029		BRA $019A
01C4	07FE		GETB R15, $7
01C6	F02D		BRA $019A
01C8	08FE		GETB R15, $8
01CA	F031		BRA $019A
01CC	09FE		GETB R15, $9
01CE	F035		BRA $019A
01D0	0AFE		GETB R15, $A
01D2	F039		BRA $019A
01D4	0BFE		GETB R15, $B
01D6	F03D		BRA $019A
01D8	0CFE		GETB R15, $C
01DA	F041		BRA $019A
01DC	0DFE		GETB R15, $D
01DE	F045		BRA $019A
01E0	0EFE		GETB R15, $E
01E2	F049		BRA $019A
01E4	0FFE		GETB R15, $F

			; clear message on screen
01E6	8B40		LBI R11, #' '
01E8	0BBD		MLH R11, R11
01EA	5B47		MOVE (R4)--, R11
01EC	5B48		MOVE (R4), R11

			; --- Test G ---
			; Keyboard Test
			
01EE	8BC7		LBI R11, #'G'
01F0	7B50		MOVB (R5)+, R11

01F2	1440		CTRL $4, #$40		; enable int.3 and typamatic
01F4	AF00		ADD R15, #$01
01F6	CF04		SS R15
01F8	F005		BRA $01F4		; small delay
01FA	1442		CTRL $4, #$42		; disable typamatic

			; --- Test H ---
			; Storage Test (05FF to end) and Stuck Key Test
			
01FC	8BC8		LBI R11, #'H'
01FE	7B50		MOVB (R5)+, R11

0200	261F		MOVE R6, $3E
0202	066C		MHL R6, R6
0204	A600		ADD R6, #$01
0206	0A34		MOVE R10, R3
0208	8406		LBI R4, #$06
020A	044D		MLH R4, R4
020C	8400		LBI R4, #$00		; R4=$0600, starting address
020E	8104		LBI R1, #$04
0210	011D		MLH R1, R1
0212	81C4		LBI R1, #$C4
0214	0203		INC2 R2, R0
0216	0014		RET R1			; call memory test routine

			; --- Test J ---
			; Executable ROS initialize
			
0218	8BD1		LBI R11, #'J'
021A	7B50		MOVB (R5)+, R11
021C	351E		MOVE $3C, R5

021E	1FFF		CTRL $F, #$FF		; reset all devices

0220	211F		MOVE R1, $3E
0222	3154		MOVE $A8, R1
0224	3155		MOVE $AA, R1

0226	2180		MOVE R1, $100
0228	3150		MOVE $A0, R1
022A	3158		MOVE $B0, R1

022C	8106		LBI R1, #$06
022E	3167		MOVE $CE, R1

0230	8180		LBI R1, #$80
0232	3151		MOVE $A2, R1

0234	8162		LBI R1, #$62
0236	31FE		MOVE $1FC, R1

0238	8106		LBI R1, #$06
023A	011D		MLH R1, R1
023C	8100		LBI R1, #$00
023E	3156		MOVE $AC, R1

0240	8106		LBI R1, #$06
0242	011D		MLH R1, R1
0244	8131		LBI R1, #$31
0246	3153		MOVE $A6, R1

0248	0E03		INC2 R14, R0
024A	A01F		BRA $026C		; $20(R0)
; ----

024C	8106		LBI R1, #$06
024E	011D		MLH R1, R1
0250	8180		LBI R1, #$80
0252	0014		RET R1
; ----

0254	8100		LBI R1, #$00
0256	011D		MLH R1, R1
0258	8198		LBI R1, #$98
025A	0014		RET R1
; ----

025C	8104		LBI R1, #$04
025E	011D		MLH R1, R1
0260	81B2		LBI R1, #$B2
0262	0014		RET R1
; ----

0264	8102		LBI R1, #$02
0266	011D		MLH R1, R1
0268	81F8		LBI R1, #$F8
026A	0014		RET R1
; ----

026C	8F07		LBI R15, #$07
026E	0FFD		MLH R15, R15
0270	8F00		LBI R15, #$00
0272	3F5F		MOVE $BE, R15

0274	AFBF		ADD R15, #$C0
0276	3F6C		MOVE $D8, R15

0278	AF03		ADD R15, #$04
027A	5EF7		MOVE (R15)--, R14

027C	FF0F		SUB R15, #$10
027E	2E50		MOVE R14, $A0
0280	0EE1		DEC R14, R14
0282	5EF1		MOVE (R15)+, R14
0284	5EF8		MOVE (R15), R14


			; --- Test K ---
			; Executable ROS check (1st half)
			
0286	251E		MOVE R5, $3C
0288	8BD2		LBI R11, #'K'
028A	7B50		MOVB (R5)+, R11
028C	351E		MOVE $3C, R5

028E	8980		LBI R9, #$80		; get status byte 1
0290	E29F		STAT R9, $2
0292	0004		NOP
0294	8A80		LBI R10, #$80
0296	0AAD		MLH R10, R10
0298	8E1F		LBI R14, #$1F
029A	0EED		MLH R14, R14
029C	8EFE		LBI R14, #$FE
029E	C9AE		SNBC R9, R10
02A0	A005		BRA $02A8		; $06(R0)

02A2	280E		MOVE R8, $1C
02A4	0203		INC2 R2, R0
02A6	2056		JMP ($00AC)

			; R12 contains highbyte of Exec ROS size
02A8	0CEC		MHL R12, R14
02AA	AC1F		ADD R12, #$20
02AC	0ECD		MLH R14, R12

			; --- Test L ---
			; Feature ROS check
			
02AE	251E		MOVE R5, $3C
02B0	8BD3		LBI R11, #'L'
02B2	819F		LBI R1, #$9F
02B4	CC1A		SNE R12, R1
02B6	7B50		MOVB (R5)+, R11
02B8	351E		MOVE $3C, R5
02BA	E0AC		SHR R10
02BC	CA03		SZ R10
02BE	F021		BRA $029E		; -> -$22(R0)

			; --- Test M ---
			; Executable ROS check (2nd half)
			
02C0	251E		MOVE R5, $3C
02C2	8BD4		LBI R11, #'M'
02C4	7B50		MOVB (R5)+, R11
02C6	351E		MOVE $3C, R5

02C8	8940		LBI R9, #$40		; get status byte 2
02CA	E29F		STAT R9, $2
02CC	0004		NOP
02CE	0AAC		MHL R10, R10
02D0	C9AE		SNBC R9, R10
02D2	A009		BRA $02DE		; $0A(R0)

02D4	280E		MOVE R8, $1C
02D6	3868		MOVE $D0, R8
02D8	2167		MOVE R1, $CE
02DA	0203		INC2 R2, R0
02DC	0010		DEC2 R0, R1
02DE	0CEC		MHL R12, R14
02E0	AC1F		ADD R12, #$20
02E2	0ECD		MLH R14, R12

			; --- Test N ---
			; Test SORT utility on Feature ROS card
			
02E4	251E		MOVE R5, $3C
02E6	8BD5		LBI R11, #'N'
02E8	819F		LBI R1, #$9F
02EA	CC1A		SNE R12, R1
02EC	7B50		MOVB (R5)+, R11
02EE	351E		MOVE $3C, R5
02F0	E0AC		SHR R10
02F2	CA03		SZ R10
02F4	F025		BRA $02D0		; -> -$26(R0)
02F6	A00B		BRA $0304		; $0C(R0)

02F8	8AFF		LBI R10, #$FF
02FA	3A1D		MOVE $3A, R10
02FC	8402		LBI R4, #$02
02FE	044D		MLH R4, R4
0300	8440		LBI R4, #$40
0302	A009		BRA $030E		; $0A(R0)

			; --- Test P ---
			; Non-Exec ROS content and CRC check
			
0304	241E		MOVE R4, $3C
0306	8BD7		LBI R11, #'P'
0308	7B40		MOVB (R4)+, R11
030A	341E		MOVE $3C, R4

030C	8440		LBI R4, #$40
030E	8E01		LBI R14, #$01
0310	8F80		LBI R15, #$80		; get keyboard status
0312	E4FF		STAT R15, $4
0314	8140		LBI R1, #$40
0316	CF15		SBS R15, R1
0318	BE04		SET R14, #$04
031A	0EED		MLH R14, R14
031C	8E00		LBI R14, #$00
031E	3E52		MOVE $A4, R14

			; print "ROS"
0320	8BD9		LBI R11, #'R'
0322	7B40		MOVB (R4)+, R11
0324	8BD6		LBI R11, #'O'
0326	7B40		MOVB (R4)+, R11
0328	8BE2		LBI R11, #'S'
032A	7B41		MOVB (R4)++, R11
032C	341B		MOVE $36, R4

			; Build IOCB for CRC check at $0100
032E	8301		LBI R3, #$01
0330	033D		MLH R3, R3
0332	8300		LBI R3, #$00		; R3 <- 0100 (address of IOCB)
0334	8E01		LBI R14, #$01
0336	0EED		MLH R14, R14
0338	8E02		LBI R14, #$02		; R14 <- 0102
033A	3E80		MOVE $100, R14		; IOCB_DA=1/_Sub=2
033C	8E40		LBI R14, #$40		; R14 <- 0140
033E	3E81		MOVE $102, R14		; IOCB_Cmd=1/_Flags=40
0340	2E56		MOVE R14, $AC
0342	3E82		MOVE $104, R14		; IOCB_BA <- 0600
0344	8E18		LBI R14, #$18
0346	0EED		MLH R14, R14
0348	8E00		LBI R14, #$00
034A	3E83		MOVE $106, R14		; IOCB_BS <- 1800
034C	2F50		MOVE R15, $A0
034E	3F84		MOVE $108, R15		; IOCB_CI1
0350	3F86		MOVE $10C, R15		; IOCB_Ret

			; Begin with module 40
0352	8640		LBI R6, #$40		; R6 <- xx40
0354	361C		MOVE $38, R6

			; First test ROS addressing
0356	0EF1		DEC R14, R15		; R14 <- FFFF
0358	8F1C		LBI R15, #$1C		; R15 <- 001C
035A	1102		CTRL $1, #$02		; select Common ROS
035C	41F8		PUTB $1, (R15)
035E	41F8		PUTB $1, (R15)		; set address to FFFF
0360	E1DF		STAT R13, $1
0362	E1CF		STAT R12, $1		; get address
0364	CD0C		SNS R13
0366	CC04		SS R12
0368	A011		BRA $037C		; not FFFF --> error

036A	011E		GETB R1, $1
036C	F000		BRA $036D
036E	011E		GETB R1, $1		; get word
0370	E1DF		STAT R13, $1
0372	E1CF		STAT R12, $1		; get autoincremented address
0374	CD0B		SNZ R13
0376	CC03		SZ R12
0378	A001		BRA $037C		; not zero --> error
037A	A009		BRA $0386		; ROS addressing OK

			; Error 01 - ROS addressing error
037C	81F0		LBI R1, #'0'
037E	011D		MLH R1, R1
0380	81F1		LBI R1, #'1'
0382	3186		MOVE $10C, R1
0384	A011		BRA $0398

			; Write ROS module number in R6 to screen
0386	361C		MOVE $38, R6
0388	8105		LBI R1, #$05
038A	011D		MLH R1, R1
038C	811E		LBI R1, #$1E
038E	0203		INC2 R2, R0
0390	0014		RET R1			; Call 051E

			; Do CRC of ROS module
0392	2857		MOVE R8, $AE
0394	0203		INC2 R2, R0
0396	2056		JMP ($00AC)

0398	2686		MOVE R6, $10C		; IOCB_Ret
039A	C60B		SNZ R6
039C	A023		BRA $03C2		; No error, OK

			; ROS error
039E	241B		MOVE R4, $36
03A0	A403		ADD R4, #$04
03A2	8BC5		LBI R11, #'E'
03A4	7B40		MOVB (R4)+, R11
03A6	8BD9		LBI R11, #'R'
03A8	7B40		MOVB (R4)+, R11
03AA	7B42		MOVB (R4)+++, R11
03AC	287D		MOVE R8, $FA
03AE	0203		INC2 R2, R0
03B0	2056		JMP ($00AC)

03B2	2F1C		MOVE R15, $38		; get ROS module number
03B4	8140		LBI R1, #$40
03B6	CF12		SE R15, R1		; don't halt if module 40
03B8	0000		HALT
			; Call AUX IPL
03BA	8105		LBI R1, #$05
03BC	011D		MLH R1, R1
03BE	81B0		LBI R1, #$B0
03C0	0014		RET R1

			; Module CRC ok
03C2	E1EF		STAT R14, $1
03C4	0EED		MLH R14, R14
03C6	E1EF		STAT R14, $1
03C8	3E1F		MOVE $3E, R14		; save current ROS address

03CA	0EE0		DEC2 R14, R14
03CC	2D50		MOVE R13, $A0
03CE	8D1C		LBI R13, #$1C
03D0	41D0		PUTB $1, (R13)+
03D2	41D8		PUTB $1, (R13)		; go back 2 words

03D4	2D1C		MOVE R13, $38
03D6	241B		MOVE R4, $36
03D8	016E		GETB R6, $1
03DA	066D		MLH R6, R6
03DC	0004		NOP
03DE	016E		GETB R6, $1
03E0	C6DA		SNE R6, R13
03E2	A01F		BRA $0404		; $20(R0)

03E4	A403		ADD R4, #$04
03E6	8BC9		LBI R11, #'I'
03E8	7B40		MOVB (R4)+, R11
03EA	8BC4		LBI R11, #'D'
03EC	7B42		MOVB (R4)+++, R11
03EE	8105		LBI R1, #$05
03F0	011D		MLH R1, R1
03F2	811E		LBI R1, #$1E
03F4	0203		INC2 R2, R0
03F6	0014		RET R1

			; Error 08
03F8	341B		MOVE $36, R4
03FA	81F0		LBI R1, #'0'
03FC	011D		MLH R1, R1
03FE	81F8		LBI R1, #'8'
0400	3186		MOVE $10C, R1
0402	F06B		BRA $0398		; -> -$6C(R0)

			; Current module 40 ?
0404	8140		LBI R1, #$40
0406	C612		SE R6, R1
0408	A043		BRA $044E		; No

			; Yes, select Common ROS word address 0BF0
040A	8E0B		LBI R14, #$0B
040C	0EED		MLH R14, R14
040E	8EF0		LBI R14, #$F0		; R14 <- 0BF0
0410	2F50		MOVE R15, $A0
0412	8F1C		LBI R15, #$1C
0414	1102		CTRL $1, #$02		; select Common ROS
0416	41F0		PUTB $1, (R15)+
0418	41F4		PUTB $1, (R15)-
041A	F000		BRA $041B
041C	011E		GETB R1, $1
041E	011D		MLH R1, R1
0420	0004		NOP
0422	011E		GETB R1, $1
0424	316E		MOVE $DC, R1

0426	2E81		MOVE R14, $102
0428	8E08		LBI R14, #$08		; IOCB_Flags=8
042A	3E81		MOVE $102, R14
042C	8E01		LBI R14, #$01
042E	0EED		MLH R14, R14
0430	8E00		LBI R14, #$00
0432	3E83		MOVE $106, R14		; IOCB_BS <- 0100

0434	2857		MOVE R8, $AE
0436	0203		INC2 R2, R0
0438	2056		JMP ($00AC)

			; After module 40 change IOCB for other modules
043A	2E81		MOVE R14, $102
043C	8E40		LBI R14, #$40		; IOCB_Flags=40
043E	3E81		MOVE $102, R14
0440	8E18		LBI R14, #$18
0442	0EED		MLH R14, R14
0444	8E00		LBI R14, #$00
0446	3E83		MOVE $106, R14		; IOCB_BS <- 1800
0448	2F80		MOVE R15, $100
044A	261C		MOVE R6, $38
044C	241B		MOVE R4, $36

044E	2E1F		MOVE R14, $3E		; restore current ROS address
0450	3E84		MOVE $108, R14		; IOCB_CI1

0452	A600		ADD R6, #$01		; increment module number
0454	8140		LBI R1, #$40
0456	C619		SGE R6, R1
0458	A02B		BRA $0486		; $2C(R0)

			; Test whether we're done with the Common ROS
045A	8142		LBI R1, #$42		; last Common ROS module
045C	C612		SE R6, R1
045E	A01D		BRA $047E		; no, do next part

			; Assume BASIC mode
0460	8610		LBI R6, #$10		; module 10
0462	8F08		LBI R15, #$08		; subdevice 8 (BASIC ROS)

			; Test whether APL or BASIC mode
0464	2E52		MOVE R14, $A4
0466	8104		LBI R1, #$04
0468	CE17		SBSH R14, R1
046A	A003		BRA $0470

			; No we're in APL mode
046C	8620		LBI R6, #$20		; module 20
046E	8F04		LBI R15, #$04		; subdevice 4 (APL ROS)

			; Setup new IOCB
0470	3F80		MOVE $100, R15		; IOCB_DA/_Sub
0472	2F50		MOVE R15, $A0
0474	3F84		MOVE $108, R15		; IOCB_CI1 <- 0
0476	8E18		LBI R14, #$18
0478	0EED		MLH R14, R14
047A	8E00		LBI R14, #$00
047C	3E83		MOVE $106, R14		; IOCB_BS <- 1800

			; Loop
047E	8103		LBI R1, #$03
0480	011D		MLH R1, R1
0482	8186		LBI R1, #$86
0484	0014		RET R1			; Jump back
			; ----

0486	8E1C		LBI R14, #$1C
0488	8F34		LBI R15, #$34
048A	C6E2		SE R6, R14
048C	C6FA		SNE R6, R15
048E	A001		BRA $0492		; $02(R0)
0490	F013		BRA $047E		; -> -$14(R0)

0492	2A1D		MOVE R10, $3A
0494	CA04		SS R10
0496	A007		BRA $04A0		; $08(R0)

0498	8102		LBI R1, #$02
049A	011D		MLH R1, R1
049C	81F8		LBI R1, #$F8
049E	0014		RET R1			; Jump to $02F8

			; --- Test Q ---
			; Bring up complete, pass
			; control to BASIC or APL
			
04A0	251E		MOVE R5, $3C		; R14L1
04A2	8BD8		LBI R11, #'Q'
04A4	7B50		MOVB (R5)+, R11
04A6	28FD		MOVE R8, $1FA
04A8	2FFC		MOVE R15, $1F8
04AA	8110		LBI R1, #$10
04AC	CF15		SBS R15, R1
04AE	2056		JMP ($00AC)
04B0	2067		JMP ($00CE)

; ----------

04B2	103F		CTRL $0, #$3F
04B4	8400		LBI R4, #$00
04B6	044D		MLH R4, R4
04B8	8420		LBI R4, #$20
04BA	2655		MOVE R6, $AA
04BC	066C		MHL R6, R6
04BE	A600		ADD R6, #$01
04C0	8A01		LBI R10, #$01
04C2	0AAD		MLH R10, R10
; ----

04C4	8C00		LBI R12, #$00
04C6	0CCD		MLH R12, R12		; R12 <- $0000
04C8	0AC5		AND R10, R12		; R10 <- $00
04CA	0EC4		MOVE R14, R12		; R14 <- $0000
04CC	0F44		MOVE R15, R4
04CE	CC0B		SNZ R12
04D0	7EF8		MOVB (R15), R14
04D2	6DF0		MOVB R13, (R15)+
04D4	CED2		SE R14, R13
04D6	0000		HALT
04D8	CA0B		SNZ R10
04DA	AE00		ADD R14, #$01
04DC	CF03		SZ R15
04DE	F011		BRA $04CE		; -> -$12(R0)

04E0	CA03		SZ R10
04E2	A00D		BRA $04F2		; $0E(R0)

04E4	AE00		ADD R14, #$01
04E6	813F		LBI R1, #$3F
04E8	8D80		LBI R13, #$80
04EA	CF1F		SNBSH R15, R1
04EC	A003		BRA $04F2		; $04(R0)

04EE	CFDF		SNBSH R15, R13
04F0	AE00		ADD R14, #$01
04F2	01FC		MHL R1, R15
04F4	C612		SE R6, R1
04F6	F029		BRA $04CE		; -> -$2A(R0)

04F8	AC7F		ADD R12, #$80
04FA	CA0B		SNZ R10
04FC	0ECC		MHL R14, R12
04FE	CC03		SZ R12
0500	F035		BRA $04CC		; -> -$36(R0)

0502	8101		LBI R1, #$01
0504	CA1F		SNBSH R10, R1
0506	F03B		BRA $04CC		; -> -$3C(R0)

0508	AA03		ADD R10, #$04
050A	00A8		ADD R0, R10
050C	0000		HALT
050E	0000		HALT

0510	8EA9		LBI R14, #$A9
0512	F047		BRA $04CC		; -> -$48(R0)

0514	8ED6		LBI R14, #$D6
0516	F04B		BRA $04CC		; -> -$4C(R0)

0518	8E00		LBI R14, #$00
051A	F04F		BRA $04CC		; -> -$50(R0)

051C	0024		RET R2
; ----

			; Write hex representation of R6 to screen
			
051E	8C0F		LBI R12, #$0F
0520	E06F		SWAP R6
0522	0C65		AND R12, R6
0524	8109		LBI R1, #$09
0526	CC10		SLE R12, R1
0528	ACC6		ADD R12, #$C7
052A	ACEF		ADD R12, #$F0
052C	7C40		MOVB (R4)+, R12
052E	8101		LBI R1, #$01
0530	C416		SBC R4, R1
0532	F015		BRA $051E		; -> -$16(R0)

0534	0024		RET R2
; ----

0536	84F1		LBI R4, #$F1
0538	A001		BRA $053C		; $02(R0)

053A	84F2		LBI R4, #$F2
053C	103F		CTRL $0, #$3F		; Disable interrupts
053E	251E		MOVE R5, $3C
0540	8540		LBI R5, #$40
0542	8BC9		LBI R11, #'I'
0544	7B50		MOVB (R5)+, R11
0546	8BD5		LBI R11, #'N'
0548	7B50		MOVB (R5)+, R11
054A	8BE3		LBI R11, #'T'
054C	7B50		MOVB (R5)+, R11
054E	8BD9		LBI R11, #'R'
0550	7B51		MOVB (R5)++, R11
0552	7451		MOVB (R5)++, R4
0554	8BC5		LBI R11, #'E'
0556	7B50		MOVB (R5)+, R11
0558	8BD9		LBI R11, #'R'
055A	7B50		MOVB (R5)+, R11
055C	7B58		MOVB (R5), R11
055E	0000		HALT			; Error halt

0560	103F		CTRL $0, #$3F		; Disable interrupts
0562	241E		MOVE R4, $3C
0564	8440		LBI R4, #$40
0566	8BD2		LBI R11, #'K'
0568	7B40		MOVB (R4)+, R11
056A	8BC5		LBI R11, #'E'
056C	7B40		MOVB (R4)+, R11
056E	8BE8		LBI R11, #'Y'
0570	7B41		MOVB (R4)++, R11
0572	8F40		LBI R15, #$40
0574	E4FF		STAT R15, $4
0576	06F4		MOVE R6, R15
0578	0203		INC2 R2, R0
057A	F05D		BRA $051E		; Call $051E,R2

			; Get scancode->EBCDIC table
057C	A401		ADD R4, #$02
057E	8E0B		LBI R14, #$0B
0580	0EED		MLH R14, R14
0582	8EF0		LBI R14, #$F0
0584	1102		CTRL $1, #$02		; Select Common ROS
0586	8D7C		LBI R13, #$7C		; R14L3
0588	41D0		PUTB $1, (R13)+
058A	41D4		PUTB $1, (R13)-
058C	F000		BRA $058D
058E	01EE		GETB R14, $1
0590	0EED		MLH R14, R14
0592	0004		NOP
0594	01EE		GETB R14, $1

			; Get character matching scancode
0596	2C50		MOVE R12, $A0
0598	0CF6		OR R12, R15
059A	E0CC		SHR R12
059C	0EC8		ADD R14, R12
059E	41D0		PUTB $1, (R13)+
05A0	41D8		PUTB $1, (R13)
05A2	F000		BRA $05A3
05A4	016E		GETB R6, $1
05A6	8101		LBI R1, #$01
05A8	CF16		SBC R15, R1
05AA	016E		GETB R6, $1
05AC	7648		MOVB (R4), R6
05AE	0000		HALT			; Error halt

05B0	2F1E		MOVE R15, $3C		; R14L1
05B2	8F80		LBI R15, #$80
05B4	8BC1		LBI R11, #'A'
05B6	7BF0		MOVB (R15)+, R11
05B8	8BE4		LBI R11, #'U'
05BA	7BF0		MOVB (R15)+, R11
05BC	8BE7		LBI R11, #'X'
05BE	7BF1		MOVB (R15)++, R11
05C0	8BC9		LBI R11, #'I'
05C2	7BF0		MOVB (R15)+, R11
05C4	8BD7		LBI R11, #'P'
05C6	7BF0		MOVB (R15)+, R11
05C8	8BD3		LBI R11, #'L'
05CA	7BF0		MOVB (R15)+, R11

05CC	8120		LBI R1, #$20
05CE	011D		MLH R1, R1
05D0	3158		MOVE $B0, R1

05D2	287C		MOVE R8, $F8
05D4	0883		INC2 R8, R8
05D6	2056		JMP ($00AC)

05D8	0000		HALT
...
05FE	0000		HALT
; ----------

0600	8101		LBI R1, #$01
0602	C815		SBS R8, R1
0604	0084		RET R8

0606	0881		DEC R8, R8
0608	103B		CTRL $0, #$3B
060A	2152		MOVE R1, $A4
060C	9180		CLR R1, #$80
060E	3152		MOVE $A4, R1
0610	105F		CTRL $0, #$5F
0612	0084		RET R8

0614	0000		HALT
...
061E	0000		HALT

0620	8100		LBI R1, #$00
0622	011D		MLH R1, R1
0624	81A5		LBI R1, #$A5
0626	4018		PUTB $0, (R1)
0628	0084		RET R8

062A	0000		HALT
...
067E	0000		HALT
; ----------

; ******************************************
; Device 1 (Common/Language ROS) I/O Routine
; ******************************************

0680	1443		CTRL $4, #$43		; disable interrupt 3

0682	DE38		MOVE R14, (R3)		; IOCB_DA/_Sub
0684	0533		INC2 R5, R3
0686	D651		MOVE R6, (R5)+		; IOCB_Cmd/_Flags
0688	D451		MOVE R4, (R5)+		; IOCB_BA
068A	8120		LBI R1, #$20
068C	C616		SBC R6, R1
068E	0344		MOVE R3, R4

0690	DC51		MOVE R12, (R5)+		; IOCB_BS
			; negate R12
0692	0FCC		MHL R15, R12
0694	81FF		LBI R1, #$FF
0696	0C17		XOR R12, R1
0698	0F17		XOR R15, R1
069A	0CFD		MLH R12, R15
069C	AC00		ADD R12, #$01

069E	8B80		LBI R11, #$80
06A0	8DF1		LBI R13, #'1'
06A2	0DDD		MLH R13, R13
06A4	8DF4		LBI R13, #'4'

			; Test for valid subdevice address
06A6	1108		CTRL $1, #$08		; select BASIC ROS (addr 8)
06A8	8108		LBI R1, #$08
06AA	CE1A		SNE R14, R1
06AC	A00F		BRA $06BE
06AE	1104		CTRL $1, #$04		; select APL ROS (addr 4)
06B0	8104		LBI R1, #$04
06B2	CE1A		SNE R14, R1
06B4	A007		BRA $06BE
06B6	1102		CTRL $1, #$02		; select Common ROS (addr 2)
06B8	8102		LBI R1, #$02
06BA	CE12		SE R14, R1
06BC	A03D		BRA $06FC		; error 14 (subdevice error)

06BE	4150		PUTB $1, (R5)+		; IOCB_CI1
06C0	4154		PUTB $1, (R5)-
06C2	8DF0		LBI R13, #'0'
06C4	0DDD		MLH R13, R13
06C6	8DF2		LBI R13, #'2'

06C8	0F6C		MHL R15, R6
06CA	8101		LBI R1, #$01
06CC	CF12		SE R15, R1
06CE	A035		BRA $0706		; not command 1

			; Command 1
06D0	2950		MOVE R9, $A0		; reset CRC to 0
06D2	8508		LBI R5, #$08
06D4	C655		SBS R6, R5
06D6	0991		DEC R9, R9		; .. or to FFFF
06D8	8D40		LBI R13, #$40

06DA	01AE		GETB R10, $1
06DC	C6D5		SBS R6, R13
06DE	7A40		MOVB (R4)+, R10		; copy ROS to RWS
06E0	AC00		ADD R12, #$01
06E2	0803		INC2 R8, R0
06E4	C655		SBS R6, R5
06E6	A043		BRA $072C		; Call CRC routine
06E8	CCBF		SNBSH R12, R11
06EA	F011		BRA $06DA		; loop over ROS

			; finished
06EC	8120		LBI R1, #$20		; Loop CRC test?
06EE	C616		SBC R6, R1		; no
06F0	F071		BRA $0680		; yes

06F2	019C		MHL R1, R9
06F4	0196		OR R1, R9
06F6	C10B		SNZ R1
06F8	A007		BRA $0702		; no error

			; Error 07
06FA	8DF7		LBI R13, #'7'

			; Put error code into IOCB
06FC	0534		MOVE R5, R3
06FE	A50B		ADD R5, #$0C		; IOCB_Ret
0700	5D58		MOVE (R5), R13

			; Return to caller
0702	0824		MOVE R8, R2
0704	2056		JMP ($00AC)
			; ----

0706	8102		LBI R1, #$02
0708	CF12		SE R15, R1
070A	F005		BRA $0706 (?? perhaps $0702 ??)

			; Command 2
070C	106F		CTRL $0, #$6F		; Display off

070E	1188		CTRL $1, #$88		; select BASIC ROS and ???
0710	8108		LBI R1, #$08
0712	CE1A		SNE R14, R1
0714	A009		BRA $0720		; $0A(R0)
0716	1184		CTRL $1, #$84		; select APL ROS and ???
0718	8104		LBI R1, #$04
071A	CE1A		SNE R14, R1
071C	A001		BRA $0720		; $02(R0)
071E	1182		CTRL $1, #$82		; select Common ROS and ???
0720	4140		PUTB $1, (R4)+
0722	AC00		ADD R12, #$01
0724	CCBF		SNBSH R12, R11
0726	F007		BRA $0720		; -> -$08(R0)

0728	1077		CTRL $0, #$77		; Display on
072A	F029		BRA $0702		; return
			; ----

			; "Add" byte in R10 to CRC in R9
072C	0E9C		MHL R14, R9
072E	0EA7		XOR R14, R10
0730	01E4		MOVE R1, R14
0732	0FE4		MOVE R15, R14
0734	E0FF		SWAP R15
0736	0EF7		XOR R14, R15
0738	9E0F		CLR R14, #$0F
073A	0E97		XOR R14, R9
073C	0914		MOVE R9, R1
073E	9FF0		CLR R15, #$F0
0740	09F7		XOR R9, R15
0742	E01E		ROR3 R1
0744	0F14		MOVE R15, R1
0746	9FE0		CLR R15, #$E0
0748	0EF7		XOR R14, R15
074A	911F		CLR R1, #$1F
074C	0917		XOR R9, R1
074E	E0FF		SWAP R15
0750	01F4		MOVE R1, R15
0752	9F1F		CLR R15, #$1F
0754	09F7		XOR R9, R15
0756	91FE		CLR R1, #$FE
0758	0E17		XOR R14, R1
075A	09ED		MLH R9, R14

075C	0083		INC2 R0, R8
; ----------


075E	0000		HALT
...

; ----------

			; Put address of HOLD routine into location $FC
0800	810C		LBI R1, #$0C
0802	011D		MLH R1, R1
0804	814A		LBI R1, #$4A
0806	317E		MOVE $FC, R1		; $FC <- $0C4A

0808	2450		MOVE R4, $A0
080A	0303		INC2 R3, R0		; Point R3 to kbd. int.
080C	A001		BRA $0810

; Keyboard interrupt

080E	1402		CTRL $4, #$02		; Reset int. 3

0810	8480		LBI R4, #$80
0812	E44F		STAT R4, $4		; Get keyboard status
0814	0D4D		MLH R13, R4
0816	8108		LBI R1, #$08
0818	C416		SBC R4, R1		; Key pending ?
081A	A02B		BRA $0848		; yes

081C	216C		MOVE R1, $D8		; Supervisor vector table
081E	A111		ADD R1, #$12		; User vector for keyboard int.
0820	D818		MOVE R8, (R1)
0822	018C		MHL R1, R8
0824	C10B		SNZ R1
0826	A011		BRA $083A		; No user vector

			; User vector set
0828	9801		CLR R8, #$01
082A	2152		MOVE R1, $A4
082C	B110		SET R1, #$10		; Level 3 RWS
082E	3152		MOVE $A4, R1
0830	2156		MOVE R1, $AC
0832	A11F		ADD R1, #$20
0834	0203		INC2 R2, R0
0836	0014		RET R1			; Call user vector
0838	F039		BRA $0800		; Loop

			; No vector
083A	2A52		MOVE R10, $A4
083C	01AC		MHL R1, R10
083E	B110		SET R1, #$10		; Kbd int. without key pending
0840	01AD		MLH R1, R10
0842	3A52		MOVE $A4, R10

0844	1F04		CTRL $F, #$04		; Reset address $B (?)
0846	0033		INC2 R0, R3		; Loop
; ----------

			; Key pending

0848	107D		CTRL $0, #$7D		; Turn off alarm
084A	8440		LBI R4, #$40
084C	E44F		STAT R4, $4		; Scancode

084E	2558		MOVE R5, $B0		; Previous code to R5
0850	2752		MOVE R7, $A4
0852	2651		MOVE R6, $A2
0854	2850		MOVE R8, $A0
0856	095C		MHL R9, R5
0858	81C0		LBI R1, #$C0
085A	C91E		SNBC R9, R1
085C	A007		BRA $0866		; $08(R0)

			; Already in Cmd-HOLD state
085E	810A		LBI R1, #$0A
0860	011D		MLH R1, R1
0862	81C8		LBI R1, #$C8
0864	0014		RET R1			; Jump to $0AC8
; ----

0866	890F		LBI R9, #$0F
0868	0945		AND R9, R4
086A	8106		LBI R1, #$06		; HOLD or ATTN ?
086C	C912		SE R9, R1
086E	A02B		BRA $089C		; No

0870	8176		LBI R1, #$76		; HOLD key pressd ?
0872	C410		SLE R4, R1
0874	A007		BRA $087E		; No, so must be ATTN

			; HOLD key
0876	810A		LBI R1, #$0A
0878	011D		MLH R1, R1
087A	815C		LBI R1, #$5C
087C	0014		RET R1			; Jump to $0A5C
			; returns to R3
; ----

			; ATTN key
087E	89B6		LBI R9, #$B6		; Set R9 to ATTN scancode
0880	8140		LBI R1, #$40
0882	C616		SBC R6, R1
0884	C498		SGT R4, R9
0886	A001		BRA $088A		; $02(R0)
0888	A04B		BRA $08D6		; $4C(R0)

088A	8180		LBI R1, #$80
088C	C616		SBC R6, R1
088E	C491		SLT R4, R9
0890	A001		BRA $0894		; $02(R0)
0892	A053		BRA $08E8		; $54(R0)

0894	C499		SGE R4, R9
0896	8808		LBI R8, #$08
0898	C490		SLE R4, R9
089A	8804		LBI R8, #$04



089C	8101		LBI R1, #$01		; Translate scancode ?
089E	C716		SBC R7, R1
08A0	A083		BRA $0926		; Yes

			; Don't translate scancode
08A2	0544		MOVE R5, R4
08A4	058D		MLH R5, R8
08A6	3558		MOVE $B0, R5		; Store scancode to $B0
08A8	81B6		LBI R1, #$B6		; ATTN ?
08AA	C912		SE R9, R1
08AC	0034		RET R3			; No, return

08AE	017C		MHL R1, R7
08B0	B180		SET R1, #$80
08B2	071D		MLH R7, R1
08B4	3752		MOVE $A4, R7

08B6	8104		LBI R1, #$04
08B8	C717		SBSH R7, R1
08BA	0034		RET R3

08BC	2AFE		MOVE R10, $1FC
08BE	61A8		MOVB R1, (R10)
08C0	B180		SET R1, #$80
08C2	71A8		MOVB (R10), R1

08C4	C498		SGT R4, R9
08C6	0034		RET R3

08C8	2BFF		MOVE R11, $1FE
08CA	0ABC		MHL R10, R11
08CC	810A		LBI R1, #$0A
08CE	0B1D		MLH R11, R1
08D0	CA12		SE R10, R1
08D2	3BFF		MOVE $1FE, R11
08D4	0034		RET R3

08D6	5EF8		MOVE (R15), R14
08D8	9640		CLR R6, #$40
08DA	3651		MOVE $A2, R6
08DC	2150		MOVE R1, $A0
08DE	3100		MOVE $00, R1
08E0	1077		CTRL $0, #$77
08E2	1402		CTRL $4, #$02
08E4	3F00		MOVE $00, R15
08E6	0034		RET R3

08E8	2A5F		MOVE R10, $BE
08EA	FA0F		SUB R10, #$10
08EC	8B01		LBI R11, #$01
08EE	0BBD		MLH R11, R11
08F0	8BF0		LBI R11, #$F0
08F2	D1B1		MOVE R1, (R11)+
08F4	51A1		MOVE (R10)+, R1
08F6	CA03		SZ R10
08F8	F007		BRA $08F2		; -> -$08(R0)

08FA	2B50		MOVE R11, $A0
08FC	D1B1		MOVE R1, (R11)+
08FE	51A1		MOVE (R10)+, R1
0900	8120		LBI R1, #$20
0902	CB12		SE R11, R1
0904	F009		BRA $08FC		; -> -$0A(R0)

0906	8140		LBI R1, #$40
0908	C616		SBC R6, R1
090A	5EF8		MOVE (R15), R14
090C	1FDF		CTRL $F, #$DF
090E	8680		LBI R6, #$80
0910	3651		MOVE $A2, R6
0912	127F		CTRL $2, #$7F
0914	8101		LBI R1, #$01
0916	071D		MLH R7, R1
0918	970E		CLR R7, #$0E
091A	3752		MOVE $A4, R7
091C	217C		MOVE R1, $F8
091E	3108		MOVE $10, R1
0920	2156		MOVE R1, $AC
0922	3100		MOVE $00, R1
0924	0034		RET R3

0926	8101		LBI R1, #$01
0928	CD15		SBS R13, R1
092A	A00F		BRA $093C		; $10(R0)

092C	8191		LBI R1, #$91
092E	C41A		SNE R4, R1
0930	A0F9		BRA $0A2C		; $FA(R0)

0932	8195		LBI R1, #$95
0934	C412		SE R4, R1
0936	A003		BRA $093C		; $04(R0)

0938	B680		SET R6, #$80
093A	9D01		CLR R13, #$01
093C	812F		LBI R1, #$2F
093E	C51A		SNE R5, R1
0940	0034		RET R3

0942	296E		MOVE R9, $DC
0944	8101		LBI R1, #$01
0946	C617		SBSH R6, R1
0948	A005		BRA $0950		; $06(R0)

094A	0948		ADD R9, R4
094C	6598		MOVB R5, (R9)
094E	A00F		BRA $0960		; $10(R0)

0950	0A44		MOVE R10, R4
0952	E0AC		SHR R10
0954	09A8		ADD R9, R10
0956	0203		INC2 R2, R0
0958	A0BB		BRA $0A16		; $BC(R0)

095A	8101		LBI R1, #$01
095C	C415		SBS R4, R1
095E	055C		MHL R5, R5
0960	8140		LBI R1, #$40
0962	C511		SLT R5, R1
0964	B802		SET R8, #$02
0966	8138		LBI R1, #$38
0968	C41A		SNE R4, R1
096A	9802		CLR R8, #$02
096C	81D7		LBI R1, #$D7
096E	8A47		LBI R10, #$47
0970	C412		SE R4, R1
0972	C4AA		SNE R4, R10
0974	9802		CLR R8, #$02
0976	81DE		LBI R1, #$DE
0978	8A4E		LBI R10, #$4E
097A	C412		SE R4, R1
097C	C4AA		SNE R4, R10
097E	9802		CLR R8, #$02
0980	81DF		LBI R1, #$DF
0982	8A4F		LBI R10, #$4F
0984	C412		SE R4, R1
0986	C4AA		SNE R4, R10
0988	9802		CLR R8, #$02
098A	8101		LBI R1, #$01
098C	C61F		SNBSH R6, R1
098E	A055		BRA $09E6		; $56(R0)

0990	8120		LBI R1, #$20
0992	C616		SBC R6, R1
0994	A01B		BRA $09B2		; $1C(R0)

0996	8154		LBI R1, #$54
0998	8A55		LBI R10, #$55
099A	C512		SE R5, R1
099C	C5AA		SNE R5, R10
099E	8500		LBI R5, #$00
09A0	8102		LBI R1, #$02
09A2	C816		SBC R8, R1
09A4	A00B		BRA $09B2		; $0C(R0)

09A6	8144		LBI R1, #$44
09A8	C51A		SNE R5, R1
09AA	852C		LBI R5, #$2C
09AC	8147		LBI R1, #$47
09AE	C51A		SNE R5, R1
09B0	852D		LBI R5, #$2D
09B2	8104		LBI R1, #$04
09B4	C617		SBSH R6, R1
09B6	A00B		BRA $09C4		; $0C(R0)

09B8	81D7		LBI R1, #$D7
09BA	C41A		SNE R4, R1
09BC	8544		LBI R5, #$44
09BE	8147		LBI R1, #$47
09C0	C41A		SNE R4, R1
09C2	8547		LBI R5, #$47
09C4	8102		LBI R1, #$02
09C6	8A01		LBI R10, #$01
09C8	C815		SBS R8, R1
09CA	CDA7		SBSH R13, R10
09CC	A017		BRA $09E6		; $18(R0)

09CE	812C		LBI R1, #$2C
09D0	8A2D		LBI R10, #$2D
09D2	C512		SE R5, R1
09D4	C5AA		SNE R5, R10
09D6	A001		BRA $09DA		; $02(R0)

09D8	A00B		BRA $09E6		; $0C(R0)

09DA	3558		MOVE $B0, R5
09DC	2873		MOVE R8, $E6
09DE	0203		INC2 R2, R0
09E0	2056		JMP ($00AC)

09E2	0004		NOP
09E4	0034		RET R3

09E6	C50B		SNZ R5
09E8	0034		RET R3

09EA	058D		MLH R5, R8
09EC	3558		MOVE $B0, R5
09EE	3651		MOVE $A2, R6
09F0	8140		LBI R1, #$40
09F2	C51A		SNE R5, R1
09F4	A013		BRA $0A0A		; $14(R0)

09F6	8102		LBI R1, #$02
09F8	8A37		LBI R10, #$37
09FA	C517		SBSH R5, R1
09FC	C5A9		SGE R5, R10
09FE	0034		RET R3

0A00	8104		LBI R1, #$04
0A02	C617		SBSH R6, R1
0A04	8A3A		LBI R10, #$3A
0A06	C5A9		SGE R5, R10
0A08	0034		RET R3

0A0A	1440		CTRL $4, #$40
0A0C	8A19		LBI R10, #$19
0A0E	FA00		SUB R10, #$01
0A10	CA03		SZ R10
0A12	F005		BRA $0A0E		; Delay

0A14	0034		RET R3
; ----

; Read word at word address in R9L3 from Common ROS into R5
; Return address in R2

0A16	1102		CTRL $1, #$02		; Select Common ROS
0A18	2A50		MOVE R10, $A0
0A1A	8A72		LBI R10, #$72		; Word address in R9L3
0A1C	41A0		PUTB $1, (R10)+
0A1E	41A4		PUTB $1, (R10)-
0A20	F000		BRA $0A21

0A22	015E		GETB R5, $1		; Get high byte
0A24	055D		MLH R5, R5
0A26	0004		NOP
0A28	015E		GETB R5, $1		; Get low byte

0A2A	0024		RET R2
; ----

0A2C	295F		MOVE R9, $BE
0A2E	F90F		SUB R9, #$10
0A30	8801		LBI R8, #$01
0A32	088D		MLH R8, R8
0A34	88F0		LBI R8, #$F0
0A36	D191		MOVE R1, (R9)+
0A38	5181		MOVE (R8)+, R1
0A3A	C903		SZ R9
0A3C	F007		BRA $0A36		; -> -$08(R0)

0A3E	2850		MOVE R8, $A0
0A40	D191		MOVE R1, (R9)+
0A42	5181		MOVE (R8)+, R1
0A44	8120		LBI R1, #$20
0A46	C812		SE R8, R1
0A48	F009		BRA $0A40		; -> -$0A(R0)

0A4A	8180		LBI R1, #$80
0A4C	CD1E		SNBC R13, R1
0A4E	12BF		CTRL $2, #$BF
0A50	8180		LBI R1, #$80
0A52	CC16		SBC R12, R1
0A54	107B		CTRL $0, #$7B
0A56	3C52		MOVE $A4, R12
0A58	9D01		CLR R13, #$01
0A5A	0034		RET R3
; ----

; HOLD

0A5C	8116		LBI R1, #$16		; Cmd-HOLD ?
0A5E	C41A		SNE R4, R1
0A60	A017		BRA $0A7A		; Yes

0A62	8101		LBI R1, #$01		; CRT on ?
0A64	C717		SBSH R7, R1
0A66	A00B		BRA $0A74		; No

0A68	8102		LBI R1, #$02		; I/O active ?
0A6A	C71F		SNBSH R7, R1
0A6C	A005		BRA $0A74		; Yes

0A6E	8102		LBI R1, #$02
0A70	C615		SBS R6, R1
0A72	A005		BRA $0A7A		; $06(R0)

0A74	B610		SET R6, #$10
0A76	3651		MOVE $A2, R6

0A78	0034		RET R3
; ----

; Cmd-HOLD

0A7A	8102		LBI R1, #$02		; I/O active ?
0A7C	C71F		SNBSH R7, R1
0A7E	1FDF		CTRL $F, #$DF		; Yes, reset all except kbd.

0A80	015C		MHL R1, R5
0A82	B180		SET R1, #$80		; Flag for Cmd-HOLD
0A84	051D		MLH R5, R1
0A86	3558		MOVE $B0, R5

			; Save registers from level 0
0A88	2850		MOVE R8, $A0
0A8A	295F		MOVE R9, $BE
0A8C	A91F		ADD R9, #$20
0A8E	8A20		LBI R10, #$20
0A90	D181		MOVE R1, (R8)+
0A92	5191		MOVE (R9)+, R1
0A94	C8A2		SE R8, R10
0A96	F007		BRA $0A90

0A98	217E		MOVE R1, $FC		; Put address of HOLD routine
0A9A	3100		MOVE $00, R1		; into R0L0

0A9C	8101		LBI R1, #$01
0A9E	CD16		SBC R13, R1
0AA0	A021		BRA $0AC4		; $22(R0)

0AA2	0C74		MOVE R12, R7
0AA4	01CC		MHL R1, R12
0AA6	9102		CLR R1, #$02		; Clear I/O active
0AA8	0C1D		MLH R12, R1
0AAA	9C0E		CLR R12, #$0E		; Clear prt. status etc.

0AAC	8110		LBI R1, #$10		; Level 3 RWS ?
0AAE	C716		SBC R7, R1
0AB0	A005		BRA $0AB8		; Yes

0AB2	8180		LBI R1, #$80		; Level 0 RWS ?
0AB4	C716		SBC R7, R1
0AB6	107B		CTRL $0, #$7B		; Yes, switch to ROS

0AB8	9D80		CLR R13, #$80
0ABA	8520		LBI R5, #$20
0ABC	E25F		STAT R5, $2		; ???
0ABE	957F		CLR R5, #$7F
0AC0	0D56		OR R13, R5
0AC2	127F		CTRL $2, #$7F		; ???

0AC4	1446		CTRL $4, #$46		; Enable interrupt
0AC6	0034		RET R3
; ----

; Cmd-HOLD active

0AC8	8180		LBI R1, #$80
0ACA	C916		SBC R9, R1
0ACC	A009		BRA $0AD8		; $0A(R0)

0ACE	8D80		LBI R13, #$80
0AD0	B980		SET R9, #$80
0AD2	059D		MLH R5, R9
0AD4	3558		MOVE $B0, R5
0AD6	0C74		MOVE R12, R7

0AD8	8102		LBI R1, #$02
0ADA	C616		SBC R6, R1
0ADC	F019		BRA $0AC4		; -> -$1A(R0)

0ADE	8189		LBI R1, #$89
0AE0	8916		LBI R9, #$16
0AE2	C41E		SNBC R4, R1
0AE4	C495		SBS R4, R9
0AE6	A001		BRA $0AEA		; $02(R0)

0AE8	A02B		BRA $0B16		; $2C(R0)

0AEA	8193		LBI R1, #$93
0AEC	C41A		SNE R4, R1
0AEE	A05B		BRA $0B4C		; $5C(R0)

0AF0	81B7		LBI R1, #$B7
0AF2	C41A		SNE R4, R1
0AF4	A09B		BRA $0B92		; $9C(R0)

0AF6	8197		LBI R1, #$97
0AF8	C41A		SNE R4, R1
0AFA	A0A3		BRA $0BA0		; $A4(R0)

0AFC	8901		LBI R9, #$01
0AFE	C697		SBSH R6, R9
0B00	C79E		SNBC R7, R9
0B02	F03F		BRA $0AC4		; -> -$40(R0)

0B04	814E		LBI R1, #$4E
0B06	C41A		SNE R4, R1
0B08	A0BD		BRA $0BC8		; $BE(R0)

0B0A	8120		LBI R1, #$20
0B0C	8A10		LBI R10, #$10
0B0E	C41E		SNBC R4, R1
0B10	C4A5		SBS R4, R10
0B12	F04F		BRA $0AC4		; -> -$50(R0)

0B14	A0B1		BRA $0BC8		; $B2(R0)

0B16	144A		CTRL $4, #$4A
0B18	2850		MOVE R8, $A0
0B1A	295F		MOVE R9, $BE
0B1C	A91F		ADD R9, #$20
0B1E	8A20		LBI R10, #$20
0B20	D191		MOVE R1, (R9)+
0B22	5181		MOVE (R8)+, R1
0B24	C8A2		SE R8, R10
0B26	F007		BRA $0B20		; -> -$08(R0)

0B28	0203		INC2 R2, R0
0B2A	A083		BRA $0BB0		; $84(R0)

0B2C	2150		MOVE R1, $A0
0B2E	3158		MOVE $B0, R1
0B30	8901		LBI R9, #$01
0B32	CD96		SBC R13, R9
0B34	0034		RET R3

0B36	3C52		MOVE $A4, R12
0B38	8990		LBI R9, #$90
0B3A	CC9D		SNBS R12, R9
0B3C	0034		RET R3

0B3E	8980		LBI R9, #$80
0B40	CC96		SBC R12, R9
0B42	107B		CTRL $0, #$7B
0B44	8180		LBI R1, #$80
0B46	CD1E		SNBC R13, R1
0B48	12BF		CTRL $2, #$BF
0B4A	0034		RET R3

; ******************************
; Einsprung in das DCP
; ******************************

0B4C	0203		INC2 R2, R0
0B4E	A05F		BRA $0BB0		; $60(R0)

0B50	8901		LBI R9, #$01
0B52	CD96		SBC R13, R9
0B54	A02B		BRA $0B82		; $2C(R0)

0B56	8101		LBI R1, #$01
0B58	C716		SBC R7, R1
0B5A	BD01		SET R13, #$01
0B5C	8680		LBI R6, #$80
0B5E	CD9E		SNBC R13, R9
0B60	3651		MOVE $A2, R6

			; Sichere Bereich ab $01F0
0B62	295F		MOVE R9, $BE
0B64	F90F		SUB R9, #$10
0B66	8801		LBI R8, #$01
0B68	088D		MLH R8, R8
0B6A	88F0		LBI R8, #$F0
0B6C	D181		MOVE R1, (R8)+
0B6E	5191		MOVE (R9)+, R1
0B70	C903		SZ R9
0B72	F007		BRA $0B6C		; -> -$08(R0)

			; Lo(R9) ist beim ersten Eintreten gleich 0

0B74	0894		MOVE R8, R9
0B76	A81F		ADD R8, #$20
0B78	0A84		MOVE R10, R8
0B7A	D181		MOVE R1, (R8)+
0B7C	5191		MOVE (R9)+, R1
0B7E	C9A2		SE R9, R10
0B80	F007		BRA $0B7A		; -> -$08(R0)

0B82	8110		LBI R1, #$10
0B84	011D		MLH R1, R1
0B86	8100		LBI R1, #$00
0B88	317C		MOVE $F8, R1		; ($F8) <- $1000
0B8A	3108		MOVE $10, R1		; R8L0 <- $1000
0B8C	2156		MOVE R1, $AC
0B8E	3100		MOVE $00, R1		; R0L0 <- ($AC)
0B90	0034		RET R3
; ----------

0B92	2160		MOVE R1, $C0
0B94	3108		MOVE $10, R1
0B96	2156		MOVE R1, $AC
0B98	3100		MOVE $00, R1
0B9A	2150		MOVE R1, $A0
0B9C	3102		MOVE $04, R1
0B9E	0034		RET R3
; ----------

0BA0	2100		MOVE R1, $00
0BA2	3102		MOVE $04, R1
0BA4	217F		MOVE R1, $FE
0BA6	0113		INC2 R1, R1
0BA8	3108		MOVE $10, R1
0BAA	2156		MOVE R1, $AC
0BAC	3100		MOVE $00, R1
0BAE	0034		RET R3

0BB0	8805		LBI R8, #$05
0BB2	088D		MLH R8, R8
0BB4	88C0		LBI R8, #$C0
0BB6	0A84		MOVE R10, R8
0BB8	AA1F		ADD R10, #$20
0BBA	295F		MOVE R9, $BE
0BBC	A93F		ADD R9, #$40
0BBE	D191		MOVE R1, (R9)+
0BC0	5181		MOVE (R8)+, R1
0BC2	C8A9		SGE R8, R10
0BC4	F007		BRA $0BBE		; -> -$08(R0)

0BC6	0024		RET R2

0BC8	88FF		LBI R8, #$FF
0BCA	81DE		LBI R1, #$DE
0BCC	C41A		SNE R4, R1
0BCE	880C		LBI R8, #$0C
0BD0	814E		LBI R1, #$4E
0BD2	C41A		SNE R4, R1
0BD4	880D		LBI R8, #$0D
0BD6	8118		LBI R1, #$18
0BD8	C41A		SNE R4, R1
0BDA	8800		LBI R8, #$00
0BDC	8158		LBI R1, #$58
0BDE	C41A		SNE R4, R1
0BE0	8820		LBI R8, #$20
0BE2	815A		LBI R1, #$5A
0BE4	C41A		SNE R4, R1
0BE6	88E0		LBI R8, #$E0
0BE8	81D8		LBI R1, #$D8
0BEA	C41A		SNE R4, R1
0BEC	88D0		LBI R8, #$D0
0BEE	811A		LBI R1, #$1A
0BF0	C41A		SNE R4, R1
0BF2	88C0		LBI R8, #$C0
0BF4	815C		LBI R1, #$5C
0BF6	C41A		SNE R4, R1
0BF8	88B0		LBI R8, #$B0
0BFA	81DA		LBI R1, #$DA
0BFC	C41A		SNE R4, R1
0BFE	88A0		LBI R8, #$A0
0C00	811C		LBI R1, #$1C
0C02	C41A		SNE R4, R1
0C04	8890		LBI R8, #$90
0C06	815E		LBI R1, #$5E
0C08	C41A		SNE R4, R1
0C0A	8880		LBI R8, #$80
0C0C	81DC		LBI R1, #$DC
0C0E	C41A		SNE R4, R1
0C10	8870		LBI R8, #$70
0C12	811E		LBI R1, #$1E
0C14	C41A		SNE R4, R1
0C16	8860		LBI R8, #$60
0C18	819E		LBI R1, #$9E
0C1A	C41A		SNE R4, R1
0C1C	8850		LBI R8, #$50
0C1E	819C		LBI R1, #$9C
0C20	C41A		SNE R4, R1
0C22	8840		LBI R8, #$40
0C24	819A		LBI R1, #$9A
0C26	C41A		SNE R4, R1
0C28	8830		LBI R8, #$30
0C2A	8198		LBI R1, #$98
0C2C	C41A		SNE R4, R1
0C2E	8810		LBI R8, #$10
0C30	C80C		SNS R8
0C32	0034		RET R3

0C34	8500		LBI R5, #$00
0C36	0586		OR R5, R8
0C38	3558		MOVE $B0, R5
0C3A	2873		MOVE R8, $E6
0C3C	0203		INC2 R2, R0
0C3E	2056		JMP ($00AC)

0C40	0034		RET R3

0C42	810B		LBI R1, #$0B
0C44	011D		MLH R1, R1
0C46	8116		LBI R1, #$16
0C48	0014		RET R1

; ****************
; Routine for HOLD
; ****************

0C4A	1447		CTRL $4, #$47		; Int 3 off

0C4C	8805		LBI R8, #$05
0C4E	088D		MLH R8, R8
0C50	88C0		LBI R8, #$C0		; R8 <- $05C0 (line 15, col 0)
0C52	8AE0		LBI R10, #$E0
0C54	295F		MOVE R9, $BE
0C56	A93F		ADD R9, #$40		; R9 <- $0740 (temp area)

			; Save 5C0-5DF
0C58	D181		MOVE R1, (R8)+
0C5A	5191		MOVE (R9)+, R1
0C5C	C8A9		SGE R8, R10
0C5E	F007		BRA $0C58		; -> -$08(R0)

			; Write blanks to 5C0-5DF
0C60	88C0		LBI R8, #$C0
0C62	8940		LBI R9, #$40
0C64	099D		MLH R9, R9
0C66	5981		MOVE (R8)+, R9
0C68	C8A9		SGE R8, R10
0C6A	F005		BRA $0C66		; -> -$06(R0)

0C6C	8906		LBI R9, #$06
0C6E	099D		MLH R9, R9
0C70	89C0		LBI R9, #$C0		; R9 <- $06C0
0C72	88C0		LBI R8, #$C0

0C74	8AC4		LBI R10, #$C4		; 4 characters (C4-C0)
0C76	2152		MOVE R1, $A4
0C78	8102		LBI R1, #$02
0C7A	C11F		SNBSH R1, R1		; I/O active ?
0C7C	8AD4		LBI R10, #$D4		; Yes (20 characters)

			; Copy HOLD message to 5C0
0C7E	D191		MOVE R1, (R9)+
0C80	5181		MOVE (R8)+, R1
0C82	C8A9		SGE R8, R10
0C84	F007		BRA $0C7E		; -> -$08(R0)

			; Modify I/O status
0C86	2851		MOVE R8, $A2
0C88	9812		CLR R8, #$12
0C8A	3851		MOVE $A2, R8

0C8C	2852		MOVE R8, $A4
0C8E	018C		MHL R1, R8
0C90	9102		CLR R1, #$02		; Clear I/O active bit
0C92	B101		SET R1, #$01		; Set CRT on bit
0C94	081D		MLH R8, R1
0C96	980E		CLR R8, #$0E		; Clear Printer active etc.
0C98	3852		MOVE $A4, R8

0C9A	1077		CTRL $0, #$77		; Display on
0C9C	1442		CTRL $4, #$42		; Int 3 on

			; Hier wird bei HOLD gehalten
0C9E	0000		HALT
; ----------

0CA0	0000		HALT
0CA2	0000		HALT
0CA4	0000		HALT
0CA6	0000		HALT
0CA8	0000		HALT
0CAA	0000		HALT
0CAC	0000		HALT
0CAE	0000		HALT
0CB0	0000		HALT
0CB2	0000		HALT
0CB4	0000		HALT
0CB6	0000		HALT
0CB8	0000		HALT
0CBA	0000		HALT
0CBC	0000		HALT
0CBE	0000		HALT
0CC0	0000		HALT
0CC2	0000		HALT
0CC4	0000		HALT
0CC6	0000		HALT
0CC8	0000		HALT
0CCA	0000		HALT
0CCC	0000		HALT
0CCE	0000		HALT
0CD0	0000		HALT
0CD2	0000		HALT
0CD4	0000		HALT
0CD6	0000		HALT
0CD8	0000		HALT
0CDA	0000		HALT
0CDC	0000		HALT
0CDE	0000		HALT
0CE0	0000		HALT
0CE2	0000		HALT
0CE4	0000		HALT
0CE6	0000		HALT
0CE8	0000		HALT
0CEA	0000		HALT
0CEC	0000		HALT
0CEE	0000		HALT
0CF0	0000		HALT
0CF2	0000		HALT
0CF4	0000		HALT
0CF6	0000		HALT
0CF8	0000		HALT
0CFA	0000		HALT
0CFC	0000		HALT
0CFE	0000		HALT
; ----

0D00	A035		BRA $0D38		; $36(R0)

0D02	8A02		LBI R10, #$02
0D04	0AAD		MLH R10, R10
0D06	8A00		LBI R10, #$00
0D08	2F5F		MOVE R15, $BE
0D0A	AF93		ADD R15, #$94
0D0C	0EA4		MOVE R14, R10
0D0E	5EF1		MOVE (R15)+, R14	; $0200
0D10	8D03		LBI R13, #$03
0D12	0DDD		MLH R13, R13
0D14	8DE0		LBI R13, #$E0
0D16	5DF8		MOVE (R15), R13		; $03E0
0D18	0FE4		MOVE R15, R14
0D1A	2E5F		MOVE R14, $BE
0D1C	AE1F		ADD R14, #$20
0D1E	8D40		LBI R13, #$40
0D20	D1E1		MOVE R1, (R14)+
0D22	51F1		MOVE (R15)+, R1
0D24	CED2		SE R14, R13
0D26	F007		BRA $0D20		; -> -$08(R0)

0D28	8D04		LBI R13, #$04
0D2A	2E50		MOVE R14, $A0
0D2C	8E20		LBI R14, #$20
0D2E	D1E1		MOVE R1, (R14)+
0D30	51F1		MOVE (R15)+, R1
0D32	CFD7		SBSH R15, R13
0D34	F007		BRA $0D2E		; -> -$08(R0)
0D36	A001		BRA $0D3A		; Have offset

0D38	2A50		MOVE R10, $A0		; No offset

0D3A	2151		MOVE R1, $A2
0D3C	B102		SET R1, #$02
0D3E	3151		MOVE $A2, R1

0D40	2F5F		MOVE R15, $BE
0D42	AF97		ADD R15, #$98
0D44	5AF1		MOVE (R15)+, R10	; Display offset
0D46	2150		MOVE R1, $A0
0D48	51F3		MOVE (R15)++, R1

			; Save variables
0D4A	52F1		MOVE (R15)+, R2
0D4C	215B		MOVE R1, $B6
0D4E	51F1		MOVE (R15)+, R1
0D50	2D52		MOVE R13, $A4
0D52	5DF1		MOVE (R15)+, R13

			; Clear ATTN flag, CRT off,
			; (don't translate scancode)
0D54	01DC		MHL R1, R13
0D56	9181		CLR R1, #$81
0D58	0D1D		MLH R13, R1
0D5A	9D01		CLR R13, #$01
0D5C	3D52		MOVE $A4, R13

0D5E	2158		MOVE R1, $B0
0D60	51F8		MOVE (R15), R1
0D62	2150		MOVE R1, $A0
0D64	3158		MOVE $B0, R1

			; Clear $076C..0795 (two IOCBs)
0D66	8F07		LBI R15, #$07
0D68	0FFD		MLH R15, R15
0D6A	8F6C		LBI R15, #$6C
0D6C	03F4		MOVE R3, R15
0D6E	2E50		MOVE R14, $A0
0D70	8D94		LBI R13, #$94
0D72	5EF1		MOVE (R15)+, R14
0D74	CFD9		SGE R15, R13
0D76	F005		BRA $0D72

0D78	8105		LBI R1, #$05
0D7A	011D		MLH R1, R1
0D7C	8100		LBI R1, #$00
0D7E	5138		MOVE (R3), R1		; IOCB_DA

			; Sense printer
0D80	2857		MOVE R8, $AE
0D82	0203		INC2 R2, R0
0D84	2056		JMP ($00AC)		; Call I/O Supervisor

			; Wait until printer idle
0D86	2862		MOVE R8, $C4
0D88	0203		INC2 R2, R0
0D8A	2056		JMP ($00AC)
0D8C	0004		NOP

0D8E	0F34		MOVE R15, R3
0D90	AF0B		ADD R15, #$0C		; IOCB_Ret
0D92	DEF8		MOVE R14, (R15)
0D94	CE03		SZ R14
0D96	A0A3		BRA $0E3C		; Error

			; IOCB_DA and IOCB_Sub
0D98	0F34		MOVE R15, R3
0D9A	0EF4		MOVE R14, R15
0D9C	AE13		ADD R14, #$14		; first word after IOCB
0D9E	D1F1		MOVE R1, (R15)+
0DA0	51E1		MOVE (R14)+, R1

			; IOCB_Cmd and IOCB_Flags
0DA2	8102		LBI R1, #$02		; Write (print)
0DA4	011D		MLH R1, R1
0DA6	8100		LBI R1, #$00
0DA8	51F1		MOVE (R15)+, R1
0DAA	51E1		MOVE (R14)+, R1

			; IOCB_BA
0DAC	8604		LBI R6, #$04
0DAE	066D		MLH R6, R6
0DB0	8600		LBI R6, #$00
0DB2	56F1		MOVE (R15)+, R6		; Buffer 1 at $0400
0DB4	0164		MOVE R1, R6
0DB6	A169		ADD R1, #$6A
0DB8	51E1		MOVE (R14)+, R1		; Buffer 2 at $046A

			; IOCB_BS
0DBA	8100		LBI R1, #$00
0DBC	011D		MLH R1, R1
0DBE	8166		LBI R1, #$66		; 102 characters
0DC0	51F1		MOVE (R15)+, R1
0DC2	51E1		MOVE (R14)+, R1

			; IOCB_CI1
0DC4	2150		MOVE R1, $A0
0DC6	0112		INC R1, R1		; 1 line feed
0DC8	51F8		MOVE (R15), R1
0DCA	51E8		MOVE (R14), R1

			; IOCB_Stat1
0DCC	AF07		ADD R15, #$08
0DCE	AE07		ADD R14, #$08
0DD0	D1F8		MOVE R1, (R15)
0DD2	51E8		MOVE (R14), R1

0DD4	2F5F		MOVE R15, $BE
0DD6	AF93		ADD R15, #$94
0DD8	DEF8		MOVE R14, (R15)
0DDA	9E1F		CLR R14, #$1F
0DDC	5EF1		MOVE (R15)+, R14

			; Limit end address to last RWS address
0DDE	DDF8		MOVE R13, (R15)
0DE0	0CDC		MHL R12, R13
0DE2	2B55		MOVE R11, $AA
0DE4	0ABC		MHL R10, R11
0DE6	CCA0		SLE R12, R10
0DE8	0DB4		MOVE R13, R11
0DEA	CCA1		SLT R12, R10
0DEC	CDB8		SGT R13, R11
0DEE	A001		BRA $0DF2		; $02(R0)
0DF0	0DB4		MOVE R13, R11
0DF2	5DF8		MOVE (R15), R13

			; Test if end address > start address
0DF4	0CDC		MHL R12, R13
0DF6	0BEC		MHL R11, R14
0DF8	CCB9		SGE R12, R11
0DFA	A005		BRA $0E02		; $06(R0)
0DFC	CCB8		SGT R12, R11
0DFE	CDE0		SLE R13, R14
0E00	A00D		BRA $0E10		; $0E(R0)

0E02	0F34		MOVE R15, R3
0E04	AF0B		ADD R15, #$0C		; IOCB_Ret
0E06	81F0		LBI R1, #$F0
0E08	011D		MLH R1, R1
0E0A	81F1		LBI R1, #$F1
0E0C	51F8		MOVE (R15), R1		; Error 01
0E0E	A031		BRA $0E42		; Exit

			; Difference gives size
0E10	0DE9		SUB R13, R14
0E12	01DC		MHL R1, R13
0E14	0EEC		MHL R14, R14
0E16	01E9		SUB R1, R14
0E18	0D1D		MLH R13, R1
0E1A	9D1F		CLR R13, #$1F		; Make multiple of 16 words
0E1C	AF05		ADD R15, #$06
0E1E	5DF8		MOVE (R15), R13

0E20	A04F		BRA $0E72		; Print hex dump
			; returns via jump to 0E22

			; Sense printer
0E22	836C		LBI R3, #$6C		; IOCB 1
0E24	0F34		MOVE R15, R3
0E26	AF01		ADD R15, #$02		; IOCB_Cmd+Flags
0E28	2150		MOVE R1, $A0
0E2A	51F8		MOVE (R15), R1		; Sense
0E2C	2857		MOVE R8, $AE
0E2E	0203		INC2 R2, R0
0E30	2056		JMP ($00AC)

			; Wait until printer idle
0E32	2862		MOVE R8, $C4
0E34	0203		INC2 R2, R0
0E36	2056		JMP ($00AC)
0E38	A001		BRA $0E3C		; Error
0E3A	A005		BRA $0E42		; OK

0E3C	287D		MOVE R8, $FA
0E3E	0203		INC2 R2, R0
0E40	2056		JMP ($00AC)		; "ERROR 0xx..."

			; Clear lines 0-11
0E42	8F02		LBI R15, #$02
0E44	0FFD		MLH R15, R15
0E46	8F00		LBI R15, #$00
0E48	8E40		LBI R14, #$40
0E4A	0EED		MLH R14, R14
0E4C	8D05		LBI R13, #$05
0E4E	5EF1		MOVE (R15)+, R14
0E50	CFD7		SBSH R15, R13
0E52	F005		BRA $0E4E		; -> -$06(R0)

0E54	2151		MOVE R1, $A2
0E56	9106		CLR R1, #$06
0E58	3151		MOVE $A2, R1

			; Restore variables and exit to caller
0E5A	2F5F		MOVE R15, $BE
0E5C	AF9D		ADD R15, #$9E
0E5E	D2F1		MOVE R2, (R15)+		; Restore R2
0E60	D1F1		MOVE R1, (R15)+
0E62	315B		MOVE $B6, R1
0E64	D1F1		MOVE R1, (R15)+
0E66	3152		MOVE $A4, R1
0E68	D1F1		MOVE R1, (R15)+
0E6A	3158		MOVE $B0, R1

0E6C	1077		CTRL $0, #$77		; Display on
0E6E	0824		MOVE R8, R2
0E70	2056		JMP ($00AC)		; Exit
; ----

; Print a memory hex dump

0E72	2F5F		MOVE R15, $BE
0E74	AF93		ADD R15, #$94
0E76	D4F8		MOVE R4, (R15)		; Start address
0E78	0E44		MOVE R14, R4
0E7A	AE1F		ADD R14, #$20		; 16 words
0E7C	5EF3		MOVE (R15)++, R14	; New start address

0E7E	DCF1		MOVE R12, (R15)+	; Display address offset

0E80	DEF8		MOVE R14, (R15)
0E82	836C		LBI R3, #$6C		; IOCB 1
0E84	CE03		SZ R14
0E86	8380		LBI R3, #$80		; IOCB 2
0E88	8101		LBI R1, #$01
0E8A	0E17		XOR R14, R1		; Toggle between the two IOCBs
0E8C	5EF8		MOVE (R15), R14

			; Create hex dump line
0E8E	0E34		MOVE R14, R3
0E90	AE03		ADD R14, #$04		; IOCB_BA
0E92	D6E8		MOVE R6, (R14)
0E94	0203		INC2 R2, R0
0E96	A02B		BRA $0EC4		; Call $0EC4,R2

			; Print line
0E98	2857		MOVE R8, $AE
0E9A	0203		INC2 R2, R0
0E9C	2056		JMP ($00AC)

0E9E	0F34		MOVE R15, R3
0EA0	AF0B		ADD R15, #$0C		; IOCB_Ret
0EA2	6EF8		MOVB R14, (R15)
0EA4	CE03		SZ R14
0EA6	F06B		BRA $0E3C		; Error

0EA8	2E52		MOVE R14, $A4
0EAA	8E80		LBI R14, #$80
0EAC	CEEF		SNBSH R14, R14
0EAE	F08D		BRA $0E22		; ATTN was pressed

0EB0	2F5F		MOVE R15, $BE
0EB2	AF9B		ADD R15, #$9C
0EB4	DEF8		MOVE R14, (R15)		; Number of lines to dump
0EB6	01EC		MHL R1, R14
0EB8	01E6		OR R1, R14
0EBA	C10B		SNZ R1
0EBC	F09B		BRA $0E22		; Finished, return

0EBE	FE1F		SUB R14, #$20
0EC0	5EF8		MOVE (R15), R14
0EC2	F051		BRA $0E72		; Loop
; ----

; Create one hex dump line with address
; Parameters:
;  R4 - Start address
;  R6 - Address of hex dump line
;  R12 - Modifier for display start address

0EC4	8E11		LBI R14, #17		; 16 data words + address

			; R10 <- R4 - R12
0EC6	0A44		MOVE R10, R4
0EC8	0AC9		SUB R10, R12
0ECA	01AC		MHL R1, R10
0ECC	0CCC		MHL R12, R12
0ECE	01C9		SUB R1, R12
0ED0	0A1D		MLH R10, R1

			; Convert address to hex
0ED2	0503		INC2 R5, R0
0ED4	A01D		BRA $0EF4		; Call $0EF4,R5

			; Four blanks between address and data
0ED6	8140		LBI R1, #$40
0ED8	011D		MLH R1, R1
0EDA	5161		MOVE (R6)+, R1
0EDC	5161		MOVE (R6)+, R1
0EDE	FE00		SUB R14, #$01

			; Convert next data word to hex
0EE0	DA41		MOVE R10, (R4)+
0EE2	0503		INC2 R5, R0
0EE4	A00D		BRA $0EF4		; Call $0EF4,R5

			; Two blanks between data words
0EE6	8140		LBI R1, #$40
0EE8	011D		MLH R1, R1
0EEA	5161		MOVE (R6)+, R1
0EEC	FE00		SUB R14, #$01

0EEE	CE03		SZ R14
0EF0	F011		BRA $0EE0		; -> -$12(R0)

0EF2	0024		RET R2
; ----

; Convert word in R10 into hex digits and store them at
; address in R6

0EF4	8D02		LBI R13, #$02
0EF6	0BAC		MHL R11, R10
0EF8	8C0F		LBI R12, #$0F
0EFA	E0BF		SWAP R11
0EFC	0CB5		AND R12, R11
0EFE	8109		LBI R1, #$09
0F00	CC10		SLE R12, R1
0F02	ACC6		ADD R12, #$C7
0F04	ACEF		ADD R12, #'0'
0F06	7C60		MOVB (R6)+, R12
0F08	CD0C		SNS R13
0F0A	0054		RET R5

0F0C	FD00		SUB R13, #$01
0F0E	CD0B		SNZ R13
0F10	0BA4		MOVE R11, R10
0F12	F01B		BRA $0EF8		; -> -$1C(R0)
; ----

0F14	0000		HALT
0F16	0000		HALT
0F18	0000		HALT
0F1A	0000		HALT
0F1C	0000		HALT
0F1E	0000		HALT
0F20	0000		HALT
0F22	0000		HALT
0F24	0000		HALT
0F26	0000		HALT
0F28	0000		HALT
0F2A	0000		HALT
0F2C	0000		HALT
0F2E	0000		HALT
0F30	0000		HALT
0F32	0000		HALT
0F34	0000		HALT
0F36	0000		HALT
0F38	0000		HALT
0F3A	0000		HALT
0F3C	0000		HALT
0F3E	0000		HALT
; ----------

0F40	2651		MOVE R6, $A2
0F42	2158		MOVE R1, $B0
0F44	0514		MOVE R5, R1
0F46	8100		LBI R1, #$00
0F48	3158		MOVE $B0, R1		; Clear last keycode

0F4A	810C		LBI R1, #$0C
0F4C	890D		LBI R9, #$0D
0F4E	C512		SE R5, R1
0F50	C59A		SNE R5, R9
0F52	A019		BRA $0F6E		; $1A(R0)

0F54	8480		LBI R4, #$80
0F56	E44F		STAT R4, $4		; Get keyboard status
0F58	8101		LBI R1, #$01
0F5A	C416		SBC R4, R1
0F5C	A039		BRA $0F98		; Katakana enable

0F5E	3539		MOVE $72, R5
0F60	2A50		MOVE R10, $A0
0F62	8A73		LBI R10, #$73
0F64	4FA8		PUTB $F, (R10)		; Reset charset
0F66	0223		INC2 R2, R2

0F68	1442		CTRL $4, #$42		; Enable Int 3
0F6A	0824		MOVE R8, R2
0F6C	2056		JMP ($00AC)		; Return to caller

0F6E	8A0C		LBI R10, #$0C
0F70	8902		LBI R9, #$02
0F72	C5A6		SBC R5, R10
0F74	C596		SBC R5, R9
0F76	F00F		BRA $0F68		; -> -$10(R0)

0F78	890B		LBI R9, #$0B
0F7A	099D		MLH R9, R9
0F7C	89F0		LBI R9, #$F0
0F7E	8120		LBI R1, #$20
0F80	C615		SBS R6, R1
0F82	A005		BRA $0F8A		; $06(R0)

0F84	8917		LBI R9, #$17
0F86	099D		MLH R9, R9
0F88	89F1		LBI R9, #$F1
0F8A	C5A2		SE R5, R10
0F8C	A900		ADD R9, #$01
0F8E	0803		INC2 R8, R0
0F90	A045		BRA $0FD8		; $46(R0)

0F92	F02B		BRA $0F68		; -> -$2C(R0)

0F94	396E		MOVE $DC, R9
0F96	F031		BRA $0F66		; -> -$32(R0)

			; Katakana enable
			
0F98	9620		CLR R6, #$20
0F9A	890B		LBI R9, #$0B
0F9C	099D		MLH R9, R9
0F9E	89F0		LBI R9, #$F0		; R9 <- $0BF0
0FA0	C50B		SNZ R5
0FA2	A00D		BRA $0FB2		; $0E(R0)

0FA4	B620		SET R6, #$20
0FA6	8917		LBI R9, #$17
0FA8	099D		MLH R9, R9
0FAA	89F1		LBI R9, #$F1		; R9 <- $17F1

0FAC	812D		LBI R1, #$2D
0FAE	C51A		SNE R5, R1
0FB0	A900		ADD R9, #$01		; R9 <- $17F2

0FB2	0803		INC2 R8, R0		; Get word from Common ROS
0FB4	A021		BRA $0FD8		; Call subroutine
0FB6	A001		BRA $0FBA		; Word is $FFFF
0FB8	A007		BRA $0FC2		; Word is not $FFFF

0FBA	810C		LBI R1, #$0C
0FBC	C515		SBS R5, R1
0FBE	F061		BRA $0F5E		; -> -$62(R0)
0FC0	F059		BRA $0F68		; -> -$5A(R0)

0FC2	950F		CLR R5, #$0F
0FC4	8120		LBI R1, #$20
0FC6	C512		SE R5, R1
0FC8	C50B		SNZ R5
0FCA	A001		BRA $0FCE
0FCC	F065		BRA $0F68		; Exit

0FCE	C503		SZ R5
0FD0	85F0		LBI R5, #$F0
0FD2	3651		MOVE $A2, R6
0FD4	396E		MOVE $DC, R9
0FD6	F079		BRA $0F5E		; -> -$7A(R0)
; ----------

0FD8	1102		CTRL $1, #$02		; Select Common ROS
0FDA	3939		MOVE $72, R9		; ROS address
0FDC	2A50		MOVE R10, $A0
0FDE	8A72		LBI R10, #$72		; R10 <- $0072 (contents of R9)
0FE0	41A0		PUTB $1, (R10)+
0FE2	41A4		PUTB $1, (R10)-
0FE4	F000		BRA $0FE5

			; Get ROS word
0FE6	019E		GETB R9, $1
0FE8	099D		MLH R9, R9
0FEA	0A94		MOVE R10, R9
0FEC	019E		GETB R9, $1

0FEE	0A95		AND R10, R9
0FF0	CA0C		SNS R10
0FF2	0084		RET R8			; Word was $FFFF
0FF4	0083		INC2 R0, R8		; Return
; ----------


0FF6	0000		HALT
0FF8	0000		HALT
0FFA	0000		HALT
0FFC	0000		HALT
0FFE	0000		HALT
; ----------

1000	A00F		BRA $1012		; $10(R0)

1002	811E		LBI R1, #$1E
1004	011D		MLH R1, R1
1006	81C8		LBI R1, #$C8
1008	0014		RET R1			; Jump to $1EC8
; ----

; Jump to error number output routine
100A	811E		LBI R1, #$1E
100C	011D		MLH R1, R1
100E	8110		LBI R1, #$10
1010	0014		RET R1			; Jump to $1E10
; ----

1012	2A51		MOVE R10, $A2
1014	8120		LBI R1, #$20
1016	CA15		SBS R10, R1
1018	A00D		BRA $1028		; $0E(R0)

101A	2150		MOVE R1, $A0
101C	3158		MOVE $B0, R1		; Clear last keycode
101E	1443		CTRL $4, #$43		; Disable int. 3
1020	2873		MOVE R8, $E6
1022	0203		INC2 R2, R0
1024	2056		JMP ($00AC)
1026	0004		NOP

1028	8CFF		LBI R12, #$FF
102A	811E		LBI R1, #$1E
102C	011D		MLH R1, R1
102E	8148		LBI R1, #$48
1030	0403		INC2 R4, R0
1032	0014		RET R1			; Call $1E48,R4

			; Fill upper half of screen with R9
1034	8D02		LBI R13, #$02
1036	0DDD		MLH R13, R13
1038	8D00		LBI R13, #$00
103A	0ED4		MOVE R14, R13
103C	8C04		LBI R12, #$04
103E	59E1		MOVE (R14)+, R9
1040	CEC7		SBSH R14, R12
1042	F005		BRA $103E		; -> -$06(R0)

1044	8C80		LBI R12, #$80
1046	2F51		MOVE R15, $A2
1048	0ED4		MOVE R14, R13
104A	8E10		LBI R14, #$10
104C	8B00		LBI R11, #$00
104E	CFC5		SBS R15, R12
1050	A003		BRA $1056		; $04(R0)

1052	8E0B		LBI R14, #$0B
1054	8B03		LBI R11, #$03
1056	3BFE		MOVE $1FC, R11
1058	0203		INC2 R2, R0
105A	20FC		JMP ($01F8)

105C	8E2B		LBI R14, #$2B
105E	CFC5		SBS R15, R12
1060	8E30		LBI R14, #$30
1062	0203		INC2 R2, R0
1064	20FC		JMP ($01F8)

1066	0200		DEC2 R2, R0
1068	32FB		MOVE $1F6, R2
106A	818D		LBI R1, #$8D
106C	31FE		MOVE $1FC, R1
106E	8E02		LBI R14, #$02
1070	0EED		MLH R14, R14
1072	8E80		LBI R14, #$80
1074	2750		MOVE R7, $A0
1076	3758		MOVE $B0, R7
1078	A04F		BRA $10CA		; $50(R0)

107A	8155		LBI R1, #$55
107C	C51A		SNE R5, R1
107E	20FC		JMP ($01F8)

1080	81FA		LBI R1, #$FA
1082	C51A		SNE R5, R1
1084	F073		BRA $1012		; -> -$74(R0)

1086	81C1		LBI R1, #$C1
1088	C519		SGE R5, R1
108A	A03D		BRA $10CA		; $3E(R0)

108C	C518		SGT R5, R1
108E	A005		BRA $1096		; $06(R0)

1090	81C4		LBI R1, #$C4
1092	C512		SE R5, R1
1094	A005		BRA $109C		; $06(R0)

1096	75E1		MOVB (R14)++, R5
1098	0756		OR R7, R5
109A	A02D		BRA $10CA		; $2E(R0)

109C	8BC3		LBI R11, #$C3
109E	C5B0		SLE R5, R11
10A0	A027		BRA $10CA		; $28(R0)

10A2	2A51		MOVE R10, $A2
10A4	8180		LBI R1, #$80
10A6	CA15		SBS R10, R1
10A8	20FC		JMP ($01F8)

10AA	0756		OR R7, R5
10AC	C5B1		SLT R5, R11
10AE	A007		BRA $10B8		; $08(R0)

10B0	8112		LBI R1, #$12
10B2	011D		MLH R1, R1
10B4	811E		LBI R1, #$1E
10B6	0014		RET R1

10B8	811E		LBI R1, #$1E
10BA	011D		MLH R1, R1
10BC	818E		LBI R1, #$8E
10BE	0403		INC2 R4, R0
10C0	0014		RET R1

10C2	8113		LBI R1, #$13
10C4	011D		MLH R1, R1
10C6	8152		LBI R1, #$52
10C8	0014		RET R1

10CA	0DE4		MOVE R13, R14
10CC	CED8		SGT R14, R13
10CE	0ED4		MOVE R14, R13
10D0	0403		INC2 R4, R0
10D2	20FA		JMP ($01F4)

10D4	C70B		SNZ R7
10D6	F05D		BRA $107A		; -> -$5E(R0)

10D8	813D		LBI R1, #$3D
10DA	C51A		SNE R5, R1
10DC	FE00		SUB R14, #$01
10DE	C590		SLE R5, R9
10E0	75E0		MOVB (R14)+, R5
10E2	8185		LBI R1, #$85
10E4	CE18		SGT R14, R1
10E6	F01B		BRA $10CC		; -> -$1C(R0)

10E8	0ED4		MOVE R14, R13
10EA	0403		INC2 R4, R0
10EC	20F9		JMP ($01F2)

10EE	0DD0		DEC2 R13, R13
10F0	9F01		CLR R15, #$01
10F2	06F4		MOVE R6, R15
10F4	8EC2		LBI R14, #$C2
10F6	8108		LBI R1, #$08
10F8	31FE		MOVE $1FC, R1
10FA	0203		INC2 R2, R0
10FC	20FC		JMP ($01F8)

10FE	0200		DEC2 R2, R0
1100	32FB		MOVE $1F6, R2
1102	818D		LBI R1, #$8D
1104	31FE		MOVE $1FC, R1
1106	2C55		MOVE R12, $AA
1108	0CCC		MHL R12, R12
110A	8E03		LBI R14, #$03
110C	0EED		MLH R14, R14
110E	8E02		LBI R14, #$02
1110	81C1		LBI R1, #$C1
1112	C712		SE R7, R1
1114	A003		BRA $111A		; $04(R0)

1116	0DE4		MOVE R13, R14
1118	8D0A		LBI R13, #$0A
111A	0B6C		MHL R11, R6
111C	CBC8		SGT R11, R12
111E	A005		BRA $1126		; $06(R0)

1120	CB04		SS R11
1122	8B00		LBI R11, #$00
1124	0BC5		AND R11, R12
1126	06BD		MLH R6, R11
1128	0564		MOVE R5, R6
112A	0403		INC2 R4, R0
112C	A027		BRA $1156		; $28(R0)

112E	AE03		ADD R14, #$04
1130	0B6C		MHL R11, R6
1132	CBC8		SGT R11, R12
1134	A005		BRA $113C		; $06(R0)

1136	CB04		SS R11
1138	8B00		LBI R11, #$00
113A	0BC5		AND R11, R12
113C	06BD		MLH R6, R11
113E	D561		MOVE R5, (R6)+
1140	0403		INC2 R4, R0
1142	A011		BRA $1156		; $12(R0)

1144	AE01		ADD R14, #$02
1146	813A		LBI R1, #$3A
1148	CE15		SBS R14, R1
114A	F01B		BRA $1130		; -> -$1C(R0)

114C	81BA		LBI R1, #$BA
114E	CE11		SLT R14, R1
1150	A00B		BRA $115E		; $0C(R0)

1152	8E82		LBI R14, #$82
1154	F03B		BRA $111A		; -> -$3C(R0)

1156	811D		LBI R1, #$1D
1158	011D		MLH R1, R1
115A	8186		LBI R1, #$86
115C	0014		RET R1

115E	F61F		SUB R6, #$20
1160	0B6C		MHL R11, R6
1162	CBC0		SLE R11, R12
1164	0BC5		AND R11, R12
1166	06BD		MLH R6, R11
1168	0ED4		MOVE R14, R13
116A	8138		LBI R1, #$38
116C	CE11		SLT R14, R1
116E	A003		BRA $1174		; $04(R0)

1170	CED0		SLE R14, R13
1172	A003		BRA $1178		; $04(R0)

1174	0ED4		MOVE R14, R13
1176	2F50		MOVE R15, $A0
1178	0403		INC2 R4, R0
117A	20FA		JMP ($01F4)

117C	8142		LBI R1, #$42
117E	C512		SE R5, R1
1180	A003		BRA $1186		; $04(R0)

1182	A60F		ADD R6, #$10
1184	F087		BRA $10FE		; -> -$88(R0)

1186	8145		LBI R1, #$45
1188	C512		SE R5, R1
118A	A003		BRA $1190		; $04(R0)

118C	F60F		SUB R6, #$10
118E	F091		BRA $10FE		; -> -$92(R0)

1190	8BC1		LBI R11, #$C1
1192	C7BA		SNE R7, R11
1194	A01D		BRA $11B4		; $1E(R0)

1196	81C4		LBI R1, #$C4
1198	C518		SGT R5, R1
119A	C5B9		SGE R5, R11
119C	F033		BRA $116A		; -> -$34(R0)

119E	0ED4		MOVE R14, R13
11A0	8B04		LBI R11, #$04
11A2	59E1		MOVE (R14)+, R9
11A4	CEB7		SBSH R14, R11
11A6	F005		BRA $11A2		; -> -$06(R0)

11A8	2750		MOVE R7, $A0
11AA	0ED4		MOVE R14, R13
11AC	8110		LBI R1, #$10
11AE	011D		MLH R1, R1
11B0	817A		LBI R1, #$7A
11B2	0014		RET R1

11B4	812E		LBI R1, #$2E
11B6	C51A		SNE R5, R1
11B8	A037		BRA $11F2		; $38(R0)

11BA	AF00		ADD R15, #$01
11BC	813D		LBI R1, #$3D
11BE	C512		SE R5, R1
11C0	A00F		BRA $11D2		; $10(R0)

11C2	FE00		SUB R14, #$01
11C4	FF01		SUB R15, #$02
11C6	8104		LBI R1, #$04
11C8	CF18		SGT R15, R1
11CA	F061		BRA $116A		; -> -$62(R0)

11CC	FE01		SUB R14, #$02
11CE	8F03		LBI R15, #$03
11D0	F067		BRA $116A		; -> -$68(R0)

11D2	8A3A		LBI R10, #$3A
11D4	C5A2		SE R5, R10
11D6	A003		BRA $11DC		; $04(R0)

11D8	AE00		ADD R14, #$01
11DA	A001		BRA $11DE		; $02(R0)

11DC	75E0		MOVB (R14)+, R5
11DE	8104		LBI R1, #$04
11E0	CF12		SE R15, R1
11E2	F079		BRA $116A		; -> -$7A(R0)

11E4	AE01		ADD R14, #$02
11E6	8F00		LBI R15, #$00
11E8	C5AA		SNE R5, R10
11EA	F081		BRA $116A		; -> -$82(R0)

11EC	8138		LBI R1, #$38
11EE	CE19		SGE R14, R1
11F0	F087		BRA $116A		; -> -$88(R0)

11F2	0ED4		MOVE R14, R13
11F4	016C		MHL R1, R6
11F6	C103		SZ R1
11F8	A00B		BRA $1206		; $0C(R0)

11FA	8106		LBI R1, #$06
11FC	C61A		SNE R6, R1
11FE	A015		BRA $1216		; $16(R0)

1200	8120		LBI R1, #$20
1202	C619		SGE R6, R1
1204	20FC		JMP ($01F8)

1206	0403		INC2 R4, R0
1208	20F9		JMP ($01F2)

120A	5F61		MOVE (R6)+, R15
120C	AE01		ADD R14, #$02
120E	8138		LBI R1, #$38
1210	CE19		SGE R14, R1
1212	F01F		BRA $11F4		; -> -$20(R0)

1214	0024		RET R2

1216	0403		INC2 R4, R0
1218	20F9		JMP ($01F2)

121A	5F68		MOVE (R6), R15
121C	0024		RET R2

121E	0200		DEC2 R2, R0
1220	32FB		MOVE $1F6, R2
1222	8E02		LBI R14, #$02
1224	0EED		MLH R14, R14
1226	8E83		LBI R14, #$83
1228	810B		LBI R1, #$0B
122A	31FE		MOVE $1FC, R1
122C	0203		INC2 R2, R0
122E	20FC		JMP ($01F8)

1230	818D		LBI R1, #$8D
1232	31FE		MOVE $1FC, R1
1234	8EC0		LBI R14, #$C0
1236	81C2		LBI R1, #$C2
1238	71E0		MOVB (R14)+, R1
123A	0DE4		MOVE R13, R14
123C	A017		BRA $1256		; $18(R0)

123E	8700		LBI R7, #$00
1240	81C5		LBI R1, #$C5
1242	8CD9		LBI R12, #$D9
1244	8BE7		LBI R11, #$E7
1246	C51A		SNE R5, R1
1248	0756		OR R7, R5
124A	C5CA		SNE R5, R12
124C	0756		OR R7, R5
124E	C5BA		SNE R5, R11
1250	0756		OR R7, R5
1252	C703		SZ R7
1254	75E1		MOVB (R14)++, R5
1256	81CC		LBI R1, #$CC
1258	CE18		SGT R14, R1
125A	CED9		SGE R14, R13
125C	0ED4		MOVE R14, R13
125E	CED8		SGT R14, R13
1260	8700		LBI R7, #$00
1262	0403		INC2 R4, R0
1264	20FA		JMP ($01F4)

1266	CED8		SGT R14, R13
1268	F02B		BRA $123E		; -> -$2C(R0)

126A	8AC2		LBI R10, #$C2
126C	88C7		LBI R8, #$C7
126E	813D		LBI R1, #$3D
1270	C512		SE R5, R1
1272	A009		BRA $127E		; $0A(R0)

1274	FE00		SUB R14, #$01
1276	CEA2		SE R14, R10
1278	CE8A		SNE R14, R8
127A	FE00		SUB R14, #$01
127C	F027		BRA $1256		; -> -$28(R0)

127E	813A		LBI R1, #$3A
1280	C512		SE R5, R1
1282	A009		BRA $128E		; $0A(R0)

1284	AE00		ADD R14, #$01
1286	CEA2		SE R14, R10
1288	CE8A		SNE R14, R8
128A	AE00		ADD R14, #$01
128C	F037		BRA $1256		; -> -$38(R0)

128E	812E		LBI R1, #$2E
1290	C51A		SNE R5, R1
1292	A00D		BRA $12A2		; $0E(R0)

1294	81CC		LBI R1, #$CC
1296	CE12		SE R14, R1
1298	75E0		MOVB (R14)+, R5
129A	81C7		LBI R1, #$C7
129C	CE1A		SNE R14, R1
129E	AE00		ADD R14, #$01
12A0	F04B		BRA $1256		; -> -$4C(R0)

12A2	0ED3		INC2 R14, R13
12A4	0403		INC2 R4, R0
12A6	20F9		JMP ($01F2)

12A8	8101		LBI R1, #$01
12AA	CF16		SBC R15, R1
12AC	20FC		JMP ($01F8)

12AE	06F4		MOVE R6, R15
12B0	81D9		LBI R1, #$D9
12B2	C71A		SNE R7, R1
12B4	B601		SET R6, #$01
12B6	AE00		ADD R14, #$01
12B8	61E8		MOVB R1, (R14)
12BA	C19A		SNE R1, R9
12BC	A019		BRA $12D8		; $1A(R0)

12BE	0403		INC2 R4, R0
12C0	20F9		JMP ($01F2)

12C2	8101		LBI R1, #$01
12C4	CF16		SBC R15, R1
12C6	20FC		JMP ($01F8)

12C8	DCF8		MOVE R12, (R15)
12CA	3C3E		MOVE $7C, R12
12CC	3F3F		MOVE $7E, R15
12CE	2C50		MOVE R12, $A0
12D0	5CF8		MOVE (R15), R12
12D2	2151		MOVE R1, $A2
12D4	B140		SET R1, #$40
12D6	3151		MOVE $A2, R1
12D8	2152		MOVE R1, $A4
12DA	9101		CLR R1, #$01
12DC	3152		MOVE $A4, R1
12DE	8E05		LBI R14, #$05
12E0	0EED		MLH R14, R14
12E2	8EC0		LBI R14, #$C0
12E4	0203		INC2 R2, R0
12E6	20F8		JMP ($01F0)

12E8	0F34		MOVE R15, R3
12EA	AF0B		ADD R15, #$0C
12EC	2C50		MOVE R12, $A0
12EE	01FC		MHL R1, R15
12F0	C103		SZ R1
12F2	5CF8		MOVE (R15), R12
12F4	2C5F		MOVE R12, $BE
12F6	FC0F		SUB R12, #$10
12F8	8F01		LBI R15, #$01
12FA	0FFD		MLH R15, R15
12FC	8FF0		LBI R15, #$F0
12FE	D1C1		MOVE R1, (R12)+
1300	51F1		MOVE (R15)+, R1
1302	CC03		SZ R12
1304	F007		BRA $12FE		; -> -$08(R0)

1306	0864		MOVE R8, R6
1308	2F56		MOVE R15, $AC
130A	81E7		LBI R1, #$E7
130C	C71A		SNE R7, R1
130E	2F67		MOVE R15, $CE
1310	0203		INC2 R2, R0
1312	00F4		RET R15

1314	2A51		MOVE R10, $A2
1316	8140		LBI R1, #$40
1318	CA15		SBS R10, R1
131A	A009		BRA $1326		; $0A(R0)

131C	9A40		CLR R10, #$40
131E	3A51		MOVE $A2, R10
1320	213F		MOVE R1, $7E
1322	253E		MOVE R5, $7C
1324	5518		MOVE (R1), R5
1326	2C5F		MOVE R12, $BE
1328	FC0F		SUB R12, #$10
132A	8F01		LBI R15, #$01
132C	0FFD		MLH R15, R15
132E	8FF0		LBI R15, #$F0
1330	D1F1		MOVE R1, (R15)+
1332	51C1		MOVE (R12)+, R1
1334	CC03		SZ R12
1336	F007		BRA $1330		; -> -$08(R0)

1338	8210		LBI R2, #$10
133A	022D		MLH R2, R2
133C	8212		LBI R2, #$12
133E	0F34		MOVE R15, R3
1340	0CFC		MHL R12, R15
1342	CC0B		SNZ R12
1344	0024		RET R2

1346	AF0B		ADD R15, #$0C
1348	DCF8		MOVE R12, (R15)
134A	CC0B		SNZ R12
134C	0024		RET R2

134E	287D		MOVE R8, $FA
1350	2056		JMP ($00AC)

1352	8EC0		LBI R14, #$C0
1354	8127		LBI R1, #$27
1356	31FE		MOVE $1FC, R1
1358	0203		INC2 R2, R0
135A	20FC		JMP ($01F8)

135C	8E03		LBI R14, #$03
135E	0EED		MLH R14, R14
1360	8E00		LBI R14, #$00
1362	8131		LBI R1, #$31
1364	31FE		MOVE $1FC, R1
1366	0203		INC2 R2, R0
1368	20FC		JMP ($01F8)

136A	8E40		LBI R14, #$40
136C	813A		LBI R1, #$3A
136E	31FE		MOVE $1FC, R1
1370	0203		INC2 R2, R0
1372	20FC		JMP ($01F8)

1374	8E80		LBI R14, #$80
1376	8145		LBI R1, #$45
1378	31FE		MOVE $1FC, R1
137A	0203		INC2 R2, R0
137C	20FC		JMP ($01F8)

137E	8EC0		LBI R14, #$C0
1380	814E		LBI R1, #$4E
1382	31FE		MOVE $1FC, R1
1384	0203		INC2 R2, R0
1386	20FC		JMP ($01F8)

1388	0ED4		MOVE R14, R13
138A	0403		INC2 R4, R0
138C	20FA		JMP ($01F4)

138E	8CF0		LBI R12, #$F0
1390	8BF5		LBI R11, #$F5
1392	C5C1		SLT R5, R12
1394	C5B0		SLE R5, R11
1396	F00F		BRA $1388		; -> -$10(R0)

1398	75E8		MOVB (R14), R5
139A	81F1		LBI R1, #$F1
139C	C518		SGT R5, R1
139E	A04B		BRA $13EC		; $4C(R0)

13A0	C5BA		SNE R5, R11
13A2	A08B		BRA $1430		; $8C(R0)

13A4	216C		MOVE R1, $D8
13A6	A103		ADD R1, #$04
13A8	D618		MOVE R6, (R1)
13AA	81F2		LBI R1, #$F2
13AC	C51A		SNE R5, R1
13AE	A607		ADD R6, #$08
13B0	81F3		LBI R1, #$F3
13B2	C51A		SNE R5, R1
13B4	A60F		ADD R6, #$10
13B6	81F4		LBI R1, #$F4
13B8	C51A		SNE R5, R1
13BA	A617		ADD R6, #$18
13BC	AE03		ADD R14, #$04
13BE	811F		LBI R1, #$1F
13C0	31FE		MOVE $1FC, R1
13C2	0203		INC2 R2, R0
13C4	20FC		JMP ($01F8)

13C6	0403		INC2 R4, R0
13C8	20FA		JMP ($01F4)

13CA	812E		LBI R1, #$2E
13CC	C512		SE R5, R1
13CE	F009		BRA $13C6		; -> -$0A(R0)

13D0	2152		MOVE R1, $A4
13D2	9101		CLR R1, #$01
13D4	3152		MOVE $A4, R1
13D6	2806		MOVE R8, $0C
13D8	0203		INC2 R2, R0
13DA	2056		JMP ($00AC)

13DC	2682		MOVE R6, $104
13DE	0662		INC R6, R6
13E0	2F86		MOVE R15, $10C
13E2	CF0B		SNZ R15
13E4	F015		BRA $13D0		; -> -$16(R0)

13E6	227C		MOVE R2, $F8
13E8	287D		MOVE R8, $FA
13EA	2056		JMP ($00AC)

13EC	2F50		MOVE R15, $A0
13EE	8F14		LBI R15, #$14
13F0	8A17		LBI R10, #$17
13F2	0AAD		MLH R10, R10
13F4	8AFC		LBI R10, #$FC
13F6	1443		CTRL $4, #$43
13F8	1102		CTRL $1, #$02
13FA	41F0		PUTB $1, (R15)+
13FC	41F8		PUTB $1, (R15)
13FE	F000		BRA $13FF		; -> -$01(R0)

1400	01BE		GETB R11, $1
1402	0BBD		MLH R11, R11
1404	0004		NOP
1406	01BE		GETB R11, $1
1408	2397		MOVE R3, $12E
140A	8C01		LBI R12, #$01
140C	0CCD		MLH R12, R12
140E	8C02		LBI R12, #$02
1410	3C80		MOVE $100, R12
1412	8C00		LBI R12, #$00
1414	05CD		MLH R5, R12
1416	3C81		MOVE $102, R12
1418	812A		LBI R1, #$2A
141A	0C1D		MLH R12, R1
141C	3C82		MOVE $104, R12
141E	8118		LBI R1, #$18
1420	0C1D		MLH R12, R1
1422	3C83		MOVE $106, R12
1424	3B84		MOVE $108, R11
1426	3587		MOVE $10E, R5
1428	2657		MOVE R6, $AE
142A	0ED4		MOVE R14, R13
142C	3E9B		MOVE $136, R14
142E	F073		BRA $13BC		; -> -$74(R0)

1430	2F9D		MOVE R15, $13A
1432	FF3F		SUB R15, #$40
1434	3E9B		MOVE $136, R14
1436	8E4E		LBI R14, #$4E
1438	D1F1		MOVE R1, (R15)+
143A	51E1		MOVE (R14)+, R1
143C	8158		LBI R1, #$58
143E	CE18		SGT R14, R1
1440	F009		BRA $1438		; -> -$0A(R0)

1442	8EC0		LBI R14, #$C0
1444	0203		INC2 R2, R0
1446	20F8		JMP ($01F0)

1448	0200		DEC2 R2, R0
144A	32FB		MOVE $1F6, R2
144C	818D		LBI R1, #$8D
144E	31FE		MOVE $1FC, R1
1450	2397		MOVE R3, $12E
1452	2E9B		MOVE R14, $136
1454	81C4		LBI R1, #$C4
1456	71E0		MOVB (R14)+, R1
1458	81E5		LBI R1, #$E5
145A	71E0		MOVB (R14)+, R1
145C	817C		LBI R1, #$7C
145E	71E2		MOVB (R14)+++, R1
1460	0DE4		MOVE R13, R14
1462	87C3		LBI R7, #$C3
1464	CED8		SGT R14, R13
1466	0ED4		MOVE R14, R13
1468	0403		INC2 R4, R0
146A	20FA		JMP ($01F4)

146C	813D		LBI R1, #$3D
146E	C51A		SNE R5, R1
1470	FE00		SUB R14, #$01
1472	C590		SLE R5, R9
1474	75E0		MOVB (R14)+, R5
1476	8187		LBI R1, #$87
1478	CE18		SGT R14, R1
147A	F017		BRA $1464		; -> -$18(R0)

147C	0EE3		INC2 R14, R14
147E	8B02		LBI R11, #$02
1480	0ED2		INC R14, R13
1482	21F9		MOVE R1, $1F2
1484	0403		INC2 R4, R0
1486	0010		DEC2 R0, R1
1488	0ED4		MOVE R14, R13
148A	65E8		MOVB R5, (R14)
148C	8B0F		LBI R11, #$0F
148E	0B55		AND R11, R5
1490	8130		LBI R1, #$30
1492	C515		SBS R5, R1
1494	AB08		ADD R11, #$09
1496	8105		LBI R1, #$05
1498	CB19		SGE R11, R1
149A	20FC		JMP ($01F8)

149C	0FBD		MLH R15, R11
149E	3F80		MOVE $100, R15
14A0	2F9D		MOVE R15, $13A
14A2	3F82		MOVE $104, R15
14A4	8F02		LBI R15, #$02
14A6	0FFD		MLH R15, R15
14A8	8F00		LBI R15, #$00
14AA	3F83		MOVE $106, R15
14AC	2750		MOVE R7, $A0
14AE	3F88		MOVE $110, R15
14B0	0203		INC2 R2, R0
14B2	2099		JMP ($0132)

14B4	2E9B		MOVE R14, $136
14B6	AE09		ADD R14, #$0A
14B8	2688		MOVE R6, $110
14BA	81C0		LBI R1, #$C0
14BC	0B6C		MHL R11, R6
14BE	CB16		SBC R11, R1
14C0	A005		BRA $14C8		; $06(R0)

14C2	819F		LBI R1, #$9F
14C4	31FE		MOVE $1FC, R1
14C6	20FC		JMP ($01F8)

14C8	8180		LBI R1, #$80
14CA	C617		SBSH R6, R1
14CC	A007		BRA $14D6		; $08(R0)

14CE	81D9		LBI R1, #$D9
14D0	71E0		MOVB (R14)+, R1
14D2	81C4		LBI R1, #$C4
14D4	71E3		MOVB (R14)++++, R1
14D6	8140		LBI R1, #$40
14D8	C617		SBSH R6, R1
14DA	A007		BRA $14E4		; $08(R0)

14DC	81E6		LBI R1, #$E6
14DE	71E0		MOVB (R14)+, R1
14E0	81E3		LBI R1, #$E3
14E2	71E3		MOVB (R14)++++, R1
14E4	8120		LBI R1, #$20
14E6	C617		SBSH R6, R1
14E8	A007		BRA $14F2		; $08(R0)

14EA	81D4		LBI R1, #$D4
14EC	71E0		MOVB (R14)+, R1
14EE	81D2		LBI R1, #$D2
14F0	71E3		MOVB (R14)++++, R1
14F2	8101		LBI R1, #$01
14F4	011D		MLH R1, R1
14F6	8160		LBI R1, #$60
14F8	3185		MOVE $10A, R1
14FA	2183		MOVE R1, $106
14FC	31A7		MOVE $14E, R1
14FE	0200		DEC2 R2, R0
1500	32FB		MOVE $1F6, R2
1502	818D		LBI R1, #$8D
1504	31FE		MOVE $1FC, R1
1506	2750		MOVE R7, $A0
1508	3781		MOVE $102, R7
150A	2E9B		MOVE R14, $136
150C	8EC0		LBI R14, #$C0
150E	3E9B		MOVE $136, R14
1510	0DE4		MOVE R13, R14
1512	81C0		LBI R1, #$C0
1514	8F03		LBI R15, #$03
1516	CE11		SLT R14, R1
1518	CEFF		SNBSH R14, R15
151A	0ED4		MOVE R14, R13
151C	0403		INC2 R4, R0
151E	20FA		JMP ($01F4)

1520	813D		LBI R1, #$3D
1522	C512		SE R5, R1
1524	A003		BRA $152A		; $04(R0)

1526	FE00		SUB R14, #$01
1528	F017		BRA $1512		; -> -$18(R0)

152A	813A		LBI R1, #$3A
152C	C512		SE R5, R1
152E	A003		BRA $1534		; $04(R0)

1530	AE00		ADD R14, #$01
1532	F021		BRA $1512		; -> -$22(R0)

1534	812E		LBI R1, #$2E
1536	C51A		SNE R5, R1
1538	A003		BRA $153E		; $04(R0)

153A	75E0		MOVB (R14)+, R5
153C	F02B		BRA $1512		; -> -$2C(R0)

153E	0ED4		MOVE R14, R13
1540	DFE1		MOVE R15, (R14)+
1542	0CFC		MHL R12, R15
1544	8740		LBI R7, #$40
1546	81D9		LBI R1, #$D9
1548	8BC4		LBI R11, #$C4
154A	CC1A		SNE R12, R1
154C	CFB2		SE R15, R11
154E	A001		BRA $1552		; $02(R0)

1550	A025		BRA $1578		; $26(R0)

1552	8710		LBI R7, #$10
1554	81E6		LBI R1, #$E6
1556	8BE3		LBI R11, #$E3
1558	CC1A		SNE R12, R1
155A	CFB2		SE R15, R11
155C	A00D		BRA $156C		; $0E(R0)

155E	6FE8		MOVB R15, (R14)
1560	81D7		LBI R1, #$D7
1562	CF12		SE R15, R1
1564	A011		BRA $1578		; $12(R0)

1566	B708		SET R7, #$08
1568	AE00		ADD R14, #$01
156A	A00B		BRA $1578		; $0C(R0)

156C	8720		LBI R7, #$20
156E	81D4		LBI R1, #$D4
1570	8BD2		LBI R11, #$D2
1572	CC1A		SNE R12, R1
1574	CFB2		SE R15, R11
1576	20FC		JMP ($01F8)

1578	077D		MLH R7, R7
157A	8700		LBI R7, #$00
157C	8120		LBI R1, #$20
157E	C717		SBSH R7, R1
1580	A007		BRA $158A		; $08(R0)

1582	811A		LBI R1, #$1A
1584	011D		MLH R1, R1
1586	81CA		LBI R1, #$CA
1588	0014		RET R1

158A	8110		LBI R1, #$10
158C	C717		SBSH R7, R1
158E	A007		BRA $1598		; $08(R0)

1590	8140		LBI R1, #$40
1592	C617		SBSH R6, R1
1594	20FC		JMP ($01F8)

1596	A005		BRA $159E		; $06(R0)

1598	8180		LBI R1, #$80
159A	C617		SBSH R6, R1
159C	20FC		JMP ($01F8)

159E	2150		MOVE R1, $A0
15A0	31A8		MOVE $150, R1
15A2	A100		ADD R1, #$01
15A4	3184		MOVE $108, R1
15A6	8118		LBI R1, #$18
15A8	31A9		MOVE $152, R1
15AA	81F2		LBI R1, #$F2
15AC	011D		MLH R1, R1
15AE	81F4		LBI R1, #$F4
15B0	31A3		MOVE $146, R1
15B2	2155		MOVE R1, $AA
15B4	31A1		MOVE $142, R1
15B6	0C7C		MHL R12, R7
15B8	0204		MOVE R2, R0
15BA	61E0		MOVB R1, (R14)+
15BC	C192		SE R1, R9
15BE	20FC		JMP ($01F8)

15C0	65E0		MOVB R5, (R14)+
15C2	C592		SE R5, R9
15C4	A007		BRA $15CE		; $08(R0)

15C6	8116		LBI R1, #$16
15C8	011D		MLH R1, R1
15CA	81AE		LBI R1, #$AE
15CC	0014		RET R1

15CE	61E0		MOVB R1, (R14)+
15D0	C192		SE R1, R9
15D2	20FC		JMP ($01F8)

15D4	81C1		LBI R1, #$C1
15D6	C512		SE R5, R1
15D8	A009		BRA $15E4		; $0A(R0)

15DA	0403		INC2 R4, R0
15DC	20F9		JMP ($01F2)

15DE	B702		SET R7, #$02
15E0	3FA0		MOVE $140, R15
15E2	0024		RET R2

15E4	81E2		LBI R1, #$E2
15E6	C512		SE R5, R1
15E8	A009		BRA $15F4		; $0A(R0)

15EA	0403		INC2 R4, R0
15EC	20F9		JMP ($01F2)

15EE	B701		SET R7, #$01
15F0	3FA1		MOVE $142, R15
15F2	0024		RET R2

15F4	81E3		LBI R1, #$E3
15F6	C512		SE R5, R1
15F8	A02B		BRA $1626		; $2C(R0)

15FA	3EFF		MOVE $1FE, R14
15FC	AE00		ADD R14, #$01
15FE	0403		INC2 R4, R0
1600	209A		JMP ($0134)

1602	3FA9		MOVE $152, R15
1604	2EFF		MOVE R14, $1FE
1606	2F50		MOVE R15, $A0
1608	6BE0		MOVB R11, (R14)+
160A	6AE0		MOVB R10, (R14)+
160C	81F0		LBI R1, #$F0
160E	CB1A		SNE R11, R1
1610	8B40		LBI R11, #$40
1612	CA9A		SNE R10, R9
1614	A005		BRA $161C		; $06(R0)

1616	0FBD		MLH R15, R11
1618	0FA6		OR R15, R10
161A	A005		BRA $1622		; $06(R0)

161C	0FAD		MLH R15, R10
161E	0FB6		OR R15, R11
1620	FE00		SUB R14, #$01
1622	3FA3		MOVE $146, R15
1624	0024		RET R2

1626	8FC6		LBI R15, #$C6
1628	C5FA		SNE R5, R15
162A	BC80		SET R12, #$80
162C	81D9		LBI R1, #$D9
162E	C512		SE R5, R1
1630	C5FA		SNE R5, R15
1632	A001		BRA $1636		; $02(R0)

1634	A013		BRA $164A		; $14(R0)

1636	6FE0		MOVB R15, (R14)+
1638	81F0		LBI R1, #$F0
163A	CF15		SBS R15, R1
163C	A017		BRA $1656		; $18(R0)

163E	0403		INC2 R4, R0
1640	209A		JMP ($0134)

1642	B704		SET R7, #$04
1644	3FA2		MOVE $144, R15
1646	0ED1		DEC R14, R13
1648	0024		RET R2

164A	81D5		LBI R1, #$D5
164C	C512		SE R5, R1
164E	A023		BRA $1674		; $24(R0)

1650	6FE0		MOVB R15, (R14)+
1652	CF9A		SNE R15, R9
1654	20FC		JMP ($01F8)

1656	0DE1		DEC R13, R14
1658	8B00		LBI R11, #$00
165A	6FE0		MOVB R15, (R14)+
165C	AB00		ADD R11, #$01
165E	CF92		SE R15, R9
1660	F007		BRA $165A		; -> -$08(R0)

1662	8112		LBI R1, #$12
1664	CB11		SLT R11, R1
1666	20FC		JMP ($01F8)

1668	BC84		SET R12, #$84
166A	B704		SET R7, #$04
166C	3DA6		MOVE $14C, R13
166E	0DE4		MOVE R13, R14
1670	0EE1		DEC R14, R14
1672	0024		RET R2

1674	2188		MOVE R1, $110
1676	8101		LBI R1, #$01
1678	C117		SBSH R1, R1
167A	20FC		JMP ($01F8)

167C	81C3		LBI R1, #$C3
167E	C512		SE R5, R1
1680	A00D		BRA $1690		; $0E(R0)

1682	AE00		ADD R14, #$01
1684	0403		INC2 R4, R0
1686	209A		JMP ($0134)

1688	3FA4		MOVE $148, R15
168A	BC01		SET R12, #$01
168C	0ED1		DEC R14, R13
168E	0024		RET R2

1690	81C8		LBI R1, #$C8
1692	C512		SE R5, R1
1694	20FC		JMP ($01F8)

1696	AE00		ADD R14, #$01
1698	0403		INC2 R4, R0
169A	209A		JMP ($0134)

169C	01FC		MHL R1, R15
169E	8B01		LBI R11, #$01
16A0	C10B		SNZ R1
16A2	CFB0		SLE R15, R11
16A4	20FC		JMP ($01F8)

16A6	E0FD		ROR R15
16A8	3FA8		MOVE $150, R15
16AA	0ED1		DEC R14, R13
16AC	0024		RET R2

16AE	07CD		MLH R7, R12
16B0	8102		LBI R1, #$02
16B2	C715		SBS R7, R1
16B4	20FC		JMP ($01F8)

16B6	8120		LBI R1, #$20
16B8	C617		SBSH R6, R1
16BA	A011		BRA $16CE		; $12(R0)

16BC	8104		LBI R1, #$04
16BE	C716		SBC R7, R1
16C0	A00B		BRA $16CE		; $0C(R0)

16C2	8144		LBI R1, #$44
16C4	C717		SBSH R7, R1
16C6	20FC		JMP ($01F8)

16C8	8101		LBI R1, #$01
16CA	C617		SBSH R6, R1
16CC	20FC		JMP ($01F8)

16CE	8110		LBI R1, #$10
16D0	C717		SBSH R7, R1
16D2	A009		BRA $16DE		; $0A(R0)

16D4	8A01		LBI R10, #$01
16D6	C7A7		SBSH R7, R10
16D8	C7A6		SBC R7, R10
16DA	A001		BRA $16DE		; $02(R0)

16DC	20FC		JMP ($01F8)

16DE	2A51		MOVE R10, $A2
16E0	0AAC		MHL R10, R10
16E2	8130		LBI R1, #$30
16E4	CA1E		SNBC R10, R1
16E6	A017		BRA $1700		; $18(R0)

16E8	21FB		MOVE R1, $1F6
16EA	3196		MOVE $12C, R1
16EC	0103		INC2 R1, R0
16EE	A00D		BRA $16FE		; $0E(R0)

16F0	CF0B		SNZ R15
16F2	A00B		BRA $1700		; $0C(R0)

16F4	2151		MOVE R1, $A2
16F6	8110		LBI R1, #$10
16F8	C117		SBSH R1, R1
16FA	2096		JMP ($012C)

16FC	A001		BRA $1700		; $02(R0)

16FE	31FB		MOVE $1F6, R1
1700	2BA1		MOVE R11, $142
1702	2AA0		MOVE R10, $140
1704	08BC		MHL R8, R11
1706	01AC		MHL R1, R10
1708	C810		SLE R8, R1
170A	A005		BRA $1712		; $06(R0)

170C	C811		SLT R8, R1
170E	CBA8		SGT R11, R10
1710	20FC		JMP ($01F8)

1712	0BA9		SUB R11, R10
1714	01BC		MHL R1, R11
1716	0AAC		MHL R10, R10
1718	01A9		SUB R1, R10
171A	0B1D		MLH R11, R1
171C	3BA5		MOVE $14A, R11
171E	8B01		LBI R11, #$01
1720	8A20		LBI R10, #$20
1722	C7B7		SBSH R7, R11
1724	C6A7		SBSH R6, R10
1726	2098		JMP ($0130)

1728	219D		MOVE R1, $13A
172A	3182		MOVE $104, R1
172C	21A7		MOVE R1, $14E
172E	3183		MOVE $106, R1
1730	8704		LBI R7, #$04
1732	8101		LBI R1, #$01
1734	C61F		SNBSH R6, R1
1736	A0B5		BRA $17EE		; $B6(R0)

1738	21A2		MOVE R1, $144
173A	3184		MOVE $108, R1
173C	0203		INC2 R2, R0
173E	2099		JMP ($0132)

1740	2150		MOVE R1, $A0
1742	3184		MOVE $108, R1
1744	2A82		MOVE R10, $104
1746	6BA8		MOVB R11, (R10)
1748	8110		LBI R1, #$10
174A	C71F		SNBSH R7, R1
174C	A02B		BRA $177A		; $2C(R0)

174E	8197		LBI R1, #$97
1750	31FE		MOVE $1FC, R1
1752	CB0B		SNZ R11
1754	20FC		JMP ($01F8)

1756	2F50		MOVE R15, $A0
1758	8120		LBI R1, #$20
175A	CB1A		SNE R11, R1
175C	0FB4		MOVE R15, R11
175E	8180		LBI R1, #$80
1760	CB1A		SNE R11, R1
1762	0FB4		MOVE R15, R11
1764	8140		LBI R1, #$40
1766	CB1A		SNE R11, R1
1768	0FB4		MOVE R15, R11
176A	CF0B		SNZ R15
176C	2098		JMP ($0130)

176E	811A		LBI R1, #$1A
1770	011D		MLH R1, R1
1772	814A		LBI R1, #$4A
1774	0403		INC2 R4, R0
1776	0014		RET R1

1778	2098		JMP ($0130)

177A	2F50		MOVE R15, $A0
177C	2CA9		MOVE R12, $152
177E	8114		LBI R1, #$14
1780	CC1A		SNE R12, R1
1782	8F20		LBI R15, #$20
1784	8128		LBI R1, #$28
1786	CC1A		SNE R12, R1
1788	8F40		LBI R15, #$40
178A	8150		LBI R1, #$50
178C	CC1A		SNE R12, R1
178E	8F80		LBI R15, #$80
1790	CF0B		SNZ R15
1792	A00B		BRA $17A0		; $0C(R0)

1794	3FA9		MOVE $152, R15
1796	811A		LBI R1, #$1A
1798	011D		MLH R1, R1
179A	814A		LBI R1, #$4A
179C	0403		INC2 R4, R0
179E	0014		RET R1

17A0	2BA9		MOVE R11, $152
17A2	2C82		MOVE R12, $104
17A4	7BC8		MOVB (R12), R11
17A6	2B50		MOVE R11, $A0
17A8	AC04		ADD R12, #$05
17AA	7BC0		MOVB (R12)+, R11
17AC	5BC8		MOVE (R12), R11
17AE	FC05		SUB R12, #$06
17B0	870B		LBI R7, #$0B
17B2	8104		LBI R1, #$04
17B4	C717		SBSH R7, R1
17B6	A02F		BRA $17E8		; $30(R0)

17B8	AC7F		ADD R12, #$80
17BA	3CFF		MOVE $1FE, R12
17BC	811A		LBI R1, #$1A
17BE	011D		MLH R1, R1
17C0	8130		LBI R1, #$30
17C2	0403		INC2 R4, R0
17C4	0014		RET R1

17C6	2CFF		MOVE R12, $1FE
17C8	3C82		MOVE $104, R12
17CA	2C50		MOVE R12, $A0
17CC	8C11		LBI R12, #$11
17CE	3C83		MOVE $106, R12
17D0	8C10		LBI R12, #$10
17D2	3C81		MOVE $102, R12
17D4	87FD		LBI R7, #$FD
17D6	0203		INC2 R2, R0
17D8	2099		JMP ($0132)

17DA	219D		MOVE R1, $13A
17DC	3182		MOVE $104, R1
17DE	21A7		MOVE R1, $14E
17E0	3183		MOVE $106, R1
17E2	2150		MOVE R1, $A0
17E4	3181		MOVE $102, R1
17E6	870B		LBI R7, #$0B
17E8	0203		INC2 R2, R0
17EA	2099		JMP ($0132)

17EC	2098		JMP ($0130)

17EE	8104		LBI R1, #$04
17F0	C717		SBSH R7, R1
17F2	A041		BRA $1836		; $42(R0)

17F4	21A6		MOVE R1, $14C
17F6	3184		MOVE $108, R1
17F8	8104		LBI R1, #$04
17FA	3181		MOVE $102, R1
17FC	0203		INC2 R2, R0
17FE	2099		JMP ($0132)

1800	8B10		LBI R11, #$10
1802	CF03		SZ R15
1804	A017		BRA $181E		; $18(R0)

1806	C7B7		SBSH R7, R11
1808	A037		BRA $1842		; $38(R0)

180A	8175		LBI R1, #$75
180C	31FE		MOVE $1FC, R1
180E	2A84		MOVE R10, $108
1810	28A2		MOVE R8, $144
1812	CA82		SE R10, R8
1814	20FC		JMP ($01F8)

1816	0AAC		MHL R10, R10
1818	088C		MHL R8, R8
181A	CA8A		SNE R10, R8
181C	A023		BRA $1842		; $24(R0)

181E	C7B7		SBSH R7, R11
1820	A00B		BRA $182E		; $0C(R0)

1822	81F1		LBI R1, #$F1
1824	8AF4		LBI R10, #$F4
1826	CF1A		SNE R15, R1
1828	CCA2		SE R12, R10
182A	A001		BRA $182E		; $02(R0)

182C	A007		BRA $1836		; $08(R0)

182E	811C		LBI R1, #$1C
1830	011D		MLH R1, R1
1832	8152		LBI R1, #$52
1834	0014		RET R1

1836	2150		MOVE R1, $A0
1838	3181		MOVE $102, R1
183A	21A2		MOVE R1, $144
183C	3184		MOVE $108, R1
183E	0203		INC2 R2, R0
1840	2099		JMP ($0132)

1842	2150		MOVE R1, $A0
1844	3184		MOVE $108, R1
1846	3181		MOVE $102, R1
1848	8110		LBI R1, #$10
184A	C717		SBSH R7, R1
184C	A045		BRA $1894		; $46(R0)

184E	8184		LBI R1, #$84
1850	31FE		MOVE $1FC, R1
1852	2F87		MOVE R15, $10E
1854	AF29		ADD R15, #$2A
1856	6CF8		MOVB R12, (R15)
1858	CC92		SE R12, R9
185A	20FC		JMP ($01F8)

185C	AF17		ADD R15, #$18
185E	8C05		LBI R12, #$05
1860	61F0		MOVB R1, (R15)+
1862	C192		SE R1, R9
1864	20FC		JMP ($01F8)

1866	FC00		SUB R12, #$01
1868	CC03		SZ R12
186A	F00B		BRA $1860		; -> -$0C(R0)

186C	2CA3		MOVE R12, $146
186E	0BCC		MHL R11, R12
1870	81F8		LBI R1, #$F8
1872	CB1A		SNE R11, R1
1874	8F80		LBI R15, #$80
1876	81F4		LBI R1, #$F4
1878	CB1A		SNE R11, R1
187A	8F40		LBI R15, #$40
187C	81F2		LBI R1, #$F2
187E	CB1A		SNE R11, R1
1880	8F20		LBI R15, #$20
1882	81F0		LBI R1, #$F0
1884	CC12		SE R12, R1
1886	2098		JMP ($0130)

1888	811A		LBI R1, #$1A
188A	011D		MLH R1, R1
188C	814A		LBI R1, #$4A
188E	0403		INC2 R4, R0
1890	0014		RET R1

1892	2098		JMP ($0130)

1894	8197		LBI R1, #$97
1896	31FE		MOVE $1FC, R1
1898	2F87		MOVE R15, $10E
189A	AF4C		ADD R15, #$4D
189C	6CF0		MOVB R12, (R15)+
189E	61F4		MOVB R1, (R15)-
18A0	0C16		OR R12, R1
18A2	CC0B		SNZ R12
18A4	20FC		JMP ($01F8)

18A6	FF4C		SUB R15, #$4D
18A8	AF2A		ADD R15, #$2B
18AA	6CF8		MOVB R12, (R15)
18AC	81C5		LBI R1, #$C5
18AE	CC12		SE R12, R1
18B0	2098		JMP ($0130)

18B2	2A50		MOVE R10, $A0
18B4	AF33		ADD R15, #$34
18B6	2B5F		MOVE R11, $BE
18B8	FB1F		SUB R11, #$20
18BA	6CF0		MOVB R12, (R15)+
18BC	68B0		MOVB R8, (R11)+
18BE	C80C		SNS R8
18C0	A005		BRA $18C8		; $06(R0)

18C2	CC82		SE R12, R8
18C4	8AFF		LBI R10, #$FF
18C6	F00D		BRA $18BA		; -> -$0E(R0)

18C8	CA03		SZ R10
18CA	2098		JMP ($0130)

18CC	2F87		MOVE R15, $10E
18CE	AF6B		ADD R15, #$6C
18D0	DCF0		MOVE R12, (R15)'
18D2	0BCC		MHL R11, R12
18D4	81F0		LBI R1, #$F0
18D6	8AF2		LBI R10, #$F2
18D8	CC1A		SNE R12, R1
18DA	CBA9		SGE R11, R10
18DC	2098		JMP ($0130)

18DE	9BF0		CLR R11, #$F0
18E0	8101		LBI R1, #$01
18E2	CB16		SBC R11, R1
18E4	2098		JMP ($0130)

18E6	8108		LBI R1, #$08
18E8	8C06		LBI R12, #$06
18EA	CB18		SGT R11, R1
18EC	CBCA		SNE R11, R12
18EE	2098		JMP ($0130)

18F0	E0BF		STAT R11, $0
18F2	0FB4		MOVE R15, R11
18F4	811A		LBI R1, #$1A
18F6	011D		MLH R1, R1
18F8	814A		LBI R1, #$4A
18FA	0403		INC2 R4, R0
18FC	0014		RET R1

18FE	8702		LBI R7, #$02
1900	8C10		LBI R12, #$10
1902	C7C7		SBSH R7, R12
1904	8701		LBI R7, #$01
1906	8102		LBI R1, #$02
1908	C717		SBSH R7, R1
190A	A007		BRA $1914		; $08(R0)

190C	811A		LBI R1, #$1A
190E	011D		MLH R1, R1
1910	817C		LBI R1, #$7C
1912	0014		RET R1

1914	21A0		MOVE R1, $140
1916	3182		MOVE $104, R1
1918	8101		LBI R1, #$01
191A	C717		SBSH R7, R1
191C	A011		BRA $1930		; $12(R0)

191E	3181		MOVE $102, R1
1920	2FA2		MOVE R15, $144
1922	21A8		MOVE R1, $150
1924	0F16		OR R15, R1
1926	21A4		MOVE R1, $148
1928	0F1D		MLH R15, R1
192A	3F84		MOVE $108, R15
192C	22FB		MOVE R2, $1F6
192E	2099		JMP ($0132)

1930	8B40		LBI R11, #$40
1932	8180		LBI R1, #$80
1934	C71F		SNBSH R7, R1
1936	C6B5		SBS R6, R11
1938	A013		BRA $194E		; $14(R0)

193A	21A5		MOVE R1, $14A
193C	3183		MOVE $106, R1
193E	0203		INC2 R2, R0
1940	2099		JMP ($0132)

1942	21A7		MOVE R1, $14E
1944	3183		MOVE $106, R1
1946	8101		LBI R1, #$01
1948	C712		SE R7, R1
194A	A069		BRA $19B6		; $6A(R0)

194C	A047		BRA $1996		; $48(R0)

194E	0200		DEC2 R2, R0
1950	A20D		ADD R2, #$0E
1952	2B83		MOVE R11, $106
1954	8101		LBI R1, #$01
1956	C712		SE R7, R1
1958	A013		BRA $196E		; $14(R0)

195A	2099		JMP ($0132)

195C	0200		DEC2 R2, R0
195E	2F82		MOVE R15, $104
1960	2C83		MOVE R12, $106
1962	0BC4		MOVE R11, R12
1964	0FC8		ADD R15, R12
1966	0CFC		MHL R12, R15
1968	0CCA		ADDH R12, R12
196A	0FCD		MLH R15, R12
196C	3F82		MOVE $104, R15
196E	2FA5		MOVE R15, $14A
1970	8CFF		LBI R12, #$FF
1972	CFCF		SNBSH R15, R12
1974	8C00		LBI R12, #$00
1976	2A50		MOVE R10, $A0
1978	0FB9		SUB R15, R11
197A	0AFC		MHL R10, R15
197C	0BBC		MHL R11, R11
197E	0AB9		SUB R10, R11
1980	0FAD		MLH R15, R10
1982	3FA5		MOVE $14A, R15
1984	0AF6		OR R10, R15
1986	CA0B		SNZ R10
1988	A00B		BRA $1996		; $0C(R0)

198A	CC04		SS R12
198C	2099		JMP ($0132)

198E	CAC7		SBSH R10, R12
1990	CFCF		SNBSH R15, R12
1992	A001		BRA $1996		; $02(R0)

1994	2099		JMP ($0132)

1996	8101		LBI R1, #$01
1998	C712		SE R7, R1
199A	A005		BRA $19A2		; $06(R0)

199C	8165		LBI R1, #$65
199E	31FE		MOVE $1FC, R1
19A0	20FC		JMP ($01F8)

19A2	8703		LBI R7, #$03
19A4	0203		INC2 R2, R0
19A6	2099		JMP ($0132)

19A8	2E9D		MOVE R14, $13A
19AA	3E82		MOVE $104, R14
19AC	0203		INC2 R2, R0
19AE	20F8		JMP ($01F0)

19B0	8180		LBI R1, #$80
19B2	C615		SBS R6, R1
19B4	20FB		JMP ($01F6)

19B6	219D		MOVE R1, $13A
19B8	3182		MOVE $104, R1
19BA	2184		MOVE R1, $108
19BC	31A5		MOVE $14A, R1
19BE	21A2		MOVE R1, $144
19C0	3184		MOVE $108, R1
19C2	8704		LBI R7, #$04
19C4	0203		INC2 R2, R0
19C6	2099		JMP ($0132)

19C8	8102		LBI R1, #$02
19CA	C617		SBSH R6, R1
19CC	A009		BRA $19D8		; $0A(R0)

19CE	2C82		MOVE R12, $104
19D0	AC05		ADD R12, #$06
19D2	21A5		MOVE R1, $14A
19D4	51C8		MOVE (R12), R1
19D6	A04B		BRA $1A24		; $4C(R0)

19D8	2C87		MOVE R12, $10E
19DA	AC04		ADD R12, #$05
19DC	8104		LBI R1, #$04
19DE	C717		SBSH R7, R1
19E0	A003		BRA $19E6		; $04(R0)

19E2	0403		INC2 R4, R0
19E4	A049		BRA $1A30		; $4A(R0)

19E6	2F87		MOVE R15, $10E
19E8	AF29		ADD R15, #$2A
19EA	8CD7		LBI R12, #$D7
19EC	8108		LBI R1, #$08
19EE	C717		SBSH R7, R1
19F0	0C94		MOVE R12, R9
19F2	7CF0		MOVB (R15)+, R12
19F4	81C5		LBI R1, #$C5
19F6	71F8		MOVB (R15), R1
19F8	AF21		ADD R15, #$22
19FA	2CA5		MOVE R12, $14A
19FC	01CC		MHL R1, R12
19FE	71F0		MOVB (R15)+, R1
1A00	7CF4		MOVB (R15)-, R12
1A02	AF11		ADD R15, #$12
1A04	0CF4		MOVE R12, R15
1A06	2B5F		MOVE R11, $BE
1A08	FB1F		SUB R11, #$20
1A0A	6AB0		MOVB R10, (R11)+
1A0C	CA0C		SNS R10
1A0E	A003		BRA $1A14		; $04(R0)

1A10	7AC0		MOVB (R12)+, R10
1A12	F009		BRA $1A0A		; -> -$0A(R0)

1A14	AF0C		ADD R15, #$0D
1A16	2BA3		MOVE R11, $146
1A18	0A94		MOVE R10, R9
1A1A	CB9A		SNE R11, R9
1A1C	0ABC		MHL R10, R11
1A1E	CB9A		SNE R11, R9
1A20	0BA4		MOVE R11, R10
1A22	5BF8		MOVE (R15), R11
1A24	870B		LBI R7, #$0B
1A26	0203		INC2 R2, R0
1A28	2099		JMP ($0132)

1A2A	2E9D		MOVE R14, $13A
1A2C	22FB		MOVE R2, $1F6
1A2E	20F8		JMP ($01F0)

1A30	2FA6		MOVE R15, $14C
1A32	8B10		LBI R11, #$10
1A34	6AF0		MOVB R10, (R15)+
1A36	7AC0		MOVB (R12)+, R10
1A38	6AF0		MOVB R10, (R15)+
1A3A	FB00		SUB R11, #$01
1A3C	CA92		SE R10, R9
1A3E	F009		BRA $1A36		; -> -$0A(R0)

1A40	CB0C		SNS R11
1A42	0044		RET R4

1A44	79C0		MOVB (R12)+, R9
1A46	FB00		SUB R11, #$01
1A48	F009		BRA $1A40		; -> -$0A(R0)

1A4A	E0FF		STAT R15, $0
1A4C	8101		LBI R1, #$01
1A4E	0F1D		MLH R15, R1
1A50	3F8B		MOVE $116, R15
1A52	8F01		LBI R15, #$01
1A54	8110		LBI R1, #$10
1A56	C717		SBSH R7, R1
1A58	8F02		LBI R15, #$02
1A5A	0FFD		MLH R15, R15
1A5C	8F08		LBI R15, #$08
1A5E	3F8C		MOVE $118, R15
1A60	219D		MOVE R1, $13A
1A62	F13F		SUB R1, #$40
1A64	318D		MOVE $11A, R1
1A66	8102		LBI R1, #$02
1A68	011D		MLH R1, R1
1A6A	8100		LBI R1, #$00
1A6C	3183		MOVE $106, R1
1A6E	318E		MOVE $11C, R1
1A70	21A0		MOVE R1, $140
1A72	318F		MOVE $11E, R1
1A74	017C		MHL R1, R7
1A76	B102		SET R1, #$02
1A78	071D		MLH R7, R1
1A7A	0044		RET R4

1A7C	218D		MOVE R1, $11A
1A7E	3182		MOVE $104, R1
1A80	8101		LBI R1, #$01
1A82	C712		SE R7, R1
1A84	A003		BRA $1A8A		; $04(R0)

1A86	0203		INC2 R2, R0
1A88	2099		JMP ($0132)

1A8A	0203		INC2 R2, R0
1A8C	329F		MOVE $13E, R2
1A8E	A315		ADD R3, #$16
1A90	379C		MOVE $138, R7
1A92	2857		MOVE R8, $AE
1A94	0203		INC2 R2, R0
1A96	2056		JMP ($00AC)

1A98	E1FF		STAT R15, $1
1A9A	0FFD		MLH R15, R15
1A9C	E1FF		STAT R15, $1
1A9E	3F8F		MOVE $11E, R15
1AA0	1100		CTRL $1, #$00
1AA2	811E		LBI R1, #$1E
1AA4	011D		MLH R1, R1
1AA6	8148		LBI R1, #$48
1AA8	0403		INC2 R4, R0
1AAA	0014		RET R1

1AAC	279C		MOVE R7, $138
1AAE	F315		SUB R3, #$16
1AB0	229F		MOVE R2, $13E
1AB2	8701		LBI R7, #$01
1AB4	8110		LBI R1, #$10
1AB6	C717		SBSH R7, R1
1AB8	2099		JMP ($0132)

1ABA	8702		LBI R7, #$02
1ABC	8B01		LBI R11, #$01
1ABE	0BBD		MLH R11, R11
1AC0	8B00		LBI R11, #$00
1AC2	8119		LBI R1, #$19
1AC4	011D		MLH R1, R1
1AC6	816E		LBI R1, #$6E
1AC8	0014		RET R1

1ACA	8120		LBI R1, #$20
1ACC	C61F		SNBSH R6, R1
1ACE	A005		BRA $1AD6		; $06(R0)

1AD0	819F		LBI R1, #$9F
1AD2	31FE		MOVE $1FC, R1
1AD4	20FC		JMP ($01F8)

1AD6	61E0		MOVB R1, (R14)+
1AD8	C192		SE R1, R9
1ADA	20FC		JMP ($01F8)

1ADC	0403		INC2 R4, R0
1ADE	209A		JMP ($0134)

1AE0	3FA5		MOVE $14A, R15
1AE2	B701		SET R7, #$01
1AE4	0ED4		MOVE R14, R13
1AE6	0403		INC2 R4, R0
1AE8	209A		JMP ($0134)

1AEA	01FC		MHL R1, R15
1AEC	01F6		OR R1, R15
1AEE	C10B		SNZ R1
1AF0	20FC		JMP ($01F8)

1AF2	3FA1		MOVE $142, R15
1AF4	3F89		MOVE $112, R15
1AF6	0ED4		MOVE R14, R13
1AF8	0403		INC2 R4, R0
1AFA	209A		JMP ($0134)

1AFC	01FC		MHL R1, R15
1AFE	01F6		OR R1, R15
1B00	C103		SZ R1
1B02	C70B		SNZ R7
1B04	20FC		JMP ($01F8)

1B06	3FA2		MOVE $144, R15
1B08	3F84		MOVE $108, R15
1B0A	0ED3		INC2 R14, R13
1B0C	8103		LBI R1, #$03
1B0E	011D		MLH R1, R1
1B10	8100		LBI R1, #$00
1B12	3182		MOVE $104, R1
1B14	8704		LBI R7, #$04
1B16	0203		INC2 R2, R0
1B18	2099		JMP ($0132)

1B1A	8101		LBI R1, #$01
1B1C	C617		SBSH R6, R1
1B1E	A03D		BRA $1B5E		; $3E(R0)

1B20	CF0B		SNZ R15
1B22	A00B		BRA $1B30		; $0C(R0)

1B24	81F1		LBI R1, #$F1
1B26	8BF4		LBI R11, #$F4
1B28	CF1A		SNE R15, R1
1B2A	CCB2		SE R12, R11
1B2C	A08B		BRA $1BBA		; $8C(R0)

1B2E	A00D		BRA $1B3E		; $0E(R0)

1B30	2F87		MOVE R15, $10E
1B32	AF4C		ADD R15, #$4D
1B34	6CF0		MOVB R12, (R15)+
1B36	61F8		MOVB R1, (R15)
1B38	0C16		OR R12, R1
1B3A	CC03		SZ R12
1B3C	A05D		BRA $1B9C		; $5E(R0)

1B3E	2F84		MOVE R15, $108
1B40	AF00		ADD R15, #$01
1B42	3F84		MOVE $108, R15
1B44	2F89		MOVE R15, $112
1B46	FF00		SUB R15, #$01
1B48	3F89		MOVE $112, R15
1B4A	01FC		MHL R1, R15
1B4C	01F6		OR R1, R15
1B4E	C103		SZ R1
1B50	F03B		BRA $1B16		; -> -$3C(R0)

1B52	2CA2		MOVE R12, $144
1B54	3C84		MOVE $108, R12
1B56	0203		INC2 R2, R0
1B58	2099		JMP ($0132)

1B5A	8705		LBI R7, #$05
1B5C	A02F		BRA $1B8E		; $30(R0)

1B5E	CF03		SZ R15
1B60	A00B		BRA $1B6E		; $0C(R0)

1B62	8705		LBI R7, #$05
1B64	2F82		MOVE R15, $104
1B66	6CF0		MOVB R12, (R15)+
1B68	CC04		SS R12
1B6A	A02F		BRA $1B9C		; $30(R0)

1B6C	A01F		BRA $1B8E		; $20(R0)

1B6E	81F1		LBI R1, #$F1
1B70	8BF1		LBI R11, #$F1
1B72	CF1A		SNE R15, R1
1B74	CCB2		SE R12, R11
1B76	A001		BRA $1B7A		; $02(R0)

1B78	A03F		BRA $1BBA		; $40(R0)

1B7A	81F4		LBI R1, #$F4
1B7C	8BF0		LBI R11, #$F0
1B7E	CF1A		SNE R15, R1
1B80	CCB2		SE R12, R11
1B82	A035		BRA $1BBA		; $36(R0)

1B84	2F84		MOVE R15, $108
1B86	8101		LBI R1, #$01
1B88	CF12		SE R15, R1
1B8A	A02D		BRA $1BBA		; $2E(R0)

1B8C	8706		LBI R7, #$06
1B8E	21A5		MOVE R1, $14A
1B90	3184		MOVE $108, R1
1B92	21A1		MOVE R1, $142
1B94	3187		MOVE $10E, R1
1B96	0203		INC2 R2, R0
1B98	2099		JMP ($0132)

1B9A	A01D		BRA $1BBA		; $1E(R0)

1B9C	2CFB		MOVE R12, $1F6
1B9E	815A		LBI R1, #$5A
1BA0	31FE		MOVE $1FC, R1
1BA2	0103		INC2 R1, R0
1BA4	A103		ADD R1, #$04
1BA6	31FB		MOVE $1F6, R1
1BA8	20FC		JMP ($01F8)

1BAA	812E		LBI R1, #$2E
1BAC	C512		SE R5, R1
1BAE	F013		BRA $1B9C		; -> -$14(R0)

1BB0	3CFB		MOVE $1F6, R12
1BB2	8101		LBI R1, #$01
1BB4	C617		SBSH R6, R1
1BB6	F029		BRA $1B8E		; -> -$2A(R0)

1BB8	F067		BRA $1B52		; -> -$68(R0)

1BBA	22FB		MOVE R2, $1F6
1BBC	2E82		MOVE R14, $104
1BBE	CF03		SZ R15
1BC0	0203		INC2 R2, R0
1BC2	20F8		JMP ($01F0)

1BC4	22FB		MOVE R2, $1F6
1BC6	287D		MOVE R8, $FA
1BC8	2056		JMP ($00AC)

1BCA	329E		MOVE $13C, R2
1BCC	8E05		LBI R14, #$05
1BCE	0EED		MLH R14, R14
1BD0	8EC0		LBI R14, #$C0
1BD2	0203		INC2 R2, R0
1BD4	20F8		JMP ($01F0)

1BD6	2B81		MOVE R11, $102
1BD8	0B7D		MLH R11, R7
1BDA	3B81		MOVE $102, R11
1BDC	379C		MOVE $138, R7
1BDE	2151		MOVE R1, $A2
1BE0	8140		LBI R1, #$40
1BE2	C117		SBSH R1, R1
1BE4	A00B		BRA $1BF2		; $0C(R0)

1BE6	2E9B		MOVE R14, $136
1BE8	0403		INC2 R4, R0
1BEA	20FA		JMP ($01F4)

1BEC	812E		LBI R1, #$2E
1BEE	C512		SE R5, R1
1BF0	F009		BRA $1BE8		; -> -$0A(R0)

1BF2	2152		MOVE R1, $A4
1BF4	9101		CLR R1, #$01
1BF6	3152		MOVE $A4, R1
1BF8	2857		MOVE R8, $AE
1BFA	0203		INC2 R2, R0
1BFC	2056		JMP ($00AC)

1BFE	2862		MOVE R8, $C4
1C00	0203		INC2 R2, R0
1C02	2056		JMP ($00AC)

1C04	0004		NOP
1C06	811E		LBI R1, #$1E
1C08	011D		MLH R1, R1
1C0A	8148		LBI R1, #$48
1C0C	0403		INC2 R4, R0
1C0E	0014		RET R1

1C10	279C		MOVE R7, $138
1C12	2688		MOVE R6, $110
1C14	2E9B		MOVE R14, $136
1C16	2D9B		MOVE R13, $136
1C18	2F52		MOVE R15, $A4
1C1A	8180		LBI R1, #$80
1C1C	CF1F		SNBSH R15, R1
1C1E	A043		BRA $1C64		; $44(R0)

1C20	2F86		MOVE R15, $10C
1C22	0CFC		MHL R12, R15
1C24	8120		LBI R1, #$20
1C26	C71F		SNBSH R7, R1
1C28	209E		JMP ($013C)

1C2A	2B81		MOVE R11, $102
1C2C	8104		LBI R1, #$04
1C2E	CB15		SBS R11, R1
1C30	CF0B		SNZ R15
1C32	209E		JMP ($013C)

1C34	8101		LBI R1, #$01
1C36	C712		SE R7, R1
1C38	A017		BRA $1C52		; $18(R0)

1C3A	81F0		LBI R1, #$F0
1C3C	8BF1		LBI R11, #$F1
1C3E	CF1A		SNE R15, R1
1C40	CCB2		SE R12, R11
1C42	A001		BRA $1C46		; $02(R0)

1C44	8F00		LBI R15, #$00
1C46	81F9		LBI R1, #$F9
1C48	8BF0		LBI R11, #$F0
1C4A	CF1A		SNE R15, R1
1C4C	CCB2		SE R12, R11
1C4E	A001		BRA $1C52		; $02(R0)

1C50	8F00		LBI R15, #$00
1C52	22FB		MOVE R2, $1F6
1C54	2E9B		MOVE R14, $136
1C56	AE3F		ADD R14, #$40
1C58	CF03		SZ R15
1C5A	0203		INC2 R2, R0
1C5C	20F8		JMP ($01F0)

1C5E	22FB		MOVE R2, $1F6
1C60	287D		MOVE R8, $FA
1C62	2056		JMP ($00AC)

1C64	8101		LBI R1, #$01
1C66	0F1D		MLH R15, R1
1C68	3F52		MOVE $A4, R15
1C6A	2F51		MOVE R15, $A2
1C6C	0FFC		MHL R15, R15
1C6E	2C96		MOVE R12, $12C
1C70	8130		LBI R1, #$30
1C72	CF16		SBC R15, R1
1C74	3CFB		MOVE $1F6, R12
1C76	816D		LBI R1, #$6D
1C78	31FE		MOVE $1FC, R1
1C7A	20FC		JMP ($01F8)

1C7C	2152		MOVE R1, $A4
1C7E	B101		SET R1, #$01
1C80	3152		MOVE $A4, R1
1C82	1442		CTRL $4, #$42
1C84	68E8		MOVB R8, (R14)
1C86	0B94		MOVE R11, R9
1C88	C8BA		SNE R8, R11
1C8A	8B6D		LBI R11, #$6D
1C8C	0B8D		MLH R11, R8
1C8E	2558		MOVE R5, $B0
1C90	C503		SZ R5
1C92	A017		BRA $1CAC		; $18(R0)

1C94	FA00		SUB R10, #$01
1C96	81FF		LBI R1, #$FF
1C98	CA17		SBSH R10, R1
1C9A	F00D		BRA $1C8E		; -> -$0E(R0)

1C9C	8A40		LBI R10, #$40
1C9E	0AAD		MLH R10, R10
1CA0	8A00		LBI R10, #$00
1CA2	7BE8		MOVB (R14), R11
1CA4	01BC		MHL R1, R11
1CA6	01BD		MLH R1, R11
1CA8	0B14		MOVE R11, R1
1CAA	F01D		BRA $1C8E		; -> -$1E(R0)

1CAC	2150		MOVE R1, $A0
1CAE	3158		MOVE $B0, R1
1CB0	78E8		MOVB (R14), R8
1CB2	812F		LBI R1, #$2F
1CB4	C51A		SNE R5, R1
1CB6	207C		JMP ($00F8)

1CB8	812E		LBI R1, #$2E
1CBA	C512		SE R5, R1
1CBC	C70B		SNZ R7
1CBE	0044		RET R4

1CC0	813A		LBI R1, #$3A
1CC2	C51A		SNE R5, R1
1CC4	0044		RET R4

1CC6	813D		LBI R1, #$3D
1CC8	C51A		SNE R5, R1
1CCA	0044		RET R4

1CCC	8142		LBI R1, #$42
1CCE	C51A		SNE R5, R1
1CD0	0044		RET R4

1CD2	8145		LBI R1, #$45
1CD4	C51A		SNE R5, R1
1CD6	0044		RET R4

1CD8	8147		LBI R1, #$47
1CDA	C518		SGT R5, R1
1CDC	F061		BRA $1C7C		; -> -$62(R0)

1CDE	81F9		LBI R1, #$F9
1CE0	8BF0		LBI R11, #$F0
1CE2	C518		SGT R5, R1
1CE4	C5B9		SGE R5, R11
1CE6	A001		BRA $1CEA		; $02(R0)

1CE8	0044		RET R4

1CEA	8BC1		LBI R11, #$C1
1CEC	81C6		LBI R1, #$C6
1CEE	C518		SGT R5, R1
1CF0	C5B9		SGE R5, R11
1CF2	F077		BRA $1C7C		; -> -$78(R0)

1CF4	0044		RET R4
; ----

1CF6	1443		CTRL $4, #$43
1CF8	3EFF		MOVE $1FE, R14
1CFA	885A		LBI R8, #$5A
1CFC	2BFE		MOVE R11, $1FC
1CFE	CB89		SGE R11, R8
1D00	A00B		BRA $1D0E		; $0C(R0)

1D02	8E05		LBI R14, #$05
1D04	0EED		MLH R14, R14
1D06	8EC0		LBI R14, #$C0
1D08	0203		INC2 R2, R0
1D0A	20F8		JMP ($01F0)

1D0C	FE3F		SUB R14, #$40
1D0E	2AFD		MOVE R10, $1FA
1D10	0AB8		ADD R10, R11
1D12	2150		MOVE R1, $A0
1D14	8114		LBI R1, #$14
1D16	1102		CTRL $1, #$02
1D18	4110		PUTB $1, (R1)+
1D1A	4118		PUTB $1, (R1)
1D1C	F000		BRA $1D1D		; -> -$01(R0)

1D1E	01AE		GETB R10, $1
1D20	CA0C		SNS R10
1D22	A003		BRA $1D28		; $04(R0)

1D24	7AE0		MOVB (R14)+, R10
1D26	F009		BRA $1D1E		; -> -$0A(R0)

1D28	CB81		SLT R11, R8
1D2A	A003		BRA $1D30		; $04(R0)

1D2C	2EFF		MOVE R14, $1FE
1D2E	0024		RET R2

1D30	0ED4		MOVE R14, R13
1D32	37FF		MOVE $1FE, R7
1D34	2750		MOVE R7, $A0
1D36	0403		INC2 R4, R0
1D38	20FA		JMP ($01F4)

1D3A	8E05		LBI R14, #$05
1D3C	0EED		MLH R14, R14
1D3E	8EC0		LBI R14, #$C0
1D40	0203		INC2 R2, R0
1D42	20F8		JMP ($01F0)

1D44	27FF		MOVE R7, $1FE
1D46	20FB		JMP ($01F6)
; ----

; Convert hex digits (address in R14) to binary (R15)

1D48	A001		BRA $1D4C		; $02(R0)

1D4A	8B04		LBI R11, #$04		; four digits
1D4C	2F50		MOVE R15, $A0

1D4E	65E0		MOVB R5, (R14)+
1D50	81F9		LBI R1, #'9'
1D52	8AF0		LBI R10, #'0'
1D54	C518		SGT R5, R1
1D56	C5A9		SGE R5, R10
1D58	A003		BRA $1D5E		; $04(R0)

1D5A	F5EF		SUB R5, #'0'
1D5C	A00D		BRA $1D6C		; $0E(R0)

1D5E	81C6		LBI R1, #'F'
1D60	8AC1		LBI R10, #'A'
1D62	C518		SGT R5, R1
1D64	C5A9		SGE R5, R10
1D66	A019		BRA $1D82		; No hex digit

1D68	A509		ADD R5, #10
1D6A	F5C0		SUB R5, #'A'

1D6C	E0FF		SWAP R15
1D6E	0F56		OR R15, R5
1D70	FB00		SUB R11, #$01
1D72	8102		LBI R1, #$02
1D74	CB12		SE R11, R1
1D76	A003		BRA $1D7C		; $04(R0)

1D78	0FFD		MLH R15, R15
1D7A	8F00		LBI R15, #$00
1D7C	CB03		SZ R11
1D7E	F031		BRA $1D4E		; -> -$32(R0)

1D80	0044		RET R4

1D82	0DE4		MOVE R13, R14
1D84	20FC		JMP ($01F8)
; ----

; Convert word to hex

1D86	8B02		LBI R11, #$02
1D88	0F5C		MHL R15, R5		; convert high byte

1D8A	8A0F		LBI R10, #$0F
1D8C	E0FF		SWAP R15		; convert one nibble
1D8E	0AF5		AND R10, R15
1D90	8109		LBI R1, #$09
1D92	CA10		SLE R10, R1
1D94	AAC6		ADD R10, #$C7
1D96	AAEF		ADD R10, #'0'
1D98	7AE0		MOVB (R14)+, R10
1D9A	CB0C		SNS R11
1D9C	0044		RET R4			; all four nibbles done

1D9E	FB00		SUB R11, #$01
1DA0	CB0B		SNZ R11
1DA2	0F54		MOVE R15, R5
1DA4	F01B		BRA $1D8A		; convert low byte
; ----

1DA6	2850		MOVE R8, $A0
1DA8	61E0		MOVB R1, (R14)+
1DAA	A800		ADD R8, #$01
1DAC	C192		SE R1, R9
1DAE	F007		BRA $1DA8		; -> -$08(R0)

1DB0	8105		LBI R1, #$05
1DB2	C811		SLT R8, R1
1DB4	20FC		JMP ($01F8)

1DB6	0DE4		MOVE R13, R14
1DB8	FE01		SUB R14, #$02
1DBA	6FE4		MOVB R15, (R14)-
1DBC	88F0		LBI R8, #$F0
1DBE	CF85		SBS R15, R8
1DC0	20FC		JMP ($01F8)

1DC2	FFEF		SUB R15, #$F0
1DC4	2A50		MOVE R10, $A0
1DC6	6BE4		MOVB R11, (R14)-
1DC8	CB9A		SNE R11, R9
1DCA	0044		RET R4

1DCC	CB85		SBS R11, R8
1DCE	20FC		JMP ($01F8)

1DD0	FBEF		SUB R11, #$F0
1DD2	CA03		SZ R10
1DD4	A003		BRA $1DDA		; $04(R0)

1DD6	8A0A		LBI R10, #$0A
1DD8	A00D		BRA $1DE8		; $0E(R0)

1DDA	AA59		ADD R10, #$5A
1DDC	8164		LBI R1, #$64
1DDE	CA18		SGT R10, R1
1DE0	A005		BRA $1DE8		; $06(R0)

1DE2	8A03		LBI R10, #$03
1DE4	0AAD		MLH R10, R10
1DE6	8AE8		LBI R10, #$E8
1DE8	CB0B		SNZ R11
1DEA	F025		BRA $1DC6		; -> -$26(R0)

1DEC	FB00		SUB R11, #$01
1DEE	0FA8		ADD R15, R10
1DF0	01A4		MOVE R1, R10
1DF2	01FC		MHL R1, R15
1DF4	011B		ADDH2 R1, R1
1DF6	0F1D		MLH R15, R1
1DF8	F011		BRA $1DE8		; -> -$12(R0)
; ----

1DFA	A005		BRA $1E02		; $06(R0)
; ----

; Clear screen

1DFC	8E02		LBI R14, #$02
1DFE	0EED		MLH R14, R14
1E00	8E00		LBI R14, #$00

; Clear to end of screen

1E02	8940		LBI R9, #$40
1E04	099D		MLH R9, R9
1E06	59E1		MOVE (R14)+, R9
1E08	8106		LBI R1, #$06
1E0A	CE17		SBSH R14, R1
1E0C	F007		BRA $1E06		; -> -$08(R0)

1E0E	0024		RET R2
; ----

; Print "ERROR 0xx yyzz" with xx=IOCB_Ret, yy=IOCB_DA and zz=IOCB_Sub
; IOCB in R3

1E10	0C24		MOVE R12, R2		; Save R2

			; Clear bottom line
1E12	8E05		LBI R14, #$05
1E14	0EED		MLH R14, R14
1E16	8EC0		LBI R14, #$C0
1E18	0203		INC2 R2, R0
1E1A	F019		BRA $1E02		; -> -$1A(R0)

1E1C	FE3E		SUB R14, #$3F
1E1E	81C5		LBI R1, #'E'
1E20	71E0		MOVB (R14)+, R1		; 'E'
1E22	81D9		LBI R1, #'R'
1E24	011D		MLH R1, R1
1E26	51E1		MOVE (R14)+, R1		; 'RR'
1E28	8BD6		LBI R11, #'O'
1E2A	01BD		MLH R1, R11
1E2C	51E2		MOVE (R14)+', R1	; 'OR '
1E2E	81F0		LBI R1, #'0'
1E30	71E0		MOVB (R14)+, R1		; '0'
1E32	0B34		MOVE R11, R3
1E34	AB0B		ADD R11, #$0C		; IOCB_Ret
1E36	D1B8		MOVE R1, (R11)
1E38	51E2		MOVE (R14)+', R1
1E3A	D538		MOVE R5, (R3)		; IOCB_DA and _Sub
1E3C	0403		INC2 R4, R0
1E3E	F0B9		BRA $1D86		; Convert to hex

1E40	FE03		SUB R14, #$04
1E42	79E8		MOVB (R14), R9

1E44	08C4		MOVE R8, R12
1E46	2056		JMP ($00AC)		; Return to caller
; ----

1E48	8940		LBI R9, #$40
1E4A	099D		MLH R9, R9		; '  '
1E4C	811D		LBI R1, #$1D
1E4E	011D		MLH R1, R1
1E50	81FC		LBI R1, #$FC
1E52	0110		DEC2 R1, R1		; R1 <- $1DFA
1E54	31F8		MOVE $1F0, R1

1E56	811D		LBI R1, #$1D
1E58	011D		MLH R1, R1
1E5A	814A		LBI R1, #$4A
1E5C	31F9		MOVE $1F2, R1

1E5E	811C		LBI R1, #$1C
1E60	011D		MLH R1, R1
1E62	817C		LBI R1, #$7C
1E64	31FA		MOVE $1F4, R1

1E66	811C		LBI R1, #$1C
1E68	011D		MLH R1, R1
1E6A	81F6		LBI R1, #$F6
1E6C	31FC		MOVE $1F8, R1

1E6E	2F50		MOVE R15, $A0
1E70	8F14		LBI R15, #$14
1E72	8A0B		LBI R10, #$0B
1E74	0AAD		MLH R10, R10
1E76	8AF6		LBI R10, #$F6
1E78	1443		CTRL $4, #$43
1E7A	1102		CTRL $1, #$02
1E7C	41F0		PUTB $1, (R15)+
1E7E	41F8		PUTB $1, (R15)
1E80	F000		BRA $1E81		; -> -$01(R0)

1E82	01BE		GETB R11, $1
1E84	0BBD		MLH R11, R11
1E86	0004		NOP
1E88	01BE		GETB R11, $1
1E8A	3BFD		MOVE $1FA, R11
1E8C	0044		RET R4

1E8E	2F50		MOVE R15, $A0
1E90	AFFF		ADD R15, #$100
1E92	3F97		MOVE $12E, R15
1E94	8118		LBI R1, #$18
1E96	011D		MLH R1, R1
1E98	81FE		LBI R1, #$FE
1E9A	3198		MOVE $130, R1
1E9C	811B		LBI R1, #$1B
1E9E	011D		MLH R1, R1
1EA0	81CA		LBI R1, #$CA
1EA2	3199		MOVE $132, R1
1EA4	811D		LBI R1, #$1D
1EA6	011D		MLH R1, R1
1EA8	81A6		LBI R1, #$A6
1EAA	319A		MOVE $134, R1
1EAC	8104		LBI R1, #$04
1EAE	011D		MLH R1, R1
1EB0	8100		LBI R1, #$00
1EB2	319D		MOVE $13A, R1
1EB4	8C01		LBI R12, #$01
1EB6	0CCD		MLH R12, R12
1EB8	8C60		LBI R12, #$60
1EBA	0BC4		MOVE R11, R12
1EBC	AB7F		ADD R11, #$80
1EBE	2A50		MOVE R10, $A0
1EC0	5AC1		MOVE (R12)+, R10
1EC2	CCB2		SE R12, R11
1EC4	F005		BRA $1EC0		; -> -$06(R0)

1EC6	0044		RET R4

1EC8	0203		INC2 R2, R0
1ECA	A03F		BRA $1F0C		; $40(R0)

1ECC	0823		INC2 R8, R2
1ECE	1FFF		CTRL $F, #$FF
1ED0	2C80		MOVE R12, $100
1ED2	0FCC		MHL R15, R12
1ED4	8C7F		LBI R12, #$7F
1ED6	810E		LBI R1, #$0E
1ED8	CF12		SE R15, R1
1EDA	A00F		BRA $1EEC		; $10(R0)

1EDC	1E80		CTRL $E, #$80
1EDE	EE5F		STAT R5, $E
1EE0	C50C		SNS R5
1EE2	A017		BRA $1EFC		; $18(R0)

1EE4	0EBE		GETB R11, $E
1EE6	CBC2		SE R11, R12
1EE8	A011		BRA $1EFC		; $12(R0)

1EEA	2056		JMP ($00AC)

1EEC	1D80		CTRL $D, #$80
1EEE	ED5F		STAT R5, $D
1EF0	C50C		SNS R5
1EF2	A007		BRA $1EFC		; $08(R0)

1EF4	0DBE		GETB R11, $D
1EF6	CBC2		SE R11, R12
1EF8	A001		BRA $1EFC		; $02(R0)

1EFA	2056		JMP ($00AC)

1EFC	8BF1		LBI R11, #$F1
1EFE	0BBD		MLH R11, R11
1F00	8BF3		LBI R11, #$F3
1F02	C504		SS R5
1F04	8BF4		LBI R11, #$F4
1F06	3B86		MOVE $10C, R11
1F08	0824		MOVE R8, R2
1F0A	2056		JMP ($00AC)

1F0C	3253		MOVE $A6, R2
1F0E	0403		INC2 R4, R0
1F10	F0C9		BRA $1E48		; -> -$CA(R0)

1F12	0403		INC2 R4, R0
1F14	F087		BRA $1E8E		; -> -$88(R0)

1F16	2397		MOVE R3, $12E
1F18	810E		LBI R1, #$0E
1F1A	011D		MLH R1, R1
1F1C	8180		LBI R1, #$80
1F1E	3180		MOVE $100, R1
1F20	2150		MOVE R1, $A0
1F22	3181		MOVE $102, R1
1F24	219D		MOVE R1, $13A
1F26	3182		MOVE $104, R1
1F28	3183		MOVE $106, R1
1F2A	F17F		SUB R1, #$80
1F2C	319B		MOVE $136, R1
1F2E	0403		INC2 R4, R0
1F30	A05D		BRA $1F90		; $5E(R0)

1F32	A00F		BRA $1F44		; $10(R0)

1F34	810D		LBI R1, #$0D
1F36	011D		MLH R1, R1
1F38	8180		LBI R1, #$80
1F3A	3180		MOVE $100, R1
1F3C	0004		NOP
1F3E	0004		NOP
1F40	0403		INC2 R4, R0
1F42	A04B		BRA $1F90		; $4C(R0)

1F44	2154		MOVE R1, $A8
1F46	31A1		MOVE $142, R1
1F48	8140		LBI R1, #$40
1F4A	011D		MLH R1, R1
1F4C	8100		LBI R1, #$00
1F4E	31A0		MOVE $140, R1
1F50	2150		MOVE R1, $A0
1F52	0112		INC R1, R1
1F54	31A2		MOVE $144, R1
1F56	0004		NOP
1F58	0004		NOP
1F5A	2183		MOVE R1, $106
1F5C	31A7		MOVE $14E, R1
1F5E	8101		LBI R1, #$01
1F60	011D		MLH R1, R1
1F62	8160		LBI R1, #$60
1F64	3185		MOVE $10A, R1
1F66	2688		MOVE R6, $110
1F68	87C0		LBI R7, #$C0
1F6A	077D		MLH R7, R7
1F6C	8700		LBI R7, #$00
1F6E	0200		DEC2 R2, R0
1F70	A20D		ADD R2, #$0E
1F72	32FB		MOVE $1F6, R2
1F74	8117		LBI R1, #$17
1F76	011D		MLH R1, R1
1F78	8100		LBI R1, #$00
1F7A	0014		RET R1

1F7C	CF03		SZ R15
1F7E	0000		HALT
1F80	28A0		MOVE R8, $140
1F82	0882		INC R8, R8
1F84	2F56		MOVE R15, $AC
1F86	AF09		ADD R15, #$0A
1F88	2C50		MOVE R12, $A0
1F8A	8C84		LBI R12, #$84
1F8C	5CF8		MOVE (R15), R12
1F8E	2056		JMP ($00AC)

1F90	349E		MOVE $13C, R4
1F92	2857		MOVE R8, $AE
1F94	0203		INC2 R2, R0
1F96	2056		JMP ($00AC)

1F98	249E		MOVE R4, $13C
1F9A	2F86		MOVE R15, $10C
1F9C	2C80		MOVE R12, $100
1F9E	0CCC		MHL R12, R12
1FA0	8B0E		LBI R11, #$0E
1FA2	CF0B		SNZ R15
1FA4	0044		RET R4

1FA6	CCB2		SE R12, R11
1FA8	A00D		BRA $1FB8		; $0E(R0)

1FAA	0CFC		MHL R12, R15
1FAC	8BF1		LBI R11, #$F1
1FAE	8AF3		LBI R10, #$F3
1FB0	CCBA		SNE R12, R11
1FB2	CFA2		SE R15, R10
1FB4	A001		BRA $1FB8		; $02(R0)
1FB6	0043		INC2 R0, R4

1FB8	287D		MOVE R8, $FA
1FBA	0203		INC2 R2, R0
1FBC	2056		JMP ($00AC)

1FBE	0000		HALT
1FC0	0000		HALT
1FC2	0000		HALT
1FC4	0000		HALT
1FC6	0000		HALT
1FC8	0000		HALT
1FCA	0000		HALT
1FCC	0000		HALT
; ----

; Setup routine

1FCE	8105		LBI R1, #$05
1FD0	011D		MLH R1, R1
1FD2	8101		LBI R1, #$01
1FD4	31E0		MOVE $1C0, R1		; $1C0 <- $0501

1FD6	8108		LBI R1, #$08
1FD8	011D		MLH R1, R1
1FDA	8100		LBI R1, #$00
1FDC	3130		MOVE $60, R1		; R0L3 <- $0800

1FDE	810D		LBI R1, #$0D
1FE0	011D		MLH R1, R1
1FE2	8100		LBI R1, #$00
1FE4	317F		MOVE $FE, R1		; $FE <- $0D00

1FE6	810F		LBI R1, #$0F
1FE8	011D		MLH R1, R1
1FEA	8140		LBI R1, #$40
1FEC	3173		MOVE $E6, R1		; $E6 <- $0F40

1FEE	8110		LBI R1, #$10
1FF0	011D		MLH R1, R1
1FF2	8100		LBI R1, #$00
1FF4	317C		MOVE $F8, R1		; $F8 <- $1000

1FF6	A109		ADD R1, #$0A
1FF8	317D		MOVE $FA, R1		; $FA <- $100A

1FFA	0824		MOVE R8, R2
1FFC	2056		JMP ($00AC)		; Return

1FFE	F031		BRA $1FCE		; -> -$32(R0)

; **********************************************************************
; *** END OF ROS PART 1
; **********************************************************************

; **********************************************************************
; *** BEGIN OF ROS PART 2
; **********************************************************************

; ***************************
; Device D (Disk) I/O Routine
; ***************************

2000	3269		MOVE $D2, R2		; Save return address

2002	D538		MOVE R5, (R3)
2004	055C		MHL R5, R5
2006	810D		LBI R1, #$0D		; Is IOCB_DA = $D ?
2008	C51A		SNE R5, R1
200A	A003		BRA $2010		; Yes

			; Device address not $Dx0
			
200C	865E		LBI R6, #$5E		; Error 02
200E	A065		BRA $2076

			; Device address correct

2010	1F01		CTRL $F, #$01		; Reset diskette adapter
2012	2853		MOVE R8, $A6
2014	0203		INC2 R2, R0
2016	2056		JMP ($00AC)		; Test if device ready
2018	A01D		BRA $2038		; Not ready

			; Device ready

201A	D538		MOVE R5, (R3)
201C	810F		LBI R1, #$0F		; Test subdevice
201E	C516		SBC R5, R1
2020	F015		BRA $200C		; Subdevice not $x0

			; Subdevice OK

2022	0433		INC2 R4, R3
2024	6548		MOVB R5, (R4)		; IOCB_Cmd
2026	C503		SZ R5
2028	A00F		BRA $203A		; Not Sense command

			; Sense

202A	A40D		ADD R4, #$0E
202C	2750		MOVE R7, $A0
202E	8704		LBI R7, #$04
2030	5748		MOVE (R4), R7		; Set IOCB_Stat1 to $0004

2032	2862		MOVE R8, $C4
2034	0203		INC2 R2, R0
2036	2056		JMP ($00AC)		; Wait for printer
2038	A0E9		BRA $2124		; Exit if error

203A	8400		LBI R4, #$00
203C	044D		MLH R4, R4
203E	84A4		LBI R4, #$A4
2040	6548		MOVB R5, (R4)
2042	B502		SET R5, #$02		; Set I/O active flag
2044	7540		MOVB (R4)+, R5
2046	6548		MOVB R5, (R4)
2048	9520		CLR R5, #$20		; Level 2 in ROS
204A	B508		SET R5, #$08		; (?)
204C	7548		MOVB (R4), R5
204E	4048		PUTB $0, (R4)

2050	106F		CTRL $0, #$6F		; CRT off
2052	8508		LBI R5, #$08
2054	3548		MOVE $90, R5
2056	ED5F		STAT R5, $D		; Diskette sense byte
2058	8108		LBI R1, #$08
205A	C515		SBS R5, R1		; Erase Gate Sense ?
205C	A003		BRA $2062		; No
205E	861E		LBI R6, #$1E		; Error 34
2060	A013		BRA $2076		; Exit

2062	1D01		CTRL $D, #$01		; Reset Read/Write/Diag
2064	0433		INC2 R4, R3
2066	6548		MOVB R5, (R4)		; IOCB_Cmd
2068	C50B		SNZ R5
206A	A0BD		BRA $212A		; Sense command

			; Other command

206C	0D7E		GETB R7, $D		; Access Sense byte
206E	8180		LBI R1, #$80
2070	C715		SBS R7, R1		; New Media ?
2072	A00B		BRA $2080		; No

			; New media -> error

2074	8626		LBI R6, #$26		; Error 30

2076	813E		LBI R1, #$3E
2078	011D		MLH R1, R1
207A	81FA		LBI R1, #$FA
207C	0203		INC2 R2, R0
207E	0014		RET R1			; Error exit
						; (doesn't return)

2080	8104		LBI R1, #$04
2082	C512		SE R5, R1		; Find command ?
2084	A007		BRA $208E		; No

			; Find

2086	8123		LBI R1, #$23
2088	011D		MLH R1, R1
208A	8116		LBI R1, #$16
208C	0014		RET R1			; Jump to $2316
; ----

208E	8105		LBI R1, #$05
2090	C512		SE R5, R1		; Mark command ?
2092	A007		BRA $209C		; No

			; Mark

2094	8124		LBI R1, #$24
2096	011D		MLH R1, R1
2098	81A6		LBI R1, #$A6
209A	0014		RET R1			; Jump to $24A6
; ----

209C	D748		MOVE R7, (R4)		; IOCB_Flags to Lo(R7)
209E	8101		LBI R1, #$01
20A0	C716		SBC R7, R1		; Absolute command ?
20A2	A033		BRA $20D8		; Yes, skip following tests

			; The following commands are not availavle
			; with the absolute flag set

20A4	A407		ADD R4, #$08
20A6	D448		MOVE R4, (R4)		; IOCB_WA
20A8	A408		ADD R4, #$09
20AA	6748		MOVB R7, (R4)
20AC	C70C		SNS R7
20AE	A033		BRA $20E4		; $34(R0)

20B0	8103		LBI R1, #$03		; Write last ?
20B2	C51A		SNE R5, R1
20B4	A02B		BRA $20E2		; Yes, jump to write routine

20B6	8108		LBI R1, #$08		; (???)
20B8	C51A		SNE R5, R1
20BA	A01F		BRA $20DC		; (Jump to read routine)

20BC	810B		LBI R1, #$0B		; Write Header ?
20BE	C512		SE R5, R1
20C0	A007		BRA $20CA		; No

			; Write Header

20C2	8127		LBI R1, #$27
20C4	011D		MLH R1, R1
20C6	8114		LBI R1, #$14
20C8	0014		RET R1			; JMP $2714
; ----

20CA	810C		LBI R1, #$0C		; Scan ?
20CC	C512		SE R5, R1
20CE	A007		BRA $20D8		; No

20D0	8128		LBI R1, #$28
20D2	011D		MLH R1, R1
20D4	8140		LBI R1, #$40
20D6	0014		RET R1			; JMP $2840
; ----

			; Read/Write

20D8	8101		LBI R1, #$01		; Read ?
20DA	C51A		SNE R5, R1
20DC	A0DB		BRA $21BA		; Yes
; ----

20DE	8102		LBI R1, #$02		; Write ?
20E0	C51A		SNE R5, R1
20E2	A0D3		BRA $21B8		; Yes
; ----

20E4	8110		LBI R1, #$10		; Find ID ?
20E6	C512		SE R5, R1
20E8	A017		BRA $2102		; No

			; Find ID

			; Preset track, side and sector from CI1
20EA	8137		LBI R1, #$37
20EC	011D		MLH R1, R1
20EE	811E		LBI R1, #$1E
20F0	0203		INC2 R2, R0
20F2	0014		RET R1			; CALL $371E,R2

			; Locate sector on disk (implies seek etc)
20F4	8137		LBI R1, #$37
20F6	011D		MLH R1, R1
20F8	8180		LBI R1, #$80
20FA	0203		INC2 R2, R0
20FC	0014		RET R1			; CALL $3780,R2

20FE	1D01		CTRL $D, #$01
2100	A015		BRA $2118		; Finished
; ----

2102	8111		LBI R1, #$11		; Initialize Head ?
2104	C512		SE R5, R1
2106	A00B		BRA $2114		; No, error 02

			; Initialize Head

2108	813A		LBI R1, #$3A
210A	011D		MLH R1, R1
210C	816C		LBI R1, #$6C
210E	0203		INC2 R2, R0
2110	0014		RET R1			; CALL $3A6C,R2
2112	A003		BRA $2118		; Finished
; ----

2114	865E		LBI R6, #$5E		; Error 02
2116	F0A1		BRA $2076		; Error exit
; ----

			; Exit Diskette I/O Supervisor

2118	2552		MOVE R5, $A4
211A	015C		MHL R1, R5
211C	9102		CLR R1, #$02		; Clear I/O active flag
211E	9508		CLR R5, #$08
2120	051D		MLH R5, R1
2122	3552		MOVE $A4, R5

2124	2269		MOVE R2, $D2
2126	0824		MOVE R8, R2
2128	2056		JMP ($00AC)		; Return to caller

; ***********************
; Diskette I/O Supervisor
; Sense Routine
; ***********************

212A	0D5E		GETB R5, $D		; Access Sense Byte
212C	8180		LBI R1, #$80
212E	C515		SBS R5, R1		; New Media ?
2130	A025		BRA $2158		; No

			; New Media
			; Set track value to $FF (=new media)

2132	8BFF		LBI R11, #$FF
2134	813B		LBI R1, #$3B
2136	011D		MLH R1, R1
2138	817C		LBI R1, #$7C
213A	0203		INC2 R2, R0
213C	0014		RET R1			; Set track value

213E	0433		INC2 R4, R3
2140	D548		MOVE R5, (R4)
2142	B540		SET R5, #$40		; IOCB_Flags
2144	5548		MOVE (R4), R5

			; Test index timing

2146	813A		LBI R1, #$3A
2148	011D		MLH R1, R1
214A	81DC		LBI R1, #$DC
214C	0203		INC2 R2, R0
214E	0014		RET R1			; CALL $3ADC, R2

2150	0D5E		GETB R5, $D		; Access Sense Byte
2152	2450		MOVE R4, $A0
2154	840B		LBI R4, #$0B		; Address of Lo(R5)
2156	4D48		PUTB $D, (R4)		; This clears New Media bit

			; No new media

2158	813B		LBI R1, #$3B
215A	011D		MLH R1, R1
215C	8178		LBI R1, #$78
215E	0203		INC2 R2, R0
2160	0014		RET R1			; Get track value

2162	CB04		SS R11			; Track $FF ?
2164	A009		BRA $2170		; No

			; Track unknown

2166	813A		LBI R1, #$3A
2168	011D		MLH R1, R1
216A	816C		LBI R1, #$6C
216C	0203		INC2 R2, R0
216E	0014		RET R1			; Recalibrate

			; Track known

2170	2550		MOVE R5, $A0
2172	354D		MOVE $9A, R5		; Track 0
2174	354E		MOVE $9C, R5
2176	8507		LBI R5, #$07		; Sector 7
2178	354F		MOVE $9E, R5
217A	85D0		LBI R5, #$D0		; Max. 8 revolutions to find
217C	354C		MOVE $98, R5		; sector ($D0 / 26 = 8)

217E	8134		LBI R1, #$34
2180	011D		MLH R1, R1
2182	8138		LBI R1, #$38
2184	0203		INC2 R2, R0
2186	0014		RET R1			; Read sector

2188	C60B		SNZ R6			; Error returned ?
218A	A003		BRA $2190		; No

218C	8632		LBI R6, #$32		; Error 24
218E	A0A7		BRA $2238		; Exit

2190	813A		LBI R1, #$3A
2192	011D		MLH R1, R1
2194	8114		LBI R1, #$14
2196	0203		INC2 R2, R0
2198	0014		RET R1			; Verify volume header

219A	8133		LBI R1, #$33
219C	011D		MLH R1, R1
219E	817E		LBI R1, #$7E
21A0	0203		INC2 R2, R0
21A2	0014		RET R1			; Verify diskette parameters

21A4	A401		ADD R4, #$02
21A6	2750		MOVE R7, $A0
21A8	870A		LBI R7, #$0A
21AA	5748		MOVE (R4), R7		; IOCB_CI1 <- $000A

21AC	A407		ADD R4, #$08
21AE	87F1		LBI R7, #$F1
21B0	077D		MLH R7, R7
21B2	87C4		LBI R7, #$C4
21B4	5748		MOVE (R4), R7		; IOCB_Stat1 <- '1D'

21B6	F09F		BRA $2118		; Return
; ----------

			; Write

21B8	A0C5		BRA $2280		; $C6(R0)

; ***********************
; Diskette I/O Supervisor
; ***********************
; Read Routine

21BA	0434		MOVE R4, R3
21BC	A402		ADD R4, #$03		; IOCB_Flags
21BE	6548		MOVB R5, (R4)
21C0	8101		LBI R1, #$01
21C2	C516		SBC R5, R1
21C4	A09D		BRA $2264		; Absolute Read

; ***********************
; Diskette I/O Supervisor
; Normal Read Routine
; ***********************

21C6	2548		MOVE R5, $90
21C8	9508		CLR R5, #$08
21CA	3548		MOVE $90, R5

			; Get number of sectors (-> R2L2)
21CC	8129		LBI R1, #$29
21CE	011D		MLH R1, R1
21D0	819C		LBI R1, #$9C
21D2	0203		INC2 R2, R0
21D4	0014		RET R1			; CALL $299C, R2

21D6	0434		MOVE R4, R3
21D8	A40D		ADD R4, #$0E
21DA	2550		MOVE R5, $A0
21DC	5548		MOVE (R4), R5		; Clear IOCB_CI2

21DE	F409		SUB R4, #$0A
21E0	D548		MOVE R5, (R4)		; IOCB_BA
21E2	352E		MOVE $5C, R5		; R14L2

			; Test if operation within file limits
21E4	8133		LBI R1, #$33
21E6	011D		MLH R1, R1
21E8	8136		LBI R1, #$36
21EA	0203		INC2 R2, R0
21EC	0014		RET R1			; Call $3336, R2

			; Calculate track, side and sector for I/O
21EE	0434		MOVE R4, R3
21F0	A407		ADD R4, #$08		; IOCB_CI1
21F2	DD48		MOVE R13, (R4)		; Get file offset
21F4	812F		LBI R1, #$2F
21F6	011D		MLH R1, R1
21F8	8112		LBI R1, #$12
21FA	0203		INC2 R2, R0
21FC	0014		RET R1			; CALL $2F12, R2

			; Read sector
21FE	8134		LBI R1, #$34
2200	011D		MLH R1, R1
2202	8138		LBI R1, #$38
2204	0203		INC2 R2, R0
2206	0014		RET R1			; CALL $3438, R2

			; Test if any error or flags
2208	C603		SZ R6
220A	A01B		BRA $2228		; Yes, error or flag

			; No, everything's ok
220C	0434		MOVE R4, R3
220E	A40D		ADD R4, #$0E		; IOCB_CI2
2210	D548		MOVE R5, (R4)
2212	A500		ADD R5, #$01
2214	5548		MOVE (R4), R5		; Increment number of read sect.

			; Adjust current buffer address for read interrupt
2216	8136		LBI R1, #$36
2218	011D		MLH R1, R1
221A	81F8		LBI R1, #$F8
221C	0203		INC2 R2, R0
221E	0014		RET R1			; CALL $36F8, R2

			; Decrement loop count
2220	2522		MOVE R5, $44		; R2L2
2222	F500		SUB R5, #$01
2224	3522		MOVE $44, R5
2226	A025		BRA $224E		; $26(R0)
; ----

			; Error or flag returned from read routine
2228	2529		MOVE R5, $52
222A	81C6		LBI R1, #$C6		; Flag 'F' (bad sector) ?
222C	C51A		SNE R5, R1
222E	A011		BRA $2242		; Yes

2230	81C4		LBI R1, #$C4		; Flag 'D' (DDAM) ?
2232	C51A		SNE R5, R1
2234	A00B		BRA $2242		; Yes

			; Hard error
2236	8618		LBI R6, #$18		; Error 37
2238	813E		LBI R1, #$3E
223A	011D		MLH R1, R1
223C	81FA		LBI R1, #$FA
223E	0203		INC2 R2, R0
2240	0014		RET R1			; Error exit
; ----

2242	0434		MOVE R4, R3
2244	A402		ADD R4, #$03		; IOCB_Flags
2246	6548		MOVB R5, (R4)
2248	8108		LBI R1, #$08
224A	C516		SBC R5, R1
224C	A02D		BRA $227C		; Error 44

			; Increment file offset
224E	8133		LBI R1, #$33
2250	011D		MLH R1, R1
2252	812A		LBI R1, #$2A
2254	0203		INC2 R2, R0
2256	0014		RET R1			; CALL $332A, R2

			; Loop if any sectors left, else return to caller
2258	2522		MOVE R5, $44		; R2L2
225A	015C		MHL R1, R5
225C	0516		OR R5, R1
225E	C503		SZ R5
2260	F07D		BRA $21E4		; Loop
2262	F0AD		BRA $21B6		; Return
; ----

			; Absolute Read

			; Preset track, side and sector from CI1
2264	8137		LBI R1, #$37
2266	011D		MLH R1, R1
2268	811E		LBI R1, #$1E
226A	0203		INC2 R2, R0
226C	0014		RET R1			; CALL $371E, R2

			; Read sector
226E	8134		LBI R1, #$34
2270	011D		MLH R1, R1
2272	8138		LBI R1, #$38
2274	0203		INC2 R2, R0
2276	0014		RET R1			; CALL $3438, R2

2278	C60B		SNZ R6
227A	F0C5		BRA $21B6		; Return

227C	860A		LBI R6, #$0A		; Error 44
227E	F047		BRA $2238		; Error exit

; ***********************
; Diskette I/O Supervisor
; ***********************
; Write Routine

2280	0434		MOVE R4, R3
2282	A402		ADD R4, #$03
2284	6548		MOVB R5, (R4)
2286	8101		LBI R1, #$01
2288	C516		SBC R5, R1
228A	A067		BRA $22F4		; Absolute Write

; ***********************
; Diskette I/O Supervisor
; ***********************
; Normal Write Routine

228C	A404		ADD R4, #$05
228E	D748		MOVE R7, (R4)
2290	A401		ADD R4, #$02
2292	D448		MOVE R4, (R4)
2294	A401		ADD R4, #$02
2296	D841		MOVE R8, (R4)+
2298	057C		MHL R5, R7
229A	0A8C		MHL R10, R8
229C	C5A0		SLE R5, R10
229E	A017		BRA $22B8		; $18(R0)

22A0	C5A1		SLT R5, R10
22A2	C788		SGT R7, R8
22A4	A001		BRA $22A8		; $02(R0)

22A6	A00F		BRA $22B8		; $10(R0)

22A8	D848		MOVE R8, (R4)
22AA	3875		MOVE $EA, R8
22AC	0A8C		MHL R10, R8
22AE	C5A0		SLE R5, R10
22B0	A005		BRA $22B8		; $06(R0)

22B2	C5A1		SLT R5, R10
22B4	C788		SGT R7, R8
22B6	A003		BRA $22BC		; $04(R0)

22B8	864E		LBI R6, #$4E
22BA	F083		BRA $2238		; -> -$84(R0)

22BC	8129		LBI R1, #$29
22BE	011D		MLH R1, R1
22C0	819C		LBI R1, #$9C
22C2	0203		INC2 R2, R0
22C4	0014		RET R1

22C6	2548		MOVE R5, $90
22C8	9528		CLR R5, #$28
22CA	3548		MOVE $90, R5
22CC	8134		LBI R1, #$34
22CE	011D		MLH R1, R1
22D0	819E		LBI R1, #$9E
22D2	0203		INC2 R2, R0
22D4	0014		RET R1

22D6	0434		MOVE R4, R3
22D8	A407		ADD R4, #$08
22DA	D741		MOVE R7, (R4)+
22DC	D441		MOVE R4, (R4)+
22DE	A401		ADD R4, #$02
22E0	D848		MOVE R8, (R4)
22E2	057C		MHL R5, R7
22E4	0A8C		MHL R10, R8
22E6	C5A0		SLE R5, R10
22E8	A005		BRA $22F0		; $06(R0)

22EA	C5A1		SLT R5, R10
22EC	C788		SGT R7, R8
22EE	A001		BRA $22F2		; $02(R0)

22F0	5748		MOVE (R4), R7
22F2	F079		BRA $227A		; -> -$7A(R0)

; ***********************
; Diskette I/O Supervisor
; ***********************
; Absolute Write Routine

22F4	8137		LBI R1, #$37
22F6	011D		MLH R1, R1
22F8	811E		LBI R1, #$1E
22FA	0203		INC2 R2, R0
22FC	0014		RET R1			; preset track/side/sector

22FE	2548		MOVE R5, $90
2300	9520		CLR R5, #$20
2302	3548		MOVE $90, R5

2304	8134		LBI R1, #$34
2306	011D		MLH R1, R1
2308	819E		LBI R1, #$9E
230A	0203		INC2 R2, R0
230C	0014		RET R1

230E	C60B		SNZ R6
2310	F097		BRA $227A		; -> -$98(R0)

2312	863C		LBI R6, #$3C
2314	F0DD		BRA $2238		; -> -$DE(R0)

; ***********************
; Diskette I/O Supervisor
; Find Routine
; ***********************

2316	0434		MOVE R4, R3
2318	A409		ADD R4, #$0A
231A	D748		MOVE R7, (R4)		; IOCB_WA
231C	A708		ADD R7, #$09
231E	85FF		LBI R5, #$FF
2320	7578		MOVB (R7), R5

2322	F406		SUB R4, #$07		; IOCB_Flags
2324	6548		MOVB R5, (R4)
2326	8106		LBI R1, #$06		; Bits 5 and 6
2328	C515		SBS R5, R1		; Both bits set ?
232A	A003		BRA $2330		; No

			; Invalid IOCB_Flags

232C	865E		LBI R6, #$5E		; Error 02
232E	A05D		BRA $238E

			; Flags OK

2330	8104		LBI R1, #$04		; Test bit 5
2332	C516		SBC R5, R1		; Clear = Find by number
2334	A023		BRA $235A		; Find by name

			; Check file number

2336	A404		ADD R4, #$05
2338	D541		MOVE R5, (R4)+		; IOCB_CI1
233A	3575		MOVE $EA, R5		; Contains file number
233C	8180		LBI R1, #$80
233E	C51F		SNBSH R5, R1		; File number in valid range ?
2340	A049		BRA $238C		; No, error 36

2342	015C		MHL R1, R5
2344	0156		OR R1, R5
2346	C10B		SNZ R1			; File number <> 0 ?
2348	A041		BRA $238C		; No, error 36

			; File number valid

234A	D448		MOVE R4, (R4)		; IOCB_WA
234C	A405		ADD R4, #$06
234E	5548		MOVE (R4), R5		; Store file number in WA

2350	0433		INC2 R4, R3
2352	D848		MOVE R8, (R4)		; IOCB_Flags
2354	8102		LBI R1, #$02		; Test bit 6
2356	C815		SBS R8, R1
2358	A0DD		BRA $2438		; $DE(R0)

			; Find by name

235A	2548		MOVE R5, $90
235C	9502		CLR R5, #$02
235E	3548		MOVE $90, R5

2360	8131		LBI R1, #$31
2362	011D		MLH R1, R1
2364	81BA		LBI R1, #$BA
2366	0203		INC2 R2, R0
2368	0014		RET R1			; CALL $31BA, R2

236A	0433		INC2 R4, R3
236C	D748		MOVE R7, (R4)		; IOCB_Flags
236E	8102		LBI R1, #$02		; Test bit 6
2370	C715		SBS R7, R1
2372	A01B		BRA $2390		; $1C(R0)

2374	A405		ADD R4, #$06
2376	D748		MOVE R7, (R4)		; IOCB_CI1
2378	377B		MOVE $F6, R7
237A	0579		SUB R5, R7
237C	075C		MHL R7, R5
237E	055D		MLH R5, R5
2380	057C		MHL R5, R7
2382	0759		SUB R7, R5
2384	055C		MHL R5, R5
2386	057D		MLH R5, R7		; R5 <- R5 - R7
2388	A500		ADD R5, #$01
238A	A009		BRA $2396		; $0A(R0)

238C	861A		LBI R6, #$1A		; Error 36
238E	A0CB		BRA $245C
; ----

2390	2750		MOVE R7, $A0
2392	8701		LBI R7, #$01
2394	377B		MOVE $F6, R7

2396	3547		MOVE $8E, R5
2398	0434		MOVE R4, R3
239A	A403		ADD R4, #$04
239C	D548		MOVE R5, (R4)
239E	3577		MOVE $EE, R5
23A0	257B		MOVE R5, $F6
23A2	812F		LBI R1, #$2F
23A4	011D		MLH R1, R1
23A6	81E8		LBI R1, #$E8
23A8	0203		INC2 R2, R0
23AA	0014		RET R1

23AC	8134		LBI R1, #$34
23AE	011D		MLH R1, R1
23B0	8138		LBI R1, #$38
23B2	0203		INC2 R2, R0
23B4	0014		RET R1

23B6	C603		SZ R6
23B8	A05F		BRA $241A		; $60(R0)

23BA	2548		MOVE R5, $90
23BC	8110		LBI R1, #$10
23BE	C515		SBS R5, R1
23C0	A013		BRA $23D6		; $14(R0)

23C2	2477		MOVE R4, $EE
23C4	257B		MOVE R5, $F6
23C6	8101		LBI R1, #$01
23C8	C516		SBC R5, R1
23CA	A47F		ADD R4, #$80
23CC	3477		MOVE $EE, R4
23CE	6548		MOVB R5, (R4)
23D0	81C4		LBI R1, #$C4
23D2	C51A		SNE R5, R1
23D4	A01B		BRA $23F2		; $1C(R0)

23D6	0433		INC2 R4, R3
23D8	D748		MOVE R7, (R4)
23DA	8102		LBI R1, #$02
23DC	C715		SBS R7, R1
23DE	A007		BRA $23E8		; $08(R0)

23E0	257B		MOVE R5, $F6
23E2	3575		MOVE $EA, R5
23E4	A07F		BRA $2466		; $80(R0)

23E6	F0D7		BRA $2310		; -> -$D8(R0)

23E8	8129		LBI R1, #$29
23EA	011D		MLH R1, R1
23EC	8166		LBI R1, #$66
23EE	0203		INC2 R2, R0
23F0	0014		RET R1

23F2	257B		MOVE R5, $F6
23F4	A500		ADD R5, #$01
23F6	357B		MOVE $F6, R5
23F8	2547		MOVE R5, $8E
23FA	F500		SUB R5, #$01
23FC	3547		MOVE $8E, R5
23FE	015C		MHL R1, R5
2400	0156		OR R1, R5
2402	C10B		SNZ R1
2404	A029		BRA $2430		; $2A(R0)

2406	2548		MOVE R5, $90
2408	8110		LBI R1, #$10
240A	C515		SBS R5, R1
240C	F075		BRA $2398		; -> -$76(R0)

240E	257B		MOVE R5, $F6
2410	8101		LBI R1, #$01
2412	C515		SBS R5, R1
2414	F07D		BRA $2398		; -> -$7E(R0)

2416	2477		MOVE R4, $EE
2418	F04F		BRA $23CA		; -> -$50(R0)

241A	2548		MOVE R5, $90
241C	8110		LBI R1, #$10
241E	C515		SBS R5, R1
2420	F02F		BRA $23F2		; -> -$30(R0)

2422	257B		MOVE R5, $F6
2424	A501		ADD R5, #$02
2426	357B		MOVE $F6, R5
2428	2547		MOVE R5, $8E
242A	F501		SUB R5, #$02
242C	3547		MOVE $8E, R5
242E	F031		BRA $23FE		; -> -$32(R0)

2430	2548		MOVE R5, $90
2432	8102		LBI R1, #$02
2434	C515		SBS R5, R1
2436	A04D		BRA $2486		; $4E(R0)

			; Find by number

2438	2575		MOVE R5, $EA		; Get file number
243A	812F		LBI R1, #$2F
243C	011D		MLH R1, R1
243E	81E8		LBI R1, #$E8
2440	0203		INC2 R2, R0
2442	0014		RET R1			; Get location of dir. entry

2444	8134		LBI R1, #$34
2446	011D		MLH R1, R1
2448	8138		LBI R1, #$38
244A	0203		INC2 R2, R0
244C	0014		RET R1			; Read sector

244E	C60B		SNZ R6			; Errors ?
2450	A013		BRA $2466		; No

2452	2529		MOVE R5, $52		; R9L2
2454	81C4		LBI R1, #$C4
2456	C51A		SNE R5, R1		; First data byte 'D' ?
2458	A02B		BRA $2486		; Yes, deleted dir. entry

245A	8618		LBI R6, #$18		; Error 37

245C	813E		LBI R1, #$3E
245E	011D		MLH R1, R1
2460	81FA		LBI R1, #$FA
2462	0203		INC2 R2, R0
2464	0014		RET R1			; Error exit

			; No errors during read of directory entry

2466	0434		MOVE R4, R3
2468	A403		ADD R4, #$04
246A	D743		MOVE R7, (R4)++		; IOCB_BA

246C	2575		MOVE R5, $EA
246E	5548		MOVE (R4), R5		; Store file no. in IOCB_CI1

2470	2848		MOVE R8, $90
2472	8110		LBI R1, #$10
2474	C815		SBS R8, R1		; MFM (Diskette 2D) ?
2476	A011		BRA $248A		; No

2478	8101		LBI R1, #$01
247A	C516		SBC R5, R1		; Odd file number ?
247C	A77F		ADD R7, #$80		; Yes, add offset 128 bytes

247E	6878		MOVB R8, (R7)
2480	81C4		LBI R1, #$C4
2482	C812		SE R8, R1		; Deleted dir. entry ?
2484	A003		BRA $248A		; No

			; Deleted directory entry

2486	8610		LBI R6, #$10		; Error 41
2488	F02D		BRA $245C		; Exit

			; Directory entry valid

248A	A405		ADD R4, #$06
248C	5747		MOVE (R4)--, R7		; Ptr to dir entry in IOCB_CI2

248E	D448		MOVE R4, (R4)		; IOCB_WA
2490	A408		ADD R4, #$09
2492	8104		LBI R1, #$04		; (Last command?)
2494	7146		MOVB (R4)---, R1
2496	5548		MOVE (R4), R5		; Store file number in WA

			; Parse header record
2498	0474		MOVE R4, R7
249A	8130		LBI R1, #$30
249C	011D		MLH R1, R1
249E	81AA		LBI R1, #$AA
24A0	0203		INC2 R2, R0
24A2	0014		RET R1			; CALL $30AA, R2

24A4	F0BF		BRA $23E6		; Return

; ***********************
; Diskette I/O Supervisor
; Mark Routine
; ***********************

24A6	0434		MOVE R4, R3
24A8	A40D		ADD R4, #$0E		; IOCB_CI2
24AA	DF48		MOVE R15, (R4)		; Number of files to mark
24AC	01FC		MHL R1, R15
24AE	01F6		OR R1, R15
24B0	C10B		SNZ R1
24B2	A037		BRA $24EC		; Zero -> error 02

24B4	8180		LBI R1, #$80
24B6	CF1F		SNBSH R15, R1
24B8	A031		BRA $24EC		; Negative -> error 02

24BA	F403		SUB R4, #$04
24BC	D448		MOVE R4, (R4)		; IOCB_WA
24BE	A405		ADD R4, #$06
24C0	D548		MOVE R5, (R4)		; Current file number
24C2	015C		MHL R1, R5
24C4	0156		OR R1, R5
24C6	C10B		SNZ R1
24C8	A021		BRA $24EC		; Zero -> error 02

			; Last file number (-> R15)
24CA	0F58		ADD R15, R5
24CC	05FC		MHL R5, R15
24CE	055A		ADDH R5, R5
24D0	0F5D		MLH R15, R5
24D2	FF00		SUB R15, #$01

			; Get total number of directory entries (-> R5)
24D4	8131		LBI R1, #$31
24D6	011D		MLH R1, R1
24D8	81BA		LBI R1, #$BA
24DA	0203		INC2 R2, R0
24DC	0014		RET R1			; CALL $31BA, R2

24DE	075C		MHL R7, R5
24E0	08FC		MHL R8, R15
24E2	C870		SLE R8, R7
24E4	A005		BRA $24EC		; $06(R0)
24E6	C871		SLT R8, R7
24E8	CF58		SGT R15, R5
24EA	A003		BRA $24F0		; $04(R0)

			; Last file number > last directory entry
24EC	865E		LBI R6, #$5E		; Error 02
24EE	A08D		BRA $257E		; Error exit
; ----

			; Read Volume Header
24F0	2550		MOVE R5, $A0
24F2	354D		MOVE $9A, R5		; Track 0
24F4	354E		MOVE $9C, R5		; Side 0
24F6	8507		LBI R5, #$07
24F8	354F		MOVE $9E, R5		; Sector 7
24FA	85D0		LBI R5, #$D0
24FC	354C		MOVE $98, R5
24FE	8134		LBI R1, #$34
2500	011D		MLH R1, R1
2502	8138		LBI R1, #$38
2504	0203		INC2 R2, R0
2506	0014		RET R1			; CALL $3438, R2

2508	0434		MOVE R4, R3
250A	A403		ADD R4, #$04		; IOCB_BA
250C	D448		MOVE R4, (R4)
250E	A447		ADD R4, #$48		; Extended Arrangement Ind.
2510	6548		MOVB R5, (R4)
2512	8140		LBI R1, #$40
2514	C51A		SNE R5, R1
2516	A003		BRA $251C		; Blank, OK

2518	8630		LBI R6, #$30		; Error 25
251A	A061		BRA $257E		; Error exit
; ----

251C	8129		LBI R1, #$29
251E	011D		MLH R1, R1
2520	81D2		LBI R1, #$D2
2522	0203		INC2 R2, R0
2524	0014		RET R1			; CALL $29D2, R2

2526	0434		MOVE R4, R3
2528	A407		ADD R4, #$08		; IOCB_CI1
252A	D548		MOVE R5, (R4)		; Size of new file in kbytes
252C	015C		MHL R1, R5
252E	0516		OR R5, R1
2530	C50B		SNZ R5
2532	F08F		BRA $24A4		; Zero -> finished, return

2534	812C		LBI R1, #$2C
2536	011D		MLH R1, R1
2538	8126		LBI R1, #$26
253A	0203		INC2 R2, R0
253C	0014		RET R1			; CALL $2C26, R2

253E	8133		LBI R1, #$33
2540	011D		MLH R1, R1
2542	8116		LBI R1, #$16
2544	0203		INC2 R2, R0
2546	0014		RET R1			; CALL $3316, R2

2548	2850		MOVE R8, $A0
254A	95F0		CLR R5, #$F0
254C	8103		LBI R1, #$03
254E	C51A		SNE R5, R1
2550	A00F		BRA $2562		; $10(R0)

2552	8102		LBI R1, #$02
2554	C51A		SNE R5, R1
2556	A007		BRA $2560		; $08(R0)

2558	8101		LBI R1, #$01
255A	C512		SE R5, R1
255C	A803		ADD R8, #$04
255E	A801		ADD R8, #$02
2560	A800		ADD R8, #$01
2562	A800		ADD R8, #$01
2564	0434		MOVE R4, R3
2566	A40D		ADD R4, #$0E
2568	D548		MOVE R5, (R4)
256A	3547		MOVE $8E, R5
256C	F409		SUB R4, #$0A
256E	D543		MOVE R5, (R4)++
2570	3577		MOVE $EE, R5
2572	D548		MOVE R5, (R4)
2574	81F0		LBI R1, #$F0
2576	055C		MHL R5, R5
2578	C51E		SNBC R5, R1
257A	A00B		BRA $2588		; $0C(R0)

257C	860E		LBI R6, #$0E
257E	813E		LBI R1, #$3E
2580	011D		MLH R1, R1
2582	81FA		LBI R1, #$FA
2584	0203		INC2 R2, R0
2586	0014		RET R1

2588	8133		LBI R1, #$33
258A	011D		MLH R1, R1
258C	8116		LBI R1, #$16
258E	0203		INC2 R2, R0
2590	0014		RET R1

2592	075C		MHL R7, R5
2594	8140		LBI R1, #$40
2596	C71A		SNE R7, R1
2598	9580		CLR R5, #$80
259A	950F		CLR R5, #$0F
259C	E05F		STAT R5, $0
259E	A500		ADD R5, #$01
25A0	015D		MLH R1, R5
25A2	8101		LBI R1, #$01
25A4	0434		MOVE R4, R3
25A6	A407		ADD R4, #$08
25A8	D541		MOVE R5, (R4)+
25AA	D448		MOVE R4, (R4)
25AC	5148		MOVE (R4), R1
25AE	A405		ADD R4, #$06
25B0	D748		MOVE R7, (R4)
25B2	377B		MOVE $F6, R7
25B4	2750		MOVE R7, $A0
25B6	0788		ADD R7, R8
25B8	F500		SUB R5, #$01
25BA	015C		MHL R1, R5
25BC	0156		OR R1, R5
25BE	C103		SZ R1
25C0	F00B		BRA $25B6		; -> -$0C(R0)

25C2	3740		MOVE $80, R7
25C4	2148		MOVE R1, $90
25C6	9114		CLR R1, #$14
25C8	3148		MOVE $90, R1
25CA	257B		MOVE R5, $F6
25CC	015C		MHL R1, R5
25CE	C103		SZ R1
25D0	A005		BRA $25D8		; $06(R0)

25D2	8113		LBI R1, #$13
25D4	C518		SGT R5, R1
25D6	A055		BRA $262E		; $56(R0)

25D8	8133		LBI R1, #$33
25DA	011D		MLH R1, R1
25DC	8116		LBI R1, #$16
25DE	0203		INC2 R2, R0
25E0	0014		RET R1

25E2	81D4		LBI R1, #$D4
25E4	055C		MHL R5, R5
25E6	C512		SE R5, R1
25E8	A043		BRA $262E		; $44(R0)

25EA	2548		MOVE R5, $90
25EC	B510		SET R5, #$10
25EE	3548		MOVE $90, R5
25F0	257B		MOVE R5, $F6
25F2	8101		LBI R1, #$01
25F4	C515		SBS R5, R1
25F6	A011		BRA $260A		; $12(R0)

25F8	2577		MOVE R5, $EE
25FA	A57F		ADD R5, #$80
25FC	3577		MOVE $EE, R5
25FE	2548		MOVE R5, $90
2600	B504		SET R5, #$04
2602	3548		MOVE $90, R5
2604	A011		BRA $2618		; $12(R0)

2606	F089		BRA $257E		; -> -$8A(R0)

2608	F0D7		BRA $2532		; -> -$D8(R0)

260A	2547		MOVE R5, $8E
260C	8101		LBI R1, #$01
260E	C512		SE R5, R1
2610	A01B		BRA $262E		; $1C(R0)

2612	015C		MHL R1, R5
2614	C103		SZ R1
2616	A015		BRA $262E		; $16(R0)

2618	257B		MOVE R5, $F6
261A	812F		LBI R1, #$2F
261C	011D		MLH R1, R1
261E	81E8		LBI R1, #$E8
2620	0203		INC2 R2, R0
2622	0014		RET R1

2624	8134		LBI R1, #$34
2626	011D		MLH R1, R1
2628	8138		LBI R1, #$38
262A	0203		INC2 R2, R0
262C	0014		RET R1

262E	2540		MOVE R5, $80
2630	812A		LBI R1, #$2A
2632	011D		MLH R1, R1
2634	81FE		LBI R1, #$FE
2636	0203		INC2 R2, R0
2638	0014		RET R1

263A	2D78		MOVE R13, $F0
263C	812F		LBI R1, #$2F
263E	011D		MLH R1, R1
2640	8112		LBI R1, #$12
2642	0203		INC2 R2, R0
2644	0014		RET R1

2646	2477		MOVE R4, $EE
2648	A41B		ADD R4, #$1C
264A	8130		LBI R1, #$30
264C	011D		MLH R1, R1
264E	8172		LBI R1, #$72
2650	0203		INC2 R2, R0
2652	0014		RET R1

2654	2477		MOVE R4, $EE
2656	A41B		ADD R4, #$1C
2658	0744		MOVE R7, R4
265A	A72D		ADD R7, #$2E
265C	8805		LBI R8, #$05
265E	6540		MOVB R5, (R4)+
2660	7570		MOVB (R7)+, R5
2662	F800		SUB R8, #$01
2664	C803		SZ R8
2666	F009		BRA $265E		; -> -$0A(R0)

2668	2D79		MOVE R13, $F2
266A	812F		LBI R1, #$2F
266C	011D		MLH R1, R1
266E	8112		LBI R1, #$12
2670	0203		INC2 R2, R0
2672	0014		RET R1

2674	2477		MOVE R4, $EE
2676	A421		ADD R4, #$22
2678	8130		LBI R1, #$30
267A	011D		MLH R1, R1
267C	8172		LBI R1, #$72
267E	0203		INC2 R2, R0
2680	0014		RET R1

2682	812E		LBI R1, #$2E
2684	011D		MLH R1, R1
2686	8130		LBI R1, #$30
2688	0203		INC2 R2, R0
268A	0014		RET R1

268C	2548		MOVE R5, $90
268E	8110		LBI R1, #$10
2690	C515		SBS R5, R1
2692	A02D		BRA $26C2		; $2E(R0)

2694	8104		LBI R1, #$04
2696	C516		SBC R5, R1
2698	A023		BRA $26BE		; $24(R0)

269A	B504		SET R5, #$04
269C	3548		MOVE $90, R5
269E	2547		MOVE R5, $8E
26A0	F500		SUB R5, #$01
26A2	3547		MOVE $8E, R5
26A4	015C		MHL R1, R5
26A6	0516		OR R5, R1
26A8	C50B		SNZ R5
26AA	A01B		BRA $26C8		; $1C(R0)

26AC	2577		MOVE R5, $EE
26AE	A57F		ADD R5, #$80
26B0	3577		MOVE $EE, R5
26B2	257B		MOVE R5, $F6
26B4	A500		ADD R5, #$01
26B6	357B		MOVE $F6, R5
26B8	F08B		BRA $262E		; -> -$8C(R0)

26BA	F0F1		BRA $25CA		; -> -$F2(R0)

26BC	F0B3		BRA $260A		; -> -$B4(R0)

26BE	9504		CLR R5, #$04
26C0	3548		MOVE $90, R5
26C2	2547		MOVE R5, $8E
26C4	F500		SUB R5, #$01
26C6	3547		MOVE $8E, R5
26C8	257B		MOVE R5, $F6
26CA	812F		LBI R1, #$2F
26CC	011D		MLH R1, R1
26CE	81E8		LBI R1, #$E8
26D0	0203		INC2 R2, R0
26D2	0014		RET R1

26D4	2148		MOVE R1, $90
26D6	9120		CLR R1, #$20
26D8	3148		MOVE $90, R1
26DA	8134		LBI R1, #$34
26DC	011D		MLH R1, R1
26DE	819E		LBI R1, #$9E
26E0	0203		INC2 R2, R0
26E2	0014		RET R1

26E4	C60B		SNZ R6
26E6	A003		BRA $26EC		; $04(R0)

26E8	8644		LBI R6, #$44
26EA	F0E5		BRA $2606		; -> -$E6(R0)

26EC	2147		MOVE R1, $8E
26EE	051C		MHL R5, R1
26F0	0156		OR R1, R5
26F2	C10B		SNZ R1
26F4	F0ED		BRA $2608		; -> -$EE(R0)

26F6	0434		MOVE R4, R3
26F8	A403		ADD R4, #$04
26FA	D448		MOVE R4, (R4)
26FC	3477		MOVE $EE, R4
26FE	257B		MOVE R5, $F6
2700	A500		ADD R5, #$01
2702	357B		MOVE $F6, R5
2704	8114		LBI R1, #$14
2706	C51A		SNE R5, R1
2708	F04F		BRA $26BA		; -> -$50(R0)

270A	2548		MOVE R5, $90
270C	8110		LBI R1, #$10
270E	C515		SBS R5, R1
2710	F0E3		BRA $262E		; -> -$E4(R0)

2712	F057		BRA $26BC		; -> -$58(R0)

; ***********************
; Diskette I/O Supervisor
; ***********************
; Write Header Routine

			; Get pointer to directory entry
2714	0434		MOVE R4, R3
2716	A40D		ADD R4, #$0E		; IOCB_CI2
2718	D448		MOVE R4, (R4)
271A	3447		MOVE $8E, R4		; Save IOCB_CI2

			; Get EOE
271C	A424		ADD R4, #$25
271E	6540		MOVB R5, (R4)+
2720	6D48		MOVB R13, (R4)
2722	0D5D		MLH R13, R5

			; Test if file size kept unchanged
2724	0434		MOVE R4, R3
2726	A409		ADD R4, #$0A		; IOCB_WA
2728	D448		MOVE R4, (R4)
272A	A403		ADD R4, #$04
272C	D748		MOVE R7, (R4)		; Total file size
272E	C7D2		SE R7, R13
2730	A041		BRA $2774		; Changed -> error 02
2732	077C		MHL R7, R7
2734	C752		SE R7, R5
2736	A03B		BRA $2774		; Dito

			; OK, file size is the same

			; Get track, side and sector for EOE
2738	812F		LBI R1, #$2F
273A	011D		MLH R1, R1
273C	8112		LBI R1, #$12
273E	0203		INC2 R2, R0
2740	0014		RET R1			; CALL $2F12, R2

			; Put track, side and sector in binary into
			; directory entry
2742	2447		MOVE R4, $8E		; Pointer to dir. entry
2744	A421		ADD R4, #$22		; EOE
2746	8130		LBI R1, #$30
2748	011D		MLH R1, R1
274A	8172		LBI R1, #$72
274C	0203		INC2 R2, R0
274E	0014		RET R1

			; Get EOD
2750	2447		MOVE R4, $8E
2752	A44C		ADD R4, #$4D		; EOD
2754	6540		MOVB R5, (R4)+
2756	6D48		MOVB R13, (R4)
2758	0D5D		MLH R13, R5

275A	0434		MOVE R4, R3
275C	A409		ADD R4, #$0A		; IOCB_WA
275E	D448		MOVE R4, (R4)
2760	A403		ADD R4, #$04
2762	D548		MOVE R5, (R4)		; Total file size
2764	A500		ADD R5, #$01		;  plus 1
2766	07DC		MHL R7, R13
2768	085C		MHL R8, R5
276A	C780		SLE R7, R8
276C	A005		BRA $2774		; EOD illegal
276E	C781		SLT R7, R8
2770	CD58		SGT R13, R5
2772	A00D		BRA $2782		; $0E(R0)

2774	865E		LBI R6, #$5E		; Error 02
2776	813E		LBI R1, #$3E
2778	011D		MLH R1, R1
277A	81FA		LBI R1, #$FA
277C	0203		INC2 R2, R0
277E	0014		RET R1			; Error exit
; ----

2780	F08D		BRA $26F4		; -> -$8E(R0)
; ----

			; Get track, side and sector for EOD
2782	812F		LBI R1, #$2F
2784	011D		MLH R1, R1
2786	8112		LBI R1, #$12
2788	0203		INC2 R2, R0
278A	0014		RET R1

			; Put track, side and sector in binary into
			; directory entry
278C	2447		MOVE R4, $8E		; Pointer to dir. entry
278E	A449		ADD R4, #$4A		; EOD
2790	8130		LBI R1, #$30
2792	011D		MLH R1, R1
2794	8172		LBI R1, #$72
2796	0203		INC2 R2, R0
2798	0014		RET R1

			; Get file number
279A	0434		MOVE R4, R3
279C	A409		ADD R4, #$0A		; IOCB_WA
279E	D448		MOVE R4, (R4)
27A0	A405		ADD R4, #$06
27A2	DF48		MOVE R15, (R4)		; File number

27A4	2447		MOVE R4, $8E		; Pointer to dir. entry
27A6	A42A		ADD R4, #$2B		; Exchange Type Indicator
27A8	6548		MOVB R5, (R4)
27AA	8140		LBI R1, #$40
27AC	C512		SE R5, R1
27AE	A06B		BRA $281C		; $6C(R0)

27B0	8133		LBI R1, #$33
27B2	011D		MLH R1, R1
27B4	8116		LBI R1, #$16
27B6	0203		INC2 R2, R0
27B8	0014		RET R1

27BA	2447		MOVE R4, $8E
27BC	810F		LBI R1, #$0F
27BE	C516		SBC R5, R1
27C0	A031		BRA $27F4		; $32(R0)

27C2	085C		MHL R8, R5
27C4	8140		LBI R1, #$40
27C6	C812		SE R8, R1
27C8	A051		BRA $281C		; $52(R0)

27CA	8180		LBI R1, #$80
27CC	C516		SBC R5, R1
27CE	A045		BRA $2816		; $46(R0)

27D0	2847		MOVE R8, $8E
27D2	A821		ADD R8, #$22
27D4	81F7		LBI R1, #$F7
27D6	6780		MOVB R7, (R8)+
27D8	C712		SE R7, R1
27DA	A007		BRA $27E4		; $08(R0)

27DC	6788		MOVB R7, (R8)
27DE	81F3		LBI R1, #$F3
27E0	C710		SLE R7, R1
27E2	A031		BRA $2816		; $32(R0)

27E4	8700		LBI R7, #$00
27E6	8830		LBI R8, #$30
27E8	A44F		ADD R4, #$50
27EA	7740		MOVB (R4)+, R7
27EC	F800		SUB R8, #$01
27EE	C803		SZ R8
27F0	F007		BRA $27EA		; -> -$08(R0)

27F2	A027		BRA $281C		; $28(R0)

27F4	2750		MOVE R7, $A0
27F6	8747		LBI R7, #$47
27F8	08F4		MOVE R8, R15
27FA	0789		SUB R7, R8
27FC	087C		MHL R8, R7
27FE	077D		MLH R7, R7
2800	078C		MHL R7, R8
2802	0879		SUB R8, R7
2804	077C		MHL R7, R7
2806	078D		MLH R7, R8
2808	8180		LBI R1, #$80
280A	C71F		SNBSH R7, R1
280C	A007		BRA $2816		; $08(R0)

280E	95F0		CLR R5, #$F0
2810	8101		LBI R1, #$01
2812	87C8		LBI R7, #$C8
2814	C512		SE R5, R1
2816	87C5		LBI R7, #$C5
2818	A42A		ADD R4, #$2B
281A	7748		MOVB (R4), R7
281C	05F4		MOVE R5, R15
281E	812F		LBI R1, #$2F
2820	011D		MLH R1, R1
2822	81E8		LBI R1, #$E8
2824	0203		INC2 R2, R0
2826	0014		RET R1

2828	2548		MOVE R5, $90
282A	9520		CLR R5, #$20
282C	3548		MOVE $90, R5
282E	8134		LBI R1, #$34
2830	011D		MLH R1, R1
2832	819E		LBI R1, #$9E
2834	0203		INC2 R2, R0
2836	0014		RET R1

2838	C60B		SNZ R6
283A	F0BB		BRA $2780		; -> -$BC(R0)

283C	8644		LBI R6, #$44
283E	F0C9		BRA $2776		; -> -$CA(R0)
; ----

			; Scan

2840	2550		MOVE R5, $A0
2842	3523		MOVE $46, R5
2844	0434		MOVE R4, R3
2846	A40D		ADD R4, #$0E
2848	D448		MOVE R4, (R4)
284A	6140		MOVB R1, (R4)+
284C	6540		MOVB R5, (R4)+
284E	051D		MLH R5, R1
2850	3522		MOVE $44, R5
2852	0516		OR R5, R1
2854	C503		SZ R5
2856	A003		BRA $285C		; $04(R0)

2858	865E		LBI R6, #$5E
285A	A05B		BRA $28B8		; $5C(R0)

285C	6540		MOVB R5, (R4)+
285E	C50B		SNZ R5
2860	F009		BRA $2858		; -> -$0A(R0)

2862	352B		MOVE $56, R5
2864	342C		MOVE $58, R4
2866	8133		LBI R1, #$33
2868	011D		MLH R1, R1
286A	8136		LBI R1, #$36
286C	0203		INC2 R2, R0
286E	0014		RET R1

2870	0434		MOVE R4, R3
2872	A407		ADD R4, #$08
2874	DD48		MOVE R13, (R4)
2876	812F		LBI R1, #$2F
2878	011D		MLH R1, R1
287A	8112		LBI R1, #$12
287C	0203		INC2 R2, R0
287E	0014		RET R1

2880	8134		LBI R1, #$34
2882	011D		MLH R1, R1
2884	8138		LBI R1, #$38
2886	0203		INC2 R2, R0
2888	0014		RET R1

288A	C603		SZ R6
288C	A057		BRA $28E6		; $58(R0)

288E	0203		INC2 R2, R0
2890	A0B1		BRA $2944		; $B2(R0)

2892	A073		BRA $2908		; $74(R0)

2894	A0A1		BRA $2938		; $A2(R0)

2896	2523		MOVE R5, $46
2898	B580		SET R5, #$80
289A	3523		MOVE $46, R5
289C	2522		MOVE R5, $44
289E	F500		SUB R5, #$01
28A0	3522		MOVE $44, R5
28A2	8133		LBI R1, #$33
28A4	011D		MLH R1, R1
28A6	812A		LBI R1, #$2A
28A8	0203		INC2 R2, R0
28AA	0014		RET R1

28AC	2522		MOVE R5, $44
28AE	015C		MHL R1, R5
28B0	0516		OR R5, R1
28B2	C503		SZ R5
28B4	A00D		BRA $28C4		; $0E(R0)

28B6	8628		LBI R6, #$28
28B8	813E		LBI R1, #$3E
28BA	011D		MLH R1, R1
28BC	81FA		LBI R1, #$FA
28BE	0203		INC2 R2, R0
28C0	0014		RET R1

28C2	F089		BRA $283A		; -> -$8A(R0)

28C4	0434		MOVE R4, R3
28C6	A407		ADD R4, #$08
28C8	D741		MOVE R7, (R4)+
28CA	D448		MOVE R4, (R4)
28CC	A401		ADD R4, #$02
28CE	D848		MOVE R8, (R4)
28D0	0789		SUB R7, R8
28D2	087C		MHL R8, R7
28D4	077D		MLH R7, R7
28D6	078C		MHL R7, R8
28D8	0879		SUB R8, R7
28DA	077C		MHL R7, R7
28DC	078D		MLH R7, R8
28DE	8180		LBI R1, #$80
28E0	C717		SBSH R7, R1
28E2	A05D		BRA $2942		; $5E(R0)

28E4	F075		BRA $2870		; -> -$76(R0)

28E6	2529		MOVE R5, $52
28E8	81C6		LBI R1, #$C6
28EA	C51A		SNE R5, R1
28EC	A009		BRA $28F8		; $0A(R0)

28EE	81C4		LBI R1, #$C4
28F0	C51A		SNE R5, R1
28F2	A003		BRA $28F8		; $04(R0)

28F4	8618		LBI R6, #$18
28F6	F03F		BRA $28B8		; -> -$40(R0)

28F8	0434		MOVE R4, R3
28FA	A402		ADD R4, #$03
28FC	6548		MOVB R5, (R4)
28FE	8108		LBI R1, #$08
2900	C515		SBS R5, R1
2902	F061		BRA $28A2		; -> -$62(R0)

2904	860A		LBI R6, #$0A
2906	F04F		BRA $28B8		; -> -$50(R0)

2908	2523		MOVE R5, $46
290A	8180		LBI R1, #$80
290C	C516		SBC R5, R1
290E	A005		BRA $2916		; $06(R0)

2910	2550		MOVE R5, $A0
2912	3522		MOVE $44, R5
2914	F073		BRA $28A2		; -> -$74(R0)

2916	0434		MOVE R4, R3
2918	A407		ADD R4, #$08
291A	DD48		MOVE R13, (R4)
291C	FD00		SUB R13, #$01
291E	5D48		MOVE (R4), R13
2920	812F		LBI R1, #$2F
2922	011D		MLH R1, R1
2924	8112		LBI R1, #$12
2926	0203		INC2 R2, R0
2928	0014		RET R1

292A	8134		LBI R1, #$34
292C	011D		MLH R1, R1
292E	8138		LBI R1, #$38
2930	0203		INC2 R2, R0
2932	0014		RET R1

2934	C603		SZ R6
2936	F021		BRA $2916		; -> -$22(R0)

2938	8133		LBI R1, #$33
293A	011D		MLH R1, R1
293C	812A		LBI R1, #$2A
293E	0203		INC2 R2, R0
2940	0014		RET R1

2942	F081		BRA $28C2		; -> -$82(R0)

2944	2F2B		MOVE R15, $56
2946	0434		MOVE R4, R3
2948	A403		ADD R4, #$04
294A	D448		MOVE R4, (R4)
294C	272C		MOVE R7, $58
294E	6540		MOVB R5, (R4)+
2950	6870		MOVB R8, (R7)+
2952	C582		SE R5, R8
2954	A009		BRA $2960		; $0A(R0)

2956	FF00		SUB R15, #$01
2958	CF03		SZ R15
295A	F00D		BRA $294E		; -> -$0E(R0)

295C	A201		ADD R2, #$02
295E	A003		BRA $2964		; $04(R0)

2960	C851		SLT R8, R5
2962	A203		ADD R2, #$04
2964	0024		RET R2

2966	0734		MOVE R7, R3
2968	A707		ADD R7, #$08
296A	D778		MOVE R7, (R7)
296C	2477		MOVE R4, $EE
296E	A404		ADD R4, #$05
2970	8F11		LBI R15, #$11
2972	6870		MOVB R8, (R7)+
2974	6540		MOVB R5, (R4)+
2976	C582		SE R5, R8
2978	A01F		BRA $299A		; $20(R0)

297A	8140		LBI R1, #$40
297C	C51A		SNE R5, R1
297E	A005		BRA $2986		; $06(R0)

2980	FF00		SUB R15, #$01
2982	CF03		SZ R15
2984	F013		BRA $2972		; -> -$14(R0)

2986	2548		MOVE R5, $90
2988	8102		LBI R1, #$02
298A	C515		SBS R5, R1
298C	A003		BRA $2992		; $04(R0)

298E	8612		LBI R6, #$12
2990	A075		BRA $2A08		; $76(R0)

2992	B502		SET R5, #$02
2994	3548		MOVE $90, R5
2996	257B		MOVE R5, $F6
2998	3575		MOVE $EA, R5
299A	0024		RET R2
; ----

; ***********************
; Diskette I/O Supervisor
; ***********************
; Calculate number of sectors from actual buffer size
; Result:
;  R7 and R2L2

299C	0434		MOVE R4, R3
299E	A405		ADD R4, #$06		; IOCB_BS -> R7
29A0	D743		MOVE R7, (R4)++

29A2	D448		MOVE R4, (R4)		; IOCB_WA -> R4
29A4	A407		ADD R4, #$08
29A6	6F48		MOVB R15, (R4)		; Physical record size

			; Calculate number of sectors from buffer size,
			; result in R7

29A8	AF06		ADD R15, #$07
29AA	2550		MOVE R5, $A0
29AC	8A01		LBI R10, #$01
29AE	C7A6		SBC R7, R10
29B0	8AFF		LBI R10, #$FF
29B2	E07C		SHR R7
29B4	057C		MHL R5, R7
29B6	E05C		SHR R5
29B8	075D		MLH R7, R5
29BA	FF00		SUB R15, #$01
29BC	CF03		SZ R15
29BE	F011		BRA $29AE		; -> -$12(R0)

29C0	CA0C		SNS R10
29C2	A700		ADD R7, #$01
29C4	3722		MOVE $44, R7		; R2L2

29C6	017C		MHL R1, R7
29C8	0176		OR R1, R7
29CA	C103		SZ R1
29CC	0024		RET R2			; Return

			; Error, number of sectors equal 0

29CE	865E		LBI R6, #$5E		; Error 02
29D0	A035		BRA $2A08		; Error exit

; ***********************
; Diskette I/O Supervisor
; ***********************

29D2	3274		MOVE $E8, R2		; Save R2

29D4	0434		MOVE R4, R3
29D6	A40D		ADD R4, #$0E		; IOCB_CI2
29D8	D547		MOVE R5, (R4)--
29DA	3547		MOVE $8E, R5		; Number of files to mark

29DC	D448		MOVE R4, (R4)		; IOCB_WA
29DE	A405		ADD R4, #$06
29E0	D548		MOVE R5, (R4)
29E2	357B		MOVE $F6, R5		; Start with first file number

			; Get track, side and sector of current file entry
29E4	257B		MOVE R5, $F6
29E6	812F		LBI R1, #$2F
29E8	011D		MLH R1, R1
29EA	81E8		LBI R1, #$E8
29EC	0203		INC2 R2, R0
29EE	0014		RET R1			; CALL $2FE8, R2

			; Read sector
29F0	8134		LBI R1, #$34
29F2	011D		MLH R1, R1
29F4	8138		LBI R1, #$38
29F6	0203		INC2 R2, R0
29F8	0014		RET R1			; CALL $3438, R2

29FA	C60B		SNZ R6
29FC	A013		BRA $2A12		; No error

			; Error or other flags returned
29FE	2529		MOVE R5, $52		; R9L2
2A00	81C4		LBI R1, #$C4
2A02	C51A		SNE R5, R1
2A04	A0C5		BRA $2ACC		; Deleted header record

2A06	8618		LBI R6, #$18		; Error 37
2A08	813E		LBI R1, #$3E
2A0A	011D		MLH R1, R1
2A0C	81FA		LBI R1, #$FA
2A0E	0203		INC2 R2, R0
2A10	0014		RET R1
; ----

2A12	2548		MOVE R5, $90
2A14	8110		LBI R1, #$10
2A16	C515		SBS R5, R1
2A18	A00F		BRA $2A2A		; FM

2A1A	257B		MOVE R5, $F6
2A1C	8101		LBI R1, #$01		; Odd file number ?
2A1E	C516		SBC R5, R1
2A20	A067		BRA $2A8A		; Yes

2A22	2529		MOVE R5, $52		; R9L2
2A24	81C4		LBI R1, #$C4		; Deleted header record ?
2A26	C51A		SNE R5, R1
2A28	A073		BRA $2A9E		; Yes

			; Mark header record as deleted
2A2A	0434		MOVE R4, R3
2A2C	A403		ADD R4, #$04		; IOCB_BA
2A2E	D448		MOVE R4, (R4)
			
2A30	812E		LBI R1, #$2E
2A32	011D		MLH R1, R1
2A34	8100		LBI R1, #$00
2A36	0203		INC2 R2, R0
2A38	0014		RET R1			; CALL $2E00, R2

2A3A	2848		MOVE R8, $90
2A3C	8110		LBI R1, #$10
2A3E	C815		SBS R8, R1
2A40	A02B		BRA $2A6E		; FM

2A42	257B		MOVE R5, $F6
2A44	8101		LBI R1, #$01
2A46	C516		SBC R5, R1
2A48	A00D		BRA $2A58		; $0E(R0)

2A4A	2547		MOVE R5, $8E
2A4C	8101		LBI R1, #$01
2A4E	C512		SE R5, R1
2A50	A05B		BRA $2AAE		; $5C(R0)

2A52	015C		MHL R1, R5
2A54	C103		SZ R1
2A56	A055		BRA $2AAE		; $56(R0)

2A58	0434		MOVE R4, R3
2A5A	A403		ADD R4, #$04		; IOCB_BA
2A5C	D448		MOVE R4, (R4)
2A5E	87C4		LBI R7, #$C4
2A60	6548		MOVB R5, (R4)
2A62	C572		SE R5, R7
2A64	A00D		BRA $2A74		; Entry not deleted

2A66	A47F		ADD R4, #$80		; Second dir. entry
2A68	6548		MOVB R5, (R4)
2A6A	C572		SE R5, R7
2A6C	A005		BRA $2A74		; Entry not deleted

2A6E	2848		MOVE R8, $90
2A70	B820		SET R8, #$20		; Mark sector deleted (DDAM)
2A72	A001		BRA $2A76

2A74	9820		CLR R8, #$20		; Mark sector normal (NDAM)

2A76	3848		MOVE $90, R8

2A78	8134		LBI R1, #$34
2A7A	011D		MLH R1, R1
2A7C	819E		LBI R1, #$9E
2A7E	0203		INC2 R2, R0
2A80	0014		RET R1			; CALL $349E, R2

2A82	C60B		SNZ R6
2A84	A061		BRA $2AE8		; $62(R0)

2A86	8644		LBI R6, #$44
2A88	F081		BRA $2A08		; -> -$82(R0)

2A8A	0434		MOVE R4, R3
2A8C	A403		ADD R4, #$04
2A8E	D448		MOVE R4, (R4)
2A90	A47F		ADD R4, #$80
2A92	6548		MOVB R5, (R4)
2A94	81C4		LBI R1, #$C4
2A96	C512		SE R5, R1
2A98	F069		BRA $2A30		; -> -$6A(R0)
2A9A	A04B		BRA $2AE8		; $4C(R0)

2A9C	F0B9		BRA $29E4		; -> -$BA(R0)

2A9E	2547		MOVE R5, $8E		; Number of files to mark
2AA0	F500		SUB R5, #$01		; Decrement by one
2AA2	3547		MOVE $8E, R5		; and store
2AA4	015C		MHL R1, R5
2AA6	0516		OR R5, R1
2AA8	C503		SZ R5
2AAA	A007		BRA $2AB4		; $08(R0)
2AAC	A045		BRA $2AF4		; Zero, finished

2AAE	2547		MOVE R5, $8E
2AB0	F500		SUB R5, #$01
2AB2	3547		MOVE $8E, R5

2AB4	257B		MOVE R5, $F6		; Current file number
2AB6	A500		ADD R5, #$01		; Increment by one
2AB8	357B		MOVE $F6, R5		; and store
2ABA	0434		MOVE R4, R3
2ABC	A403		ADD R4, #$04		; IOCB_BA
2ABE	D448		MOVE R4, (R4)
2AC0	A47F		ADD R4, #$80		; Second dir. entry
2AC2	6548		MOVB R5, (R4)
2AC4	81C4		LBI R1, #$C4
2AC6	C512		SE R5, R1
2AC8	F099		BRA $2A30		; Not a deleted header record
2ACA	F05D		BRA $2A6E		; Deleted header record

2ACC	2548		MOVE R5, $90
2ACE	8110		LBI R1, #$10
2AD0	C515		SBS R5, R1
2AD2	A013		BRA $2AE8		; $14(R0)

2AD4	2547		MOVE R5, $8E
2AD6	F500		SUB R5, #$01
2AD8	3547		MOVE $8E, R5
2ADA	015C		MHL R1, R5
2ADC	0516		OR R5, R1
2ADE	C50B		SNZ R5
2AE0	A011		BRA $2AF4		; $12(R0)

2AE2	257B		MOVE R5, $F6
2AE4	A500		ADD R5, #$01
2AE6	357B		MOVE $F6, R5
2AE8	2547		MOVE R5, $8E
2AEA	F500		SUB R5, #$01
2AEC	3547		MOVE $8E, R5
2AEE	015C		MHL R1, R5
2AF0	0516		OR R5, R1
2AF2	C50B		SNZ R5

2AF4	2074		JMP ($00E8)		; Return
; ----

2AF6	257B		MOVE R5, $F6
2AF8	A500		ADD R5, #$01
2AFA	357B		MOVE $F6, R5
2AFC	F061		BRA $2A9C		; -> -$62(R0)

2AFE	3243		MOVE $86, R2
2B00	2F50		MOVE R15, $A0
2B02	2976		MOVE R9, $EC
2B04	2A75		MOVE R10, $EA
2B06	0754		MOVE R7, R5
2B08	0894		MOVE R8, R9
2B0A	0788		ADD R7, R8
2B0C	087C		MHL R8, R7
2B0E	088A		ADDH R8, R8
2B10	078D		MLH R7, R8
2B12	08A4		MOVE R8, R10
2B14	0879		SUB R8, R7
2B16	078C		MHL R7, R8
2B18	088D		MLH R8, R8
2B1A	087C		MHL R8, R7
2B1C	0789		SUB R7, R8
2B1E	088C		MHL R8, R8
2B20	087D		MLH R8, R7
2B22	8180		LBI R1, #$80
2B24	C81F		SNBSH R8, R1
2B26	A091		BRA $2BBA		; $92(R0)

2B28	0894		MOVE R8, R9
2B2A	018C		MHL R1, R8
2B2C	E08E		ROR3 R8
2B2E	98E0		CLR R8, #$E0
2B30	E01E		ROR3 R1
2B32	911F		CLR R1, #$1F
2B34	0816		OR R8, R1
2B36	018C		MHL R1, R8
2B38	E01E		ROR3 R1
2B3A	91E0		CLR R1, #$E0
2B3C	081D		MLH R8, R1
2B3E	0794		MOVE R7, R9
2B40	97F8		CLR R7, #$F8
2B42	0434		MOVE R4, R3
2B44	A403		ADD R4, #$04
2B46	D448		MOVE R4, (R4)
2B48	A4FF		ADD R4, #$100
2B4A	0488		ADD R4, R8
2B4C	084C		MHL R8, R4
2B4E	088A		ADDH R8, R8
2B50	048D		MLH R4, R8
2B52	6848		MOVB R8, (R4)
2B54	C804		SS R8
2B56	A00F		BRA $2B68		; $10(R0)

2B58	AF07		ADD R15, #$08
2B5A	0F79		SUB R15, R7
2B5C	09F8		ADD R9, R15
2B5E	0F9C		MHL R15, R9
2B60	0FFA		ADDH R15, R15
2B62	09FD		MLH R9, R15
2B64	3976		MOVE $EC, R9
2B66	F067		BRA $2B00		; -> -$68(R0)

2B68	C803		SZ R8
2B6A	A007		BRA $2B74		; $08(R0)

2B6C	AF07		ADD R15, #$08
2B6E	0F79		SUB R15, R7
2B70	8707		LBI R7, #$07
2B72	A003		BRA $2B78		; $04(R0)

2B74	0203		INC2 R2, R0
2B76	A08D		BRA $2C06		; $8E(R0)

2B78	0DF4		MOVE R13, R15
2B7A	0154		MOVE R1, R5
2B7C	0D19		SUB R13, R1
2B7E	01DC		MHL R1, R13
2B80	0DDD		MLH R13, R13
2B82	0D1C		MHL R13, R1
2B84	01D9		SUB R1, R13
2B86	0DDC		MHL R13, R13
2B88	0D1D		MLH R13, R1
2B8A	8180		LBI R1, #$80
2B8C	CD17		SBSH R13, R1
2B8E	A00F		BRA $2BA0		; $10(R0)

2B90	8107		LBI R1, #$07
2B92	C71A		SNE R7, R1
2B94	A003		BRA $2B9A		; $04(R0)

2B96	A700		ADD R7, #$01
2B98	F025		BRA $2B74		; -> -$26(R0)

2B9A	2750		MOVE R7, $A0
2B9C	A400		ADD R4, #$01
2B9E	F04D		BRA $2B52		; -> -$4E(R0)

2BA0	0F54		MOVE R15, R5
2BA2	217A		MOVE R1, $F4
2BA4	A100		ADD R1, #$01
2BA6	317A		MOVE $F4, R1
2BA8	3978		MOVE $F0, R9
2BAA	09F8		ADD R9, R15
2BAC	0F9C		MHL R15, R9
2BAE	0FFA		ADDH R15, R15
2BB0	09FD		MLH R9, R15
2BB2	3976		MOVE $EC, R9
2BB4	F900		SUB R9, #$01
2BB6	3979		MOVE $F2, R9
2BB8	2043		JMP ($0086)

2BBA	257A		MOVE R5, $F4
2BBC	C50B		SNZ R5
2BBE	A039		BRA $2BFA		; $3A(R0)

2BC0	2548		MOVE R5, $90
2BC2	8104		LBI R1, #$04
2BC4	C515		SBS R5, R1
2BC6	A031		BRA $2BFA		; $32(R0)

2BC8	2477		MOVE R4, $EE
2BCA	81C4		LBI R1, #$C4
2BCC	7148		MOVB (R4), R1
2BCE	257B		MOVE R5, $F6
2BD0	812F		LBI R1, #$2F
2BD2	011D		MLH R1, R1
2BD4	81E8		LBI R1, #$E8
2BD6	0203		INC2 R2, R0
2BD8	0014		RET R1

2BDA	2148		MOVE R1, $90
2BDC	9120		CLR R1, #$20
2BDE	3148		MOVE $90, R1
2BE0	8134		LBI R1, #$34
2BE2	011D		MLH R1, R1
2BE4	819E		LBI R1, #$9E
2BE6	0203		INC2 R2, R0
2BE8	0014		RET R1

2BEA	C60B		SNZ R6
2BEC	A00B		BRA $2BFA		; $0C(R0)

2BEE	8644		LBI R6, #$44
2BF0	813E		LBI R1, #$3E
2BF2	011D		MLH R1, R1
2BF4	81FA		LBI R1, #$FA
2BF6	0203		INC2 R2, R0
2BF8	0014		RET R1

2BFA	0434		MOVE R4, R3
2BFC	A40D		ADD R4, #$0E
2BFE	257A		MOVE R5, $F4
2C00	5548		MOVE (R4), R5
2C02	860E		LBI R6, #$0E
2C04	F015		BRA $2BF0		; -> -$16(R0)

2C06	AF00		ADD R15, #$01
2C08	8107		LBI R1, #$07
2C0A	0179		SUB R1, R7
2C0C	8D80		LBI R13, #$80
2C0E	0118		ADD R1, R1
2C10	0018		ADD R0, R1
2C12	E0DD		ROR R13
2C14	E0DD		ROR R13
2C16	E0DD		ROR R13
2C18	E0DD		ROR R13
2C1A	E0DD		ROR R13
2C1C	E0DD		ROR R13
2C1E	E0DD		ROR R13
2C20	C8D6		SBC R8, R13
2C22	F0C7		BRA $2B5C		; -> -$C8(R0)

2C24	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; ***********************

2C26	3274		MOVE $E8, R2		; Save R2

2C28	0434		MOVE R4, R3
2C2A	A403		ADD R4, #$04		; IOCB_BA
2C2C	D448		MOVE R4, (R4)
2C2E	A4FF		ADD R4, #$100		; ??
2C30	8FFF		LBI R15, #$FF
2C32	2550		MOVE R5, $A0
2C34	5541		MOVE (R4)+, R5
2C36	FF00		SUB R15, #$01
2C38	CF03		SZ R15
2C3A	F007		BRA $2C34		; -> -$08(R0)

			; Get number of sectors per cylinder
2C3C	8131		LBI R1, #$31
2C3E	011D		MLH R1, R1
2C40	817E		LBI R1, #$7E
2C42	0203		INC2 R2, R0
2C44	0014		RET R1			; CALL $317E, R2

			; Get drive status word
2C46	8133		LBI R1, #$33
2C48	011D		MLH R1, R1
2C4A	8116		LBI R1, #$16
2C4C	0203		INC2 R2, R0
2C4E	0014		RET R1			; CALL $3316, R2

2C50	075C		MHL R7, R5
2C52	8140		LBI R1, #$40
2C54	C71A		SNE R7, R1
2C56	9580		CLR R5, #$80
2C58	950F		CLR R5, #$0F
2C5A	E05F		STAT R5, $0
2C5C	A500		ADD R5, #$01
2C5E	0434		MOVE R4, R3
2C60	A409		ADD R4, #$0A
2C62	D448		MOVE R4, (R4)
2C64	075D		MLH R7, R5
2C66	8701		LBI R7, #$01
2C68	5748		MOVE (R4), R7
2C6A	284D		MOVE R8, $9A
2C6C	8F4A		LBI R15, #$4A
2C6E	2650		MOVE R6, $A0
2C70	2750		MOVE R7, $A0
2C72	F500		SUB R5, #$01
2C74	0F59		SUB R15, R5
2C76	0688		ADD R6, R8
2C78	FF00		SUB R15, #$01
2C7A	CF03		SZ R15
2C7C	F007		BRA $2C76		; -> -$08(R0)

2C7E	3675		MOVE $EA, R6
2C80	3776		MOVE $EC, R7
2C82	2750		MOVE R7, $A0
2C84	377A		MOVE $F4, R7
2C86	8701		LBI R7, #$01
2C88	377B		MOVE $F6, R7
2C8A	8131		LBI R1, #$31
2C8C	011D		MLH R1, R1
2C8E	81BA		LBI R1, #$BA
2C90	0203		INC2 R2, R0
2C92	0014		RET R1

2C94	3547		MOVE $8E, R5
2C96	0434		MOVE R4, R3
2C98	A403		ADD R4, #$04
2C9A	D748		MOVE R7, (R4)
2C9C	3777		MOVE $EE, R7
2C9E	257B		MOVE R5, $F6
2CA0	812F		LBI R1, #$2F
2CA2	011D		MLH R1, R1
2CA4	81E8		LBI R1, #$E8
2CA6	0203		INC2 R2, R0
2CA8	0014		RET R1

2CAA	8134		LBI R1, #$34
2CAC	011D		MLH R1, R1
2CAE	8138		LBI R1, #$38
2CB0	0203		INC2 R2, R0
2CB2	0014		RET R1

2CB4	C60B		SNZ R6
2CB6	A015		BRA $2CCE		; $16(R0)

2CB8	2548		MOVE R5, $90
2CBA	8110		LBI R1, #$10
2CBC	C515		SBS R5, R1
2CBE	A0BD		BRA $2D7E		; $BE(R0)

2CC0	2547		MOVE R5, $8E
2CC2	F500		SUB R5, #$01
2CC4	3547		MOVE $8E, R5
2CC6	257B		MOVE R5, $F6
2CC8	A500		ADD R5, #$01
2CCA	357B		MOVE $F6, R5
2CCC	A0AF		BRA $2D7E		; $B0(R0)

2CCE	8131		LBI R1, #$31
2CD0	011D		MLH R1, R1
2CD2	817E		LBI R1, #$7E
2CD4	0203		INC2 R2, R0
2CD6	0014		RET R1

2CD8	2548		MOVE R5, $90
2CDA	8110		LBI R1, #$10
2CDC	C515		SBS R5, R1
2CDE	A009		BRA $2CEA		; $0A(R0)

2CE0	2477		MOVE R4, $EE
2CE2	6548		MOVB R5, (R4)
2CE4	81C4		LBI R1, #$C4
2CE6	C51A		SNE R5, R1
2CE8	A093		BRA $2D7E		; $94(R0)

2CEA	2477		MOVE R4, $EE
2CEC	A41B		ADD R4, #$1C
2CEE	8132		LBI R1, #$32
2CF0	011D		MLH R1, R1
2CF2	8186		LBI R1, #$86
2CF4	0203		INC2 R2, R0
2CF6	0014		RET R1

2CF8	2477		MOVE R4, $EE
2CFA	A421		ADD R4, #$22
2CFC	8132		LBI R1, #$32
2CFE	011D		MLH R1, R1
2D00	8186		LBI R1, #$86
2D02	0203		INC2 R2, R0
2D04	0014		RET R1

2D06	2477		MOVE R4, $EE
2D08	A41E		ADD R4, #$1F
2D0A	6140		MOVB R1, (R4)+
2D0C	6740		MOVB R7, (R4)+
2D0E	071D		MLH R7, R1
2D10	A403		ADD R4, #$04
2D12	6140		MOVB R1, (R4)+
2D14	6848		MOVB R8, (R4)
2D16	081D		MLH R8, R1
2D18	0F84		MOVE R15, R8
2D1A	0174		MOVE R1, R7
2D1C	0F19		SUB R15, R1
2D1E	01FC		MHL R1, R15
2D20	0FFD		MLH R15, R15
2D22	0F1C		MHL R15, R1
2D24	01F9		SUB R1, R15
2D26	0FFC		MHL R15, R15
2D28	0F1D		MLH R15, R1
2D2A	2575		MOVE R5, $EA
2D2C	0589		SUB R5, R8
2D2E	085C		MHL R8, R5
2D30	055D		MLH R5, R5
2D32	058C		MHL R5, R8
2D34	0859		SUB R8, R5
2D36	055C		MHL R5, R5
2D38	058D		MLH R5, R8
2D3A	8880		LBI R8, #$80
2D3C	C58F		SNBSH R5, R8
2D3E	A003		BRA $2D44		; $04(R0)

2D40	CF87		SBSH R15, R8
2D42	A00D		BRA $2D52		; $0E(R0)

2D44	8616		LBI R6, #$16
2D46	813E		LBI R1, #$3E
2D48	011D		MLH R1, R1
2D4A	81FA		LBI R1, #$FA
2D4C	0203		INC2 R2, R0
2D4E	0014		RET R1

2D50	F0BB		BRA $2C96		; -> -$BC(R0)

2D52	AF00		ADD R15, #$01
2D54	8903		LBI R9, #$03
2D56	0874		MOVE R8, R7
2D58	2550		MOVE R5, $A0
2D5A	058C		MHL R5, R8
2D5C	E08C		SHR R8
2D5E	E05C		SHR R5
2D60	085D		MLH R8, R5
2D62	F900		SUB R9, #$01
2D64	C903		SZ R9
2D66	F00B		BRA $2D5C		; -> -$0C(R0)

2D68	0434		MOVE R4, R3
2D6A	A403		ADD R4, #$04
2D6C	D448		MOVE R4, (R4)
2D6E	A4FF		ADD R4, #$100
2D70	0488		ADD R4, R8
2D72	084C		MHL R8, R4
2D74	088A		ADDH R8, R8
2D76	048D		MLH R4, R8
2D78	97F8		CLR R7, #$F8
2D7A	0203		INC2 R2, R0
2D7C	A02B		BRA $2DAA		; $2C(R0)

2D7E	2547		MOVE R5, $8E
2D80	F500		SUB R5, #$01
2D82	3547		MOVE $8E, R5
2D84	015C		MHL R1, R5
2D86	0516		OR R5, R1
2D88	C50B		SNZ R5
2D8A	2074		JMP ($00E8)

2D8C	257B		MOVE R5, $F6
2D8E	A500		ADD R5, #$01
2D90	357B		MOVE $F6, R5
2D92	2748		MOVE R7, $90
2D94	8110		LBI R1, #$10
2D96	C715		SBS R7, R1
2D98	F049		BRA $2D50		; -> -$4A(R0)

2D9A	257B		MOVE R5, $F6
2D9C	8101		LBI R1, #$01
2D9E	C515		SBS R5, R1
2DA0	F051		BRA $2D50		; -> -$52(R0)

2DA2	2577		MOVE R5, $EE
2DA4	A57F		ADD R5, #$80
2DA6	3577		MOVE $EE, R5
2DA8	F0C9		BRA $2CE0		; -> -$CA(R0)

2DAA	8107		LBI R1, #$07
2DAC	0179		SUB R1, R7
2DAE	2D50		MOVE R13, $A0
2DB0	8DFF		LBI R13, #$FF
2DB2	0118		ADD R1, R1
2DB4	0018		ADD R0, R1
2DB6	E0DC		SHR R13
2DB8	E0DC		SHR R13
2DBA	E0DC		SHR R13
2DBC	E0DC		SHR R13
2DBE	E0DC		SHR R13
2DC0	E0DC		SHR R13
2DC2	E0DC		SHR R13
2DC4	0F78		ADD R15, R7
2DC6	FF07		SUB R15, #$08
2DC8	8180		LBI R1, #$80
2DCA	CF1F		SNBSH R15, R1
2DCC	A009		BRA $2DD8		; $0A(R0)

2DCE	6148		MOVB R1, (R4)
2DD0	01D6		OR R1, R13
2DD2	7140		MOVB (R4)+, R1
2DD4	8700		LBI R7, #$00
2DD6	F02D		BRA $2DAA		; -> -$2E(R0)

2DD8	81FF		LBI R1, #$FF
2DDA	0F17		XOR R15, R1
2DDC	AF00		ADD R15, #$01
2DDE	011D		MLH R1, R1
2DE0	8100		LBI R1, #$00
2DE2	0FF8		ADD R15, R15
2DE4	00F8		ADD R0, R15
2DE6	E01C		SHR R1
2DE8	E01C		SHR R1
2DEA	E01C		SHR R1
2DEC	E01C		SHR R1
2DEE	E01C		SHR R1
2DF0	E01C		SHR R1
2DF2	E01C		SHR R1
2DF4	E01C		SHR R1
2DF6	0D15		AND R13, R1
2DF8	6148		MOVB R1, (R4)
2DFA	01D6		OR R1, R13
2DFC	7148		MOVB (R4), R1
2DFE	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; ***********************
; Mark header record as deleted if permitted

2E00	A429		ADD R4, #$2A		; Write Protect Indicator
2E02	6548		MOVB R5, (R4)
2E04	8140		LBI R1, #$40
2E06	C512		SE R5, R1
2E08	A019		BRA $2E24		; File is write protected

2E0A	A417		ADD R4, #$18		; Expiration Date
2E0C	8F06		LBI R15, #$06		; Length of field
2E0E	6540		MOVB R5, (R4)+
2E10	8140		LBI R1, #$40
2E12	C512		SE R5, R1
2E14	A00D		BRA $2E24		; File not expired
2E16	FF00		SUB R15, #$01
2E18	CF03		SZ R15
2E1A	F00D		BRA $2E0E		; -> -$0E(R0)

			; Mark header record as deleted
			; (HDR1 -> DDR1)
2E1C	F447		SUB R4, #$48		; Header Label ID
2E1E	81C4		LBI R1, #$C4
2E20	7148		MOVB (R4), R1

2E22	0024		RET R2			; Return
; ----

			; Put number of failed file into IOCB
2E24	0434		MOVE R4, R3
2E26	A40D		ADD R4, #$0E		; IOCB_CI2
2E28	257B		MOVE R5, $F6
2E2A	5548		MOVE (R4), R5

2E2C	8614		LBI R6, #$14		; Error 39
2E2E	F0E9		BRA $2D46		; Error exit

; ***********************
; Diskette I/O Supervisor
; ***********************

2E30	3241		MOVE $82, R2
2E32	2477		MOVE R4, $EE
2E34	81C8		LBI R1, #'H'
2E36	7140		MOVB (R4)+, R1
2E38	81C4		LBI R1, #'D'
2E3A	7140		MOVB (R4)+, R1
2E3C	81D9		LBI R1, #'R'
2E3E	7140		MOVB (R4)+, R1
2E40	81F1		LBI R1, #'1'
2E42	7140		MOVB (R4)+, R1
2E44	8140		LBI R1, #' '
2E46	7140		MOVB (R4)+, R1
2E48	81E2		LBI R1, #'S'
2E4A	7140		MOVB (R4)+, R1
2E4C	81E8		LBI R1, #'Y'
2E4E	7140		MOVB (R4)+, R1
2E50	81E2		LBI R1, #'S'
2E52	7140		MOVB (R4)+, R1
2E54	257B		MOVE R5, $F6
2E56	2750		MOVE R7, $A0
2E58	8803		LBI R8, #$03
2E5A	088D		MLH R8, R8
2E5C	88E8		LBI R8, #$E8
2E5E	0589		SUB R5, R8
2E60	085C		MHL R8, R5
2E62	055D		MLH R5, R5
2E64	058C		MHL R5, R8
2E66	0859		SUB R8, R5
2E68	055C		MHL R5, R5
2E6A	058D		MLH R5, R8
2E6C	8180		LBI R1, #$80
2E6E	C517		SBSH R5, R1
2E70	A011		BRA $2E84		; $12(R0)

2E72	8803		LBI R8, #$03
2E74	088D		MLH R8, R8
2E76	88E8		LBI R8, #$E8
2E78	0588		ADD R5, R8
2E7A	085C		MHL R8, R5
2E7C	088A		ADDH R8, R8
2E7E	058D		MLH R5, R8
2E80	81F0		LBI R1, #$F0
2E82	A001		BRA $2E86		; $02(R0)

2E84	81F1		LBI R1, #$F1
2E86	7140		MOVB (R4)+, R1
2E88	F563		SUB R5, #$64
2E8A	8180		LBI R1, #$80
2E8C	C51F		SNBSH R5, R1
2E8E	A003		BRA $2E94		; $04(R0)

2E90	A700		ADD R7, #$01
2E92	F00B		BRA $2E88		; -> -$0C(R0)

2E94	B7F0		SET R7, #$F0
2E96	7740		MOVB (R4)+, R7
2E98	A563		ADD R5, #$64
2E9A	8130		LBI R1, #$30
2E9C	011D		MLH R1, R1
2E9E	8192		LBI R1, #$92
2EA0	0203		INC2 R2, R0
2EA2	0014		RET R1

2EA4	075C		MHL R7, R5
2EA6	7740		MOVB (R4)+, R7
2EA8	7540		MOVB (R4)+, R5
2EAA	8740		LBI R7, #$40
2EAC	880C		LBI R8, #$0C
2EAE	7740		MOVB (R4)+, R7
2EB0	F800		SUB R8, #$01
2EB2	C803		SZ R8
2EB4	F007		BRA $2EAE		; -> -$08(R0)

2EB6	81F1		LBI R1, #$F1
2EB8	7140		MOVB (R4)+, R1
2EBA	81F2		LBI R1, #$F2
2EBC	7140		MOVB (R4)+, R1
2EBE	81F8		LBI R1, #$F8
2EC0	7140		MOVB (R4)+, R1
2EC2	8140		LBI R1, #$40
2EC4	7140		MOVB (R4)+, R1
2EC6	8133		LBI R1, #$33
2EC8	011D		MLH R1, R1
2ECA	8116		LBI R1, #$16
2ECC	0203		INC2 R2, R0
2ECE	0014		RET R1

2ED0	2477		MOVE R4, $EE
2ED2	A420		ADD R4, #$21
2ED4	B5F0		SET R5, #$F0
2ED6	81F0		LBI R1, #$F0
2ED8	C51A		SNE R5, R1
2EDA	8540		LBI R5, #$40
2EDC	7548		MOVB (R4), R5
2EDE	A405		ADD R4, #$06
2EE0	8140		LBI R1, #$40
2EE2	7140		MOVB (R4)+, R1
2EE4	7140		MOVB (R4)+, R1
2EE6	7140		MOVB (R4)+, R1
2EE8	7140		MOVB (R4)+, R1
2EEA	055C		MHL R5, R5
2EEC	81C5		LBI R1, #$C5
2EEE	7140		MOVB (R4)+, R1
2EF0	881E		LBI R8, #$1E
2EF2	8740		LBI R7, #$40
2EF4	7740		MOVB (R4)+, R7
2EF6	F800		SUB R8, #$01
2EF8	C803		SZ R8
2EFA	F007		BRA $2EF4		; -> -$08(R0)

2EFC	A404		ADD R4, #$05
2EFE	7740		MOVB (R4)+, R7
2F00	8140		LBI R1, #$40
2F02	C51A		SNE R5, R1
2F04	8700		LBI R7, #$00
2F06	8830		LBI R8, #$30
2F08	7740		MOVB (R4)+, R7
2F0A	F800		SUB R8, #$01
2F0C	C803		SZ R8
2F0E	F007		BRA $2F08		; -> -$08(R0)

2F10	2041		JMP ($0082)

; ***********************
; Diskette I/O Supervisor
; ***********************
; Calculate track, side and sector from file offset
; Parameters:
;  R3 - pointer to IOCB
;  R13 - file offset in number of sectors from beginning of file

2F12	3243		MOVE $86, R2		; Save R2

			; Get sectors per track (-> R5)
2F14	8131		LBI R1, #$31
2F16	011D		MLH R1, R1
2F18	8198		LBI R1, #$98
2F1A	0203		INC2 R2, R0
2F1C	0014		RET R1			; CALL $3198, R2

			; Value *8 gives no. of tries until sector found
2F1E	0154		MOVE R1, R5
2F20	E01F		SWAP R1
2F22	E01D		ROR R1
2F24	314C		MOVE $98, R1

2F26	2750		MOVE R7, $A0

2F28	0434		MOVE R4, R3
2F2A	A409		ADD R4, #$0A		; IOCB_WA
2F2C	D448		MOVE R4, (R4)
2F2E	A400		ADD R4, #$01
2F30	6848		MOVB R8, (R4)		; Get sector and side from WA
2F32	9880		CLR R8, #$80		; Clear side bit

2F34	0FD4		MOVE R15, R13		; File offset in no. of sectors
2F36	0154		MOVE R1, R5		; Sectors per track
2F38	0189		SUB R1, R8		; Sectors remaining on track
2F3A	0F19		SUB R15, R1

			; Test if offset on current track
2F3C	8880		LBI R8, #$80
2F3E	0203		INC2 R2, R0
2F40	A01D		BRA $2F60

			; Desired sector is not on current track
2F42	E05F		SWAP R5
2F44	E05D		ROR R5

2F46	0F59		SUB R15, R5
2F48	CF8F		SNBSH R15, R8
2F4A	A00B		BRA $2F58		; $0C(R0)
2F4C	01FC		MHL R1, R15
2F4E	01F6		OR R1, R15
2F50	C10B		SNZ R1
2F52	A003		BRA $2F58		; $04(R0)

2F54	A707		ADD R7, #$08
2F56	F011		BRA $2F46		; Loop ^

2F58	0F58		ADD R15, R5
2F5A	E05E		ROR3 R5
2F5C	0204		MOVE R2, R0
2F5E	0F59		SUB R15, R5		; Loop v

			; R8 is $80
2F60	CF8F		SNBSH R15, R8
2F62	A00B		BRA $2F70		; $0C(R0)

2F64	01FC		MHL R1, R15
2F66	01F6		OR R1, R15
2F68	C10B		SNZ R1
2F6A	A003		BRA $2F70		; $04(R0)

2F6C	A700		ADD R7, #$01
2F6E	0024		RET R2			; Loop ^
; ----

2F70	0F58		ADD R15, R5
2F72	3F4F		MOVE $9E, R15		; Sector
2F74	C703		SZ R7
2F76	A017		BRA $2F90		; $18(R0)

2F78	0434		MOVE R4, R3
2F7A	A409		ADD R4, #$0A
2F7C	D448		MOVE R4, (R4)
2F7E	D548		MOVE R5, (R4)
2F80	075C		MHL R7, R5
2F82	374D		MOVE $9A, R7		; Cylinder
2F84	2750		MOVE R7, $A0
2F86	8180		LBI R1, #$80
2F88	C516		SBC R5, R1
2F8A	8701		LBI R7, #$01
2F8C	374E		MOVE $9C, R7		; Side
2F8E	A005		BRA $2F96		; $06(R0)

2F90	374D		MOVE $9A, R7
2F92	0203		INC2 R2, R0
2F94	A001		BRA $2F98		; $02(R0)

2F96	2043		JMP ($0086)		; Return

; ***********************
; Diskette I/O Supervisor
; ***********************

2F98	3242		MOVE $84, R2
2F9A	8133		LBI R1, #$33
2F9C	011D		MLH R1, R1
2F9E	8116		LBI R1, #$16
2FA0	0203		INC2 R2, R0
2FA2	0014		RET R1

2FA4	0434		MOVE R4, R3
2FA6	A409		ADD R4, #$0A
2FA8	D448		MOVE R4, (R4)
2FAA	055C		MHL R5, R5
2FAC	8140		LBI R1, #$40
2FAE	C512		SE R5, R1
2FB0	A00D		BRA $2FC0		; $0E(R0)

2FB2	2850		MOVE R8, $A0
2FB4	384E		MOVE $9C, R8
2FB6	D548		MOVE R5, (R4)
2FB8	085C		MHL R8, R5
2FBA	254D		MOVE R5, $9A
2FBC	0858		ADD R8, R5
2FBE	A023		BRA $2FE4		; $24(R0)

2FC0	2750		MOVE R7, $A0
2FC2	D548		MOVE R5, (R4)
2FC4	8180		LBI R1, #$80
2FC6	C516		SBC R5, R1
2FC8	8701		LBI R7, #$01
2FCA	284D		MOVE R8, $9A
2FCC	8101		LBI R1, #$01
2FCE	C815		SBS R8, R1
2FD0	A007		BRA $2FDA		; $08(R0)

2FD2	A700		ADD R7, #$01
2FD4	9702		CLR R7, #$02
2FD6	C70B		SNZ R7
2FD8	A800		ADD R8, #$01
2FDA	374E		MOVE $9C, R7
2FDC	E08C		SHR R8
2FDE	D548		MOVE R5, (R4)
2FE0	075C		MHL R7, R5
2FE2	0878		ADD R8, R7
2FE4	384D		MOVE $9A, R8

2FE6	2042		JMP ($0084)

; ****************************************************
; Diskette I/O Supervisor
; Get track, side and sector number of directory entry
; for a given file number
; ****************************************************

2FE8	3242		MOVE $84, R2		; Save R2
2FEA	0F54		MOVE R15, R5		; File number

2FEC	8131		LBI R1, #$31
2FEE	011D		MLH R1, R1
2FF0	81BA		LBI R1, #$BA
2FF2	0203		INC2 R2, R0
2FF4	0014		RET R1			; Get number of dir. entries

2FF6	0754		MOVE R7, R5		; Max. dir entry number
2FF8	08F4		MOVE R8, R15		; File number
2FFA	0789		SUB R7, R8
2FFC	087C		MHL R8, R7
2FFE	077D		MLH R7, R7
3000	078C		MHL R7, R8
3002	0879		SUB R8, R7
3004	077C		MHL R7, R7
3006	078D		MLH R7, R8		; R7 <- R7 - R8
3008	8180		LBI R1, #$80
300A	C717		SBSH R7, R1		; File number > Max dir. entry?
300C	A00B		BRA $301A		; No, ok

300E	861A		LBI R6, #$1A		; Error 36
3010	813E		LBI R1, #$3E
3012	011D		MLH R1, R1
3014	81FA		LBI R1, #$FA
3016	0203		INC2 R2, R0
3018	0014		RET R1			; Error exit

301A	2750		MOVE R7, $A0		; Start with side 0
301C	2850		MOVE R8, $A0		; and track 0

301E	01FC		MHL R1, R15
3020	C103		SZ R1
3022	A009		BRA $302E
3024	8113		LBI R1, #$13
3026	CF10		SLE R15, R1		; File number <= 19
3028	A003		BRA $302E		; No

302A	AF06		ADD R15, #$07		; Add 7 sectors for dir. entry
302C	A037		BRA $3066

			; File number > 19 means dir. entry is not
			; on track 0 side 0

302E	015C		MHL R1, R5
3030	C103		SZ R1
3032	A00B		BRA $3040		; $0C(R0)
3034	812D		LBI R1, #$2D
3036	C512		SE R5, R1		; Max. 45 entries ?
3038	A005		BRA $3040		; No

303A	8701		LBI R7, #$01		; Side 1
303C	FF12		SUB R15, #$13		; Sector number
303E	A025		BRA $3066

			; More than max. 45 entries on diskette,
			; so there are 2 entries per sector (Diskette 2D)

3040	FF11		SUB R15, #$12
3042	E0FC		SHR R15			; Rel. sector with dir. entry
3044	2150		MOVE R1, $A0
3046	01FC		MHL R1, R15
3048	E01C		SHR R1
304A	0F1D		MLH R15, R1
304C	8101		LBI R1, #$01
304E	0717		XOR R7, R1
3050	C70B		SNZ R7
3052	A800		ADD R8, #$01
3054	FF19		SUB R15, #$1A		; 26 sectors per dir. track
3056	01FC		MHL R1, R15
3058	01F6		OR R1, R15
305A	C10B		SNZ R1
305C	A005		BRA $3064		; Zero -> done
305E	8180		LBI R1, #$80
3060	CF17		SBSH R15, R1		; Negative -> done
3062	F017		BRA $304C		; Loop

3064	AF19		ADD R15, #$1A		; Add 26 sectors (correction)

			; Track, side and sector of dir. entry known

3066	374E		MOVE $9C, R7		; Side
3068	384D		MOVE $9A, R8		; Track
306A	3F4F		MOVE $9E, R15		; Sector
306C	81D0		LBI R1, #$D0		; Number of retries
306E	314C		MOVE $98, R1

3070	2042		JMP ($0084)		; Return to caller

; ***********************
; Diskette I/O Supervisor
; ***********************
; Convert track, side and sector back to EBCDIC for Write Header

3072	3241		MOVE $82, R2		; Save R2

3074	254D		MOVE R5, $9A		; Track
3076	0203		INC2 R2, R0
3078	A017		BRA $3092		; $18(R0)
307A	5541		MOVE (R4)+, R5

307C	254E		MOVE R5, $9C		; Side
307E	0203		INC2 R2, R0
3080	A00F		BRA $3092		; $10(R0)
3082	7541		MOVB (R4)++, R5

3084	254F		MOVE R5, $9E		; Sector
3086	0203		INC2 R2, R0
3088	A007		BRA $3092		; $08(R0)
308A	7544		MOVB (R4)-, R5

308C	055C		MHL R5, R5
308E	7548		MOVB (R4), R5

3090	2041		JMP ($0082)		; Return

; ***********************
; Diskette I/O Supervisor
; ***********************
; Convert binary byte to EBCDIC

3092	2850		MOVE R8, $A0

3094	F509		SUB R5, #$0A
3096	8180		LBI R1, #$80
3098	C51F		SNBSH R5, R1
309A	A003		BRA $30A0		; $04(R0)
309C	A800		ADD R8, #$01
309E	F00B		BRA $3094		; Loop

30A0	B8F0		SET R8, #$F0
30A2	A509		ADD R5, #$0A
30A4	B5F0		SET R5, #$F0
30A6	058D		MLH R5, R8

30A8	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; ***********************
; Read and parse information from header record

30AA	3243		MOVE $86, R2		; Save R2
30AC	3447		MOVE $8E, R4		; Save R4 (Ptr. to dir. entry)

30AE	81C8		LBI R1, #$C8
30B0	6540		MOVB R5, (R4)+
30B2	C512		SE R5, R1		; 'H' ?
30B4	A047		BRA $30FE		; No, error 38

30B6	81C4		LBI R1, #$C4
30B8	6540		MOVB R5, (R4)+
30BA	C512		SE R5, R1		; 'D' ?
30BC	A03F		BRA $30FE		; No, error 38

30BE	81D9		LBI R1, #$D9
30C0	6540		MOVB R5, (R4)+
30C2	C512		SE R5, R1		; 'R' ?
30C4	A037		BRA $30FE		; No, error 38

30C6	81F1		LBI R1, #$F1
30C8	6548		MOVB R5, (R4)
30CA	C512		SE R5, R1		; '1' ?
30CC	A02F		BRA $30FE		; No, error 38

30CE	8133		LBI R1, #$33
30D0	011D		MLH R1, R1
30D2	8116		LBI R1, #$16
30D4	0203		INC2 R2, R0
30D6	0014		RET R1			; Get status word

30D8	95F0		CLR R5, #$F0		; Sector length code

30DA	2447		MOVE R4, $8E		; Restore R4
30DC	A42A		ADD R4, #$2B
30DE	6748		MOVB R7, (R4)		; Exchange Type Indicator
30E0	8140		LBI R1, #$40
30E2	C71A		SNE R7, R1
30E4	A011		BRA $30F8		; Blank

30E6	81C8		LBI R1, #$C8
30E8	C712		SE R7, R1
30EA	A007		BRA $30F4		; Not a basic exchange data set

30EC	8140		LBI R1, #$40
30EE	7148		MOVB (R4), R1
30F0	8701		LBI R7, #$01		; 256 bytes phys. record size
30F2	A003		BRA $30F8

30F4	F409		SUB R4, #$0A
30F6	6748		MOVB R7, (R4)		; Physical Record Length

30F8	97F0		CLR R7, #$F0
30FA	C57A		SNE R5, R7
30FC	A003		BRA $3102		; $04(R0)

30FE	8616		LBI R6, #$16		; Error 38
3100	F0F1		BRA $3010		; -> -$F2(R0)

3102	0834		MOVE R8, R3
3104	A809		ADD R8, #$0A
3106	D888		MOVE R8, (R8)		; IOCB_WA
3108	A807		ADD R8, #$08
310A	7788		MOVB (R8), R7		; Store record length in WA

310C	2447		MOVE R4, $8E		; Restore R4
310E	A41B		ADD R4, #$1C		; Ptr to Begin Of Extent
3110	0203		INC2 R2, R0
3112	A0DB		BRA $31F0		; Check extent

3114	0203		INC2 R2, R0
3116	A065		BRA $317E		; Get sectors/cylinder in $9A

3118	2447		MOVE R4, $8E		; Restore R4
311A	A421		ADD R4, #$22		; End Of Extent (EOE)
311C	D548		MOVE R5, (R4)		; Track (EOE)
311E	8132		LBI R1, #$32
3120	011D		MLH R1, R1
3122	815A		LBI R1, #$5A
3124	0203		INC2 R2, R0
3126	0014		RET R1			; Convert to binary

3128	814A		LBI R1, #$4A
312A	C810		SLE R8, R1		; EOE <= track 74 ?
312C	F02F		BRA $30FE		; No, error 38

			; Convert EOE in header record
312E	8132		LBI R1, #$32
3130	011D		MLH R1, R1
3132	8186		LBI R1, #$86
3134	0203		INC2 R2, R0
3136	0014		RET R1			

3138	0203		INC2 R2, R0
313A	A20D		ADD R2, #$0E		; R2 = $314A
			; (Go straight through following subroutine)
; ----

			; Get binary value back from header record
313C	6740		MOVB R7, (R4)+
313E	6548		MOVB R5, (R4)
3140	057D		MLH R5, R7

			; Get pointer to work area
3142	0434		MOVE R4, R3
3144	A409		ADD R4, #$0A		; IOCB_WA
3146	D448		MOVE R4, (R4)
3148	0024		RET R2
; ----

			; Store marked file size in WA
314A	A403		ADD R4, #$04
314C	5548		MOVE (R4), R5

			; Convert EOD in header record
314E	2447		MOVE R4, $8E		; Restore R4
3150	A449		ADD R4, #$4A		; EOD
3152	8132		LBI R1, #$32
3154	011D		MLH R1, R1
3156	8186		LBI R1, #$86
3158	0203		INC2 R2, R0
315A	0014		RET R1

315C	0203		INC2 R2, R0
315E	F023		BRA $313C		; -> -$24(R0)

			; Store used file size in WA
3160	A401		ADD R4, #$02
3162	5541		MOVE (R4)+, R5

			; Test if used size > marked size
3164	D748		MOVE R7, (R4)		; Marked file size
3166	A700		ADD R7, #$01
3168	0759		SUB R7, R5
316A	057C		MHL R5, R7
316C	077D		MLH R7, R7
316E	075C		MHL R7, R5
3170	0579		SUB R5, R7
3172	077C		MHL R7, R7
3174	075D		MLH R7, R5
3176	8180		LBI R1, #$80
3178	C71F		SNBSH R7, R1		; Used > marked ?
317A	F07D		BRA $30FE		; Yes, error 38

317C	2043		JMP ($0086)		; Return
; ----------

; **********************************
; Diskette I/O Supervisor
; Get number of sectors per cylinder
; **********************************

317E	3242		MOVE $84, R2		; Save R2

3180	0203		INC2 R2, R0
3182	A013		BRA $3198		; Get sectors/track

3184	354E		MOVE $9C, R5
3186	0203		INC2 R2, R0
3188	A079		BRA $3204		; Get drive status
318A	274E		MOVE R7, $9C

318C	055C		MHL R5, R5
318E	8140		LBI R1, #$40
3190	C512		SE R5, R1		; Diskette 1 ?
3192	0778		ADD R7, R7		; No, double number of sectors
3194	374D		MOVE $9A, R7

3196	2042		JMP ($0084)		; Return to caller

; ****************************************
; Diskette I/O Supervisor
; Calculate sectors/track for current disk
; ****************************************
; Returns value in R5

3198	3241		MOVE $82, R2		; Save R2

319A	0203		INC2 R2, R0
319C	A065		BRA $3204		; Get drive status

319E	95F0		CLR R5, #$F0		; Sector length code
31A0	085C		MHL R8, R5
31A2	81D4		LBI R1, #$D4
31A4	C81A		SNE R8, R1		; Diskette 2D ?
31A6	F500		SUB R5, #$01		; Yes, normalize to 0-2

31A8	2150		MOVE R1, $A0
31AA	95F0		CLR R5, #$F0
31AC	0558		ADD R5, R5
31AE	0058		ADD R0, R5
31B0	A10A		ADD R1, #$0B		; 26 sectors/track
31B2	A106		ADD R1, #$07		; 15 sectors/track
31B4	A107		ADD R1, #$08		; 8 sectors/track
31B6	0514		MOVE R5, R1

31B8	2041		JMP ($0082)		; Return to caller

; *******************************************
; Diskette I/O Supervisor
; Calculate total number of directory entries
; on the current disk
; *******************************************
; Return:
;  R5 and R7 (same)

31BA	3241		MOVE $82, R2		; Save R2

			; Get status word
31BC	0203		INC2 R2, R0
31BE	A043		BRA $3204		; Call $3316

31C0	075C		MHL R7, R5
31C2	8140		LBI R1, #$40
31C4	C71A		SNE R7, R1		; Diskette 1 ?
31C6	9580		CLR R5, #$80		; Yes, clear interleave bit

31C8	085C		MHL R8, R5
31CA	2750		MOVE R7, $A0
31CC	8713		LBI R7, #$13		; Standard 19 dir. entries
31CE	8140		LBI R1, #$40
31D0	C81A		SNE R8, R1		; Diskette 1
31D2	A007		BRA $31DC		; Yes, skip next block

31D4	81F2		LBI R1, #$F2
31D6	C812		SE R8, R1		; Test if Diskette 2 or 2D
31D8	A719		ADD R7, #$1A		; Add 26 dir. entries for 2D
31DA	A719		ADD R7, #$1A		; Add 26 dir. entries for 2

31DC	950F		CLR R5, #$0F		; Clear length code nibble
31DE	E05F		SWAP R5			; Number of add. dir. tracks
31E0	C50B		SNZ R5
31E2	A007		BRA $31EC		; No additional dir. tracks

			; Calculate total number of directory entries

31E4	A767		ADD R7, #$68		; 104 entries per add. track
31E6	F500		SUB R5, #$01		; Decrement track count
31E8	C503		SZ R5
31EA	F007		BRA $31E4		; Loop

31EC	0574		MOVE R5, R7
31EE	2041		JMP ($0082)		; Return to caller

; ***********************
; Diskette I/O Supervisor
; Check Extent (BOE)
; ***********************

31F0	3242		MOVE $84, R2		; Save R2

31F2	D542		MOVE R5, (R4)+'		; Track of extent
31F4	0203		INC2 R2, R0
31F6	A061		BRA $325A		; Convert to binary

31F8	814A		LBI R1, #$4A
31FA	C810		SLE R8, R1		; Track <= 74 ?
31FC	A057		BRA $3256		; No, error 38

31FE	0F84		MOVE R15, R8
3200	0744		MOVE R7, R4

3202	0203		INC2 R2, R0
3204	A07D		BRA $3284		; Get drive status

3206	065C		MHL R6, R5
3208	81D4		LBI R1, #$D4
320A	C612		SE R6, R1		; Diskette 2D ?
320C	8500		LBI R5, #$00		; No, no additional dir tracks
320E	950F		CLR R5, #$0F
3210	E05F		SWAP R5			; Number of dir. tracks
3212	CF58		SGT R15, R5		; Data track > last dir track ?
3214	A03F		BRA $3256		; No, error 38

3216	0474		MOVE R4, R7
3218	6740		MOVB R7, (R4)+		; Number is at odd address
321A	6545		MOVB R5, (R4)--		; so have to do byte accesses
321C	057D		MLH R5, R7		; Sector of extent
321E	0203		INC2 R2, R0
3220	A037		BRA $325A		; Convert to binary (into R8)

3222	08FD		MLH R8, R15		; Track number to high byte

3224	6548		MOVB R5, (R4)		; Head of extent
3226	87F0		LBI R7, #$F0
3228	C57A		SNE R5, R7		; Side 0 ?
322A	A00B		BRA $3238		; Yes

322C	8140		LBI R1, #$40
322E	C61A		SNE R6, R1
3230	A023		BRA $3256		; Blank, error 38

3232	87F1		LBI R7, #$F1
3234	C572		SE R5, R7		; Side 1 ?
3236	A01D		BRA $3256		; No, error 38

3238	95F0		CLR R5, #$F0
323A	C503		SZ R5
323C	B880		SET R8, #$80		; Set flag for side 1

323E	0734		MOVE R7, R3
3240	A709		ADD R7, #$0A
3242	D778		MOVE R7, (R7)		; IOCB_WA
3244	5878		MOVE (R7), R8		; Store track etc. in WA

3246	0203		INC2 R2, R0
3248	F0B1		BRA $3198		; Get sectors/track

324A	D778		MOVE R7, (R7)
324C	9780		CLR R7, #$80		; Clear side bit
324E	C703		SZ R7			; Track 0 -> error
3250	C750		SLE R7, R5		; Sector>sect/trk -> error
3252	A001		BRA $3256		; Error 38

3254	2042		JMP ($0084)		; Return to caller

3256	8616		LBI R6, #$16		; Error 38
3258	A0A9		BRA $3304		; Exit

; **************************************
; Diskette I/O Supervisor
; Convert EBCDIC number (word) to binary
; **************************************

			; Test if number is numeric (EBCDIC)

325A	075C		MHL R7, R5
325C	88F0		LBI R8, #$F0
325E	C78D		SNBS R7, R8
3260	C585		SBS R5, R8
3262	F00D		BRA $3256		; Not numeric, error 38

			; Convert EBCDIC to binary, high digit

3264	97F0		CLR R7, #$F0
3266	8109		LBI R1, #$09
3268	C710		SLE R7, R1
326A	F015		BRA $3256		; Number invalid, error 38

326C	2850		MOVE R8, $A0		; Binary track number

326E	C70B		SNZ R7
3270	A005		BRA $3278		; $06(R0)
3272	A809		ADD R8, #$0A		; Add 10
3274	F700		SUB R7, #$01
3276	F009		BRA $326E		; Loop

			; Convert EBCDIC to binary, low digit

3278	95F0		CLR R5, #$F0
327A	8109		LBI R1, #$09
327C	C510		SLE R5, R1
327E	F029		BRA $3256		; Number invalid, error 38

3280	0858		ADD R8, R5
3282	0024		RET R2
; ----------

3284	A08F		BRA $3316		; $90(R0)

; ***********************
; Diskette I/O Supervisor
; ***********************
; Calculate number of sectors between BOE and either EOE or EOD.
; Stores the result in reverse order (low byte first, then high byte)
; back into header record.
; Parameter:
;  R4 points to EOD or EOE in header record

3286	3241		MOVE $82, R2		; Save R2

3288	D542		MOVE R5, (R4)+'		; End Track
328A	0203		INC2 R2, R0
328C	F033		BRA $325A		; Convert to binary
328E	0B84		MOVE R11, R8		; Save result

3290	6840		MOVB R8, (R4)+
3292	6545		MOVB R5, (R4)--
3294	058D		MLH R5, R8		; End Sector
3296	0203		INC2 R2, R0
3298	F03F		BRA $325A		; Convert to binary
329A	0D84		MOVE R13, R8		; Save result

329C	6C41		MOVB R12, (R4)++	; End Side
329E	87F0		LBI R7, #$F0
32A0	CC7A		SNE R12, R7
32A2	A00D		BRA $32B2		; Side 0, ok

32A4	254D		MOVE R5, $9A
32A6	214E		MOVE R1, $9C
32A8	C51A		SNE R5, R1
32AA	A055		BRA $3302		; Error 38

32AC	87F1		LBI R7, #$F1
32AE	CC72		SE R12, R7		; Side 1 ?
32B0	A04F		BRA $3302		; No, error 38

32B2	9CF0		CLR R12, #$F0		; Make binary

32B4	0734		MOVE R7, R3
32B6	A709		ADD R7, #$0A
32B8	D778		MOVE R7, (R7)		; IOCB_WA
32BA	D578		MOVE R5, (R7)		; Get BOE from WA
32BC	2750		MOVE R7, $A0		; Total number of sectors
32BE	015C		MHL R1, R5		; Track
32C0	0B19		SUB R11, R1		; Tracks between end and BOE
32C2	8180		LBI R1, #$80
32C4	CB1F		SNBSH R11, R1		; End Track < BOE ?
32C6	A039		BRA $3302		; Yes, error 38

32C8	CB0B		SNZ R11
32CA	A007		BRA $32D4		; Done
32CC	214D		MOVE R1, $9A		; Sectors/cylinder
32CE	0718		ADD R7, R1		; Add to number of sectors
32D0	FB00		SUB R11, #$01		; Decrement cylinder cound
32D2	F00B		BRA $32C8		; Loop

32D4	8180		LBI R1, #$80
32D6	C516		SBC R5, R1
32D8	FC00		SUB R12, #$01		
32DA	284E		MOVE R8, $9C
32DC	CD03		SZ R13
32DE	CD80		SLE R13, R8
32E0	A01F		BRA $3302		; Error 38

32E2	8180		LBI R1, #$80
32E4	CC15		SBS R12, R1
32E6	A003		BRA $32EC		; $04(R0)

32E8	0789		SUB R7, R8
32EA	A003		BRA $32F0		; $04(R0)

32EC	CC03		SZ R12
32EE	0788		ADD R7, R8
32F0	9580		CLR R5, #$80
32F2	0D59		SUB R13, R5
32F4	0D78		ADD R13, R7
32F6	07DC		MHL R7, R13
32F8	077A		ADDH R7, R7
32FA	0D7D		MLH R13, R7
32FC	8180		LBI R1, #$80
32FE	CD17		SBSH R13, R1
3300	A00B		BRA $330E		; $0C(R0)

3302	8616		LBI R6, #$16		; Error 38

3304	813E		LBI R1, #$3E
3306	011D		MLH R1, R1
3308	81FA		LBI R1, #$FA
330A	0203		INC2 R2, R0
330C	0014		RET R1			; Error routine
; ----

330E	7D44		MOVB (R4)-, R13
3310	0DDC		MHL R13, R13
3312	7D48		MOVB (R4), R13

3314	2041		JMP ($0082)		; Return to caller

; *************************
; Diskette I/O Supervisor
; Get drive status word (?)
; *************************

3316	246C		MOVE R4, $D8
3318	F40B		SUB R4, #$0C

331A	D538		MOVE R5, (R3)		; IOCB_Sub in Lo(R5)
331C	0558		ADD R5, R5		; Shift left one position
331E	C50B		SNZ R5
3320	A003		BRA $3326		; Finished
3322	A401		ADD R4, #$02
3324	F009		BRA $331C		; Loop

3326	D548		MOVE R5, (R4)
3328	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; Increment IOCB_CI1
; (File number on find)
; ***********************

332A	0434		MOVE R4, R3
332C	A407		ADD R4, #$08
332E	D548		MOVE R5, (R4)		; IOCB_CI1
3330	A500		ADD R5, #$01
3332	5548		MOVE (R4), R5

3334	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; ***********************
; Check if read operation is within the limits of the file

			; Get offset (in sectors)
3336	0434		MOVE R4, R3
3338	A407		ADD R4, #$08
333A	D748		MOVE R7, (R4)		; IOCB_CI1 (file offset)
333C	8180		LBI R1, #$80
333E	C71F		SNBSH R7, R1
3340	A037		BRA $337A		; Error 10

			; Get used space (no. of sectors)
3342	A401		ADD R4, #$02
3344	D448		MOVE R4, (R4)		; IOCB_WA
3346	A401		ADD R4, #$02
3348	D848		MOVE R8, (R4)

			; Test if operation beyond end of file
334A	0574		MOVE R5, R7
334C	0589		SUB R5, R8
334E	085C		MHL R8, R5
3350	055D		MLH R5, R5
3352	058C		MHL R5, R8
3354	0859		SUB R8, R5
3356	055C		MHL R5, R5
3358	058D		MLH R5, R8		; R5 <- R5 - R8
335A	8180		LBI R1, #$80
335C	C51F		SNBSH R5, R1		; Offset <= EOF ?
335E	0024		RET R2			; Yes, return

			; Error, operation past end of file or data

3360	A401		ADD R4, #$02
3362	D848		MOVE R8, (R4)		; Get 4(IOCB_WA)

3364	0574		MOVE R5, R7
3366	0859		SUB R8, R5
3368	058C		MHL R5, R8
336A	088D		MLH R8, R8
336C	085C		MHL R8, R5
336E	0589		SUB R5, R8
3370	088C		MHL R8, R8
3372	085D		MLH R8, R5		; R8 <- R8 - R5
3374	8180		LBI R1, #$80

3376	8650		LBI R6, #$50		; Default to error 9 (EOD)
3378	C81F		SNBSH R8, R1		; Negative (R8<R5) ?
337A	864E		LBI R6, #$4E		; Yes, error 10 (EOF)
337C	F079		BRA $3304		; Error exit

; *********************************************
; Diskette I/O Supervisor
; Verify diskette parameters from Volume Header
; and adjusts IOCB_BS to sector size
; *********************************************

337E	0434		MOVE R4, R3
3380	A403		ADD R4, #$04
3382	D448		MOVE R4, (R4)		; IOCB_BA

3384	A446		ADD R4, #$47
3386	6748		MOVB R7, (R4)		; Volume Surface Indicator
3388	A403		ADD R4, #$04
338A	6848		MOVB R8, (R4)		; Physical Sector Length

338C	8140		LBI R1, #$40
338E	C71A		SNE R7, R1		; Diskette 1
3390	A01D		BRA $33B0		; Yes

3392	ED5F		STAT R5, $D		; Diskette Sense Byte
3394	8104		LBI R1, #$04
3396	C515		SBS R5, R1		; Two-sided diskette ?
3398	A011		BRA $33AC		; No, error 25

339A	81F2		LBI R1, #$F2
339C	C71A		SNE R7, R1		; Diskette 2 ?
339E	A00F		BRA $33B0		; Yes

33A0	81D4		LBI R1, #$D4
33A2	C712		SE R7, R1		; Diskette 2D ?
33A4	A005		BRA $33AC		; No, error 25

33A6	8140		LBI R1, #$40
33A8	C812		SE R8, R1		; 128 bytes/sect. ?
33AA	A00F		BRA $33BC		; No

33AC	8630		LBI R6, #$30		; Error 25
33AE	F0AB		BRA $3304		; -> -$AC(R0)

33B0	81F3		LBI R1, #$F3
33B2	C81A		SNE R8, R1		; 1024 bytes/sect. ?
33B4	F009		BRA $33AC		; Yes, error 25

33B6	8140		LBI R1, #$40
33B8	C81A		SNE R8, R1		; 128 bytes/sect. ?
33BA	A00B		BRA $33C8		; Yes

33BC	81F1		LBI R1, #$F1
33BE	C819		SGE R8, R1		; >= 256 bytes/sect. ?
33C0	F015		BRA $33AC		; No, error 25

33C2	81F3		LBI R1, #$F3
33C4	C810		SLE R8, R1		; <= 1024 bytes/sect. ?
33C6	F01B		BRA $33AC		; No, error 25

33C8	98F0		CLR R8, #$F0		; Make binary (sector length)

33CA	8140		LBI R1, #$40
33CC	C712		SE R7, R1		; Diskette 1 ?
33CE	A019		BRA $33EA		; No

			; Diskette 1

33D0	A400		ADD R4, #$01
33D2	D548		MOVE R5, (R4)		; Interleave factor
33D4	8140		LBI R1, #$40
33D6	C51A		SNE R5, R1		; Blank (1:1) ?
33D8	A031		BRA $340C		; Yes

33DA	81F1		LBI R1, #$F1
33DC	C512		SE R5, R1		; '.1' ?
33DE	A005		BRA $33E6		; No

33E0	055C		MHL R5, R5
33E2	81F0		LBI R1, #$F0
33E4	C512		SE R5, R1		; '01' ?
33E6	B880		SET R8, #$80		; No

33E8	A021		BRA $340C

			; Diskette 2

33EA	81D4		LBI R1, #$D4		; 'M'
33EC	C712		SE R7, R1		; Diskette 2D ?
33EE	A01B		BRA $340C		; No

33F0	F40A		SUB R4, #$0B
33F2	6548		MOVB R5, (R4)		; Extended Label Area
33F4	8140		LBI R1, #$40
33F6	C51A		SNE R5, R1		; Additional tracks ?
33F8	A00B		BRA $3406		; No

33FA	81F1		LBI R1, #$F1
33FC	C519		SGE R5, R1		; >= '1'
33FE	F053		BRA $33AC		; No, error 25

3400	81F9		LBI R1, #$F9
3402	C510		SLE R5, R1		; <= '9'
3404	F059		BRA $33AC		; No, error 25

3406	95F0		CLR R5, #$F0		; Make binary
3408	E05F		SWAP R5			; To high nibble
340A	0856		OR R8, R5		; Sector length to low nibble

340C	087D		MLH R8, R7		; Vol. Surf. Ind. to high byte

			; Save status word

340E	246C		MOVE R4, $D8
3410	F40B		SUB R4, #$0C
3412	D738		MOVE R7, (R3)
3414	0778		ADD R7, R7
3416	C70B		SNZ R7
3418	A003		BRA $341E		; $04(R0)
341A	A401		ADD R4, #$02
341C	F009		BRA $3414		; -> -$0A(R0)

341E	5848		MOVE (R4), R8

			; Set IOCB_BS to size of a data sector

3420	98F0		CLR R8, #$F0		; Get length code
3422	8103		LBI R1, #$03
3424	C81A		SNE R8, R1		; 1024 bytes/sect. ?
3426	A800		ADD R8, #$01		; Size $0400
3428	2F50		MOVE R15, $A0
342A	0F8D		MLH R15, R8
342C	C80B		SNZ R8
342E	8F80		LBI R15, #$80		; 128 bytes (default)
3430	0434		MOVE R4, R3
3432	A405		ADD R4, #$06
3434	5F48		MOVE (R4), R15		; IOCB_BS

3436	0024		RET R2			; Return to caller

; ******************************************************
; Diskette I/O Supervisor
; Read sector
; Locates the sector on disk and reads in the data field
; ******************************************************

3438	3245		MOVE $8A, R2		; Save R2

343A	2550		MOVE R5, $A0
343C	354A		MOVE $94, R5

343E	8137		LBI R1, #$37
3440	011D		MLH R1, R1
3442	8180		LBI R1, #$80
3444	0203		INC2 R2, R0
3446	0014		RET R1			; Locate sector on disk

			; Sector found

3448	0434		MOVE R4, R3
344A	A403		ADD R4, #$04
344C	D448		MOVE R4, (R4)		; IOCB_BA

344E	2548		MOVE R5, $90
3450	8108		LBI R1, #$08
3452	C515		SBS R5, R1
3454	242E		MOVE R4, $5C

3456	8600		LBI R6, #$00
3458	813D		LBI R1, #$3D
345A	011D		MLH R1, R1
345C	815C		LBI R1, #$5C
345E	0203		INC2 R2, R0
3460	0014		RET R1			; Read data field

3462	C60B		SNZ R6			; Errors found ?
3464	A035		BRA $349C		; No

3466	8180		LBI R1, #$80
3468	C615		SBS R6, R1		; CRC error ?
346A	A02F		BRA $349C		; No

346C	2551		MOVE R5, $A2
346E	8180		LBI R1, #$80
3470	C51F		SNBSH R5, R1		; Retry on CRC errors ?
3472	A00B		BRA $3480		; No

3474	254A		MOVE R5, $94
3476	A500		ADD R5, #$01
3478	354A		MOVE $94, R5		; Increment retry counter
347A	810A		LBI R1, #$0A
347C	C519		SGE R5, R1
347E	F041		BRA $343E		; Retry read

3480	8120		LBI R1, #$20
3482	C61D		SNBS R6, R1		; DDAM ?
3484	A00B		BRA $3492		; Yes

3486	8640		LBI R6, #$40		; Error 17
3488	813E		LBI R1, #$3E
348A	011D		MLH R1, R1
348C	81FA		LBI R1, #$FA
348E	0203		INC2 R2, R0
3490	0014		RET R1			; Error exit

3492	2729		MOVE R7, $52		; Get first data byte from R9L2
3494	81C4		LBI R1, #$C4
3496	C71A		SNE R7, R1		; Is it 'D' ?
3498	F013		BRA $3486		; Yes, error 17

			; Sectors with DDAM may have CRC errors if first
			; data byte is not 'D'. No error is set then.

349A	9680		CLR R6, #$80		; Clear CRC error flag

349C	2045		JMP ($008A)		; Return to caller

; ***********************
; Diskette I/O Supervisor
; ***********************

349E	3245		MOVE $8A, R2		; Save R2

34A0	2550		MOVE R5, $A0
34A2	354A		MOVE $94, R5		; Reset retry counter

34A4	2548		MOVE R5, $90
34A6	9501		CLR R5, #$01
34A8	3548		MOVE $90, R5

34AA	0434		MOVE R4, R3
34AC	A403		ADD R4, #$04		; IOCB_BA
34AE	D748		MOVE R7, (R4)
34B0	372E		MOVE $5C, R7		; R14L2

34B2	8108		LBI R1, #$08
34B4	C516		SBC R5, R1
34B6	A021		BRA $34DA		; $22(R0)

34B8	A409		ADD R4, #$0A		; IOCB_CI2
34BA	2550		MOVE R5, $A0
34BC	5548		MOVE (R4), R5

34BE	2522		MOVE R5, $44		; R2L2
34C0	3523		MOVE $46, R5		; R3L2

34C2	F405		SUB R4, #$06		; IOCB_CI1
34C4	DD48		MOVE R13, (R4)
34C6	3D2C		MOVE $58, R13		; R12L2

34C8	252E		MOVE R5, $5C		; R14L2
34CA	352D		MOVE $5A, R5		; R13L2

34CC	812F		LBI R1, #$2F
34CE	011D		MLH R1, R1
34D0	8112		LBI R1, #$12
34D2	0203		INC2 R2, R0
34D4	0014		RET R1			; CALL $2F12, R2

34D6	254D		MOVE R5, $9A
34D8	352B		MOVE $56, R5		; R11L2

			; Locate sector on disk (implies seek etc.)
34DA	8137		LBI R1, #$37
34DC	011D		MLH R1, R1
34DE	8180		LBI R1, #$80
34E0	0203		INC2 R2, R0
34E2	0014		RET R1			; CALL $3780, R2

34E4	242E		MOVE R4, $5C		; R14L2
34E6	86FB		LBI R6, #$FB
34E8	2548		MOVE R5, $90
34EA	8120		LBI R1, #$20
34EC	C516		SBC R5, R1
34EE	86F8		LBI R6, #$F8
34F0	8110		LBI R1, #$10
34F2	C515		SBS R5, R1
34F4	A009		BRA $3500		; $0A(R0)

34F6	853E		LBI R5, #$3E
34F8	055D		MLH R5, R5
34FA	8572		LBI R5, #$72
34FC	8714		LBI R7, #$14
34FE	A007		BRA $3508		; $08(R0)

3500	853E		LBI R5, #$3E
3502	055D		MLH R5, R5
3504	85D8		LBI R5, #$D8
3506	870A		LBI R7, #$0A
3508	8900		LBI R9, #$00
350A	099D		MLH R9, R9
350C	8967		LBI R9, #$67
350E	2F2F		MOVE R15, $5E
3510	CF71		SLT R15, R7
3512	A00D		BRA $3522		; $0E(R0)

3514	F900		SUB R9, #$01
3516	8180		LBI R1, #$80
3518	C917		SBSH R9, R1
351A	F00D		BRA $350E		; -> -$0E(R0)

351C	1D01		CTRL $D, #$01
351E	8638		LBI R6, #$38
3520	A0BD		BRA $35E0		; $BE(R0)

3522	1D01		CTRL $D, #$01
3524	3520		MOVE $40, R5
3526	813E		LBI R1, #$3E
3528	011D		MLH R1, R1
352A	811A		LBI R1, #$1A
352C	0203		INC2 R2, R0
352E	0014		RET R1

3530	2548		MOVE R5, $90
3532	8109		LBI R1, #$09
3534	C516		SBC R5, R1
3536	A05F		BRA $3598		; $60(R0)

3538	2723		MOVE R7, $46
353A	F700		SUB R7, #$01
353C	3723		MOVE $46, R7
353E	8133		LBI R1, #$33
3540	011D		MLH R1, R1
3542	812A		LBI R1, #$2A
3544	0203		INC2 R2, R0
3546	0014		RET R1

3548	017C		MHL R1, R7
354A	0176		OR R1, R7
354C	C10B		SNZ R1
354E	A037		BRA $3588		; $38(R0)

3550	2775		MOVE R7, $EA
3552	0D54		MOVE R13, R5
3554	0759		SUB R7, R5
3556	057C		MHL R5, R7
3558	077D		MLH R7, R7
355A	075C		MHL R7, R5
355C	0579		SUB R5, R7
355E	077C		MHL R7, R7
3560	075D		MLH R7, R5
3562	8180		LBI R1, #$80
3564	C71F		SNBSH R7, R1
3566	A01F		BRA $3588		; $20(R0)

3568	812F		LBI R1, #$2F
356A	011D		MLH R1, R1
356C	8112		LBI R1, #$12
356E	0203		INC2 R2, R0
3570	0014		RET R1

3572	254D		MOVE R5, $9A
3574	272B		MOVE R7, $56
3576	C752		SE R7, R5
3578	A00D		BRA $3588		; $0E(R0)

357A	8136		LBI R1, #$36
357C	011D		MLH R1, R1
357E	81F8		LBI R1, #$F8
3580	0203		INC2 R2, R0
3582	0014		RET R1

3584	F0AB		BRA $34DA		; -> -$AC(R0)

3586	F0C1		BRA $34C6		; -> -$C2(R0)

3588	252D		MOVE R5, $5A
358A	352E		MOVE $5C, R5
358C	2D2C		MOVE R13, $58
358E	812F		LBI R1, #$2F
3590	011D		MLH R1, R1
3592	8112		LBI R1, #$12
3594	0203		INC2 R2, R0
3596	0014		RET R1

3598	8137		LBI R1, #$37
359A	011D		MLH R1, R1
359C	8180		LBI R1, #$80
359E	0203		INC2 R2, R0
35A0	0014		RET R1

35A2	242E		MOVE R4, $5C
35A4	86FF		LBI R6, #$FF
35A6	813D		LBI R1, #$3D
35A8	011D		MLH R1, R1
35AA	815C		LBI R1, #$5C
35AC	0203		INC2 R2, R0
35AE	0014		RET R1

35B0	2548		MOVE R5, $90
35B2	8120		LBI R1, #$20
35B4	C515		SBS R5, R1
35B6	A077		BRA $3630		; $78(R0)

35B8	6548		MOVB R5, (R4)
35BA	81C6		LBI R1, #$C6
35BC	C512		SE R5, R1
35BE	A05F		BRA $3620		; $60(R0)

35C0	8120		LBI R1, #$20
35C2	C615		SBS R6, R1
35C4	A007		BRA $35CE		; $08(R0)

35C6	2529		MOVE R5, $52
35C8	81C6		LBI R1, #$C6
35CA	C51A		SNE R5, R1
35CC	A013		BRA $35E2		; $14(R0)

35CE	254A		MOVE R5, $94
35D0	A500		ADD R5, #$01
35D2	354A		MOVE $94, R5
35D4	810A		LBI R1, #$0A
35D6	C519		SGE R5, R1
35D8	F055		BRA $3584		; -> -$56(R0)

35DA	2547		MOVE R5, $8E
35DC	7548		MOVB (R4), R5
35DE	8624		LBI R6, #$24
35E0	A089		BRA $366C		; $8A(R0)

35E2	2548		MOVE R5, $90
35E4	9521		CLR R5, #$21
35E6	3548		MOVE $90, R5
35E8	2547		MOVE R5, $8E
35EA	7548		MOVB (R4), R5
35EC	252C		MOVE R5, $58
35EE	0434		MOVE R4, R3
35F0	A407		ADD R4, #$08
35F2	5548		MOVE (R4), R5
35F4	8133		LBI R1, #$33
35F6	011D		MLH R1, R1
35F8	812A		LBI R1, #$2A
35FA	0203		INC2 R2, R0
35FC	0014		RET R1

35FE	2822		MOVE R8, $44
3600	A405		ADD R4, #$06
3602	D748		MOVE R7, (R4)
3604	0879		SUB R8, R7
3606	078C		MHL R7, R8
3608	088D		MLH R8, R8
360A	087C		MHL R8, R7
360C	0789		SUB R7, R8
360E	088C		MHL R8, R8
3610	087D		MLH R8, R7
3612	3823		MOVE $46, R8
3614	2550		MOVE R5, $A0
3616	354A		MOVE $94, R5
3618	A0A7		BRA $36C2		; $A8(R0)

361A	F097		BRA $3584		; -> -$98(R0)

361C	F097		BRA $3586		; -> -$98(R0)

361E	F093		BRA $358C		; -> -$94(R0)

3620	8120		LBI R1, #$20
3622	C615		SBS R6, R1
3624	A00D		BRA $3634		; $0E(R0)

3626	8180		LBI R1, #$80
3628	C616		SBC R6, R1
362A	A007		BRA $3634		; $08(R0)

362C	8600		LBI R6, #$00
362E	A0C5		BRA $36F6		; $C6(R0)

3630	C60B		SNZ R6
3632	A057		BRA $368C		; $58(R0)

3634	2751		MOVE R7, $A2
3636	8180		LBI R1, #$80
3638	C71F		SNBSH R7, R1
363A	A011		BRA $364E		; $12(R0)

363C	2548		MOVE R5, $90
363E	B501		SET R5, #$01
3640	3548		MOVE $90, R5
3642	254A		MOVE R5, $94
3644	A500		ADD R5, #$01
3646	354A		MOVE $94, R5
3648	810A		LBI R1, #$0A
364A	C519		SGE R5, R1
364C	F0C9		BRA $3584		; -> -$CA(R0)

364E	8680		LBI R6, #$80
3650	2548		MOVE R5, $90
3652	8108		LBI R1, #$08
3654	C516		SBC R5, R1
3656	A09D		BRA $36F6		; $9E(R0)

3658	8180		LBI R1, #$80
365A	C71F		SNBSH R7, R1
365C	A00B		BRA $366A		; $0C(R0)

365E	0434		MOVE R4, R3
3660	A402		ADD R4, #$03
3662	6540		MOVB R5, (R4)+
3664	8108		LBI R1, #$08
3666	C515		SBS R5, R1
3668	A00B		BRA $3676		; $0C(R0)

366A	863C		LBI R6, #$3C
366C	813E		LBI R1, #$3E
366E	011D		MLH R1, R1
3670	81FA		LBI R1, #$FA
3672	0203		INC2 R2, R0
3674	0014		RET R1

3676	242E		MOVE R4, $5C
3678	6548		MOVB R5, (R4)
367A	3547		MOVE $8E, R5
367C	85C6		LBI R5, #$C6
367E	7548		MOVB (R4), R5
3680	2548		MOVE R5, $90
3682	B520		SET R5, #$20
3684	3548		MOVE $90, R5
3686	2550		MOVE R5, $A0
3688	354A		MOVE $94, R5
368A	F071		BRA $361A		; -> -$72(R0)

368C	2548		MOVE R5, $90
368E	8108		LBI R1, #$08
3690	C516		SBC R5, R1
3692	A05F		BRA $36F4		; $60(R0)

3694	9501		CLR R5, #$01
3696	3548		MOVE $90, R5
3698	0203		INC2 R2, R0
369A	A05B		BRA $36F8		; $5C(R0)

369C	252C		MOVE R5, $58
369E	A500		ADD R5, #$01
36A0	352C		MOVE $58, R5
36A2	0434		MOVE R4, R3
36A4	A40D		ADD R4, #$0E
36A6	D548		MOVE R5, (R4)
36A8	A500		ADD R5, #$01
36AA	5548		MOVE (R4), R5
36AC	2550		MOVE R5, $A0
36AE	354A		MOVE $94, R5
36B0	F405		SUB R4, #$06
36B2	D548		MOVE R5, (R4)
36B4	272C		MOVE R7, $58
36B6	C572		SE R5, R7
36B8	F09B		BRA $361E		; -> -$9C(R0)

36BA	055C		MHL R5, R5
36BC	077C		MHL R7, R7
36BE	C572		SE R5, R7
36C0	F0A3		BRA $361E		; -> -$A4(R0)

36C2	2523		MOVE R5, $46
36C4	015C		MHL R1, R5
36C6	0156		OR R1, R5
36C8	C10B		SNZ R1
36CA	A027		BRA $36F4		; $28(R0)

36CC	0434		MOVE R4, R3
36CE	A407		ADD R4, #$08
36D0	D541		MOVE R5, (R4)+
36D2	2775		MOVE R7, $EA
36D4	0D54		MOVE R13, R5
36D6	0759		SUB R7, R5
36D8	057C		MHL R5, R7
36DA	077D		MLH R7, R7
36DC	075C		MHL R7, R5
36DE	0579		SUB R5, R7
36E0	077C		MHL R7, R7
36E2	075D		MLH R7, R5
36E4	8180		LBI R1, #$80
36E6	C717		SBSH R7, R1
36E8	F0CD		BRA $361C		; -> -$CE(R0)

36EA	D448		MOVE R4, (R4)
36EC	A401		ADD R4, #$02
36EE	5D48		MOVE (R4), R13
36F0	864E		LBI R6, #$4E
36F2	F087		BRA $366C		; -> -$88(R0)

36F4	8600		LBI R6, #$00
36F6	2045		JMP ($008A)

; ***********************
; Diskette I/O Supervisor
; ***********************
; Adds sector size to current buffer address in R14L2 (for read interrupt)

36F8	0434		MOVE R4, R3
36FA	A409		ADD R4, #$0A		; IOCB_WA
36FC	D448		MOVE R4, (R4)
36FE	A407		ADD R4, #$08
3700	6548		MOVB R5, (R4)		; Get physical record size
3702	8103		LBI R1, #$03
3704	C51A		SNE R5, R1
3706	A500		ADD R5, #$01		; 1024 bytes/sector
3708	055D		MLH R5, R5
370A	C50B		SNZ R5
370C	8580		LBI R5, #$80		; 128 bytes/sector
370E	950F		CLR R5, #$0F

3710	272E		MOVE R7, $5C		; R14L2
3712	0758		ADD R7, R5
3714	057C		MHL R5, R7
3716	055A		ADDH R5, R5
3718	075D		MLH R7, R5
371A	372E		MOVE $5C, R7		; R14L2

371C	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; ***********************
; Presets track, side and sector from CI1

371E	3242		MOVE $84, R2		; Save R2

3720	0434		MOVE R4, R3
3722	A407		ADD R4, #$08		; IOCB_CI1
3724	6840		MOVB R8, (R4)+		; Track number
3726	814C		LBI R1, #$4C
3728	C818		SGT R8, R1		; Greater than 76 ?
372A	A003		BRA $3730		; No

372C	865E		LBI R6, #$5E		; Error 02
372E	F0C3		BRA $366C		; Error exit
; ----

3730	384D		MOVE $9A, R8		; Store track number

3732	6748		MOVB R7, (R4)
3734	2550		MOVE R5, $A0
3736	8180		LBI R1, #$80		; Test if bit 0 set
3738	C716		SBC R7, R1
373A	8501		LBI R5, #$01		; Yes, side 1
373C	354E		MOVE $9C, R5		; Store side

373E	9780		CLR R7, #$80		; Clear side flag
3740	C70B		SNZ R7			; Test sector number
3742	F017		BRA $372C		; Zero, error

3744	C80B		SNZ R8
3746	A019		BRA $3762		; Track zero

			; Get drive status word
3748	8133		LBI R1, #$33
374A	011D		MLH R1, R1
374C	8116		LBI R1, #$16
374E	0203		INC2 R2, R0
3750	0014		RET R1			; CALL $3316, R2

3752	0F5C		MHL R15, R5
3754	8140		LBI R1, #$40
3756	CF1A		SNE R15, R1
3758	9580		CLR R5, #$80
375A	950F		CLR R5, #$0F
375C	E05F		SWAP R5
375E	C850		SLE R8, R5
3760	A003		BRA $3766		; $04(R0)

3762	851A		LBI R5, #$1A
3764	A009		BRA $3770		; $0A(R0)

			; Get sectors per track
3766	8131		LBI R1, #$31
3768	011D		MLH R1, R1
376A	8198		LBI R1, #$98
376C	0203		INC2 R2, R0
376E	0014		RET R1

3770	0154		MOVE R1, R5
3772	E01F		SWAP R1
3774	E01D		ROR R1
3776	314C		MOVE $98, R1

3778	C750		SLE R7, R5
377A	F04F		BRA $372C		; Error

377C	374F		MOVE $9E, R7		; Store sector number

377E	2042		JMP ($0084)		; Return

; **************************************
; Diskette I/O Supervisor
; Locates a sector on the disk
; Automatically seeks to the given track
; and handles retries
; **************************************

3780	3244		MOVE $88, R2		; Save R2

3782	2550		MOVE R5, $A0
3784	354B		MOVE $96, R5
3786	813B		LBI R1, #$3B
3788	011D		MLH R1, R1
378A	8178		LBI R1, #$78
378C	0203		INC2 R2, R0
378E	0014		RET R1			; Get track value

3790	ED5F		STAT R5, $D		; Diskette Sense byte
3792	8108		LBI R1, #$08
3794	C515		SBS R5, R1		; Erase Gate active ?
3796	A009		BRA $37A2		; No

3798	8138		LBI R1, #$38
379A	011D		MLH R1, R1
379C	81A0		LBI R1, #$A0
379E	0203		INC2 R2, R0
37A0	0014		RET R1			; Wait for Erase Gate off

37A2	2148		MOVE R1, $90
37A4	91C0		CLR R1, #$C0
37A6	3148		MOVE $90, R1

37A8	254D		MOVE R5, $9A
37AA	CB5A		SNE R11, R5		; Already on desired track ?
37AC	A051		BRA $3800		; Yes

37AE	C5B8		SGT R5, R11		; Track > current track ?
37B0	A00D		BRA $37C0		; No

37B2	05B9		SUB R5, R11
37B4	0F54		MOVE R15, R5
37B6	8A00		LBI R10, #$00		; Seek in
37B8	2148		MOVE R1, $90
37BA	B180		SET R1, #$80
37BC	3148		MOVE $90, R1
37BE	A00B		BRA $37CC

37C0	0FB4		MOVE R15, R11
37C2	0F59		SUB R15, R5
37C4	8AFF		LBI R10, #$FF		; Seek out
37C6	2148		MOVE R1, $90
37C8	B140		SET R1, #$40
37CA	3148		MOVE $90, R1

37CC	813D		LBI R1, #$3D
37CE	011D		MLH R1, R1
37D0	810C		LBI R1, #$0C
37D2	0203		INC2 R2, R0
37D4	0014		RET R1			; Seek routine

37D6	2B4D		MOVE R11, $9A		; Update current track
37D8	813B		LBI R1, #$3B
37DA	011D		MLH R1, R1
37DC	817C		LBI R1, #$7C
37DE	0203		INC2 R2, R0
37E0	0014		RET R1			; Set track value

37E2	CB03		SZ R11			; Track 0 ?
37E4	A00B		BRA $37F2		; No

37E6	813A		LBI R1, #$3A
37E8	011D		MLH R1, R1
37EA	8194		LBI R1, #$94
37EC	0203		INC2 R2, R0
37EE	0014		RET R1			; Verify Access Lines
37F0	A00D		BRA $3800		; $0E(R0)

			; Delay after seek

37F2	8915		LBI R9, #$15
37F4	099D		MLH R9, R9
37F6	89BD		LBI R9, #$BD
37F8	F900		SUB R9, #$01
37FA	8180		LBI R1, #$80
37FC	C917		SBSH R9, R1
37FE	F007		BRA $37F8		; Loop

			; On desired track

3800	8139		LBI R1, #$39
3802	011D		MLH R1, R1
3804	813E		LBI R1, #$3E
3806	0203		INC2 R2, R0
3808	0014		RET R1			; Set adapter flags

380A	2550		MOVE R5, $A0
380C	3549		MOVE $92, R5

380E	813B		LBI R1, #$3B
3810	011D		MLH R1, R1
3812	819A		LBI R1, #$9A
3814	0203		INC2 R2, R0
3816	0014		RET R1			; Read next ID field

3818	C60B		SNZ R6			; CRC error ?
381A	A023		BRA $3840		; No

381C	1D01		CTRL $D, #$01		; Reset R/W/D
381E	2549		MOVE R5, $92
3820	A500		ADD R5, #$01
3822	3549		MOVE $92, R5
3824	214C		MOVE R1, $98
3826	C511		SLT R5, R1
3828	A011		BRA $383C		; $12(R0)

382A	8580		LBI R5, #$80		; Read status byte
382C	E45F		STAT R5, $4		; from keyboard adapter
382E	8108		LBI R1, #$08
3830	C515		SBS R5, R1		; Key pending ?
3832	F025		BRA $380E		; No, loop
3834	1442		CTRL $4, #$42		; Enable int. 3

3836	2550		MOVE R5, $A0
3838	354C		MOVE $98, R5
383A	F02D		BRA $380E		; Loop

383C	863E		LBI R6, #$3E		; Error 18
383E	A03E		BRA $387F		; Error routine

			; ID field read

3840	254D		MOVE R5, $9A		; Compare track with ID byte 1
3842	C5BA		SNE R5, R11		; Same (track correct) ?
3844	A02F		BRA $3876		; Yes

			; Track byte from ID field is not equal to
			; current track number

3846	1D01		CTRL $D, #$01		; Reset R/W/D
3848	144A		CTRL $4, #$4A
384A	254B		MOVE R5, $96
384C	A500		ADD R5, #$01
384E	354B		MOVE $96, R5		; Increment retry counter
3850	8705		LBI R7, #$05
3852	C571		SLT R5, R7
3854	A005		BRA $385C		; $06(R0)

3856	0203		INC2 R2, R0
3858	A059		BRA $38B4		; Seek to desired track
385A	F051		BRA $380A		; Retry read on current track

385C	C572		SE R5, R7
385E	A00B		BRA $386C		; $0C(R0)

			; Recalibrate after 5 retries

3860	813A		LBI R1, #$3A
3862	011D		MLH R1, R1
3864	816C		LBI R1, #$6C
3866	0203		INC2 R2, R0
3868	0014		RET R1			; Call $3A6C
386A	F0C9		BRA $37A2		; Retry

386C	870A		LBI R7, #$0A
386E	C579		SGE R5, R7
3870	F01B		BRA $3856		; -> -$1C(R0)

			; 10 unsuccessful retries

3872	862C		LBI R6, #$2C		; Error 27
3874	A009		BRA $3880		; Error exit

			; Track byte from ID correct

3876	214E		MOVE R1, $9C		; Compare side with ID byte 2
3878	CC1A		SNE R12, R1		; Same (side correct) ?
387A	A00D		BRA $388A		; Yes

387C	1D01		CTRL $D, #$01
387E	862E		LBI R6, #$2E
3880	813E		LBI R1, #$3E
3882	011D		MLH R1, R1
3884	81FA		LBI R1, #$FA
3886	0203		INC2 R2, R0
3888	0014		RET R1

			; Side byte from ID correct

388A	214F		MOVE R1, $9E		; Compare sector with ID byte 3
388C	CD1A		SNE R13, R1		; Same (sector found) ?
388E	A00D		BRA $389E		; Yes

			; Wrong sector number

3890	1D01		CTRL $D, #$01		; Reset R/W/D
3892	1442		CTRL $4, #$42
3894	8139		LBI R1, #$39
3896	011D		MLH R1, R1
3898	81AA		LBI R1, #$AA
389A	0203		INC2 R2, R0
389C	0014		RET R1			; Find sector

			; Desired sector found

389E	2044		JMP ($0088)		; Return to caller

; *******************************
; Diskette I/O Supervisor
; Wait for Erase Gate to turn off
; *******************************

38A0	8938		LBI R9, #$38		; Timeout value

38A2	ED5F		STAT R5, $D		; Diskette Sense byte
38A4	8108		LBI R1, #$08
38A6	C515		SBS R5, R1		; Erase Gate active ?
38A8	0024		RET R2			; No, return to caller

38AA	F900		SUB R9, #$01
38AC	C903		SZ R9
38AE	F00D		BRA $38A2		; Loop

			; Timeout

38B0	861E		LBI R6, #$1E		; Error 34
38B2	F033		BRA $3880		; Error routine

; *******************************************
; Diskette I/O Supervisor
; Relative seek from current to desired track
; *******************************************

38B4	3243		MOVE $86, R2		; Save R2

38B6	CB0C		SNS R11
38B8	A025		BRA $38E0		; Track unknown

38BA	2F4D		MOVE R15, $9A		; Get track
38BC	CFB8		SGT R15, R11		; Compare to track from ID
38BE	A00D		BRA $38CE		; 

			; Head too far outside (track to small)

38C0	0FB9		SUB R15, R11		; Difference to desired track
38C2	8A00		LBI R10, #$00		; Step direction
38C4	2148		MOVE R1, $90
38C6	B180		SET R1, #$80
38C8	9140		CLR R1, #$40
38CA	3148		MOVE $90, R1
38CC	A043		BRA $3912		; $44(R0)

			; Head too far inside (track to big)

38CE	07B4		MOVE R7, R11
38D0	07F9		SUB R7, R15		; Difference to desired track
38D2	0F74		MOVE R15, R7
38D4	8AFF		LBI R10, #$FF		; Step direction
38D6	2148		MOVE R1, $90
38D8	B140		SET R1, #$40
38DA	9180		CLR R1, #$80
38DC	3148		MOVE $90, R1
38DE	A031		BRA $3912		; $32(R0)

			; Track unknown

38E0	8180		LBI R1, #$80
38E2	2548		MOVE R5, $90
38E4	C515		SBS R5, R1
38E6	A005		BRA $38EE		; $06(R0)

38E8	8F01		LBI R15, #$01
38EA	8A00		LBI R10, #$00
38EC	A023		BRA $3912		; $24(R0)

38EE	8140		LBI R1, #$40
38F0	C515		SBS R5, R1
38F2	A005		BRA $38FA		; $06(R0)

38F4	8F01		LBI R15, #$01
38F6	8AFF		LBI R10, #$FF
38F8	A017		BRA $3912		; $18(R0)

38FA	813A		LBI R1, #$3A
38FC	011D		MLH R1, R1
38FE	816C		LBI R1, #$6C
3900	0203		INC2 R2, R0
3902	0014		RET R1

3904	2F4D		MOVE R15, $9A
3906	CF0B		SNZ R15
3908	A031		BRA $393C		; $32(R0)

390A	8A00		LBI R10, #$00
390C	2148		MOVE R1, $90
390E	B180		SET R1, #$80
3910	3148		MOVE $90, R1

			; Seek to correct position

3912	813D		LBI R1, #$3D
3914	011D		MLH R1, R1
3916	810C		LBI R1, #$0C
3918	0203		INC2 R2, R0
391A	0014		RET R1			; Seek

391C	254D		MOVE R5, $9A
391E	C503		SZ R5			; Seek to track 0 ?
3920	A00B		BRA $392E		; No

3922	813A		LBI R1, #$3A
3924	011D		MLH R1, R1
3926	8194		LBI R1, #$94
3928	0203		INC2 R2, R0
392A	0014		RET R1			; Verify access lines
392C	A00D		BRA $393C		; $0E(R0)

			; Delay after seek operation

392E	8915		LBI R9, #$15
3930	099D		MLH R9, R9
3932	89BD		LBI R9, #$BD
3934	F900		SUB R9, #$01
3936	8180		LBI R1, #$80
3938	C917		SBSH R9, R1
393A	F007		BRA $3934		; -> -$08(R0)

393C	2043		JMP ($0086)		; Return to caller

; *************************
; Diskette I/O Supervisor
; Set adapter flags
; (Side, Filter, MFM, etc.)
; *************************

393E	3241		MOVE $82, R2		; Save R2

3940	0D8E		GETB R8, $D		; Access Sense byte
3942	9874		CLR R8, #$74

3944	2148		MOVE R1, $90
3946	9110		CLR R1, #$10
3948	3148		MOVE $90, R1

394A	274D		MOVE R7, $9A
394C	812A		LBI R1, #$2A
394E	C711		SLT R7, R1		; Track >= 42 ?
3950	B810		SET R8, #$10		; Yes, set Inner Tracks
3952	813C		LBI R1, #$3C
3954	C711		SLT R7, R1		; Track >= 60 ?
3956	B820		SET R8, #$20		; Yes, set Switch Filter
3958	C703		SZ R7			; Track 0 ?
395A	A005		BRA $3962		; No

395C	274E		MOVE R7, $9C
395E	C70B		SNZ R7			; Side 0 ?
3960	A019		BRA $397C		; Yes (system track)

3962	8133		LBI R1, #$33
3964	011D		MLH R1, R1
3966	8116		LBI R1, #$16
3968	0203		INC2 R2, R0
396A	0014		RET R1			; Get status word (?)

396C	055C		MHL R5, R5
396E	81D4		LBI R1, #$D4		; 'M'
3970	C512		SE R5, R1		; Diskette 2D ?
3972	A007		BRA $397C		; No

3974	2148		MOVE R1, $90
3976	B110		SET R1, #$10
3978	3148		MOVE $90, R1
397A	B840		SET R8, #$40		; MFM

397C	214E		MOVE R1, $9C		; Side
397E	C103		SZ R1
3980	A003		BRA $3986

3982	9804		CLR R8, #$04		; Select Side 0
3984	A00B		BRA $3992

3986	8140		LBI R1, #$40
3988	C512		SE R5, R1		; Diskette 1 ?
398A	A003		BRA $3990		; No

398C	862A		LBI R6, #$2A		; Error 28
398E	A0AB		BRA $3A3C		; Error routine

3990	B804		SET R8, #$04		; Select Side 1

3992	2750		MOVE R7, $A0
3994	8711		LBI R7, #$11		; Lo(R8)
3996	4D78		PUTB $D, (R7)		; Access Control byte

3998	9880		CLR R8, #$80
399A	0D7E		GETB R7, $D		; Access Sense byte
399C	C78A		SNE R7, R8		; Got new settings ?
399E	2041		JMP ($0082)		; Yes, return to caller

			; Access Sense byte not updated

39A0	ED5F		STAT R5, $D		; Diskette Sense byte
39A2	075D		MLH R7, R5
39A4	3774		MOVE $E8, R7		; Set Diskette Status Byte
39A6	861C		LBI R6, #$1C		; Error 35
39A8	A091		BRA $3A3C		; Error routine

; ******************************
; Diskette I/O Supervisor
; Find a sector on current track
; Retries several times
; ******************************

39AA	3242		MOVE $84, R2		; Save R2

39AC	2550		MOVE R5, $A0
39AE	3549		MOVE $92, R5

39B0	8800		LBI R8, #$00

39B2	813B		LBI R1, #$3B
39B4	011D		MLH R1, R1
39B6	819A		LBI R1, #$9A
39B8	0203		INC2 R2, R0
39BA	0014		RET R1			; Read ID

39BC	C60B		SNZ R6			; CRC error ?
39BE	A01F		BRA $39E0		; No

39C0	1D01		CTRL $D, #$01		; Reset R/W/D
39C2	254F		MOVE R5, $9E
39C4	C5D2		SE R5, R13		; Sector found ?
39C6	A01F		BRA $39E8		; No

			; Sector found, but CRC error

39C8	2551		MOVE R5, $A2
39CA	8180		LBI R1, #$80
39CC	C51F		SNBSH R5, R1
39CE	A00B		BRA $39DC		; No retries please

39D0	2549		MOVE R5, $92
39D2	A500		ADD R5, #$01
39D4	3549		MOVE $92, R5		; Increment retry counter
39D6	810A		LBI R1, #$0A
39D8	C519		SGE R5, R1
39DA	A00B		BRA $39E8		; Retry read

39DC	8642		LBI R6, #$42		; Error 16
39DE	A05B		BRA $3A3C		; Exit

39E0	254F		MOVE R5, $9E		; Sector to find
39E2	C5DA		SNE R5, R13		; Found ?
39E4	2042		JMP ($0084)		; Yes, return to caller

			; Sector not found

39E6	1D01		CTRL $D, #$01		; Reset R/W/D
39E8	A800		ADD R8, #$01		; Increment find counter

39EA	8580		LBI R5, #$80
39EC	E45F		STAT R5, $4		; Get keyboard status
39EE	8108		LBI R1, #$08
39F0	C515		SBS R5, R1		; Key pending ?
39F2	A003		BRA $39F8		; No

39F4	1442		CTRL $4, #$42		; Enable Int 3
39F6	8800		LBI R8, #$00

39F8	254C		MOVE R5, $98
39FA	C859		SGE R8, R5
39FC	F04B		BRA $39B2		; Read next ID

39FE	2549		MOVE R5, $92
3A00	C503		SZ R5
3A02	A003		BRA $3A08		; $04(R0)

3A04	863A		LBI R6, #$3A		; Error 20
3A06	A033		BRA $3A3C		; Exit

3A08	015C		MHL R1, R5
3A0A	C151		SLT R1, R5
3A0C	F009		BRA $3A04		; -> -$0A(R0)

3A0E	055D		MLH R5, R5
3A10	3549		MOVE $92, R5
3A12	F063		BRA $39B0		; Restart

; ***********************
; Diskette I/O Supervisor
; Verify volume header
; ***********************

3A14	0434		MOVE R4, R3
3A16	A403		ADD R4, #$04
3A18	D448		MOVE R4, (R4)		; IOCB_BA
3A1A	81E5		LBI R1, #$E5		; 'V'
3A1C	6740		MOVB R7, (R4)+
3A1E	C712		SE R7, R1		; Test byte 1
3A20	A017		BRA $3A3A		; Wrong

3A22	81D6		LBI R1, #$D6		; 'O'
3A24	6740		MOVB R7, (R4)+
3A26	C712		SE R7, R1		; Test byte 2
3A28	A00F		BRA $3A3A		; Wrong

3A2A	81D3		LBI R1, #$D3		; 'L'
3A2C	6740		MOVB R7, (R4)+
3A2E	C712		SE R7, R1		; Test byte 3
3A30	A007		BRA $3A3A		; Wrong

3A32	81F1		LBI R1, #$F1		; '1'
3A34	6748		MOVB R7, (R4)
3A36	C71A		SNE R7, R1		; Test byte 4
3A38	A00B		BRA $3A46		; Correct

3A3A	8632		LBI R6, #$32		; Error 24

3A3C	813E		LBI R1, #$3E
3A3E	011D		MLH R1, R1
3A40	81FA		LBI R1, #$FA
3A42	0203		INC2 R2, R0
3A44	0014		RET R1			; Error exit

3A46	A406		ADD R4, #$07
3A48	8140		LBI R1, #$40
3A4A	6748		MOVB R7, (R4)		; Accessibility
3A4C	C71A		SNE R7, R1
3A4E	A003		BRA $3A54		; Access allowed

3A50	860C		LBI R6, #$0C		; Error 43
3A52	F017		BRA $3A3C		; Exit

3A54	A43E		ADD R4, #$3F
3A56	8140		LBI R1, #$40
3A58	6748		MOVB R7, (R4)		; Special Requirements Ind.
3A5A	C712		SE R7, R1
3A5C	A009		BRA $3A68		; Not blank

3A5E	A405		ADD R4, #$06
3A60	81E6		LBI R1, #$E6		; 'W'
3A62	6748		MOVB R7, (R4)		; Label Standard Version
3A64	C71A		SNE R7, R1
3A66	0024		RET R2			; Everything's correct, return

3A68	8630		LBI R6, #$30		; Error 25
3A6A	F02F		BRA $3A3C		; Exit

; ***********************
; Diskette I/O Supervisor
; Recalibrate to track 0
; ***********************
; Initialize Head

3A6C	3242		MOVE $84, R2		; Save R2
3A6E	2F50		MOVE R15, $A0

3A70	0D5E		GETB R5, $D		; Access Sense byte
3A72	95FC		CLR R5, #$FC		; Mask Access Lines
3A74	C50B		SNZ R5
3A76	A00B		BRA $3A84		; $0C(R0)

3A78	8702		LBI R7, #$02
3A7A	C579		SGE R5, R7
3A7C	AF00		ADD R15, #$01
3A7E	AF00		ADD R15, #$01
3A80	C572		SE R5, R7
3A82	AF00		ADD R15, #$01

3A84	AF4D		ADD R15, #$4E

			; Seek

3A86	8AFF		LBI R10, #$FF
3A88	813D		LBI R1, #$3D
3A8A	011D		MLH R1, R1
3A8C	810C		LBI R1, #$0C
3A8E	0203		INC2 R2, R0
3A90	0014		RET R1			; CALL $3D0C, R2

3A92	A001		BRA $3A96		; $02(R0)

; *******************************
; Diskette I/O Supervisor
; Verify Access Lines for track 0
; *******************************

3A94	3242		MOVE $84, R2

3A96	0D5E		GETB R5, $D		; Access Sense byte
3A98	95FC		CLR R5, #$FC		; Mask Access Lines
3A9A	8703		LBI R7, #$03
3A9C	C57A		SNE R5, R7		; Track 0, 4, 8, ... ?
3A9E	A025		BRA $3AC6		; Yes

			; Access Lines not %11, seek the
			; required number of tracks outwards

3AA0	2F50		MOVE R15, $A0		; Number of tracks to track 0
3AA2	8701		LBI R7, #$01
3AA4	C570		SLE R5, R7
3AA6	AF00		ADD R15, #$01		; One
3AA8	C572		SE R5, R7
3AAA	AF00		ADD R15, #$01		; Another one
3AAC	AF00		ADD R15, #$01		; And another one (max. 3)
3AAE	8AFF		LBI R10, #$FF		; Seek out
3AB0	813D		LBI R1, #$3D
3AB2	011D		MLH R1, R1
3AB4	810C		LBI R1, #$0C
3AB6	0203		INC2 R2, R0
3AB8	0014		RET R1			; Seek routine

3ABA	0D5E		GETB R5, $D		; Access Sense byte
3ABC	B5FC		SET R5, #$FC
3ABE	C50C		SNS R5			; Access Lines all set ?
3AC0	A003		BRA $3AC6		; Yes

3AC2	862C		LBI R6, #$2C		; No, error 27
3AC4	A095		BRA $3B5C		; Error routine

3AC6	8B00		LBI R11, #$00		; Track 0
3AC8	0203		INC2 R2, R0
3ACA	A0AF		BRA $3B7C		; Set track value

			; Delay after seek

3ACC	8915		LBI R9, #$15
3ACE	099D		MLH R9, R9
3AD0	89BD		LBI R9, #$BD
3AD2	F900		SUB R9, #$01
3AD4	8180		LBI R1, #$80
3AD6	C917		SBSH R9, R1
3AD8	F007		BRA $3AD2		; -> -$08(R0)

3ADA	2042		JMP ($0084)		; Return to caller

; ***********************
; Diskette I/O Supervisor
; Test Index Timing
; ***********************

3ADC	3241		MOVE $82, R2		; Save R2

3ADE	8971		LBI R9, #$71
3AE0	099D		MLH R9, R9
3AE2	892B		LBI R9, #$2B		; R9 <- $712B
						; (Timeout value)

3AE4	ED5F		STAT R5, $D		; Diskette Sense Byte
3AE6	8710		LBI R7, #$10
3AE8	C576		SBC R5, R7		; Index ?
3AEA	8700		LBI R7, #$00		; Yes

3AEC	0203		INC2 R2, R0
3AEE	A057		BRA $3B48		; Wait for Index bit change

3AF0	0203		INC2 R2, R0
3AF2	A0B3		BRA $3BA8		; Engage heads

3AF4	8971		LBI R9, #$71
3AF6	099D		MLH R9, R9
3AF8	892B		LBI R9, #$2B		; R9 <- $712B

3AFA	103F		CTRL $0, #$3F		; Disable interrupts
3AFC	ED5F		STAT R5, $D		; Diskette Sense byte
3AFE	8710		LBI R7, #$10
3B00	C575		SBS R5, R7		; Index ?
3B02	A005		BRA $3B0A		; No

3B04	8700		LBI R7, #$00
3B06	0203		INC2 R2, R0
3B08	A03D		BRA $3B48		; Wait until index hole passed

3B0A	8710		LBI R7, #$10
3B0C	0203		INC2 R2, R0
3B0E	A037		BRA $3B48		; Wait for index hole

			; Delay after detection of index hole

3B10	8906		LBI R9, #$06
3B12	099D		MLH R9, R9
3B14	8936		LBI R9, #$36		; R9 <- $0636
3B16	F900		SUB R9, #$01
3B18	8180		LBI R1, #$80
3B1A	C917		SBSH R9, R1
3B1C	F007		BRA $3B16		; Loop

3B1E	ED5F		STAT R5, $D		; Diskette Sense byte
3B20	8110		LBI R1, #$10
3B22	C516		SBC R5, R1		; Index ?
3B24	A031		BRA $3B58		; Yes, error 45

3B26	1D01		CTRL $D, #$01		; Reset R/W/D

3B28	8935		LBI R9, #$35
3B2A	099D		MLH R9, R9
3B2C	89D5		LBI R9, #$D5		; R9 <- $35D5
3B2E	0203		INC2 R2, R0
3B30	A033		BRA $3B66		; Wait for index hole
3B32	A00B		BRA $3B40		; Index hole found too early

3B34	8902		LBI R9, #$02
3B36	099D		MLH R9, R9
3B38	89F7		LBI R9, #$F7		; R9 <- $02F7
3B3A	0203		INC2 R2, R0
3B3C	A027		BRA $3B66		; Wait for index hole
3B3E	A003		BRA $3B44		; Index hole found in time

3B40	8660		LBI R6, #$60		; Error 01
3B42	A015		BRA $3B5A

3B44	105F		CTRL $0, #$5F		; Enable interrupts
3B46	2041		JMP ($0082)		; Return to caller
; ----------

			; Wait for Index bit change or timeout

3B48	ED5F		STAT R5, $D		; Diskette Sense byte
3B4A	95EF		CLR R5, #$EF		
3B4C	C57A		SNE R5, R7		; Test Index bit
3B4E	0024		RET R2

3B50	F900		SUB R9, #$01
3B52	8180		LBI R1, #$80
3B54	C917		SBSH R9, R1
3B56	F00F		BRA $3B48		; Loop until timeout

			; Timeout

3B58	8608		LBI R6, #$08		; Error 45
3B5A	105F		CTRL $0, #$5F		; Enable interrupts
3B5C	813E		LBI R1, #$3E
3B5E	011D		MLH R1, R1
3B60	81FA		LBI R1, #$FA
3B62	0203		INC2 R2, R0
3B64	0014		RET R1			; Error routine
						; (won't return here)
; ----------

			; Wait for index hole or timeout

3B66	F900		SUB R9, #$01		; Decrement timeout counter
3B68	8180		LBI R1, #$80
3B6A	C91F		SNBSH R9, R1
3B6C	0023		INC2 R0, R2		; Error exit (timeout)

3B6E	ED5F		STAT R5, $D		; Diskette Sense byte
3B70	8110		LBI R1, #$10
3B72	C515		SBS R5, R1		; Exit loop if Index found
3B74	F00F		BRA $3B66		; Loop until timeout

3B76	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; Get track value
; ***********************

3B78	8AFF		LBI R10, #$FF
3B7A	A001		BRA $3B7E		; $02(R0)

; ***********************
; Diskette I/O Supervisor
; Set track value
; ***********************

3B7C	8A00		LBI R10, #$00

3B7E	246C		MOVE R4, $D8
3B80	F40F		SUB R4, #$10
3B82	D538		MOVE R5, (R3)		; IOCB_Sub in Lo(R5)
3B84	0558		ADD R5, R5		; Shift left one position
3B86	C50B		SNZ R5
3B88	A003		BRA $3B8E		; Finished
3B8A	A400		ADD R4, #$01
3B8C	F009		BRA $3B84		; Loop

3B8E	CA04		SS R10
3B90	A003		BRA $3B96

3B92	6B48		MOVB R11, (R4)		; Get value
3B94	0024		RET R2

3B96	7B48		MOVB (R4), R11		; Set value
3B98	0024		RET R2

; ***********************
; Diskette I/O Supervisor
; Read ID Routine
; ***********************

3B9A	3241		MOVE $82, R2		; Save R2

3B9C	1D01		CTRL $D, #$01		; Reset R/W/D
3B9E	8108		LBI R1, #$08
3BA0	0D5E		GETB R5, $D		; Access Sense byte
3BA2	C516		SBC R5, R1		; Heads engaged ?
3BA4	A003		BRA $3BAA		; Yes

3BA6	0203		INC2 R2, R0
3BA8	A085		BRA $3C30		; Engage heads

3BAA	8944		LBI R9, #$44
3BAC	099D		MLH R9, R9
3BAE	8966		LBI R9, #$66		; R9 <- $4466

3BB0	2450		MOVE R4, $A0
3BB2	8416		LBI R4, #$16		; Buffer address (R11L0)
3BB4	3424		MOVE $48, R4		; R4L2 <- $0016

3BB6	2F50		MOVE R15, $A0
3BB8	8F04		LBI R15, #$04		; Read 4 bytes
3BBA	3F2F		MOVE $5E, R15		; R15L2 <- $0004

3BBC	2750		MOVE R7, $A0		; Clear flag
3BBE	372A		MOVE $54, R7		; R10L2 <- $0000

3BC0	873C		LBI R7, #$3C
3BC2	077D		MLH R7, R7
3BC4	875E		LBI R7, #$5E		; Address of Int 2 routine
3BC6	3720		MOVE $40, R7		; R0L2 <- $3C5E

3BC8	8600		LBI R6, #$00
3BCA	3626		MOVE $4C, R6		; R6L2 <- $00

3BCC	1443		CTRL $4, #$43		; Int 3 off
3BCE	1D40		CTRL $D, #$40		; Start Read
3BD0	144B		CTRL $4, #$4B		; (?)
3BD2	0203		INC2 R2, R0
3BD4	A03B		BRA $3C12		; Wait for data or timeout

3BD6	2525		MOVE R5, $4A		; R5L2
3BD8	81FE		LBI R1, #$FE		; ID address mark
3BDA	C51A		SNE R5, R1		; Correct address mark ?
3BDC	A003		BRA $3BE2		; Yes

3BDE	1D01		CTRL $D, #$01		; Reset R/W/D
3BE0	F031		BRA $3BB0		; Restart

			; ID address mark found

3BE2	8900		LBI R9, #$00
3BE4	099D		MLH R9, R9
3BE6	8933		LBI R9, #$33		; R9 <- $0033

			; Rest of ID field is read automatically

3BE8	2750		MOVE R7, $A0
3BEA	372A		MOVE $54, R7		; R10L2 <- $0000
3BEC	144B		CTRL $4, #$4B
3BEE	0203		INC2 R2, R0
3BF0	A01F		BRA $3C12		; Wait for data or timeout

3BF2	ED5F		STAT R5, $D		; Diskette Status byte
3BF4	8101		LBI R1, #$01
3BF6	C515		SBS R5, R1		; R/W Overrun ?
3BF8	A005		BRA $3C00		; No

3BFA	1D01		CTRL $D, #$01		; Reset R/W/D
3BFC	8622		LBI R6, #$22		; Error 32
3BFE	A053		BRA $3C54

3C00	8600		LBI R6, #$00
3C02	8102		LBI R1, #$02
3C04	C516		SBC R5, R1		; CRC Error ?
3C06	8680		LBI R6, #$80		; Yes

			; R11 and R12 contain the 4 data bytes
			; from the ID field

3C08	0EC4		MOVE R14, R12		; R14 <- 4th byte
3C0A	0DEC		MHL R13, R14		; R13 <- 3rd byte
3C0C	0CB4		MOVE R12, R11		; R12 <- 2nd byte
3C0E	0BCC		MHL R11, R12		; R11 <- 1st byte

3C10	2041		JMP ($0082)		; Return to caller
; ----------

			; Wait for data byte to arrive from diskette
			; or timeout

3C12	F900		SUB R9, #$01		; Decrement loop counter
3C14	8180		LBI R1, #$80
3C16	C91F		SNBSH R9, R1
3C18	A007		BRA $3C22		; Timeout

3C1A	272A		MOVE R7, $54		; R10L2
3C1C	C704		SS R7
3C1E	F00D		BRA $3C12		; Loop
3C20	0024		RET R2			; Data byte arrived, return

3C22	ED5F		STAT R5, $D		; Diskette Sense byte
3C24	8101		LBI R1, #$01
3C26	C516		SBC R5, R1		; R/W Overrun ?
3C28	F02F		BRA $3BFA		; Yes, error 32

3C2A	1D01		CTRL $D, #$01
3C2C	8638		LBI R6, #$38		; Error 21
3C2E	A023		BRA $3C54

; ***********************
; Diskette I/O Supervisor
; Head Engage Routine
; ***********************

3C30	0D5E		GETB R5, $D		; Access Sense byte
3C32	9580		CLR R5, #$80		; Don't reset New Media
3C34	B508		SET R5, #$08		; Engage Head
3C36	2450		MOVE R4, $A0
3C38	840B		LBI R4, #$0B
3C3A	4D48		PUTB $D, (R4)

			; Delay until heads engaged

3C3C	8931		LBI R9, #$31
3C3E	099D		MLH R9, R9
3C40	89B0		LBI R9, #$B0		; R9 <- $31B0
3C42	F900		SUB R9, #$01
3C44	8180		LBI R1, #$80
3C46	C917		SBSH R9, R1
3C48	F007		BRA $3C42		; Loop

3C4A	0D5E		GETB R5, $D		; Access Sense byte
3C4C	8108		LBI R1, #$08
3C4E	C51D		SNBS R5, R1		; Heads engaged ?
3C50	0024		RET R2			; Yes, OK and return

			; Heads still not engaged, error

3C52	8620		LBI R6, #$20		; Error 33

3C54	813E		LBI R1, #$3E
3C56	011D		MLH R1, R1
3C58	81FA		LBI R1, #$FA
3C5A	0203		INC2 R2, R0
3C5C	0014		RET R1

; ***********************
; Diskette I/O Supervisor
; Interrupt 2 Routine
; Read Mode
; ***********************

3C5E	ED5F		STAT R5, $D		; Diskette Sense byte
3C60	8140		LBI R1, #$40
3C62	0754		MOVE R7, R5
3C64	9516		CLR R5, #$16
3C66	C512		SE R5, R1		; Read Mode ?
3C68	A08B		BRA $3CF6		; No, error 35

3C6A	8AFF		LBI R10, #$FF		; New byte ready
3C6C	0D5E		GETB R5, $D		; Get data byte (Address Mark)
			; Exit from interrupt routine because
			; GETB resets IRQ2 line

3C6E	1447		CTRL $4, #$47		; (?)
3C70	F000		BRA $3C71		; Delay jump

3C72	FF02		SUB R15, #$03
3C74	8880		LBI R8, #$80
3C76	0D7E		GETB R7, $D		; Get first data byte
			; Exit from interrupt routine because
			; GETB resets IRQ2 line

3C78	C603		SZ R6
3C7A	A03D		BRA $3CBA		; $3E(R0)

			; Read

3C7C	7740		MOVB (R4)+, R7		; Store first data byte
3C7E	0974		MOVE R9, R7		; Save first data in R9
3C80	FF00		SUB R15, #$01
3C82	CF8F		SNBSH R15, R8
3C84	A009		BRA $3C90		; $0A(R0)

3C86	0D7E		GETB R7, $D		; Get data byte
3C88	7740		MOVB (R4)+, R7		; Store data byte
3C8A	FF00		SUB R15, #$01		; Decrement byte counter
3C8C	CF87		SBSH R15, R8		; Done ?
3C8E	F009		BRA $3C86		; No, loop

3C90	1D04		CTRL $D, #$04		; Read CRC
3C92	0004		NOP
3C94	0D7E		GETB R7, $D		; Get n-1 th data byte
3C96	F000		BRA $3C97
3C98	0004		NOP
3C9A	7740		MOVB (R4)+, R7		; Store it
3C9C	0D7E		GETB R7, $D		; Get n'th data byte
3C9E	F000		BRA $3C9F
3CA0	7740		MOVB (R4)+, R7		; Store it
3CA2	0004		NOP
3CA4	0D7E		GETB R7, $D		; CRC byte 1
3CA6	F000		BRA $3CA7
3CA8	0004		NOP
3CAA	8AFF		LBI R10, #$FF		; Set done flag
3CAC	1447		CTRL $4, #$47
3CAE	0D7E		GETB R7, $D		; CRC byte 2

			; Read gap bytes until interrupted

3CB0	2F50		MOVE R15, $A0
3CB2	AF00		ADD R15, #$01		; Count number of gap bytes read
3CB4	F000		BRA $3CB5		; Delay
3CB6	0D7E		GETB R7, $D
3CB8	F007		BRA $3CB2		; Loop

; ----

3CBA	0974		MOVE R9, R7
3CBC	6140		MOVB R1, (R4)+
3CBE	C712		SE R7, R1
3CC0	A025		BRA $3CE8		; $26(R0)

3CC2	FF00		SUB R15, #$01
3CC4	0D7E		GETB R7, $D
3CC6	6140		MOVB R1, (R4)+
3CC8	C712		SE R7, R1
3CCA	A01B		BRA $3CE8		; $1C(R0)

3CCC	FF00		SUB R15, #$01
3CCE	CF87		SBSH R15, R8
3CD0	F00D		BRA $3CC4		; -> -$0E(R0)

3CD2	1D04		CTRL $D, #$04
3CD4	0004		NOP
3CD6	0D7E		GETB R7, $D
3CD8	6140		MOVB R1, (R4)+
3CDA	C712		SE R7, R1
3CDC	A009		BRA $3CE8		; $0A(R0)

3CDE	F000		BRA $3CDF		; -> -$01(R0)

3CE0	0D7E		GETB R7, $D
3CE2	6148		MOVB R1, (R4)
3CE4	C71A		SNE R7, R1
3CE6	F045		BRA $3CA2		; -> -$46(R0)

3CE8	103F		CTRL $0, #$3F
3CEA	1D01		CTRL $D, #$01
3CEC	853D		LBI R5, #$3D
3CEE	055D		MLH R5, R5
3CF0	85DE		LBI R5, #$DE
3CF2	3500		MOVE $00, R5
3CF4	105F		CTRL $0, #$5F

			; Error

3CF6	853D		LBI R5, #$3D
3CF8	055D		MLH R5, R5
3CFA	8500		LBI R5, #$00
3CFC	3500		MOVE $00, R5
3CFE	1D01		CTRL $D, #$01
; ----

			; This is executed at level 0

3D00	2727		MOVE R7, $4E
3D02	0D5E		GETB R5, $D
3D04	057D		MLH R5, R7
3D06	3574		MOVE $E8, R5		; Set Diskette Status Byte
3D08	861C		LBI R6, #$1C		; Error 35
3D0A	F0B7		BRA $3C54		; Error routine

; ***********************
; Diskette I/O Supervisor
; Seek Routine
; ***********************

3D0C	3241		MOVE $82, R2		; Save R2

3D0E	1D01		CTRL $D, #$01		; Reset R/W/D

			; Check bounds of R15 (track counter)

3D10	8151		LBI R1, #$51
3D12	CF10		SLE R15, R1
3D14	8F4E		LBI R15, #$4E
3D16	07F4		MOVE R7, R15

3D18	0D5E		GETB R5, $D		; Access Sense byte
3D1A	0654		MOVE R6, R5

			; Generate next Access Lines pattern

3D1C	95FC		CLR R5, #$FC		; Mask Access Lines
3D1E	0854		MOVE R8, R5
3D20	8103		LBI R1, #$03
3D22	0817		XOR R8, R1		; Invert Access Line bits
3D24	E08E		ROR3 R8
3D26	E08E		ROR3 R8			; Move them to bits 4 and 5
3D28	0586		OR R5, R8		; Insert original bits 6 and 7

3D2A	CA03		SZ R10
3D2C	A003		BRA $3D32		; $04(R0)

3D2E	E05D		ROR R5
3D30	A007		BRA $3D3A		; $08(R0)

3D32	0854		MOVE R8, R5
3D34	E08F		SWAP R8
3D36	0586		OR R5, R8
3D38	E05E		ROR3 R5

			; Send new Access Lines pattern to adapter

3D3A	95FC		CLR R5, #$FC
3D3C	9603		CLR R6, #$03
3D3E	0566		OR R5, R6
3D40	2450		MOVE R4, $A0
3D42	840B		LBI R4, #$0B		; Lo(R5L0)
3D44	4D48		PUTB $D, (R4)

3D46	8903		LBI R9, #$03
3D48	099D		MLH R9, R9
3D4A	891B		LBI R9, #$1B		; R9 <- $031B
3D4C	F900		SUB R9, #$01
3D4E	8180		LBI R1, #$80
3D50	C917		SBSH R9, R1
3D52	F007		BRA $3D4C		; Delay loop

3D54	F700		SUB R7, #$01		; Decrement track counter
3D56	C703		SZ R7			; Finished ?
3D58	F041		BRA $3D18		; No, loop

3D5A	2041		JMP ($0082)		; Return to caller

; *************************
; Diskette I/O Supervisor
; Read data field of sector
; R4: Pointer to buffer
; *************************

3D5C	3241		MOVE $82, R2		; Save R2

3D5E	8900		LBI R9, #$00
3D60	099D		MLH R9, R9
3D62	8967		LBI R9, #$67		; Timeout value

3D64	3626		MOVE $4C, R6		; R6L2
3D66	2F50		MOVE R15, $A0
3D68	8103		LBI R1, #$03
3D6A	CE11		SLT R14, R1
3D6C	8E04		LBI R14, #$04
3D6E	0FED		MLH R15, R14
3D70	CE0B		SNZ R14
3D72	8F80		LBI R15, #$80

3D74	8814		LBI R8, #$14		; 20 gap bytes (MFM)
3D76	2548		MOVE R5, $90
3D78	8110		LBI R1, #$10
3D7A	C515		SBS R5, R1		; MFM ?
3D7C	880A		LBI R8, #$0A		; No, then 10 gap bytes (FM)

			; Skip over some gap bytes

3D7E	F900		SUB R9, #$01
3D80	8180		LBI R1, #$80
3D82	C91F		SNBSH R9, R1
3D84	A08D		BRA $3E14		; Error 21

3D86	252F		MOVE R5, $5E		; R15L2 (number of gap bytes)
3D88	C589		SGE R5, R8
3D8A	F00D		BRA $3D7E		; Loop

3D8C	1D01		CTRL $D, #$01		; Reset R/W/D
3D8E	2850		MOVE R8, $A0
3D90	382A		MOVE $54, R8		; Clear flag (R10L2)
3D92	3424		MOVE $48, R4		; Buffer address (R4L2)
3D94	3F2F		MOVE $5E, R15		; Number of bytes (R15L2)
3D96	883C		LBI R8, #$3C
3D98	088D		MLH R8, R8
3D9A	885E		LBI R8, #$5E
3D9C	3820		MOVE $40, R8		; Int 2 routine (R0L2)
3D9E	2650		MOVE R6, $A0
3DA0	1D40		CTRL $D, #$40		; Start Read
3DA2	144B		CTRL $4, #$4B
3DA4	0203		INC2 R2, R0
3DA6	A03B		BRA $3DE4		; Wait for data byte

3DA8	2525		MOVE R5, $4A		; R5L2
3DAA	81F8		LBI R1, #$F8
3DAC	C512		SE R5, R1		; Deleted Data Address Mark ?
3DAE	A003		BRA $3DB4		; No

3DB0	8620		LBI R6, #$20		; Set flag for DDAM
3DB2	A007		BRA $3DBC

3DB4	81FB		LBI R1, #$FB
3DB6	C51A		SNE R5, R1		; Normal Data Address Mark ?
3DB8	A001		BRA $3DBC		; Yes
3DBA	F02F		BRA $3D8C		; No, ignore and retry

			; Read data field

3DBC	8907		LBI R9, #$07
3DBE	099D		MLH R9, R9
3DC0	893E		LBI R9, #$3E
3DC2	144B		CTRL $4, #$4B
3DC4	2850		MOVE R8, $A0
3DC6	382A		MOVE $54, R8		; Clear flag (R10L2)
3DC8	0203		INC2 R2, R0
3DCA	A017		BRA $3DE4		; Wait until all data read

3DCC	ED5F		STAT R5, $D		; Diskette Sense Byte
3DCE	1D01		CTRL $D, #$01		; Reset R/W/D
3DD0	8101		LBI R1, #$01
3DD2	C515		SBS R5, R1		; R/W Overrun ?
3DD4	A003		BRA $3DDA		; No

3DD6	8622		LBI R6, #$22		; Error 32
3DD8	A035		BRA $3E10		; Exit

3DDA	8102		LBI R1, #$02
3DDC	C516		SBC R5, R1		; CRC error ?
3DDE	B680		SET R6, #$80		; Set flag for CRC error

3DE0	144A		CTRL $4, #$4A
3DE2	2041		JMP ($0082)		; Return to caller
; ----------

3DE4	F900		SUB R9, #$01
3DE6	8180		LBI R1, #$80
3DE8	C91F		SNBSH R9, R1
3DEA	A007		BRA $3DF4

3DEC	272A		MOVE R7, $54
3DEE	C704		SS R7
3DF0	F00D		BRA $3DE4
3DF2	0024		RET R2

3DF4	8101		LBI R1, #$01
3DF6	ED5F		STAT R5, $D
3DF8	C516		SBC R5, R1
3DFA	F02D		BRA $3DCE

3DFC	1D01		CTRL $D, #$01
3DFE	2551		MOVE R5, $A2
3E00	8180		LBI R1, #$80
3E02	C51F		SNBSH R5, R1
3E04	A007		BRA $3E0E		; Error 22

3E06	254A		MOVE R5, $94
3E08	8109		LBI R1, #$09
3E0A	C519		SGE R5, R1
3E0C	F02F		BRA $3DDE

			; Error 22
3E0E	8636		LBI R6, #$36

			; Error exit
3E10	0203		INC2 R2, R0
3E12	A0E5		BRA $3EFA

			; Error 21
3E14	8638		LBI R6, #$38		; Error 21
3E16	1D01		CTRL $D, #$01		; Reset R/W/D
3E18	F009		BRA $3E10		; Exit

; ----------

3E1A	8907		LBI R9, #$07
3E1C	099D		MLH R9, R9
3E1E	893E		LBI R9, #$3E

			; Setup level 2 registers
3E20	3424		MOVE $48, R4		; R4L2
3E22	3626		MOVE $4C, R6		; R6L2
3E24	2F50		MOVE R15, $A0
3E26	8103		LBI R1, #$03
3E28	CE11		SLT R14, R1
3E2A	8E04		LBI R14, #$04
3E2C	0FED		MLH R15, R14
3E2E	CE0B		SNZ R14
3E30	8F80		LBI R15, #$80
3E32	3F2F		MOVE $5E, R15		; R15L2
3E34	2850		MOVE R8, $A0
3E36	382A		MOVE $54, R8		; R10L2

3E38	1D80		CTRL $D, #$80		; Start Write

3E3A	F900		SUB R9, #$01
3E3C	8180		LBI R1, #$80
3E3E	C91F		SNBSH R9, R1
3E40	A013		BRA $3E56
3E42	272A		MOVE R7, $54		; R10L2
3E44	C704		SS R7
3E46	F00D		BRA $3E3A

3E48	ED5F		STAT R5, $D		; Write overrun?
3E4A	8101		LBI R1, #$01
3E4C	C515		SBS R5, R1
3E4E	A013		BRA $3E64
3E50	1D01		CTRL $D, #$01		; Yes, reset write
3E52	8622		LBI R6, #$22
3E54	F045		BRA $3E10		; Error ..

3E56	8101		LBI R1, #$01
3E58	ED5F		STAT R5, $D
3E5A	C516		SBC R5, R1
3E5C	F00D		BRA $3E50		; Write overrun

3E5E	1D01		CTRL $D, #$01
3E60	8634		LBI R6, #$34
3E62	F053		BRA $3E10

3E64	8108		LBI R1, #$08
3E66	C515		SBS R5, R1
3E68	A003		BRA $3E6E

3E6A	144A		CTRL $4, #$4A
3E6C	0024		RET R2

3E6E	861E		LBI R6, #$1E
3E70	F061		BRA $3E10

; ----------

3E72	144B		CTRL $4, #$4B

			; Write sync field
3E74	2750		MOVE R7, $A0
3E76	870C		LBI R7, #$0C
3E78	8800		LBI R8, #$00
3E7A	088D		MLH R8, R8
3E7C	88A0		LBI R8, #$A0
3E7E	4D88		PUTB $D, (R8)
3E80	F700		SUB R7, #$01
3E82	C703		SZ R7
3E84	F007		BRA $3E7E

			; Write address mark
3E86	1D02		CTRL $D, #$02		; Write Address Mark
3E88	85A1		LBI R5, #$A1		; Address Mark byte
3E8A	884B		LBI R8, #$4B		; Lo(R5L2)
3E8C	4D88		PUTB $D, (R8)		; .. first
3E8E	F000		BRA $3E8F
3E90	F000		BRA $3E91
3E92	4D88		PUTB $D, (R8)		; .. second
3E94	F000		BRA $3E95
3E96	F000		BRA $3E97
3E98	4D88		PUTB $D, (R8)		; .. third
3E9A	F000		BRA $3E9B

3E9C	1D08		CTRL $D, #$08		; Turn on Erase Gate
3E9E	884D		LBI R8, #$4D		; Lo(R6L2)
3EA0	4D88		PUTB $D, (R8)		; .. and last
3EA2	F000		BRA $3EA3

			; Write ID field
3EA4	8880		LBI R8, #$80
3EA6	FF00		SUB R15, #$01
3EA8	4D40		PUTB $D, (R4)+
3EAA	0004		NOP
3EAC	FF00		SUB R15, #$01
3EAE	CF87		SBSH R15, R8
3EB0	F009		BRA $3EA8

			; Write two CRC bytes
3EB2	1D0C		CTRL $D, #$0C		; Write CRC
3EB4	0004		NOP
3EB6	4D48		PUTB $D, (R4)		; CRC byte 1
3EB8	F000		BRA $3EB9
3EBA	1D0C		CTRL $D, #$0C
3EBC	F000		BRA $3EBD
3EBE	4D48		PUTB $D, (R4)		; CRC byte 2

3EC0	2450		MOVE R4, $A0
3EC2	845E		LBI R4, #$5E		; R15L0
3EC4	1D08		CTRL $D, #$08		; CRC off
3EC6	F000		BRA $3EC7
3EC8	4D48		PUTB $D, (R4)
3ECA	0004		NOP

3ECC	8AFF		LBI R10, #$FF		; Set Done flag

			; Finished
3ECE	1447		CTRL $4, #$47
3ED0	F000		BRA $3ED1
3ED2	F000		BRA $3ED3

3ED4	1D09		CTRL $D, #$09		; Reset Write; keep Erase Gate
3ED6	0000		HALT

; ----------

3ED8	144B		CTRL $4, #$4B
3EDA	2750		MOVE R7, $A0
3EDC	8706		LBI R7, #$06
3EDE	8800		LBI R8, #$00
3EE0	088D		MLH R8, R8
3EE2	88A0		LBI R8, #$A0
3EE4	4D88		PUTB $D, (R8)
3EE6	F700		SUB R7, #$01
3EE8	0004		NOP
3EEA	C703		SZ R7
3EEC	F009		BRA $3EE4

3EEE	1D02		CTRL $D, #$02		; Write Address Mark
3EF0	884D		LBI R8, #$4D
3EF2	4D88		PUTB $D, (R8)
3EF4	F000		BRA $3EF5

3EF6	1D08		CTRL $D, #$08		; Erase Gate
3EF8	F055		BRA $3EA4
; ----------

			; Diskette Error Routine

3EFA	3240		MOVE $80, R2		; Save R2
3EFC	144A		CTRL $4, #$4A		; Enable Int 3

3EFE	87F0		LBI R7, #$F0
3F00	077D		MLH R7, R7		; R7 <- $F0F0
3F02	0068		ADD R0, R6
3F04	A700		ADD R7, #$01		; F0F1
3F06	A700		ADD R7, #$01		; F0F2
3F08	A700		ADD R7, #$01		; ...
3F0A	A700		ADD R7, #$01
3F0C	A700		ADD R7, #$01
3F0E	A700		ADD R7, #$01
3F10	A700		ADD R7, #$01
3F12	A700		ADD R7, #$01		; F0F8
3F14	A700		ADD R7, #$01		; F0F9
3F16	A7F6		ADD R7, #$F7		; F1F0
3F18	A700		ADD R7, #$01		; F1F1
3F1A	A700		ADD R7, #$01		; ...
3F1C	A700		ADD R7, #$01
3F1E	A700		ADD R7, #$01
3F20	A700		ADD R7, #$01
3F22	A700		ADD R7, #$01
3F24	A700		ADD R7, #$01
3F26	A700		ADD R7, #$01
3F28	A700		ADD R7, #$01
3F2A	A7F6		ADD R7, #$F7		; F2F0
3F2C	A700		ADD R7, #$01
3F2E	A700		ADD R7, #$01
3F30	A700		ADD R7, #$01
3F32	A700		ADD R7, #$01
3F34	A700		ADD R7, #$01
3F36	A700		ADD R7, #$01
3F38	A700		ADD R7, #$01
3F3A	A700		ADD R7, #$01
3F3C	A700		ADD R7, #$01
3F3E	A7F6		ADD R7, #$F7		; F3F0
3F40	A700		ADD R7, #$01
3F42	A700		ADD R7, #$01
3F44	A700		ADD R7, #$01
3F46	A700		ADD R7, #$01
3F48	A700		ADD R7, #$01
3F4A	A700		ADD R7, #$01
3F4C	A700		ADD R7, #$01
3F4E	A700		ADD R7, #$01
3F50	A700		ADD R7, #$01
3F52	A7F6		ADD R7, #$F7		; F4F0
3F54	A700		ADD R7, #$01
3F56	A700		ADD R7, #$01
3F58	A700		ADD R7, #$01
3F5A	A700		ADD R7, #$01
3F5C	A700		ADD R7, #$01
3F5E	A700		ADD R7, #$01
3F60	A700		ADD R7, #$01
3F62	A700		ADD R7, #$01
3F64	A700		ADD R7, #$01		; F4F9

3F66	0434		MOVE R4, R3
3F68	A40B		ADD R4, #$0C		; IOCB_Ret
3F6A	5748		MOVE (R4), R7		; Set return code
3F6C	0433		INC2 R4, R3
3F6E	6548		MOVB R5, (R4)		; IOCB_Cmd

3F70	8140		LBI R1, #$40
3F72	C612		SE R6, R1		; Error 17 ?
3F74	A015		BRA $3F8C		; No

3F76	8100		LBI R1, #$00
3F78	C51A		SNE R5, R1		; Sense ?
3F7A	A00B		BRA $3F88		; Yes

3F7C	8104		LBI R1, #$04
3F7E	C51A		SNE R5, R1		; Find ?
3F80	A005		BRA $3F88		; Yes

3F82	8105		LBI R1, #$05
3F84	C512		SE R5, R1		; Mark ?
3F86	A003		BRA $3F8C		; No

			; Error 17 while Sense, Find or Mark
3F88	8644		LBI R6, #$44		; Set to error 15
3F8A	F08D		BRA $3EFE

3F8C	8134		LBI R1, #$34
3F8E	C619		SGE R6, R1		; Error <= 23 (<= is correct)
3F90	A00F		BRA $3FA2		; No

3F92	8144		LBI R1, #$44
3F94	C610		SLE R6, R1
3F96	A009		BRA $3FA2		; $0A(R0)

3F98	813A		LBI R1, #$3A
3F9A	011D		MLH R1, R1
3F9C	81DC		LBI R1, #$DC
3F9E	0203		INC2 R2, R0
3FA0	0014		RET R1

3FA2	8116		LBI R1, #$16
3FA4	C612		SE R6, R1		; Error 38 ?
3FA6	A00D		BRA $3FB6		; No

3FA8	8105		LBI R1, #$05
3FAA	C512		SE R5, R1		; Mark ?
3FAC	A007		BRA $3FB6		; No

3FAE	0434		MOVE R4, R3
3FB0	A40D		ADD R4, #$0E		; IOCB_CI2
3FB2	277B		MOVE R7, $F6
3FB4	5748		MOVE (R4), R7

3FB6	8160		LBI R1, #$60
3FB8	C61A		SNE R6, R1		; Error 01 ?
3FBA	A011		BRA $3FCE		; Yes

3FBC	8108		LBI R1, #$08
3FBE	C61A		SNE R6, R1		; Error 45 ?
3FC0	A00B		BRA $3FCE		; Yes

3FC2	8122		LBI R1, #$22
3FC4	C610		SLE R6, R1		; Error >= 32 (>= is correct)
3FC6	A011		BRA $3FDA		; No

3FC8	811C		LBI R1, #$1C
3FCA	C619		SGE R6, R1		; Error <= 35
3FCC	A00B		BRA $3FDA		; No

			; Reset adapter

3FCE	0D8E		GETB R8, $D		; Access Sense byte
3FD0	9888		CLR R8, #$88		; Clear New Media/Head Engage
3FD2	1D01		CTRL $D, #$01		; Reset R/W/D
3FD4	2450		MOVE R4, $A0
3FD6	8411		LBI R4, #$11		; Lo(R8)
3FD8	4D48		PUTB $D, (R4)

			; Exit from Diskette I/O Supervisor

3FDA	8121		LBI R1, #$21
3FDC	011D		MLH R1, R1
3FDE	8118		LBI R1, #$18
3FE0	0014		RET R1			; JMP $2118
3FE2	0000		HALT
3FE4	0000		HALT
; ----------

; Setup routine

3FE6	8102		LBI R1, #$02
3FE8	011D		MLH R1, R1
3FEA	8102		LBI R1, #$02
3FEC	31E1		MOVE $1C2, R1		; $1C2 <- $0202

			; Put address of diskette I/O supervisor routine
			; into vector table (entry for system device D)
3FEE	8120		LBI R1, #$20
3FF0	011D		MLH R1, R1
3FF2	8100		LBI R1, #$00
3FF4	246C		MOVE R4, $D8
3FF6	A433		ADD R4, #$34
3FF8	5148		MOVE (R4), R1

			; Return to caller
3FFA	0824		MOVE R8, R2
3FFC	2056		JMP ($00AC)

			; Entry point for setup routine
3FFE	F019		BRA $3FE6

; **********************************************************************
; *** END OF ROS PART 2
; **********************************************************************


; **********************************************************************
; *** BEGIN OF ROS PART 3
; **********************************************************************

; *** I/O Supervisor Initialization ***

4000	246C		MOVE R4, $D8		; vector for device 0
4002	D548		MOVE R5, (R4)
4004	065C		MHL R6, R5
4006	0656		OR R6, R5
4008	C603		SZ R6
400A	A007		BRA $4014		; vector already set

			; Set vector for device 0 ($41DC)
400C	8541		LBI R5, #$41
400E	055D		MLH R5, R5
4010	85DC		LBI R5, #$DC
4012	5548		MOVE (R4), R5

4014	A40F		ADD R4, #$10		; vector for device 4
4016	D548		MOVE R5, (R4)
4018	065C		MHL R6, R5
401A	0656		OR R6, R5
401C	C603		SZ R6
401E	A007		BRA $4028		; vector alreadz set

			; Set vector for device 4 ($4334)
4020	8543		LBI R5, #$43
4022	055D		MLH R5, R5
4024	8534		LBI R5, #$34
4026	5548		MOVE (R4), R5

4028	8148		LBI R1, #$48
402A	011D		MLH R1, R1
402C	8114		LBI R1, #$14
402E	3161		MOVE $C2, R1

4030	8148		LBI R1, #$48
4032	011D		MLH R1, R1
4034	813A		LBI R1, #$3A
4036	3160		MOVE $C0, R1

4038	2452		MOVE R4, $A4
403A	054C		MHL R5, R4
403C	9504		CLR R5, #$04
403E	27FC		MOVE R7, $1F8
4040	8620		LBI R6, #$20
4042	C765		SBS R7, R6
4044	B504		SET R5, #$04
4046	045D		MLH R4, R5
4048	3452		MOVE $A4, R4

404A	8441		LBI R4, #$41
404C	044D		MLH R4, R4
404E	844E		LBI R4, #$4E
4050	3462		MOVE $C4, R4

			; Initialization done, change entry point of
			; supervisor routine
4052	8140		LBI R1, #$40
4054	011D		MLH R1, R1
4056	815A		LBI R1, #$5A
4058	3157		MOVE $AE, R1

; ----------

; ********************
; Begin I/O Supervisor
; ********************

405A	215F		MOVE R1, $BE
405C	F111		SUB R1, #$12
405E	D418		MOVE R4, (R1)
4060	C403		SZ R4
4062	A007		BRA $406C		; $08(R0)

4064	8400		LBI R4, #$00
4066	044D		MLH R4, R4
4068	8414		LBI R4, #$14
406A	5418		MOVE (R1), R4

406C	103F		CTRL $0, #$3F		; Disable Interrupts
406E	2452		MOVE R4, $A4
4070	B402		SET R4, #$02		; in Exec-ROS (?)
4072	3452		MOVE $A4, R4
4074	105F		CTRL $0, #$5F		; Enable Interrupts

4076	1102		CTRL $1, #$02		; Select Common ROS
4078	144A		CTRL $4, #$4A		; Typamatic off / Int 3 on

407A	325B		MOVE $B6, R2		; Save return address
407C	0D34		MOVE R13, R3		; Ptr to IOCB in R13

407E	8101		LBI R1, #$01
4080	C417		SBSH R4, R1		; Test CRT status
4082	A031		BRA $40B6		; CRT off -> jump
4084	1077		CTRL $0, #$77		; Turn CRT on (as told)

4086	8102		LBI R1, #$02
4088	C41F		SNBSH R4, R1		; Is I/O active ?
408A	A02B		BRA $40B8		; Yes -> jump

408C	2451		MOVE R4, $A2
408E	8110		LBI R1, #$10
4090	C415		SBS R4, R1		; Should call be HOLDed ?
4092	A023		BRA $40B8		; No

			; HOLD
4094	2558		MOVE R5, $B0
4096	055C		MHL R5, R5
4098	B540		SET R5, #$40
409A	055D		MLH R5, R5
409C	95FF		CLR R5, #$FF
409E	3558		MOVE $B0, R5

40A0	8140		LBI R1, #$40
40A2	011D		MLH R1, R1
40A4	81B8		LBI R1, #$B8		; R1 <- $40B8
40A6	255F		MOVE R5, $BE
40A8	A51F		ADD R5, #$20		; R5 <- $0720 (temp area)
40AA	5153		MOVE (R5)++, R1		; \
40AC	5251		MOVE (R5)+, R2		;  > Save registers
40AE	5358		MOVE (R5), R3		; /
40B0	287E		MOVE R8, $FC		; Address of HOLD routine
40B2	0203		INC2 R2, R0
40B4	2056		JMP ($00AC)		; HOLD
; ----------

40B6	106F		CTRL $0, #$6F		; Turn CRT off

40B8	0D34		MOVE R13, R3		; Ptr to IOCB to R13

40BA	AD0B		ADD R13, #$0C		; IOCB_Ret
40BC	2450		MOVE R4, $A0
40BE	54D8		MOVE (R13), R4		; Clear error code

40C0	FD0B		SUB R13, #$0C		; IOCB_DA
40C2	64D8		MOVB R4, (R13)
40C4	81F0		LBI R1, #$F0
40C6	C416		SBC R4, R1		; Is DA >= $10 (invalid)
40C8	A021		BRA $40EC		; Yes -> Error

40CA	2862		MOVE R8, $C4
40CC	0203		INC2 R2, R0
40CE	2056		JMP ($00AC)
40D0	A029		BRA $40FC		; $2A(R0)

40D2	0D34		MOVE R13, R3
40D4	64D8		MOVB R4, (R13)		; IOCB_DA
40D6	256C		MOVE R5, $D8
40D8	0448		ADD R4, R4
40DA	0448		ADD R4, R4
40DC	0548		ADD R5, R4
40DE	D451		MOVE R4, (R5)+
40E0	064C		MHL R6, R4
40E2	0645		AND R6, R4
40E4	C60C		SNS R6
40E6	A00D		BRA $40F6		; $0E(R0)

40E8	064C		MHL R6, R4
40EA	C60B		SNZ R6
40EC	A0E1		BRA $41D0		; Error 13

40EE	2804		MOVE R8, $08		; R8 <- R4L0
40F0	0203		INC2 R2, R0
40F2	2056		JMP ($00AC)		; Call I/O routine for device
40F4	A005		BRA $40FC		; $06(R0)

40F6	D858		MOVE R8, (R5)
40F8	0203		INC2 R2, R0
40FA	2067		JMP ($00CE)
; ----------

40FC	2452		MOVE R4, $A4
40FE	8101		LBI R1, #$01
4100	C417		SBSH R4, R1
4102	A045		BRA $414A		; $46(R0)

4104	1077		CTRL $0, #$77
4106	8102		LBI R1, #$02
4108	C41F		SNBSH R4, R1
410A	A029		BRA $4136		; $2A(R0)

410C	2451		MOVE R4, $A2
410E	8110		LBI R1, #$10
4110	C415		SBS R4, R1
4112	A021		BRA $4136		; $22(R0)

4114	2558		MOVE R5, $B0
4116	055C		MHL R5, R5
4118	B540		SET R5, #$40
411A	055D		MLH R5, R5
411C	95FF		CLR R5, #$FF
411E	3558		MOVE $B0, R5
4120	8141		LBI R1, #$41
4122	011D		MLH R1, R1
4124	8136		LBI R1, #$36
4126	255F		MOVE R5, $BE
4128	A51F		ADD R5, #$20
412A	5153		MOVE (R5)++, R1
412C	5251		MOVE (R5)+, R2
412E	5358		MOVE (R5), R3
4130	287E		MOVE R8, $FC
4132	0203		INC2 R2, R0
4134	2056		JMP ($00AC)

4136	0D34		MOVE R13, R3
4138	225B		MOVE R2, $B6
413A	144A		CTRL $4, #$4A
413C	103F		CTRL $0, #$3F
413E	2452		MOVE R4, $A4
4140	9402		CLR R4, #$02
4142	3452		MOVE $A4, R4
4144	105F		CTRL $0, #$5F
4146	0824		MOVE R8, R2
4148	2056		JMP ($00AC)

414A	106F		CTRL $0, #$6F
414C	F017		BRA $4136		; -> -$18(R0)
; ----------

414E	0D34		MOVE R13, R3		; Ptr to IOCB to R13
4150	AD0F		ADD R13, #$10		; IOCB_Stat1
4152	D4D8		MOVE R4, (R13)
4154	FD0F		SUB R13, #$10

4156	850C		LBI R5, #$0C
4158	C45E		SNBC R4, R5
415A	A069		BRA $41C6		; Return

415C	8104		LBI R1, #$04
415E	C415		SBS R4, R1
4160	A069		BRA $41CC		; R5 <- $04
4162	8508		LBI R5, #$08

4164	215F		MOVE R1, $BE
4166	F111		SUB R1, #$12
4168	D718		MOVE R7, (R1)

			; Busy wait until printer ready or timeout
416A	8990		LBI R9, #$90
416C	099D		MLH R9, R9
416E	8900		LBI R9, #$00		; R9 <- $9000
4170	2652		MOVE R6, $A4
4172	C655		SBS R6, R5		; Check printer status
4174	A015		BRA $418C		; Printer ready
4176	81FF		LBI R1, #$FF
4178	F900		SUB R9, #$01
417A	C917		SBSH R9, R1
417C	F00D		BRA $4170		; Loop
417E	F700		SUB R7, #$01
4180	0A7C		MHL R10, R7
4182	CA03		SZ R10
4184	F01B		BRA $416A		; Loop
4186	C703		SZ R7
4188	F01F		BRA $416A		; Loop
418A	A02D		BRA $41BA		; Error 70

			; Printer ready
418C	8102		LBI R1, #$02
418E	C415		SBS R4, R1
4190	A033		BRA $41C6		; Exit

4192	850C		LBI R5, #$0C
4194	215F		MOVE R1, $BE
4196	F111		SUB R1, #$12
4198	D718		MOVE R7, (R1)
419A	8990		LBI R9, #$90
419C	099D		MLH R9, R9
419E	8900		LBI R9, #$00		; R9 <- $9000
41A0	2652		MOVE R6, $A4
41A2	C655		SBS R6, R5
41A4	A01F		BRA $41C6		; Exit
41A6	81FF		LBI R1, #$FF
41A8	F900		SUB R9, #$01
41AA	C917		SBSH R9, R1
41AC	F00D		BRA $41A0		; -> -$0E(R0)
41AE	F700		SUB R7, #$01
41B0	0A7C		MHL R10, R7
41B2	CA03		SZ R10
41B4	F01B		BRA $419A		; -> -$1C(R0)
41B6	C703		SZ R7
41B8	F01F		BRA $419A		; -> -$20(R0)

41BA	86F7		LBI R6, #$F7
41BC	066D		MLH R6, R6
41BE	86F0		LBI R6, #$F0		; R6 <- '70'
41C0	AD0B		ADD R13, #$0C		; IOCB_Ret
41C2	56D8		MOVE (R13), R6
41C4	A001		BRA $41C8		; Error

41C6	A201		ADD R2, #$02		; OK return

41C8	0824		MOVE R8, R2
41CA	2056		JMP ($00AC)		; Return
; ----------

41CC	8504		LBI R5, #$04
41CE	F06B		BRA $4164		; -> -$6C(R0)

; **********
; Error '13'
; **********

41D0	86F1		LBI R6, #$F1
41D2	066D		MLH R6, R6
41D4	86F3		LBI R6, #$F3		; R6 <- '13'
41D6	AD0B		ADD R13, #$0C		; IOCB_Ret
41D8	56D8		MOVE (R13), R6		; Set error code
41DA	F0DF		BRA $40FC

; ----------

; *****************************
; Device 0 (Screen) I/O Routine
; *****************************

41DC	3259		MOVE $B2, R2		; Save R2
41DE	1443		CTRL $4, #$43		; Disable Int 3

41E0	0D34		MOVE R13, R3
41E2	D4D1		MOVE R4, (R13)+
41E4	64D0		MOVB R4, (R13)+
41E6	94F0		CLR R4, #$F0		; IOCB_Cmd

41E8	66D6		MOVB R6, (R13)---	; IOCB_Flags
41EA	96F0		CLR R6, #$F0

41EC	0448		ADD R4, R4
41EE	0048		ADD R0, R4
41F0	A0AF		BRA $42A2		; Screen on
41F2	A02F		BRA $4224		; Screen off
41F4	A077		BRA $426E		; Scroll up
41F6	A03B		BRA $4234		; Scroll down
41F8	A015		BRA $4210		; Clear screen
41FA	A0C7		BRA $42C4		; Alarm on
41FC	A0C9		BRA $42C8		; Alarm off
41FE	A0CB		BRA $42CC		; Beep
4200	A0DD		BRA $42E0		; (?)
4202	A0B1		BRA $42B6		; invalid
4204	A0AF		BRA $42B6		; invalid
4206	A0AD		BRA $42B6		; invalid
4208	A0AB		BRA $42B6		; invalid
420A	A0A9		BRA $42B6		; invalid
420C	A0A7		BRA $42B6		; invalid
420E	A0A5		BRA $42B6		; invalid

			; Clear screen

4210	8402		LBI R4, #$02
4212	044D		MLH R4, R4
4214	8400		LBI R4, #$00		; R4 <- $0200
4216	8540		LBI R5, #$40
4218	055D		MLH R5, R5		; R5 <- $4040
421A	8606		LBI R6, #$06		; End address (high byte)
421C	5541		MOVE (R4)+, R5
421E	C467		SBSH R4, R6
4220	F005		BRA $421C		; Loop
4222	A08B		BRA $42B0		; Exit

			; Screen off

4224	102F		CTRL $0, #$2F		; Disable Ints / Screen off
4226	2452		MOVE R4, $A4
4228	054C		MHL R5, R4
422A	9501		CLR R5, #$01		; Clear CRT on flag
422C	045D		MLH R4, R5
422E	3452		MOVE $A4, R4
4230	105F		CTRL $0, #$5F		; Enable Ints
4232	A07B		BRA $42B0		; Exit

			; Scroll down

4234	8410		LBI R4, #16
4236	0469		SUB R4, R6		; Line counter

4238	8506		LBI R5, #$06
423A	055D		MLH R5, R5
423C	853E		LBI R5, #$3E		; R5 <- $063E

423E	F53F		SUB R5, #$40		; Calc start address
4240	F600		SUB R6, #1
4242	C604		SS R6
4244	F007		BRA $423E		; Loop

4246	0654		MOVE R6, R5		; R5 = current line
4248	F63F		SUB R6, #$40		; R6 = previous line

424A	F400		SUB R4, #1		; Decrement line counter
424C	C40B		SNZ R4
424E	A00D		BRA $425E

4250	8720		LBI R7, #$20		; 32 words per line
4252	D165		MOVE R1, (R6)-		; copy word from previous line
4254	5155		MOVE (R5)-, R1		; ... to current line
4256	F700		SUB R7, #1		; Decrement word counter
4258	C703		SZ R7
425A	F009		BRA $4252
425C	F013		BRA $424A

			; Clear line 0
425E	8640		LBI R6, #$40
4260	066D		MLH R6, R6		; R6 <- $4040
4262	8720		LBI R7, #$20		; 32 words
4264	5655		MOVE (R5)-, R6
4266	F700		SUB R7, #1
4268	C703		SZ R7
426A	F007		BRA $4264

426C	A033		BRA $42A2		; Screen on and exit

			; Scroll up

426E	810F		LBI R1, #15		; Lines to scroll

4270	8502		LBI R5, #$02
4272	055D		MLH R5, R5
4274	8500		LBI R5, #$00		; R5 <- $0200 (current line)

4276	8402		LBI R4, #$02
4278	044D		MLH R4, R4
427A	8440		LBI R4, #$40		; R4 <- $0240 (next line)

427C	C61A		SNE R6, R1
427E	A015		BRA $4296		; No lines to scroll
			; Should jump to 4294 or 42A2 instead!!

4280	8720		LBI R7, #$20		; 32 words
4282	D141		MOVE R1, (R4)+		; copy word from next line
4284	5151		MOVE (R5)+, R1		; ... to current line
4286	F700		SUB R7, #1
4288	C703		SZ R7
428A	F009		BRA $4282

428C	A600		ADD R6, #1
428E	810F		LBI R1, #15
4290	C612		SE R6, R1
4292	F013		BRA $4280

			; Clear bottom line
4294	8720		LBI R7, #$20		; 32 words
4296	8440		LBI R4, #$40
4298	044D		MLH R4, R4
429A	5451		MOVE (R5)+, R4
429C	F700		SUB R7, #1
429E	C703		SZ R7
42A0	F007		BRA $429A

			; Screen on

42A2	1037		CTRL $0, #$37		; Disable Ints / Screen on
42A4	2452		MOVE R4, $A4
42A6	054C		MHL R5, R4
42A8	B501		SET R5, #$01		; Set Screen on flag
42AA	045D		MLH R4, R5
42AC	3452		MOVE $A4, R4
42AE	105F		CTRL $0, #$5F		; Enable Ints

			; Exit

42B0	2259		MOVE R2, $B2		; Restore R2
42B2	0824		MOVE R8, R2
42B4	2056		JMP ($00AC)		; Return to caller

			; Error

42B6	84F0		LBI R4, #$F0
42B8	044D		MLH R4, R4
42BA	84F2		LBI R4, #$F2		; R4 <- '02'
42BC	0D34		MOVE R13, R3
42BE	AD0B		ADD R13, #$0C		; IOCB_Ret
42C0	54D8		MOVE (R13), R4		; Set error code
42C2	F021		BRA $42A2		; Screen on and return

			; Alarm on

42C4	107E		CTRL $0, #$7E
42C6	F017		BRA $42B0		; Exit

			; Alarm off

42C8	107D		CTRL $0, #$7D
42CA	F01B		BRA $42B0		; Exit

			; Beep

42CC	107E		CTRL $0, #$7E
42CE	8980		LBI R9, #$80
42D0	099D		MLH R9, R9
42D2	8900		LBI R9, #$00		; R9 <- $8000
42D4	81FF		LBI R1, #$FF
42D6	F900		SUB R9, #1
42D8	C917		SBSH R9, R1
42DA	F007		BRA $42D4		; Delay loop
42DC	107D		CTRL $0, #$7D
42DE	F02F		BRA $42B0		; Exit

			; (?)

42E0	2551		MOVE R5, $A2
42E2	8104		LBI R1, #$04
42E4	C515		SBS R5, R1
42E6	A01B		BRA $4304		; $1C(R0)

42E8	AD0F		ADD R13, #$10		; IOCB_Stat1
42EA	D5D8		MOVE R5, (R13)
42EC	B504		SET R5, #$04
42EE	55D8		MOVE (R13), R5

42F0	2862		MOVE R8, $C4
42F2	0203		INC2 R2, R0
42F4	2056		JMP ($00AC)
42F6	A02F		BRA $4328		; $30(R0)

42F8	0D34		MOVE R13, R3
42FA	AD0F		ADD R13, #$10		; IOCB_Stat1
42FC	D5D8		MOVE R5, (R13)
42FE	9504		CLR R5, #$04
4300	55D8		MOVE (R13), R5
4302	FD0F		SUB R13, #$10

4304	AD07		ADD R13, #$08		; IOCB_CI1
4306	64D8		MOVB R4, (R13)
4308	810F		LBI R1, #$0F
430A	C416		SBC R4, R1
430C	F057		BRA $42B6		; Error

430E	81F0		LBI R1, #$F0
4310	C41D		SNBS R4, R1
4312	F05D		BRA $42B6		; Error

			; R4 = $x0 with x>0
4314	8100		LBI R1, #$00
4316	011D		MLH R1, R1
4318	81B1		LBI R1, #$B1		; R1 <- $00B1
431A	7418		MOVB (R1), R4

431C	1443		CTRL $4, #$43		; Disable Int 3
431E	2873		MOVE R8, $E6
4320	0203		INC2 R2, R0
4322	2056		JMP ($00AC)
4324	0004		NOP
4326	F077		BRA $42B0		; Exit
; ---

4328	0D34		MOVE R13, R3
432A	AD0F		ADD R13, #$10		; IOCB_Stat1
432C	D5D8		MOVE R5, (R13)
432E	9504		CLR R5, #$04
4330	55D8		MOVE (R13), R5

4332	F083		BRA $42B0		; Exit

; *******************************
; Device 4 (Keyboard) I/O Routine
; *******************************

4334	1077		CTRL $0, #$77		; Display On
4336	325A		MOVE $B4, R2		; Save R2

4338	0D34		MOVE R13, R3		; IOCB
433A	AD01		ADD R13, #$02
433C	64D5		MOVB R4, (R13)--	; IOCB_Cmd
433E	8101		LBI R1, #$01
4340	C41A		SNE R4, R1
4342	A039		BRA $437E

4344	8140		LBI R1, #$40
4346	C41A		SNE R4, R1
4348	A019		BRA $4364		; $1A(R0)

434A	8141		LBI R1, #$41
434C	C41A		SNE R4, R1
434E	A017		BRA $4368		; $18(R0)

			; Error 02
4350	0D34		MOVE R13, R3
4352	AD0B		ADD R13, #$0C		; IOCB_Ret
4354	81F0		LBI R1, #'0'
4356	011D		MLH R1, R1
4358	81F2		LBI R1, #'2'
435A	51D8		MOVE (R13), R1
435C	8143		LBI R1, #$43
435E	011D		MLH R1, R1
4360	81EC		LBI R1, #$EC
4362	0014		RET R1

			; Command $40

4364	840C		LBI R4, #$0C
4366	A001		BRA $436A		; $02(R0)

			; Command $41

4368	840D		LBI R4, #$0D

436A	8100		LBI R1, #$00
436C	011D		MLH R1, R1
436E	81B1		LBI R1, #$B1
4370	7418		MOVB (R1), R4
4372	1443		CTRL $4, #$43
4374	2873		MOVE R8, $E6
4376	0203		INC2 R2, R0
4378	2056		JMP ($00AC)
437A	0004		NOP

			; Return
437C	A06D		BRA $43EC		; $6E(R0)

			; Command 1
			
437E	2451		MOVE R4, $A2
4380	8104		LBI R1, #$04
4382	C41E		SNBC R4, R1
4384	A00D		BRA $4394		; $0E(R0)

4386	9404		CLR R4, #$04
4388	3451		MOVE $A2, R4
438A	8149		LBI R1, #$49
438C	011D		MLH R1, R1
438E	8134		LBI R1, #$34
4390	0203		INC2 R2, R0
4392	0014		RET R1			; Call $4934

4394	2452		MOVE R4, $A4
4396	B401		SET R4, #$01
4398	054C		MHL R5, R4
439A	9580		CLR R5, #$80
439C	045D		MLH R4, R5
439E	3452		MOVE $A4, R4

43A0	2450		MOVE R4, $A0
43A2	3458		MOVE $B0, R4

43A4	0D34		MOVE R13, R3		; IOCB
43A6	AD00		ADD R13, #$01
43A8	64D4		MOVB R4, (R13)-		; IOCB_Sub
43AA	8180		LBI R1, #$80
43AC	C412		SE R4, R1
43AE	A047		BRA $43F8		; $48(R0)

			; Input one character without echo
43B0	AD03		ADD R13, #$04
43B2	D4D4		MOVE R4, (R13)~		; IOCB_BA

			; Cursor blink loop, exits if key pressed
43B4	6648		MOVB R6, (R4)		; get char in current position
43B6	8140		LBI R1, #$40
43B8	C612		SE R6, R1
43BA	A003		BRA $43C0
43BC	876D		LBI R7, #'_'		; blink with underscore
43BE	A001		BRA $43C2
43C0	8740		LBI R7, #' '		; blink with blank
43C2	0864		MOVE R8, R6
43C4	7748		MOVB (R4), R7
43C6	8940		LBI R9, #$40
43C8	099D		MLH R9, R9
43CA	8900		LBI R9, #$00
43CC	2A58		MOVE R10, $B0
43CE	CA03		SZ R10
43D0	A00F		BRA $43E2		; key pressed -> exit loop
43D2	81FF		LBI R1, #$FF
43D4	F900		SUB R9, #$01
43D6	C917		SBSH R9, R1
43D8	F00D		BRA $43CC
43DA	067D		MLH R6, R7
43DC	0784		MOVE R7, R8
43DE	086C		MHL R8, R6
43E0	F01D		BRA $43C4

43E2	7648		MOVB (R4), R6
43E4	2150		MOVE R1, $A0
43E6	3158		MOVE $B0, R1
43E8	7AD8		MOVB (R13), R10		; store character
43EA	FD02		SUB R13, #$03

			; Return
43EC	2452		MOVE R4, $A4
43EE	9401		CLR R4, #$01
43F0	3452		MOVE $A4, R4
43F2	225A		MOVE R2, $B4		; restore R2
43F4	0824		MOVE R8, R2
43F6	2056		JMP ($00AC)		; return to caller

			; Input string with echo and editing
43F8	2E50		MOVE R14, $A0
43FA	2450		MOVE R4, $A0
43FC	AD03		ADD R13, #$04
43FE	DCD1		MOVE R12, (R13)+
4400	8102		LBI R1, #$02
4402	04CC		MHL R4, R12
4404	C411		SLT R4, R1
4406	A007		BRA $4410		; $08(R0)

4408	8143		LBI R1, #$43
440A	011D		MLH R1, R1
440C	8150		LBI R1, #$50
440E	0014		RET R1

4410	D7D8		MOVE R7, (R13)
4412	0874		MOVE R8, R7
4414	097C		MHL R9, R7
4416	C703		SZ R7
4418	A003		BRA $441E		; $04(R0)

441A	C90B		SNZ R9
441C	F015		BRA $4408		; -> -$16(R0)

441E	8A04		LBI R10, #$04
4420	C9A0		SLE R9, R10
4422	F01B		BRA $4408		; -> -$1C(R0)

4424	C9A2		SE R9, R10
4426	A003		BRA $442C		; $04(R0)

4428	C703		SZ R7
442A	F023		BRA $4408		; -> -$24(R0)

442C	0974		MOVE R9, R7
442E	0EC4		MOVE R14, R12
4430	05C4		MOVE R5, R12
4432	AD07		ADD R13, #$08
4434	D4D8		MOVE R4, (R13)
4436	0744		MOVE R7, R4
4438	0578		ADD R5, R7
443A	075C		MHL R7, R5
443C	077A		ADDH R7, R7
443E	057D		MLH R5, R7
4440	0E98		ADD R14, R9
4442	09EC		MHL R9, R14
4444	099A		ADDH R9, R9
4446	0E9D		MLH R14, R9
4448	FE00		SUB R14, #$01
444A	09EC		MHL R9, R14
444C	8106		LBI R1, #$06
444E	C911		SLT R9, R1
4450	F049		BRA $4408		; -> -$4A(R0)

4452	095C		MHL R9, R5
4454	8106		LBI R1, #$06
4456	C911		SLT R9, R1
4458	F051		BRA $4408		; -> -$52(R0)

445A	0744		MOVE R7, R4
445C	A700		ADD R7, #$01
445E	0A7C		MHL R10, R7
4460	0B8C		MHL R11, R8
4462	CAB0		SLE R10, R11
4464	F05D		BRA $4408		; -> -$5E(R0)

4466	CAB2		SE R10, R11
4468	A003		BRA $446E		; $04(R0)

446A	C780		SLE R7, R8
446C	F065		BRA $4408		; -> -$66(R0)

446E	1102		CTRL $1, #$02
4470	8149		LBI R1, #$49
4472	011D		MLH R1, R1
4474	81B0		LBI R1, #$B0
4476	0203		INC2 R2, R0
4478	0014		RET R1			; Call $49B0

447A	8104		LBI R1, #$04
447C	2F52		MOVE R15, $A4
447E	CF1F		SNBSH R15, R1
4480	A03D		BRA $44C0		; $3E(R0)

4482	0744		MOVE R7, R4
4484	A700		ADD R7, #$01
4486	2950		MOVE R9, $A0
4488	2A50		MOVE R10, $A0
448A	087C		MHL R8, R7
448C	C80B		SNZ R8
448E	A005		BRA $4496		; $06(R0)

4490	087C		MHL R8, R7
4492	C803		SZ R8
4494	A005		BRA $449C		; $06(R0)

4496	8163		LBI R1, #$63
4498	C718		SGT R7, R1
449A	A005		BRA $44A2		; $06(R0)

449C	A900		ADD R9, #$01
449E	F763		SUB R7, #$64
44A0	F011		BRA $4490		; -> -$12(R0)

44A2	8109		LBI R1, #$09
44A4	C718		SGT R7, R1
44A6	A005		BRA $44AE		; $06(R0)

44A8	AA00		ADD R10, #$01
44AA	F709		SUB R7, #$0A
44AC	F00B		BRA $44A2		; -> -$0C(R0)

44AE	A7EF		ADD R7, #$F0
44B0	A9EF		ADD R9, #$F0
44B2	AAEF		ADD R10, #$F0
44B4	8105		LBI R1, #$05
44B6	011D		MLH R1, R1
44B8	81FD		LBI R1, #$FD
44BA	7910		MOVB (R1)+, R9
44BC	7A10		MOVB (R1)+, R10
44BE	7718		MOVB (R1), R7
44C0	05C4		MOVE R5, R12
44C2	0744		MOVE R7, R4
44C4	0578		ADD R5, R7
44C6	075C		MHL R7, R5
44C8	077A		ADDH R7, R7
44CA	057D		MLH R5, R7
44CC	6658		MOVB R6, (R5)
44CE	8140		LBI R1, #$40
44D0	C612		SE R6, R1
44D2	A003		BRA $44D8		; $04(R0)

44D4	876D		LBI R7, #$6D
44D6	A001		BRA $44DA		; $02(R0)

44D8	8740		LBI R7, #$40		; Leerzeichen
44DA	0864		MOVE R8, R6
44DC	7758		MOVB (R5), R7		; schreibe Cursor (Blank)
44DE	8940		LBI R9, #$40
44E0	099D		MLH R9, R9
44E2	8900		LBI R9, #$00

44E4	2A58		MOVE R10, $B0
44E6	CA03		SZ R10
44E8	A00F		BRA $44FA		; $10(R0)

44EA	81FF		LBI R1, #$FF
44EC	F900		SUB R9, #$01
44EE	C917		SBSH R9, R1
44F0	F00D		BRA $44E4		; -> -$0E(R0)

44F2	067D		MLH R6, R7
44F4	0784		MOVE R7, R8
44F6	086C		MHL R8, R6
44F8	F01D		BRA $44DC		; -> -$1E(R0)

44FA	7658		MOVB (R5), R6
44FC	2750		MOVE R7, $A0
44FE	3758		MOVE $B0, R7
4500	8102		LBI R1, #$02
4502	CA17		SBSH R10, R1
4504	A091		BRA $4598		; $92(R0)

4506	2751		MOVE R7, $A2
4508	8120		LBI R1, #$20
450A	C716		SBC R7, R1
450C	A06D		BRA $457C		; $6E(R0)

450E	6F58		MOVB R15, (R5)
4510	2751		MOVE R7, $A2
4512	8102		LBI R1, #$02
4514	C71F		SNBSH R7, R1
4516	A047		BRA $4560		; $48(R0)

4518	870B		LBI R7, #$0B
451A	077D		MLH R7, R7
451C	87F5		LBI R7, #$F5
451E	8800		LBI R8, #$00
4520	088D		MLH R8, R8
4522	880E		LBI R8, #$0E
4524	4180		PUTB $1, (R8)+
4526	4184		PUTB $1, (R8)-
4528	F000		BRA $4529		; -> -$01(R0)

452A	017E		GETB R7, $1
452C	077D		MLH R7, R7
452E	0004		NOP
4530	017E		GETB R7, $1
4532	8800		LBI R8, #$00
4534	088D		MLH R8, R8
4536	880E		LBI R8, #$0E
4538	4180		PUTB $1, (R8)+
453A	4188		PUTB $1, (R8)
453C	F000		BRA $453D		; -> -$01(R0)

453E	018E		GETB R8, $1
4540	C80C		SNS R8
4542	A037		BRA $457C		; $38(R0)

4544	C8A2		SE R8, R10
4546	A00D		BRA $4556		; $0E(R0)

4548	0004		NOP
454A	018E		GETB R8, $1
454C	C8F2		SE R8, R15
454E	A009		BRA $455A		; $0A(R0)

4550	0004		NOP
4552	01AE		GETB R10, $1
4554	A025		BRA $457C		; $26(R0)

4556	018E		GETB R8, $1
4558	F000		BRA $4559		; -> -$01(R0)

455A	018E		GETB R8, $1
455C	0004		NOP
455E	F021		BRA $453E		; -> -$22(R0)

4560	276D		MOVE R7, $DA
4562	6870		MOVB R8, (R7)+
4564	C80C		SNS R8
4566	A013		BRA $457C		; $14(R0)

4568	C8A2		SE R8, R10
456A	A009		BRA $4576		; $0A(R0)

456C	6870		MOVB R8, (R7)+
456E	C8F2		SE R8, R15
4570	A005		BRA $4578		; $06(R0)

4572	6A78		MOVB R10, (R7)
4574	A005		BRA $457C		; $06(R0)

4576	A700		ADD R7, #$01
4578	A700		ADD R7, #$01
457A	F019		BRA $4562		; -> -$1A(R0)

457C	7A58		MOVB (R5), R10
457E	A400		ADD R4, #$01
4580	2A52		MOVE R10, $A4
4582	8104		LBI R1, #$04
4584	CA17		SBSH R10, R1
4586	A007		BRA $4590		; $08(R0)

4588	21FE		MOVE R1, $1FC
458A	6A18		MOVB R10, (R1)
458C	9A80		CLR R10, #$80
458E	7A18		MOVB (R1), R10

4590	8144		LBI R1, #$44
4592	011D		MLH R1, R1
4594	816E		LBI R1, #$6E
4596	0014		RET R1

4598	08A4		MOVE R8, R10
459A	8126		LBI R1, #$26
459C	CA19		SGE R10, R1
459E	A071		BRA $4612		; $72(R0)

45A0	8147		LBI R1, #$47
45A2	CA10		SLE R10, R1
45A4	F015		BRA $4590		; -> -$16(R0)

45A6	F825		SUB R8, #$26
45A8	0888		ADD R8, R8
45AA	0088		ADD R0, R8
45AC	A0A9		BRA $4658		; $AA(R0)
45AE	A053		BRA $4604		; $54(R0)
45B0	A03D		BRA $45F0		; $3E(R0)
45B2	A075		BRA $462A		; $76(R0)
45B4	F025		BRA $4590		; -> -$26(R0)
45B6	A061		BRA $461A		; $62(R0)
45B8	F029		BRA $4590		; -> -$2A(R0)
45BA	F02B		BRA $4590		; -> -$2C(R0)
45BC	A08F		BRA $464E		; $90(R0)
45BE	A079		BRA $463A		; $7A(R0)
45C0	A0A3		BRA $4666		; $A4(R0)
45C2	A0A1		BRA $4666		; $A2(R0)
45C4	A09F		BRA $4666		; $A0(R0)
45C6	A09D		BRA $4666		; $9E(R0)
45C8	A09B		BRA $4666		; $9C(R0)
45CA	A099		BRA $4666		; $9A(R0)
45CC	A097		BRA $4666		; $98(R0)
45CE	A095		BRA $4666		; $96(R0)
45D0	A093		BRA $4666		; $94(R0)
45D2	A091		BRA $4666		; $92(R0)
45D4	F057		BRA $457E		; -> -$58(R0)
45D6	F059		BRA $457E		; -> -$5A(R0)
45D8	A0CB		BRA $46A6		; $CC(R0)
45DA	A083		BRA $4660		; $84(R0)
45DC	A081		BRA $4660		; $82(R0)
45DE	A065		BRA $4646		; $66(R0)
45E0	A019		BRA $45FC		; $1A(R0)
45E2	A05D		BRA $4642		; $5E(R0)
45E4	A0A9		BRA $4690		; $AA(R0)
45E6	A0A7		BRA $4690		; $A8(R0)
45E8	F059		BRA $4590		; -> -$5A(R0)
45EA	A093		BRA $4680		; $94(R0)
45EC	A091		BRA $4680		; $92(R0)
45EE	F05F		BRA $4590		; -> -$60(R0)

45F0	8A4F		LBI R10, #$4F
45F2	8104		LBI R1, #$04
45F4	2752		MOVE R7, $A4
45F6	C717		SBSH R7, R1
45F8	A001		BRA $45FC		; $02(R0)

45FA	8ABF		LBI R10, #$BF
45FC	8145		LBI R1, #$45
45FE	011D		MLH R1, R1
4600	8106		LBI R1, #$06
4602	0014		RET R1

4604	8ABF		LBI R10, #$BF
4606	8104		LBI R1, #$04
4608	2752		MOVE R7, $A4
460A	C717		SBSH R7, R1
460C	F011		BRA $45FC		; -> -$12(R0)

460E	8A4F		LBI R10, #$4F
4610	F015		BRA $45FC		; -> -$16(R0)

4612	8147		LBI R1, #$47
4614	011D		MLH R1, R1
4616	813E		LBI R1, #$3E
4618	0014		RET R1

461A	8104		LBI R1, #$04
461C	2F52		MOVE R15, $A4
461E	CF1F		SNBSH R15, R1
4620	A003		BRA $4626		; $04(R0)

4622	8A5C		LBI R10, #$5C
4624	F029		BRA $45FC		; -> -$2A(R0)

4626	8AB6		LBI R10, #$B6
4628	F02D		BRA $45FC		; -> -$2E(R0)

462A	8104		LBI R1, #$04
462C	2F52		MOVE R15, $A4
462E	CF1F		SNBSH R15, R1
4630	A003		BRA $4636		; $04(R0)

4632	8A61		LBI R10, #$61
4634	F039		BRA $45FC		; -> -$3A(R0)

4636	8AB8		LBI R10, #$B8
4638	F03D		BRA $45FC		; -> -$3E(R0)

463A	8147		LBI R1, #$47
463C	011D		MLH R1, R1
463E	810E		LBI R1, #$0E
4640	0014		RET R1

4642	8A40		LBI R10, #$40
4644	F049		BRA $45FC		; -> -$4A(R0)

4646	8146		LBI R1, #$46
4648	011D		MLH R1, R1
464A	81E0		LBI R1, #$E0
464C	0014		RET R1

464E	8120		LBI R1, #$20
4650	FD05		SUB R13, #$06
4652	71D8		MOVB (R13), R1
4654	AD05		ADD R13, #$06
4656	A01F		BRA $4678		; $20(R0)

4658	2861		MOVE R8, $C2
465A	0203		INC2 R2, R0
465C	2056		JMP ($00AC)

465E	F0CF		BRA $4590		; -> -$D0(R0)

4660	F400		SUB R4, #$01
4662	F500		SUB R5, #$01
4664	F0D5		BRA $4590		; -> -$D6(R0)

4666	8104		LBI R1, #$04
4668	2F52		MOVE R15, $A4
466A	CF1F		SNBSH R15, R1
466C	A0C7		BRA $4736		; $C8(R0)

466E	9AF0		CLR R10, #$F0
4670	54D8		MOVE (R13), R4
4672	FD05		SUB R13, #$06
4674	7AD8		MOVB (R13), R10
4676	AD05		ADD R13, #$06
4678	8148		LBI R1, #$48
467A	011D		MLH R1, R1
467C	8106		LBI R1, #$06
467E	0014		RET R1

4680	FD04		SUB R13, #$05
4682	68D8		MOVB R8, (R13)
4684	AD04		ADD R13, #$05
4686	8180		LBI R1, #$80
4688	C81A		SNE R8, R1
468A	A0A9		BRA $4736		; $AA(R0)

468C	8840		LBI R8, #$40
468E	A00D		BRA $469E		; $0E(R0)

4690	FD04		SUB R13, #$05
4692	68D8		MOVB R8, (R13)
4694	AD04		ADD R13, #$05
4696	8180		LBI R1, #$80
4698	C81A		SNE R8, R1
469A	A099		BRA $4736		; $9A(R0)

469C	8880		LBI R8, #$80
469E	FD05		SUB R13, #$06
46A0	78D8		MOVB (R13), R8
46A2	AD05		ADD R13, #$06
46A4	F02D		BRA $4678		; -> -$2E(R0)

46A6	07E4		MOVE R7, R14
46A8	F700		SUB R7, #$01
46AA	D878		MOVE R8, (R7)
46AC	8140		LBI R1, #$40
46AE	C812		SE R8, R1
46B0	A083		BRA $4736		; $84(R0)

46B2	FD07		SUB R13, #$08
46B4	D8D8		MOVE R8, (R13)
46B6	AD07		ADD R13, #$08
46B8	F800		SUB R8, #$01
46BA	C842		SE R8, R4
46BC	A007		BRA $46C6		; $08(R0)

46BE	098C		MHL R9, R8
46C0	0A4C		MHL R10, R4
46C2	C9AA		SNE R9, R10
46C4	A06F		BRA $4736		; $70(R0)

46C6	6970		MOVB R9, (R7)+
46C8	7975		MOVB (R7)--, R9
46CA	F800		SUB R8, #$01
46CC	098C		MHL R9, R8
46CE	0A4C		MHL R10, R4
46D0	C9A2		SE R9, R10
46D2	F00D		BRA $46C6		; -> -$0E(R0)

46D4	C489		SGE R4, R8
46D6	F011		BRA $46C6		; -> -$12(R0)

46D8	A700		ADD R7, #$01
46DA	8140		LBI R1, #$40
46DC	7178		MOVB (R7), R1
46DE	A055		BRA $4736		; $56(R0)

46E0	FD07		SUB R13, #$08
46E2	D7D8		MOVE R7, (R13)
46E4	AD07		ADD R13, #$08
46E6	F700		SUB R7, #$01
46E8	C742		SE R7, R4
46EA	A007		BRA $46F4		; $08(R0)

46EC	087C		MHL R8, R7
46EE	094C		MHL R9, R4
46F0	C89A		SNE R8, R9
46F2	A013		BRA $4708		; $14(R0)

46F4	A500		ADD R5, #$01
46F6	6854		MOVB R8, (R5)-
46F8	7850		MOVB (R5)+, R8
46FA	F700		SUB R7, #$01
46FC	087C		MHL R8, R7
46FE	094C		MHL R9, R4
4700	C892		SE R8, R9
4702	F00F		BRA $46F4		; -> -$10(R0)

4704	C479		SGE R4, R7
4706	F013		BRA $46F4		; -> -$14(R0)

4708	8140		LBI R1, #$40
470A	7154		MOVB (R5)-, R1
470C	A027		BRA $4736		; $28(R0)

470E	FD07		SUB R13, #$08
4710	D7D8		MOVE R7, (R13)
4712	AD07		ADD R13, #$08
4714	2F52		MOVE R15, $A4
4716	8104		LBI R1, #$04
4718	CF17		SBSH R15, R1
471A	A007		BRA $4724		; $08(R0)

471C	2FFE		MOVE R15, $1FC
471E	61F8		MOVB R1, (R15)
4720	B180		SET R1, #$80
4722	71F8		MOVB (R15), R1
4724	8140		LBI R1, #$40
4726	7150		MOVB (R5)+, R1
4728	F700		SUB R7, #$01
472A	087C		MHL R8, R7
472C	094C		MHL R9, R4
472E	C892		SE R8, R9
4730	F00D		BRA $4724		; -> -$0E(R0)

4732	C479		SGE R4, R7
4734	F011		BRA $4724		; -> -$12(R0)

4736	8144		LBI R1, #$44
4738	011D		MLH R1, R1
473A	816E		LBI R1, #$6E
473C	0014		RET R1

473E	103F		CTRL $0, #$3F
4740	8104		LBI R1, #$04
4742	2F52		MOVE R15, $A4
4744	CF1F		SNBSH R15, R1
4746	A003		BRA $474C		; $04(R0)

4748	1108		CTRL $1, #$08
474A	A001		BRA $474E		; $02(R0)

474C	1104		CTRL $1, #$04
474E	FD03		SUB R13, #$04
4750	D7D8		MOVE R7, (R13)
4752	AD03		ADD R13, #$04
4754	C703		SZ R7
4756	A005		BRA $475E		; $06(R0)

4758	087C		MHL R8, R7
475A	C80B		SNZ R8
475C	A09B		BRA $47FA		; $9C(R0)

475E	8800		LBI R8, #$00
4760	088D		MLH R8, R8
4762	880E		LBI R8, #$0E
4764	4180		PUTB $1, (R8)+
4766	4188		PUTB $1, (R8)
4768	F000		BRA $4769		; -> -$01(R0)

476A	018E		GETB R8, $1
476C	C80C		SNS R8
476E	A089		BRA $47FA		; $8A(R0)

4770	C8A2		SE R8, R10
4772	A03F		BRA $47B4		; $40(R0)

4774	018E		GETB R8, $1
4776	C80B		SNZ R8
4778	A049		BRA $47C4		; $4A(R0)

477A	0004		NOP
477C	019E		GETB R9, $1
477E	099D		MLH R9, R9
4780	0004		NOP
4782	019E		GETB R9, $1
4784	8A00		LBI R10, #$00
4786	0AAD		MLH R10, R10
4788	8A12		LBI R10, #$12
478A	41A0		PUTB $1, (R10)+
478C	41A8		PUTB $1, (R10)
478E	F000		BRA $478F		; -> -$01(R0)

4790	01AE		GETB R10, $1
4792	7A58		MOVB (R5), R10
4794	A400		ADD R4, #$01
4796	8149		LBI R1, #$49
4798	011D		MLH R1, R1
479A	81B0		LBI R1, #$B0
479C	0203		INC2 R2, R0
479E	0014		RET R1

47A0	05C4		MOVE R5, R12
47A2	0744		MOVE R7, R4
47A4	0578		ADD R5, R7
47A6	075C		MHL R7, R5
47A8	077A		ADDH R7, R7
47AA	057D		MLH R5, R7
47AC	F800		SUB R8, #$01
47AE	C803		SZ R8
47B0	F021		BRA $4790		; -> -$22(R0)

47B2	A045		BRA $47FA		; $46(R0)

47B4	A702		ADD R7, #$03
47B6	8800		LBI R8, #$00
47B8	088D		MLH R8, R8
47BA	880E		LBI R8, #$0E
47BC	4180		PUTB $1, (R8)+
47BE	4188		PUTB $1, (R8)
47C0	0004		NOP
47C2	F059		BRA $476A		; -> -$5A(R0)

47C4	018E		GETB R8, $1
47C6	088D		MLH R8, R8
47C8	0004		NOP
47CA	018E		GETB R8, $1
47CC	F000		BRA $47CD		; -> -$01(R0)

47CE	019E		GETB R9, $1
47D0	099D		MLH R9, R9
47D2	0004		NOP
47D4	019E		GETB R9, $1
47D6	6A98		MOVB R10, (R9)
47D8	6B80		MOVB R11, (R8)+
47DA	7B58		MOVB (R5), R11
47DC	A400		ADD R4, #$01
47DE	8149		LBI R1, #$49
47E0	011D		MLH R1, R1
47E2	81B0		LBI R1, #$B0
47E4	0203		INC2 R2, R0
47E6	0014		RET R1

47E8	05C4		MOVE R5, R12
47EA	0744		MOVE R7, R4
47EC	0578		ADD R5, R7
47EE	075C		MHL R7, R5
47F0	077A		ADDH R7, R7
47F2	057D		MLH R5, R7
47F4	FA00		SUB R10, #$01
47F6	CA03		SZ R10
47F8	F021		BRA $47D8		; -> -$22(R0)

47FA	1102		CTRL $1, #$02
47FC	105F		CTRL $0, #$5F
47FE	8144		LBI R1, #$44
4800	011D		MLH R1, R1
4802	816E		LBI R1, #$6E
4804	0014		RET R1

4806	2E52		MOVE R14, $A4
4808	9E01		CLR R14, #$01
480A	3E52		MOVE $A4, R14
480C	54D8		MOVE (R13), R4
480E	225A		MOVE R2, $B4
4810	0824		MOVE R8, R2
4812	2056		JMP ($00AC)

4814	2151		MOVE R1, $A2
4816	B102		SET R1, #$02
4818	3151		MOVE $A2, R1
481A	215F		MOVE R1, $BE
481C	5211		MOVE (R1)+, R2
481E	5311		MOVE (R1)+, R3
4820	5411		MOVE (R1)+, R4
4822	5511		MOVE (R1)+, R5
4824	5611		MOVE (R1)+, R6
4826	5711		MOVE (R1)+, R7
4828	5811		MOVE (R1)+, R8
482A	5911		MOVE (R1)+, R9
482C	5A11		MOVE (R1)+, R10
482E	5B11		MOVE (R1)+, R11
4830	5C11		MOVE (R1)+, R12
4832	5D11		MOVE (R1)+, R13
4834	5E11		MOVE (R1)+, R14
4836	5F18		MOVE (R1), R15
4838	A007		BRA $4842		; $08(R0)

483A	2151		MOVE R1, $A2
483C	B103		SET R1, #$03
483E	3151		MOVE $A2, R1
4840	325E		MOVE $BC, R2

4842	8149		LBI R1, #$49
4844	011D		MLH R1, R1
4846	8134		LBI R1, #$34
4848	0203		INC2 R2, R0
484A	0014		RET R1

484C	2D5F		MOVE R13, $BE
484E	AD6B		ADD R13, #$6C
4850	8105		LBI R1, #$05
4852	011D		MLH R1, R1
4854	8100		LBI R1, #$00
4856	51D1		MOVE (R13)+, R1
4858	8102		LBI R1, #$02
485A	011D		MLH R1, R1
485C	8100		LBI R1, #$00
485E	51D1		MOVE (R13)+, R1
4860	8102		LBI R1, #$02
4862	011D		MLH R1, R1
4864	8100		LBI R1, #$00
4866	0614		MOVE R6, R1
4868	07D4		MOVE R7, R13
486A	51D1		MOVE (R13)+, R1
486C	011D		MLH R1, R1
486E	8140		LBI R1, #$40
4870	51D1		MOVE (R13)+, R1
4872	8101		LBI R1, #$01
4874	51D1		MOVE (R13)+, R1
4876	8100		LBI R1, #$00
4878	011D		MLH R1, R1
487A	51D1		MOVE (R13)+, R1
487C	51D8		MOVE (R13), R1
487E	8810		LBI R8, #$10
4880	215F		MOVE R1, $BE
4882	A15F		ADD R1, #$60
4884	5611		MOVE (R1)+, R6
4886	5711		MOVE (R1)+, R7
4888	5D11		MOVE (R1)+, R13
488A	5818		MOVE (R1), R8
488C	2D5F		MOVE R13, $BE
488E	AD6B		ADD R13, #$6C
4890	03D4		MOVE R3, R13
4892	2862		MOVE R8, $C4
4894	0203		INC2 R2, R0
4896	2056		JMP ($00AC)

4898	A091		BRA $492C		; $92(R0)

489A	246C		MOVE R4, $D8
489C	A413		ADD R4, #$14
489E	D548		MOVE R5, (R4)
48A0	065C		MHL R6, R5
48A2	C603		SZ R6
48A4	A005		BRA $48AC		; $06(R0)

48A6	0D34		MOVE R13, R3
48A8	AD0B		ADD R13, #$0C
48AA	A073		BRA $4920		; $74(R0)

48AC	2805		MOVE R8, $0A
48AE	0203		INC2 R2, R0
48B0	2056		JMP ($00AC)

48B2	2862		MOVE R8, $C4
48B4	0203		INC2 R2, R0
48B6	2056		JMP ($00AC)

48B8	A071		BRA $492C		; $72(R0)

48BA	1077		CTRL $0, #$77
48BC	215F		MOVE R1, $BE
48BE	A15F		ADD R1, #$60
48C0	D611		MOVE R6, (R1)+
48C2	D711		MOVE R7, (R1)+
48C4	DD11		MOVE R13, (R1)+
48C6	D818		MOVE R8, (R1)
48C8	D9D8		MOVE R9, (R13)
48CA	C903		SZ R9
48CC	A059		BRA $4928		; $5A(R0)

48CE	F800		SUB R8, #$01
48D0	C80B		SNZ R8
48D2	A005		BRA $48DA		; $06(R0)

48D4	A63F		ADD R6, #$40
48D6	5678		MOVE (R7), R6
48D8	F059		BRA $4880		; -> -$5A(R0)

48DA	8149		LBI R1, #$49
48DC	011D		MLH R1, R1
48DE	8134		LBI R1, #$34
48E0	0203		INC2 R2, R0
48E2	0014		RET R1

48E4	144A		CTRL $4, #$4A
48E6	2451		MOVE R4, $A2
48E8	8101		LBI R1, #$01
48EA	C416		SBC R4, R1
48EC	A025		BRA $4914		; $26(R0)

48EE	215F		MOVE R1, $BE
48F0	D211		MOVE R2, (R1)+
48F2	D311		MOVE R3, (R1)+
48F4	D411		MOVE R4, (R1)+
48F6	D511		MOVE R5, (R1)+
48F8	D611		MOVE R6, (R1)+
48FA	D711		MOVE R7, (R1)+
48FC	D811		MOVE R8, (R1)+
48FE	D911		MOVE R9, (R1)+
4900	DA11		MOVE R10, (R1)+
4902	DB11		MOVE R11, (R1)+
4904	DC11		MOVE R12, (R1)+
4906	DD11		MOVE R13, (R1)+
4908	DE11		MOVE R14, (R1)+
490A	DF18		MOVE R15, (R1)

490C	2151		MOVE R1, $A2
490E	9106		CLR R1, #$06
4910	3151		MOVE $A2, R1
4912	0024		RET R2
; ----------

4914	2151		MOVE R1, $A2
4916	9107		CLR R1, #$07
4918	3151		MOVE $A2, R1
491A	225E		MOVE R2, $BC
491C	0824		MOVE R8, R2
491E	2056		JMP ($00AC)

4920	86F1		LBI R6, #$F1
4922	066D		MLH R6, R6
4924	86F3		LBI R6, #$F3
4926	56D8		MOVE (R13), R6
4928	235F		MOVE R3, $BE
492A	A36B		ADD R3, #$6C
492C	287D		MOVE R8, $FA
492E	0203		INC2 R2, R0
4930	2056		JMP ($00AC)

4932	F04F		BRA $48E4		; -> -$50(R0)

4934	335D		MOVE $BA, R3
4936	325C		MOVE $B8, R2
4938	2D5F		MOVE R13, $BE
493A	AD6B		ADD R13, #$6C
493C	03D4		MOVE R3, R13
493E	8505		LBI R5, #$05
4940	055D		MLH R5, R5
4942	8500		LBI R5, #$00
4944	55D1		MOVE (R13)+, R5
4946	2550		MOVE R5, $A0
4948	8609		LBI R6, #$09
494A	55D1		MOVE (R13)+, R5
494C	F600		SUB R6, #$01
494E	C603		SZ R6
4950	F007		BRA $494A		; -> -$08(R0)

4952	235F		MOVE R3, $BE
4954	A36B		ADD R3, #$6C
4956	246C		MOVE R4, $D8
4958	A413		ADD R4, #$14
495A	D548		MOVE R5, (R4)
495C	065C		MHL R6, R5
495E	C603		SZ R6
4960	A013		BRA $4976		; $14(R0)

4962	0D34		MOVE R13, R3
4964	AD0B		ADD R13, #$0C
4966	81F1		LBI R1, #$F1
4968	011D		MLH R1, R1
496A	81F3		LBI R1, #$F3
496C	51D8		MOVE (R13), R1
496E	287D		MOVE R8, $FA
4970	0203		INC2 R2, R0
4972	2056		JMP ($00AC)

4974	A02D		BRA $49A4		; $2E(R0)

4976	2805		MOVE R8, $0A
4978	0203		INC2 R2, R0
497A	2056		JMP ($00AC)

497C	0D34		MOVE R13, R3
497E	AD0B		ADD R13, #$0C
4980	D5D8		MOVE R5, (R13)
4982	C50B		SNZ R5
4984	A015		BRA $499C		; $16(R0)

4986	2651		MOVE R6, $A2
4988	8102		LBI R1, #$02
498A	C616		SBC R6, R1
498C	F01F		BRA $496E		; -> -$20(R0)

498E	81F1		LBI R1, #$F1
4990	C512		SE R5, R1
4992	F025		BRA $496E		; -> -$26(R0)

4994	055C		MHL R5, R5
4996	81F5		LBI R1, #$F5
4998	C512		SE R5, R1
499A	F02D		BRA $496E		; -> -$2E(R0)

499C	2862		MOVE R8, $C4
499E	0203		INC2 R2, R0
49A0	2056		JMP ($00AC)

49A2	F035		BRA $496E		; -> -$36(R0)

49A4	2D5D		MOVE R13, $BA
49A6	235D		MOVE R3, $BA
49A8	1442		CTRL $4, #$42
49AA	225C		MOVE R2, $B8
49AC	1077		CTRL $0, #$77
49AE	0024		RET R2

49B0	FD07		SUB R13, #$08
49B2	D7D8		MOVE R7, (R13)
49B4	AD07		ADD R13, #$08
49B6	0944		MOVE R9, R4
49B8	0799		SUB R7, R9
49BA	097C		MHL R9, R7
49BC	077D		MLH R7, R7
49BE	079C		MHL R7, R9
49C0	0979		SUB R9, R7
49C2	077C		MHL R7, R7
49C4	079D		MLH R7, R9
49C6	097C		MHL R9, R7
49C8	0976		OR R9, R7
49CA	C903		SZ R9
49CC	A003		BRA $49D2		; $04(R0)

49CE	2450		MOVE R4, $A0
49D0	A00D		BRA $49E0		; $0E(R0)

49D2	074C		MHL R7, R4
49D4	C704		SS R7
49D6	A007		BRA $49E0		; $08(R0)

49D8	FD07		SUB R13, #$08
49DA	D4D8		MOVE R4, (R13)
49DC	AD07		ADD R13, #$08
49DE	F400		SUB R4, #$01

49E0	0024		RET R2
; ----------

49E2	0000		HALT
49E4	0000		HALT
49E6	0000		HALT
49E8	0000		HALT
49EA	0000		HALT
49EC	0000		HALT
49EE	0000		HALT
49F0	0000		HALT
49F2	0000		HALT
49F4	0000		HALT
49F6	0000		HALT
49F8	0000		HALT
49FA	0000		HALT
49FC	0000		HALT
49FE	0000		HALT
; ----------

; ******************************
; Device 5 (Printer) I/O Routine
; ******************************

4A00	3269		MOVE $D2, R2		; Save R2

4A02	0D33		INC2 R13, R3
4A04	6ED8		MOVB R14, (R13)		; IOCB_Cmd
4A06	8FE0		LBI R15, #$E0
4A08	AD0D		ADD R13, #$0E		; IOCB_Stat1

4A0A	6CD8		MOVB R12, (R13)
4A0C	8948		LBI R9, #$48
4A0E	CE0B		SNZ R14			; Sense ?
4A10	0C94		MOVE R12, R9		; Yes
4A12	CC92		SE R12, R9
4A14	A0B9		BRA $4AD0		; Error 02
4A16	7CD0		MOVB (R13)+, R12

4A18	6CD8		MOVB R12, (R13)
4A1A	8924		LBI R9, #$24
4A1C	CE0B		SNZ R14			; Sense ?
4A1E	0C94		MOVE R12, R9		; Yes
4A20	CC92		SE R12, R9
4A22	A0AB		BRA $4AD0		; Error 02
4A24	7CD8		MOVB (R13), R12		; IOCB_Stat1 is now $4824

4A26	CE03		SZ R14			; Sense ?
4A28	A03B		BRA $4A66		; No

			; Sense

4A2A	2862		MOVE R8, $C4
4A2C	0203		INC2 R2, R0
4A2E	2056		JMP ($00AC)
4A30	A003		BRA $4A36		; $04(R0)

4A32	2E50		MOVE R14, $A0
4A34	A02F		BRA $4A66		; $30(R0)

4A36	8FF0		LBI R15, #$F0
4A38	2C63		MOVE R12, $C6
4A3A	8180		LBI R1, #$80
4A3C	CC15		SBS R12, R1
4A3E	A08F		BRA $4AD0		; Jump to $50BC

4A40	2150		MOVE R1, $A0
4A42	3163		MOVE $C6, R1
4A44	8EF7		LBI R14, #$F7
4A46	0EED		MLH R14, R14
4A48	8EF1		LBI R14, #$F1
4A4A	0D34		MOVE R13, R3
4A4C	AD0B		ADD R13, #$0C
4A4E	5ED3		MOVE (R13)++, R14	; IOCB_Ret
4A50	1F10		CTRL $F, #$10
4A52	2D23		MOVE R13, $46		; R3L2
4A54	6ED8		MOVB R14, (R13)
4A56	8105		LBI R1, #$05
4A58	CE12		SE R14, R1
4A5A	A007		BRA $4A64		; $08(R0)

4A5C	AD0F		ADD R13, #$10
4A5E	DED8		MOVE R14, (R13)
4A60	9E10		CLR R14, #$10
4A62	5ED8		MOVE (R13), R14
4A64	2E50		MOVE R14, $A0

			; Command other than Sense
			
4A66	8FE8		LBI R15, #$E8
4A68	05AE		GETB R10, $5		; Status byte A
4A6A	CA0C		SNS R10			; Printer there ?
4A6C	A061		BRA $4AD0		; No, error 13

4A6E	8D00		LBI R13, #$00
4A70	0DDD		MLH R13, R13
4A72	8DA4		LBI R13, #$A4
4A74	6CD8		MOVB R12, (R13)
4A76	BC02		SET R12, #$02
4A78	7CD0		MOVB (R13)+, R12	; Set I/O active flag
4A7A	6CD8		MOVB R12, (R13)
4A7C	BC08		SET R12, #$08		; Set printer busy flag
4A7E	9C20		CLR R12, #$20		; Level 2 RWS
4A80	7CD8		MOVB (R13), R12
4A82	40D8		PUTB $0, (R13)

4A84	05AE		GETB R10, $5		; Status byte A
4A86	8110		LBI R1, #$10		; Wire check or not ready
4A88	CA15		SBS R10, R1
4A8A	A00B		BRA $4A98		; $0C(R0)

4A8C	CE03		SZ R14			; Sense ?
4A8E	A007		BRA $4A98		; No

4A90	0203		INC2 R2, R0
4A92	A093		BRA $4B28		; $94(R0)

4A94	CE03		SZ R14
4A96	A02D		BRA $4AC6		; $2E(R0)

4A98	8F04		LBI R15, #$04
4A9A	E5DF		STAT R13, $5		; Status byte B
4A9C	8180		LBI R1, #$80		; Print motor latch B
4A9E	CD1D		SNBS R13, R1
4AA0	A023		BRA $4AC6		; $24(R0)

4AA2	8F10		LBI R15, #$10
4AA4	E5DF		STAT R13, $5
4AA6	8140		LBI R1, #$40		; Print motor latch A
4AA8	CD15		SBS R13, R1
4AAA	A019		BRA $4AC6		; $1A(R0)

4AAC	8F00		LBI R15, #$00
4AAE	8102		LBI R1, #$02		; Not end of forms
4AB0	CA15		SBS R10, R1
4AB2	A011		BRA $4AC6		; $12(R0)

4AB4	2C63		MOVE R12, $C6
4AB6	8140		LBI R1, #$40
4AB8	CC15		SBS R12, R1
4ABA	A01B		BRA $4AD8		; $1C(R0)

4ABC	8F38		LBI R15, #$38
4ABE	CE03		SZ R14
4AC0	A003		BRA $4AC6		; $04(R0)

4AC2	2C50		MOVE R12, $A0
4AC4	A011		BRA $4AD8		; $12(R0)

4AC6	3140		MOVE $80, R1
4AC8	8150		LBI R1, #$50
4ACA	011D		MLH R1, R1
4ACC	81A8		LBI R1, #$A8
4ACE	0014		RET R1

4AD0	8150		LBI R1, #$50
4AD2	011D		MLH R1, R1
4AD4	81BC		LBI R1, #$BC
4AD6	0014		RET R1

4AD8	CE03		SZ R14
4ADA	A007		BRA $4AE4		; $08(R0)

4ADC	BCB2		SET R12, #$B2
4ADE	9C01		CLR R12, #$01
4AE0	3C63		MOVE $C6, R12
4AE2	A0B5		BRA $4B9A		; $B6(R0)

4AE4	8D00		LBI R13, #$00
4AE6	0DDD		MLH R13, R13
4AE8	8DA2		LBI R13, #$A2
4AEA	D1D8		MOVE R1, (R13)
4AEC	B104		SET R1, #$04
4AEE	51D8		MOVE (R13), R1
4AF0	8103		LBI R1, #$03
4AF2	CE1A		SNE R14, R1
4AF4	A005		BRA $4AFC		; $06(R0)

4AF6	8102		LBI R1, #$02
4AF8	CE12		SE R14, R1
4AFA	A00B		BRA $4B08		; $0C(R0)

4AFC	BC88		SET R12, #$88
4AFE	3C63		MOVE $C6, R12
4B00	2C50		MOVE R12, $A0
4B02	8C0A		LBI R12, #$0A
4B04	3C40		MOVE $80, R12
4B06	A00F		BRA $4B18		; $10(R0)

4B08	810D		LBI R1, #$0D
4B0A	CE12		SE R14, R1
4B0C	A011		BRA $4B20		; $12(R0)

4B0E	BC84		SET R12, #$84
4B10	3C63		MOVE $C6, R12
4B12	2C50		MOVE R12, $A0
4B14	8C01		LBI R12, #$01
4B16	3C40		MOVE $80, R12
4B18	814C		LBI R1, #$4C
4B1A	011D		MLH R1, R1
4B1C	8170		LBI R1, #$70
4B1E	0014		RET R1

4B20	8FE0		LBI R15, #$E0
4B22	CE04		SS R14
4B24	F05F		BRA $4AC6		; -> -$60(R0)

4B26	F02B		BRA $4AFC		; -> -$2C(R0)

4B28	1F10		CTRL $F, #$10
4B2A	8E0F		LBI R14, #$0F
4B2C	2150		MOVE R1, $A0
4B2E	312B		MOVE $56, R1
4B30	814E		LBI R1, #$4E
4B32	312F		MOVE $5E, R1
4B34	8F30		LBI R15, #$30
4B36	0FFD		MLH R15, R15
4B38	8F00		LBI R15, #$00
4B3A	3F2E		MOVE $5C, R15
4B3C	0103		INC2 R1, R0
4B3E	A02D		BRA $4B6E		; $2E(R0)

4B40	0BAC		MHL R11, R10
4B42	05BE		GETB R11, $5
4B44	8132		LBI R1, #$32
4B46	8D01		LBI R13, #$01
4B48	CB1E		SNBC R11, R1
4B4A	CBD5		SBS R11, R13
4B4C	A015		BRA $4B64		; $16(R0)

4B4E	3E0F		MOVE $1E, R14
4B50	FF00		SUB R15, #$01
4B52	CF0B		SNZ R15
4B54	A005		BRA $4B5C		; $06(R0)

4B56	2B50		MOVE R11, $A0
4B58	1552		CTRL $5, #$52		; Reset timer interrupt
4B5A	F01B		BRA $4B40		; -> -$1C(R0)

4B5C	1551		CTRL $5, #$51		; Disable timer interrupts
4B5E	3F0E		MOVE $1C, R15
4B60	2B50		MOVE R11, $A0
4B62	1552		CTRL $5, #$52		; Reset timer interrupt
4B64	8F14		LBI R15, #$14
4B66	81FF		LBI R1, #$FF
4B68	310E		MOVE $1C, R1
4B6A	1F10		CTRL $F, #$10		; Reset printer
4B6C	0000		HALT
4B6E	3120		MOVE $40, R1
4B70	8A2C		LBI R10, #$2C
4B72	0AAD		MLH R10, R10
4B74	05AE		GETB R10, $5
4B76	3A2A		MOVE $54, R10
4B78	15D8		CTRL $5, #$D8		; Preset timer counter
4B7A	0004		NOP
4B7C	15D1		CTRL $5, #$D1		; Enable timer interrupts

4B7E	FF00		SUB R15, #$01
4B80	0DFC		MHL R13, R15
4B82	0DF6		OR R13, R15
4B84	CE0B		SNZ R14
4B86	0024		RET R2
4B88	CD03		SZ R13
4B8A	CE0C		SNS R14
4B8C	A001		BRA $4B90		; Exit loop
4B8E	F011		BRA $4B7E		; Loop

4B90	8F20		LBI R15, #$20
4B92	CE0C		SNS R14
4B94	2F2F		MOVE R15, $5E
4B96	8EFF		LBI R14, #$FF
4B98	0024		RET R2

4B9A	1F10		CTRL $F, #$10		; Reset printer
4B9C	0D34		MOVE R13, R3
4B9E	AD05		ADD R13, #$06
4BA0	2150		MOVE R1, $A0
4BA2	8184		LBI R1, #$84		; 132 characters/line
4BA4	51D8		MOVE (R13), R1		; preset IOCB_BS
4BA6	AD03		ADD R13, #$04
4BA8	2150		MOVE R1, $A0
4BAA	51D8		MOVE (R13), R1		; clear IOCB_WA
4BAC	0203		INC2 R2, R0
4BAE	A039		BRA $4BEA		; $3A(R0)

4BB0	8D77		LBI R13, #$77
4BB2	0DDD		MLH R13, R13
4BB4	3D7A		MOVE $F4, R13
4BB6	3D7B		MOVE $F6, R13
4BB8	3D64		MOVE $C8, R13
4BBA	2D50		MOVE R13, $A0
4BBC	3D79		MOVE $F2, R13
4BBE	8DFF		LBI R13, #$FF
4BC0	0DDD		MLH R13, R13
4BC2	8DD4		LBI R13, #$D4
4BC4	8101		LBI R1, #$01
4BC6	CA15		SBS R10, R1
4BC8	A00F		BRA $4BDA		; $10(R0)

4BCA	3D7A		MOVE $F4, R13
4BCC	2D45		MOVE R13, $8A
4BCE	BD84		SET R13, #$84
4BD0	3D45		MOVE $8A, R13
4BD2	2D24		MOVE R13, $48
4BD4	BD88		SET R13, #$88
4BD6	3D24		MOVE $48, R13
4BD8	A007		BRA $4BE2		; $08(R0)

4BDA	3D79		MOVE $F2, R13
4BDC	2D24		MOVE R13, $48
4BDE	BD84		SET R13, #$84
4BE0	3D24		MOVE $48, R13
4BE2	8151		LBI R1, #$51
4BE4	011D		MLH R1, R1
4BE6	814E		LBI R1, #$4E
4BE8	0014		RET R1

4BEA	0D34		MOVE R13, R3
4BEC	3D23		MOVE $46, R13
4BEE	AD0F		ADD R13, #$10
4BF0	DCD8		MOVE R12, (R13)
4BF2	BC10		SET R12, #$10
4BF4	5CD8		MOVE (R13), R12
4BF6	2D50		MOVE R13, $A0
4BF8	0CD4		MOVE R12, R13
4BFA	09D4		MOVE R9, R13
4BFC	89F6		LBI R9, #$F6
4BFE	8CEA		LBI R12, #$EA
4C00	5DC1		MOVE (R12)+, R13
4C02	CC98		SGT R12, R9
4C04	F005		BRA $4C00		; -> -$06(R0)

4C06	8C82		LBI R12, #$82
4C08	899E		LBI R9, #$9E
4C0A	5DC1		MOVE (R12)+, R13
4C0C	CC98		SGT R12, R9
4C0E	F005		BRA $4C0A		; -> -$06(R0)

4C10	8C48		LBI R12, #$48
4C12	895E		LBI R9, #$5E
4C14	5DC1		MOVE (R12)+, R13
4C16	CC98		SGT R12, R9
4C18	F005		BRA $4C14		; -> -$06(R0)

4C1A	8108		LBI R1, #$08
4C1C	0D1D		MLH R13, R1
4C1E	3D2B		MOVE $56, R13
4C20	05AE		GETB R10, $5
4C22	2540		MOVE R5, $80
4C24	2450		MOVE R4, $A0
4C26	0933		INC2 R9, R3
4C28	6C98		MOVB R12, (R9)
4C2A	CC0B		SNZ R12
4C2C	A009		BRA $4C38		; $0A(R0)

4C2E	0934		MOVE R9, R3
4C30	A908		ADD R9, #$09
4C32	6C98		MOVB R12, (R9)
4C34	CC03		SZ R12
4C36	B440		SET R4, #$40
4C38	E5CF		STAT R12, $5
4C3A	8120		LBI R1, #$20
4C3C	CC16		SBC R12, R1
4C3E	B480		SET R4, #$80
4C40	3424		MOVE $48, R4
4C42	0934		MOVE R9, R3
4C44	A901		ADD R9, #$02
4C46	D798		MOVE R7, (R9)
4C48	8101		LBI R1, #$01
4C4A	2E50		MOVE R14, $A0
4C4C	C716		SBC R7, R1
4C4E	BE10		SET R14, #$10
4C50	04ED		MLH R4, R14
4C52	8101		LBI R1, #$01
4C54	C51A		SNE R5, R1
4C56	A003		BRA $4C5C		; $04(R0)

4C58	2D50		MOVE R13, $A0
4C5A	A007		BRA $4C64		; $08(R0)

4C5C	0934		MOVE R9, R3
4C5E	A90D		ADD R9, #$0E
4C60	DD98		MOVE R13, (R9)
4C62	B401		SET R4, #$01
4C64	3445		MOVE $8A, R4
4C66	3446		MOVE $8C, R4
4C68	8C2E		LBI R12, #$2E
4C6A	3C47		MOVE $8E, R12
4C6C	0024		RET R2

4C6E	F08D		BRA $4BE2		; -> -$8E(R0)

4C70	0203		INC2 R2, R0
4C72	F089		BRA $4BEA		; -> -$8A(R0)

4C74	0934		MOVE R9, R3
4C76	A903		ADD R9, #$04
4C78	DE91		MOVE R14, (R9)+
4C7A	DF98		MOVE R15, (R9)
4C7C	09FC		MHL R9, R15
4C7E	01FC		MHL R1, R15
4C80	01F6		OR R1, R15
4C82	C10B		SNZ R1
4C84	A04D		BRA $4CD4		; $4E(R0)

4C86	0CEC		MHL R12, R14
4C88	09C8		ADD R9, R12
4C8A	0F9D		MLH R15, R9
4C8C	0FE8		ADD R15, R14
4C8E	FF00		SUB R15, #$01
4C90	0933		INC2 R9, R3
4C92	6C98		MOVB R12, (R9)
4C94	CC04		SS R12
4C96	A029		BRA $4CC2		; $2A(R0)

4C98	3E4C		MOVE $98, R14
4C9A	3F4D		MOVE $9A, R15
4C9C	A903		ADD R9, #$04
4C9E	DC98		MOVE R12, (R9)
4CA0	FC00		SUB R12, #$01
4CA2	09C4		MOVE R9, R12
4CA4	09C8		ADD R9, R12
4CA6	09C8		ADD R9, R12
4CA8	09C8		ADD R9, R12
4CAA	09C8		ADD R9, R12
4CAC	09C8		ADD R9, R12
4CAE	09C8		ADD R9, R12
4CB0	09C8		ADD R9, R12
4CB2	09C8		ADD R9, R12
4CB4	09C8		ADD R9, R12
4CB6	3949		MOVE $92, R9
4CB8	2945		MOVE R9, $8A
4CBA	B920		SET R9, #$20
4CBC	3945		MOVE $8A, R9
4CBE	3946		MOVE $8C, R9
4CC0	A0E1		BRA $4DA4		; $E2(R0)

4CC2	08E4		MOVE R8, R14
4CC4	0203		INC2 R2, R0
4CC6	A0E3		BRA $4DAC		; $E4(R0)

4CC8	A0A3		BRA $4D6E		; $A4(R0)

4CCA	0D58		ADD R13, R5
4CCC	AE00		ADD R14, #$01
4CCE	0203		INC2 R2, R0
4CD0	A0C7		BRA $4D9A		; $C8(R0)

4CD2	F011		BRA $4CC2		; -> -$12(R0)

4CD4	2145		MOVE R1, $8A
4CD6	2D46		MOVE R13, $8C
4CD8	0D16		OR R13, R1
4CDA	8142		LBI R1, #$42
4CDC	CD1E		SNBC R13, R1
4CDE	A07D		BRA $4D5E		; $7E(R0)

4CE0	0934		MOVE R9, R3
4CE2	A907		ADD R9, #$08
4CE4	DC98		MOVE R12, (R9)
4CE6	09CC		MHL R9, R12
4CE8	8180		LBI R1, #$80
4CEA	0915		AND R9, R1
4CEC	2150		MOVE R1, $A0
4CEE	0C1D		MLH R12, R1
4CF0	2124		MOVE R1, $48
4CF2	0D16		OR R13, R1
4CF4	8101		LBI R1, #$01
4CF6	CD16		SBC R13, R1
4CF8	A049		BRA $4D44		; $4A(R0)

4CFA	0133		INC2 R1, R3
4CFC	D118		MOVE R1, (R1)
4CFE	91FD		CLR R1, #$FD
4D00	C10B		SNZ R1
4D02	A003		BRA $4D08		; $04(R0)

4D04	0C9D		MLH R12, R9
4D06	A00D		BRA $4D16		; $0E(R0)

4D08	E0CF		SWAP R12
4D0A	810F		LBI R1, #$0F
4D0C	01C5		AND R1, R12
4D0E	0196		OR R1, R9
4D10	0C1D		MLH R12, R1
4D12	81F0		LBI R1, #$F0
4D14	0C15		AND R12, R1
4D16	3C42		MOVE $84, R12
4D18	8102		LBI R1, #$02
4D1A	CD15		SBS R13, R1
4D1C	A03F		BRA $4D5E		; $40(R0)

4D1E	8180		LBI R1, #$80
4D20	C916		SBC R9, R1
4D22	A01B		BRA $4D40		; $1C(R0)

4D24	09CC		MHL R9, R12
4D26	C903		SZ R9
4D28	A005		BRA $4D30		; $06(R0)

4D2A	8103		LBI R1, #$03
4D2C	CC18		SGT R12, R1
4D2E	A003		BRA $4D34		; $04(R0)

4D30	FC03		SUB R12, #$04
4D32	A027		BRA $4D5C		; $28(R0)

4D34	8180		LBI R1, #$80
4D36	0C1D		MLH R12, R1
4D38	0DC4		MOVE R13, R12
4D3A	8C04		LBI R12, #$04
4D3C	0CD9		SUB R12, R13
4D3E	A01B		BRA $4D5C		; $1C(R0)

4D40	AC03		ADD R12, #$04
4D42	A017		BRA $4D5C		; $18(R0)

4D44	0DC4		MOVE R13, R12
4D46	0C9D		MLH R12, R9
4D48	0CD8		ADD R12, R13
4D4A	0CD8		ADD R12, R13
4D4C	0CD8		ADD R12, R13
4D4E	0CD8		ADD R12, R13
4D50	0CD8		ADD R12, R13
4D52	0CD8		ADD R12, R13
4D54	0CD8		ADD R12, R13
4D56	0CD8		ADD R12, R13
4D58	0CD8		ADD R12, R13
4D5A	0CD8		ADD R12, R13
4D5C	3C42		MOVE $84, R12
4D5E	8101		LBI R1, #$01
4D60	CA15		SBS R10, R1
4D62	A005		BRA $4D6A		; $06(R0)

4D64	2D24		MOVE R13, $48
4D66	BD08		SET R13, #$08
4D68	3D24		MOVE $48, R13
4D6A	2450		MOVE R4, $A0
4D6C	F0FF		BRA $4C6E		; -> -$100(R0)

4D6E	0E84		MOVE R14, R8
4D70	3D48		MOVE $90, R13
4D72	3E4C		MOVE $98, R14
4D74	2945		MOVE R9, $8A
4D76	B920		SET R9, #$20
4D78	3945		MOVE $8A, R9
4D7A	3946		MOVE $8C, R9
4D7C	816D		LBI R1, #$6D
4D7E	094C		MHL R9, R4
4D80	CC1A		SNE R12, R1
4D82	B980		SET R9, #$80
4D84	049D		MLH R4, R9
4D86	0E84		MOVE R14, R8
4D88	3D49		MOVE $92, R13
4D8A	3E4D		MOVE $9A, R14
4D8C	0203		INC2 R2, R0
4D8E	A0C7		BRA $4E58		; $C8(R0)

4D90	A01F		BRA $4DB2		; $20(R0)

4D92	0E84		MOVE R14, R8
4D94	0D58		ADD R13, R5
4D96	AE00		ADD R14, #$01
4D98	0203		INC2 R2, R0
4D9A	A0D1		BRA $4E6E		; $D2(R0)

4D9C	A009		BRA $4DA8		; $0A(R0)

4D9E	2D46		MOVE R13, $8C
4DA0	9D01		CLR R13, #$01
4DA2	3D46		MOVE $8C, R13
4DA4	A077		BRA $4E1E		; $78(R0)

4DA6	F0D3		BRA $4CD4		; -> -$D4(R0)

4DA8	08E4		MOVE R8, R14
4DAA	0203		INC2 R2, R0
4DAC	A0AF		BRA $4E5E		; $B0(R0)

4DAE	F029		BRA $4D86		; -> -$2A(R0)

4DB0	F01F		BRA $4D92		; -> -$20(R0)

4DB2	3D4A		MOVE $94, R13
4DB4	3E4E		MOVE $9C, R14
4DB6	2946		MOVE R9, $8C
4DB8	8108		LBI R1, #$08
4DBA	C417		SBSH R4, R1
4DBC	A00F		BRA $4DCE		; $10(R0)

4DBE	079C		MHL R7, R9
4DC0	B740		SET R7, #$40
4DC2	097D		MLH R9, R7
4DC4	2145		MOVE R1, $8A
4DC6	071C		MHL R7, R1
4DC8	B740		SET R7, #$40
4DCA	017D		MLH R1, R7
4DCC	3145		MOVE $8A, R1
4DCE	8101		LBI R1, #$01
4DD0	C415		SBS R4, R1
4DD2	B942		SET R9, #$42
4DD4	3946		MOVE $8C, R9
4DD6	3D4B		MOVE $96, R13
4DD8	3E4F		MOVE $9E, R14
4DDA	094C		MHL R9, R4
4DDC	9940		CLR R9, #$40
4DDE	8108		LBI R1, #$08
4DE0	C916		SBC R9, R1
4DE2	B940		SET R9, #$40
4DE4	049D		MLH R4, R9
4DE6	0D58		ADD R13, R5
4DE8	0E84		MOVE R14, R8
4DEA	AE00		ADD R14, #$01
4DEC	0203		INC2 R2, R0
4DEE	A07D		BRA $4E6E		; $7E(R0)

4DF0	A047		BRA $4E3A		; $48(R0)

4DF2	2D4B		MOVE R13, $96
4DF4	0D58		ADD R13, R5
4DF6	FD00		SUB R13, #$01
4DF8	3D4B		MOVE $96, R13
4DFA	2D46		MOVE R13, $8C
4DFC	2C45		MOVE R12, $8A
4DFE	8180		LBI R1, #$80
4E00	C417		SBSH R4, R1
4E02	A003		BRA $4E08		; $04(R0)

4E04	BC02		SET R12, #$02
4E06	9D02		CLR R13, #$02
4E08	8140		LBI R1, #$40
4E0A	C417		SBSH R4, R1
4E0C	A00B		BRA $4E1A		; $0C(R0)

4E0E	09CC		MHL R9, R12
4E10	B908		SET R9, #$08
4E12	0C9D		MLH R12, R9
4E14	09DC		MHL R9, R13
4E16	B908		SET R9, #$08
4E18	0D9D		MLH R13, R9
4E1A	3D46		MOVE $8C, R13
4E1C	3C45		MOVE $8A, R12
4E1E	2D49		MOVE R13, $92
4E20	0D58		ADD R13, R5
4E22	FD00		SUB R13, #$01
4E24	3D49		MOVE $92, R13
4E26	2D2B		MOVE R13, $56
4E28	0CDC		MHL R12, R13
4E2A	8106		LBI R1, #$06
4E2C	CC1D		SNBS R12, R1
4E2E	BC40		SET R12, #$40
4E30	0DCD		MLH R13, R12
4E32	3D2B		MOVE $56, R13
4E34	0203		INC2 R2, R0
4E36	A03D		BRA $4E76		; $3E(R0)

4E38	F093		BRA $4DA6		; -> -$94(R0)

4E3A	08E4		MOVE R8, R14
4E3C	0203		INC2 R2, R0
4E3E	A01D		BRA $4E5E		; $1E(R0)

4E40	A001		BRA $4E44		; $02(R0)

4E42	F05D		BRA $4DE6		; -> -$5E(R0)

4E44	0E84		MOVE R14, R8
4E46	3D49		MOVE $92, R13
4E48	3E4D		MOVE $9A, R14
4E4A	816D		LBI R1, #$6D
4E4C	CC1A		SNE R12, R1
4E4E	A005		BRA $4E56		; $06(R0)

4E50	014C		MHL R1, R4
4E52	9180		CLR R1, #$80
4E54	041D		MLH R4, R1
4E56	0203		INC2 R2, R0
4E58	A00B		BRA $4E66		; $0C(R0)

4E5A	F085		BRA $4DD6		; -> -$86(R0)

4E5C	F077		BRA $4DE6		; -> -$78(R0)

4E5E	815A		LBI R1, #$5A
4E60	011D		MLH R1, R1
4E62	81EA		LBI R1, #$EA
4E64	0014		RET R1

4E66	815B		LBI R1, #$5B
4E68	011D		MLH R1, R1
4E6A	8134		LBI R1, #$34
4E6C	0014		RET R1

4E6E	815C		LBI R1, #$5C
4E70	011D		MLH R1, R1
4E72	8162		LBI R1, #$62
4E74	0014		RET R1

4E76	3276		MOVE $EC, R2
4E78	8500		LBI R5, #$00
4E7A	055D		MLH R5, R5
4E7C	85F2		LBI R5, #$F2
4E7E	8D77		LBI R13, #$77
4E80	0DDD		MLH R13, R13
4E82	3D7B		MOVE $F6, R13
4E84	8611		LBI R6, #$11
4E86	8707		LBI R7, #$07
4E88	8180		LBI R1, #$80
4E8A	C416		SBC R4, R1
4E8C	861A		LBI R6, #$1A
4E8E	2848		MOVE R8, $90
4E90	0869		SUB R8, R6
4E92	2949		MOVE R9, $92
4E94	0968		ADD R9, R6
4E96	0E84		MOVE R14, R8
4E98	0F94		MOVE R15, R9
4E9A	0DFC		MHL R13, R15
4E9C	0CEC		MHL R12, R14
4E9E	0DC8		ADD R13, R12
4EA0	0FDD		MLH R15, R13
4EA2	0FE8		ADD R15, R14
4EA4	2E50		MOVE R14, $A0
4EA6	0EFC		MHL R14, R15
4EA8	E0EC		SHR R14
4EAA	E0FC		SHR R15
4EAC	0FED		MLH R15, R14
4EAE	0EF4		MOVE R14, R15
4EB0	2F64		MOVE R15, $C8
4EB2	0203		INC2 R2, R0
4EB4	A0A9		BRA $4F60		; $AA(R0)

4EB6	A095		BRA $4F4E		; $96(R0)

4EB8	8EFF		LBI R14, #$FF
4EBA	0EED		MLH R14, R14
4EBC	8EFD		LBI R14, #$FD
4EBE	0203		INC2 R2, R0
4EC0	A09D		BRA $4F60		; $9E(R0)

4EC2	A001		BRA $4EC6		; $02(R0)

4EC4	A06D		BRA $4F34		; $6E(R0)

4EC6	0EF4		MOVE R14, R15
4EC8	0F84		MOVE R15, R8
4ECA	0203		INC2 R2, R0
4ECC	A091		BRA $4F60		; $92(R0)

4ECE	A063		BRA $4F34		; $64(R0)

4ED0	2D24		MOVE R13, $48
4ED2	BD04		SET R13, #$04
4ED4	3D24		MOVE $48, R13
4ED6	2D46		MOVE R13, $8C
4ED8	BD04		SET R13, #$04
4EDA	3D46		MOVE $8C, R13
4EDC	5851		MOVE (R5)+, R8
4EDE	8103		LBI R1, #$03
4EE0	CD16		SBC R13, R1
4EE2	A005		BRA $4EEA		; $06(R0)

4EE4	0979		SUB R9, R7
4EE6	5958		MOVE (R5), R9
4EE8	A037		BRA $4F22		; $38(R0)

4EEA	2F4B		MOVE R15, $96
4EEC	0F68		ADD R15, R6
4EEE	0F79		SUB R15, R7
4EF0	2E49		MOVE R14, $92
4EF2	0203		INC2 R2, R0
4EF4	A069		BRA $4F60		; $6A(R0)

4EF6	A003		BRA $4EFC		; $04(R0)

4EF8	5E51		MOVE (R5)+, R14
4EFA	A003		BRA $4F00		; $04(R0)

4EFC	5F51		MOVE (R5)+, R15
4EFE	2E48		MOVE R14, $90
4F00	2F4A		MOVE R15, $94
4F02	0DF4		MOVE R13, R15
4F04	CED2		SE R14, R13
4F06	A00B		BRA $4F14		; $0C(R0)

4F08	0EEC		MHL R14, R14
4F0A	0DDC		MHL R13, R13
4F0C	CED2		SE R14, R13
4F0E	A003		BRA $4F14		; $04(R0)

4F10	5858		MOVE (R5), R8
4F12	A001		BRA $4F16		; $02(R0)

4F14	5F58		MOVE (R5), R15
4F16	2F4A		MOVE R15, $94
4F18	2E4B		MOVE R14, $96
4F1A	AF01		ADD R15, #$02
4F1C	AE01		ADD R14, #$02
4F1E	3F4A		MOVE $94, R15
4F20	3E4B		MOVE $96, R14
4F22	0203		INC2 R2, R0
4F24	A0C5		BRA $4FEC		; $C6(R0)

4F26	2F48		MOVE R15, $90
4F28	2E49		MOVE R14, $92
4F2A	FF00		SUB R15, #$01
4F2C	FE00		SUB R14, #$01
4F2E	3F48		MOVE $90, R15
4F30	3E49		MOVE $92, R14
4F32	A0D9		BRA $500E		; $DA(R0)

4F34	2F45		MOVE R15, $8A
4F36	3F24		MOVE $48, R15
4F38	2F46		MOVE R15, $8C
4F3A	BF04		SET R15, #$04
4F3C	3F45		MOVE $8A, R15
4F3E	8103		LBI R1, #$03
4F40	CF16		SBC R15, R1
4F42	F059		BRA $4EEA		; -> -$5A(R0)

4F44	0979		SUB R9, R7
4F46	5953		MOVE (R5)++, R9
4F48	DD58		MOVE R13, (R5)
4F4A	3D7A		MOVE $F4, R13
4F4C	F02B		BRA $4F22		; -> -$2C(R0)

4F4E	0E94		MOVE R14, R9
4F50	0203		INC2 R2, R0
4F52	A00B		BRA $4F60		; $0C(R0)

4F54	A06F		BRA $4FC6		; $70(R0)

4F56	0EF4		MOVE R14, R15
4F58	8F05		LBI R15, #$05
4F5A	0FFD		MLH R15, R15
4F5C	8F29		LBI R15, #$29
4F5E	0203		INC2 R2, R0
4F60	A081		BRA $4FE4		; $82(R0)

4F62	A001		BRA $4F66		; $02(R0)

4F64	A05F		BRA $4FC6		; $60(R0)

4F66	2D45		MOVE R13, $8A
4F68	BD04		SET R13, #$04
4F6A	3D45		MOVE $8A, R13
4F6C	5951		MOVE (R5)+, R9
4F6E	2D46		MOVE R13, $8C
4F70	8103		LBI R1, #$03
4F72	CD16		SBC R13, R1
4F74	A005		BRA $4F7C		; $06(R0)

4F76	0878		ADD R8, R7
4F78	5858		MOVE (R5), R8
4F7A	A037		BRA $4FB4		; $38(R0)

4F7C	2E4A		MOVE R14, $94
4F7E	0E69		SUB R14, R6
4F80	0E78		ADD R14, R7
4F82	2F48		MOVE R15, $90
4F84	0203		INC2 R2, R0
4F86	A05B		BRA $4FE4		; $5C(R0)

4F88	A003		BRA $4F8E		; $04(R0)

4F8A	5F51		MOVE (R5)+, R15
4F8C	A003		BRA $4F92		; $04(R0)

4F8E	5E51		MOVE (R5)+, R14
4F90	2E49		MOVE R14, $92
4F92	2F4B		MOVE R15, $96
4F94	0DF4		MOVE R13, R15
4F96	CED2		SE R14, R13
4F98	A00B		BRA $4FA6		; $0C(R0)

4F9A	0EEC		MHL R14, R14
4F9C	0DDC		MHL R13, R13
4F9E	CED2		SE R14, R13
4FA0	A003		BRA $4FA6		; $04(R0)

4FA2	5958		MOVE (R5), R9
4FA4	A001		BRA $4FA8		; $02(R0)

4FA6	5F58		MOVE (R5), R15
4FA8	2F4A		MOVE R15, $94
4FAA	2E4B		MOVE R14, $96
4FAC	FF00		SUB R15, #$01
4FAE	FE00		SUB R14, #$01
4FB0	3F4A		MOVE $94, R15
4FB2	3E4B		MOVE $96, R14
4FB4	0203		INC2 R2, R0
4FB6	A033		BRA $4FEC		; $34(R0)

4FB8	2F48		MOVE R15, $90
4FBA	2E49		MOVE R14, $92
4FBC	AF01		ADD R15, #$02
4FBE	AE01		ADD R14, #$02
4FC0	3F48		MOVE $90, R15
4FC2	3E49		MOVE $92, R14
4FC4	A047		BRA $500E		; $48(R0)

4FC6	2F45		MOVE R15, $8A
4FC8	BF04		SET R15, #$04
4FCA	3F24		MOVE $48, R15
4FCC	2F46		MOVE R15, $8C
4FCE	3F45		MOVE $8A, R15
4FD0	BF04		SET R15, #$04
4FD2	3F46		MOVE $8C, R15
4FD4	8103		LBI R1, #$03
4FD6	CF16		SBC R15, R1
4FD8	F05D		BRA $4F7C		; -> -$5E(R0)

4FDA	0878		ADD R8, R7
4FDC	5853		MOVE (R5)++, R8
4FDE	DD58		MOVE R13, (R5)
4FE0	3D7A		MOVE $F4, R13
4FE2	F02F		BRA $4FB4		; -> -$30(R0)

4FE4	8159		LBI R1, #$59
4FE6	011D		MLH R1, R1
4FE8	81E4		LBI R1, #$E4
4FEA	0014		RET R1

4FEC	3277		MOVE $EE, R2
4FEE	2E49		MOVE R14, $92
4FF0	8F05		LBI R15, #$05
4FF2	0FFD		MLH R15, R15
4FF4	8F27		LBI R15, #$27
4FF6	815C		LBI R1, #$5C
4FF8	011D		MLH R1, R1
4FFA	8162		LBI R1, #$62
4FFC	0203		INC2 R2, R0
4FFE	0014		RET R1

5000	2077		JMP ($00EE)

5002	3040		MOVE $80, R0
5004	8F0C		LBI R15, #$0C
5006	8150		LBI R1, #$50
5008	011D		MLH R1, R1
500A	81A8		LBI R1, #$A8
500C	0014		RET R1

500E	2624		MOVE R6, $48
5010	8104		LBI R1, #$04
5012	C615		SBS R6, R1
5014	A011		BRA $5028		; $12(R0)

5016	2745		MOVE R7, $8A
5018	097C		MHL R9, R7
501A	9908		CLR R9, #$08
501C	8140		LBI R1, #$40
501E	C916		SBC R9, R1
5020	B908		SET R9, #$08
5022	079D		MLH R7, R9
5024	3745		MOVE $8A, R7
5026	A01F		BRA $5048		; $20(R0)

5028	2724		MOVE R7, $48
502A	097C		MHL R9, R7
502C	9908		CLR R9, #$08
502E	8140		LBI R1, #$40
5030	C916		SBC R9, R1
5032	B908		SET R9, #$08
5034	079D		MLH R7, R9
5036	3724		MOVE $48, R7
5038	2746		MOVE R7, $8C
503A	097C		MHL R9, R7
503C	9908		CLR R9, #$08
503E	8140		LBI R1, #$40
5040	C916		SBC R9, R1
5042	B908		SET R9, #$08
5044	079D		MLH R7, R9
5046	3746		MOVE $8C, R7
5048	8700		LBI R7, #$00
504A	077D		MLH R7, R7
504C	878A		LBI R7, #$8A
504E	8803		LBI R8, #$03
5050	8900		LBI R9, #$00
5052	099D		MLH R9, R9
5054	89F2		LBI R9, #$F2
5056	8104		LBI R1, #$04
5058	C616		SBC R6, R1
505A	A019		BRA $5076		; $1A(R0)

505C	8E05		LBI R14, #$05
505E	0EED		MLH R14, R14
5060	8E15		LBI R14, #$15
5062	DF98		MOVE R15, (R9)
5064	0203		INC2 R2, R0
5066	F083		BRA $4FE4		; -> -$84(R0)

5068	A001		BRA $506C		; $02(R0)

506A	A021		BRA $508E		; $22(R0)

506C	8C05		LBI R12, #$05
506E	0CCD		MLH R12, R12
5070	8C25		LBI R12, #$25
5072	5C98		MOVE (R9), R12
5074	A017		BRA $508E		; $18(R0)

5076	8F00		LBI R15, #$00
5078	0FFD		MLH R15, R15
507A	8F15		LBI R15, #$15
507C	DE98		MOVE R14, (R9)
507E	0203		INC2 R2, R0
5080	F09D		BRA $4FE4		; -> -$9E(R0)

5082	A001		BRA $5086		; $02(R0)

5084	A007		BRA $508E		; $08(R0)

5086	8C00		LBI R12, #$00
5088	0CCD		MLH R12, R12
508A	8C01		LBI R12, #$01
508C	5C98		MOVE (R9), R12
508E	D671		MOVE R6, (R7)+
5090	A901		ADD R9, #$02
5092	DD98		MOVE R13, (R9)
5094	8177		LBI R1, #$77
5096	CD12		SE R13, R1
5098	A005		BRA $50A0		; $06(R0)

509A	0DDC		MHL R13, R13
509C	CD1A		SNE R13, R1
509E	A005		BRA $50A6		; $06(R0)

50A0	F800		SUB R8, #$01
50A2	C803		SZ R8
50A4	F04F		BRA $5056		; -> -$50(R0)

50A6	2076		JMP ($00EC)

50A8	8157		LBI R1, #$57
50AA	011D		MLH R1, R1
50AC	810A		LBI R1, #$0A
50AE	0203		INC2 R2, R0
50B0	0014		RET R1

50B2	2C63		MOVE R12, $C6
50B4	BC40		SET R12, #$40
50B6	9C80		CLR R12, #$80
50B8	0CFD		MLH R12, R15
50BA	3C63		MOVE $C6, R12

			; Some error condition exists, make
			; error code

50BC	8140		LBI R1, #$40
50BE	CF18		SGT R15, R1
50C0	A023		BRA $50E6		; Error 50

50C2	9FE0		CLR R15, #$E0
50C4	00F8		ADD R0, R15

			; Error 02

50C6	8FF0		LBI R15, #$F0
50C8	0FFD		MLH R15, R15
50CA	8FF2		LBI R15, #$F2
50CC	A063		BRA $5132

			; Error 13

50CE	8FF1		LBI R15, #$F1
50D0	0FFD		MLH R15, R15
50D2	8FF3		LBI R15, #$F3
50D4	A05B		BRA $5132

			; Error 70:
			; ???

50D6	8FF7		LBI R15, #$F7
50D8	0FFD		MLH R15, R15
50DA	8FF0		LBI R15, #$F0
50DC	A053		BRA $5132

			; Error 71:
			; ???

50DE	8FF7		LBI R15, #$F7
50E0	0FFD		MLH R15, R15
50E2	8FF1		LBI R15, #$F1
50E4	A04B		BRA $5132

50E6	81F5		LBI R1, #$F5
50E8	0F1D		MLH R15, R1

			; Error 50:
			; End of forms - '+End of forms' line is shown

50EA	00F8		ADD R0, R15
50EC	8FF0		LBI R15, #$F0
50EE	A041		BRA $5132		; $42(R0)

			; Error 51:
			; Printer not ready

50F0	8FF1		LBI R15, #$F1
50F2	A03D		BRA $5132		; $3E(R0)

			; Error 52:
			; Forms step time-out

50F4	8FF2		LBI R15, #$F2
50F6	A039		BRA $5132		; $3A(R0)

			; Error 53:
			; Line length too long

50F8	8FF3		LBI R15, #$F3
50FA	A035		BRA $5132		; $36(R0)

			; Error 54:
			; Wire check - Indicates that a print wire driver
			; was on too long

50FC	8FF4		LBI R15, #$F4
50FE	A031		BRA $5132		; $32(R0)

			; Error 55:
			; Undefined interrupt

5100	8FF5		LBI R15, #$F5
5102	A02D		BRA $5132		; $2E(R0)

			; Error 56:
			; Incorrect print emitter sequence

5104	8FF6		LBI R15, #$F6
5106	A029		BRA $5132		; $2A(R0)

			; Error 57:
			; Missing print emitter pulses

5108	8FF7		LBI R15, #$F7
510A	A025		BRA $5132		; $26(R0)

			; Error 58:
			; Timer interrupt time-out

510C	8FF8		LBI R15, #$F8
510E	A021		BRA $5132		; $22(R0)

			; Error 59:
			; Overspeed error

5110	8FF9		LBI R15, #$F9
5112	A01D		BRA $5132		; $1E(R0)

			; Error 47:
			; Print position error -
			; The print head was not in the position indicated
			; by the microprogram

5114	8FF4		LBI R15, #$F4
5116	0FFD		MLH R15, R15
5118	8FF7		LBI R15, #$F7
511A	A015		BRA $5132		; $16(R0)

			; Error 48:
			; Undetermined unrecoverable error on a sense command

511C	8FF4		LBI R15, #$F4
511E	0FFD		MLH R15, R15
5120	8FF8		LBI R15, #$F8
5122	A00D		BRA $5132		; $0E(R0)

			; Error 72:
			; ???

5124	8FF7		LBI R15, #$F7
5126	0FFD		MLH R15, R15
5128	8FF2		LBI R15, #$F2
512A	A005		BRA $5132		; $06(R0)

			; Error 49:
			; Two or more underscores with a delete

512C	8FF4		LBI R15, #$F4
512E	0FFD		MLH R15, R15
5130	8FF9		LBI R15, #$F9

			; Set return value and exit supervisor

5132	0D34		MOVE R13, R3
5134	AD0B		ADD R13, #$0C		; IOCB_Ret
5136	5FD8		MOVE (R13), R15
5138	8C51		LBI R12, #$51
513A	0CCD		MLH R12, R12
513C	8C48		LBI R12, #$48
513E	3C20		MOVE $40, R12		; R2L0 <- $5148 (null handler)
5140	1F10		CTRL $F, #$10		; Reset printer

5142	2269		MOVE R2, $D2		; Restore R2
5144	0824		MOVE R8, R2
5146	2056		JMP ($00AC)		; Exit

; **********************
; Printer I/O
; Null interrupt handler
; **********************

5148	1F10		CTRL $F, #$10		; Reset printer adapter
514A	F003		BRA $5148		; Loop on next IRQ
; ----

514C	F0A5		BRA $50A8		; -> -$A6(R0)

514E	8D03		LBI R13, #$03
5150	3D26		MOVE $4C, R13
5152	8A49		LBI R10, #$49
5154	0AAD		MLH R10, R10
5156	05AE		GETB R10, $5
5158	3A2A		MOVE $54, R10
515A	8C52		LBI R12, #$52
515C	0CCD		MLH R12, R12
515E	8C9C		LBI R12, #$9C
5160	15D8		CTRL $5, #$D8		; Preset timer counter
5162	3C20		MOVE $40, R12
5164	15D1		CTRL $5, #$D1		; Enable timer interrupts
5166	8D0A		LBI R13, #$0A
5168	0DDD		MLH R13, R13
516A	8D00		LBI R13, #$00
516C	FD00		SUB R13, #$01
516E	01DC		MHL R1, R13
5170	01D6		OR R1, R13
5172	C103		SZ R1
5174	A003		BRA $517A		; $04(R0)

5176	8F20		LBI R15, #$20
5178	F0D1		BRA $50A8		; -> -$D2(R0)

517A	2C26		MOVE R12, $4C
517C	CC03		SZ R12
517E	F013		BRA $516C		; -> -$14(R0)

5180	0D34		MOVE R13, R3
5182	AD01		ADD R13, #$02
5184	6CD8		MOVB R12, (R13)
5186	8952		LBI R9, #$52
5188	099D		MLH R9, R9
518A	89AE		LBI R9, #$AE
518C	3920		MOVE $40, R9
518E	15E1		CTRL $5, #$E1		; ?
5190	CC0B		SNZ R12
5192	A017		BRA $51AC		; $18(R0)

5194	AD03		ADD R13, #$04
5196	DCD8		MOVE R12, (R13)
5198	0DCC		MHL R13, R12
519A	0CD6		OR R12, R13
519C	CC0B		SNZ R12
519E	A073		BRA $5214		; $74(R0)

51A0	2D24		MOVE R13, $48
51A2	2C45		MOVE R12, $8A
51A4	0CD6		OR R12, R13
51A6	8120		LBI R1, #$20
51A8	CC15		SBS R12, R1
51AA	A067		BRA $5214		; $68(R0)

51AC	15A1		CTRL $5, #$A1		; Enable print emitter int.
51AE	0AAC		MHL R10, R10
51B0	05AE		GETB R10, $5
51B2	8D0B		LBI R13, #$0B
51B4	3D26		MOVE $4C, R13
51B6	15A0		CTRL $5, #$A0		; Print go latch
51B8	8D53		LBI R13, #$53
51BA	0DDD		MLH R13, R13
51BC	8DF0		LBI R13, #$F0
51BE	3D75		MOVE $EA, R13
51C0	2C24		MOVE R12, $48
51C2	01CC		MHL R1, R12
51C4	B102		SET R1, #$02
51C6	0C1D		MLH R12, R1
51C8	15D8		CTRL $5, #$D8		; Preset timer counter
51CA	3C24		MOVE $48, R12
51CC	15D1		CTRL $5, #$D1		; Enable timer interrupts
51CE	2C24		MOVE R12, $48
51D0	8102		LBI R1, #$02
51D2	CC16		SBC R12, R1
51D4	A037		BRA $520E		; $38(R0)

51D6	2C63		MOVE R12, $C6
51D8	8120		LBI R1, #$20
51DA	CC15		SBS R12, R1
51DC	A023		BRA $5202		; $24(R0)

51DE	2862		MOVE R8, $C4
51E0	0203		INC2 R2, R0
51E2	2056		JMP ($00AC)

51E4	A015		BRA $51FC		; $16(R0)

51E6	2C63		MOVE R12, $C6
51E8	9C20		CLR R12, #$20
51EA	3C63		MOVE $C6, R12
51EC	2F2F		MOVE R15, $5E
51EE	0D34		MOVE R13, R3
51F0	AD0B		ADD R13, #$0C
51F2	8140		LBI R1, #$40
51F4	CC16		SBC R12, R1
51F6	5FD8		MOVE (R13), R15
51F8	1F10		CTRL $F, #$10		; Reset printer
51FA	A00B		BRA $5208		; $0C(R0)

51FC	3040		MOVE $80, R0
51FE	8F30		LBI R15, #$30
5200	F0B5		BRA $514C		; -> -$B6(R0)

5202	8A49		LBI R10, #$49
5204	0AAD		MLH R10, R10
5206	05AE		GETB R10, $5
5208	2269		MOVE R2, $D2
520A	0824		MOVE R8, R2
520C	2056		JMP ($00AC)

520E	2D50		MOVE R13, $A0
5210	8D04		LBI R13, #$04
5212	A015		BRA $522A		; $16(R0)

5214	8D56		LBI R13, #$56
5216	0DDD		MLH R13, R13
5218	8D6E		LBI R13, #$6E
521A	3D75		MOVE $EA, R13
521C	0AAC		MHL R10, R10
521E	05AE		GETB R10, $5
5220	8D0B		LBI R13, #$0B
5222	15D8		CTRL $5, #$D8		; Preset timer counter
5224	3D26		MOVE $4C, R13
5226	15D1		CTRL $5, #$D1		; Enable timer interrupts
5228	2D42		MOVE R13, $84
522A	3D25		MOVE $4A, R13
522C	01DC		MHL R1, R13
522E	9180		CLR R1, #$80
5230	0D16		OR R13, R1
5232	CD0B		SNZ R13
5234	A04F		BRA $5286		; $50(R0)

5236	8180		LBI R1, #$80
5238	1560		CTRL $5, #$60		; ROS address byte 7
523A	2D25		MOVE R13, $4A
523C	05D4		MOVE R5, R13
523E	CD17		SBSH R13, R1
5240	15E0		CTRL $5, #$E0		; ROS address byte 6
5242	0AAC		MHL R10, R10
5244	05AE		GETB R10, $5
5246	8E0C		LBI R14, #$0C
5248	0BAC		MHL R11, R10
524A	05BE		GETB R11, $5
524C	0EB5		AND R14, R11
524E	CAE2		SE R10, R14
5250	A009		BRA $525C		; $0A(R0)

5252	FD00		SUB R13, #$01
5254	8180		LBI R1, #$80
5256	CD17		SBSH R13, R1
5258	AD01		ADD R13, #$02
525A	A00F		BRA $526C		; $10(R0)

525C	810C		LBI R1, #$0C
525E	0A17		XOR R10, R1
5260	CAE2		SE R10, R14
5262	A007		BRA $526C		; $08(R0)

5264	AD00		ADD R13, #$01
5266	8180		LBI R1, #$80
5268	CD17		SBSH R13, R1
526A	FD01		SUB R13, #$02
526C	3D25		MOVE $4A, R13
526E	0203		INC2 R2, R0
5270	A027		BRA $529A		; $28(R0)

5272	1590		CTRL $5, #$90		; Forms go latch
5274	2424		MOVE R4, $48
5276	0D4C		MHL R13, R4
5278	1591		CTRL $5, #$91		; Enable forms interrupt
527A	BD24		SET R13, #$24
527C	04DD		MLH R4, R13
527E	3424		MOVE $48, R4
5280	2D50		MOVE R13, $A0
5282	3D43		MOVE $86, R13
5284	F083		BRA $5202		; -> -$84(R0)

5286	8157		LBI R1, #$57
5288	011D		MLH R1, R1
528A	810A		LBI R1, #$0A
528C	0203		INC2 R2, R0
528E	0014		RET R1

5290	2C63		MOVE R12, $C6
5292	9C9C		CLR R12, #$9C
5294	3C63		MOVE $C6, R12
5296	1F10		CTRL $F, #$10		; Reset printer
5298	F097		BRA $5202		; -> -$98(R0)

529A	A0DB		BRA $5378		; $DC(R0)

529C	F600		SUB R6, #$01
529E	C60B		SNZ R6
52A0	A003		BRA $52A6		; $04(R0)

52A2	1552		CTRL $5, #$52		; Reset timer interrupt
52A4	F009		BRA $529C		; -> -$0A(R0)

52A6	1551		CTRL $5, #$51		; Disable timer interrupts
52A8	0004		NOP
52AA	1552		CTRL $5, #$52		; Reset timer interrupt
52AC	0000		HALT
52AE	0BAC		MHL R11, R10
52B0	05BE		GETB R11, $5
52B2	8101		LBI R1, #$01
52B4	CB1D		SNBS R11, R1
52B6	A051		BRA $530A		; $52(R0)

52B8	0AAC		MHL R10, R10
52BA	05AE		GETB R10, $5
52BC	8120		LBI R1, #$20
52BE	CB15		SBS R11, R1
52C0	A021		BRA $52E4		; $22(R0)

52C2	81E0		LBI R1, #$E0
52C4	CA1E		SNBC R10, R1
52C6	A017		BRA $52E0		; $18(R0)

52C8	0DA4		MOVE R13, R10
52CA	9D1F		CLR R13, #$1F
52CC	8160		LBI R1, #$60
52CE	CD1A		SNE R13, R1
52D0	A00D		BRA $52E0		; $0E(R0)

52D2	81A0		LBI R1, #$A0
52D4	CD11		SLT R13, R1
52D6	A007		BRA $52E0		; $08(R0)

52D8	8157		LBI R1, #$57
52DA	011D		MLH R1, R1
52DC	8122		LBI R1, #$22
52DE	0014		RET R1

52E0	1522		CTRL $5, #$22		; Reset print emitter int.
52E2	F035		BRA $52AE		; -> -$36(R0)

52E4	8102		LBI R1, #$02
52E6	CB1D		SNBS R11, R1
52E8	A017		BRA $5302		; $18(R0)

52EA	8110		LBI R1, #$10
52EC	CB16		SBC R11, R1
52EE	A003		BRA $52F4		; $04(R0)

52F0	8F14		LBI R15, #$14
52F2	A009		BRA $52FE		; $0A(R0)

52F4	8F10		LBI R15, #$10
52F6	E5DF		STAT R13, $5
52F8	8140		LBI R1, #$40
52FA	CD1D		SNBS R13, R1
52FC	8F04		LBI R15, #$04
52FE	3140		MOVE $80, R1
5300	A031		BRA $5334		; $32(R0)

5302	8156		LBI R1, #$56
5304	011D		MLH R1, R1
5306	81AC		LBI R1, #$AC
5308	0014		RET R1

530A	8153		LBI R1, #$53
530C	011D		MLH R1, R1
530E	813C		LBI R1, #$3C
5310	3174		MOVE $E8, R1
5312	2D43		MOVE R13, $86
5314	AD00		ADD R13, #$01
5316	3D43		MOVE $86, R13
5318	8110		LBI R1, #$10
531A	C415		SBS R4, R1
531C	A021		BRA $5340		; $22(R0)

531E	0203		INC2 R2, R0
5320	A0AF		BRA $53D2		; $B0(R0)

5322	2D43		MOVE R13, $86
5324	2147		MOVE R1, $8E
5326	CD10		SLE R13, R1
5328	A005		BRA $5330		; $06(R0)

532A	2D50		MOVE R13, $A0
532C	3D44		MOVE $88, R13
532E	2075		JMP ($00EA)

5330	8F1C		LBI R15, #$1C
5332	3140		MOVE $80, R1
5334	8159		LBI R1, #$59
5336	011D		MLH R1, R1
5338	8172		LBI R1, #$72
533A	0014		RET R1

533C	1552		CTRL $5, #$52		; Reset timer interrupt
533E	F091		BRA $52AE		; -> -$92(R0)

5340	8120		LBI R1, #$20
5342	C417		SBSH R4, R1
5344	A009		BRA $5350		; $0A(R0)

5346	8137		LBI R1, #$37
5348	CD19		SGE R13, R1
534A	A003		BRA $5350		; $04(R0)

534C	8F08		LBI R15, #$08
534E	F01D		BRA $5332		; -> -$1E(R0)

5350	2D50		MOVE R13, $A0
5352	3D44		MOVE $88, R13
5354	2178		MOVE R1, $F0
5356	C10B		SNZ R1
5358	A02D		BRA $5388		; $2E(R0)

535A	2D78		MOVE R13, $F0
535C	FD00		SUB R13, #$01
535E	3D78		MOVE $F0, R13
5360	8104		LBI R1, #$04
5362	C41F		SNBSH R4, R1
5364	A009		BRA $5370		; $0A(R0)

5366	CD03		SZ R13
5368	A01D		BRA $5388		; $1E(R0)

536A	1510		CTRL $5, #$10		; Reset forms go latch
536C	9440		CLR R4, #$40
536E	A017		BRA $5388		; $18(R0)

5370	0D4C		MHL R13, R4
5372	9D04		CLR R13, #$04
5374	04DD		MLH R4, R13
5376	0203		INC2 R2, R0
5378	A055		BRA $53D0		; $56(R0)

537A	2D50		MOVE R13, $A0
537C	8D0B		LBI R13, #$0B
537E	3D78		MOVE $F0, R13
5380	860C		LBI R6, #$0C
5382	8A49		LBI R10, #$49
5384	0AAD		MLH R10, R10
5386	05AE		GETB R10, $5
5388	F600		SUB R6, #$01
538A	C60B		SNZ R6
538C	2075		JMP ($00EA)

538E	8102		LBI R1, #$02
5390	C417		SBSH R4, R1
5392	2074		JMP ($00E8)

5394	0AAC		MHL R10, R10
5396	05AE		GETB R10, $5
5398	2D65		MOVE R13, $CA
539A	01A4		MOVE R1, R10
539C	911F		CLR R1, #$1F
539E	CD1A		SNE R13, R1
53A0	2074		JMP ($00E8)

53A2	C10B		SNZ R1
53A4	2074		JMP ($00E8)

53A6	0D14		MOVE R13, R1
53A8	8160		LBI R1, #$60
53AA	CD1A		SNE R13, R1
53AC	2074		JMP ($00E8)

53AE	81A0		LBI R1, #$A0
53B0	CD11		SLT R13, R1
53B2	2074		JMP ($00E8)

53B4	8103		LBI R1, #$03
53B6	2D63		MOVE R13, $C6
53B8	CD16		SBC R13, R1
53BA	2074		JMP ($00E8)

53BC	8108		LBI R1, #$08
53BE	CD17		SBSH R13, R1
53C0	2074		JMP ($00E8)

53C2	01BC		MHL R1, R11
53C4	B120		SET R1, #$20
53C6	0B1D		MLH R11, R1
53C8	8157		LBI R1, #$57
53CA	011D		MLH R1, R1
53CC	8132		LBI R1, #$32
53CE	0014		RET R1

53D0	A0C1		BRA $5494		; $C2(R0)

53D2	8DC0		LBI R13, #$C0
53D4	8104		LBI R1, #$04
53D6	C41E		SNBC R4, R1
53D8	0BD7		XOR R11, R13
53DA	0DB5		AND R13, R11
53DC	E0DF		STAT R13, $0
53DE	00D8		ADD R0, R13
53E0	15AB		CTRL $5, #$AB		; Print motot latch B
53E2	0024		RET R2

53E4	15A3		CTRL $5, #$A3		; Not print motor latches A+B
53E6	0024		RET R2

53E8	15AF		CTRL $5, #$AF		; Print motor latches A+B
53EA	0024		RET R2

53EC	15A7		CTRL $5, #$A7		; Print motor latch A
53EE	0024		RET R2

53F0	8104		LBI R1, #$04
53F2	C41F		SNBSH R4, R1
53F4	A021		BRA $5418		; $22(R0)

53F6	2D78		MOVE R13, $F0
53F8	CD03		SZ R13
53FA	2074		JMP ($00E8)

53FC	8601		LBI R6, #$01
53FE	0203		INC2 R2, R0
5400	F02F		BRA $53D2		; -> -$30(R0)

5402	8D54		LBI R13, #$54
5404	0DDD		MLH R13, R13
5406	8D24		LBI R13, #$24
5408	3D75		MOVE $EA, R13
540A	8A5C		LBI R10, #$5C
540C	0AAD		MLH R10, R10
540E	05AE		GETB R10, $5
5410	014C		MHL R1, R4
5412	9102		CLR R1, #$02
5414	041D		MLH R4, R1
5416	2074		JMP ($00E8)

5418	2650		MOVE R6, $A0
541A	04DD		MLH R4, R13
541C	0D4C		MHL R13, R4
541E	BD20		SET R13, #$20
5420	04DD		MLH R4, R13
5422	2074		JMP ($00E8)

5424	0203		INC2 R2, R0
5426	F055		BRA $53D2		; -> -$56(R0)

5428	8D54		LBI R13, #$54
542A	0DDD		MLH R13, R13
542C	8D3A		LBI R13, #$3A
542E	3D75		MOVE $EA, R13
5430	8601		LBI R6, #$01
5432	8A52		LBI R10, #$52
5434	0AAD		MLH R10, R10
5436	05AE		GETB R10, $5
5438	2074		JMP ($00E8)

543A	0203		INC2 R2, R0
543C	F06B		BRA $53D2		; -> -$6C(R0)

543E	8601		LBI R6, #$01
5440	8180		LBI R1, #$80
5442	C41E		SNBC R4, R1
5444	A00B		BRA $5452		; $0C(R0)

5446	8A31		LBI R10, #$31
5448	8D54		LBI R13, #$54
544A	0DDD		MLH R13, R13
544C	8DB4		LBI R13, #$B4
544E	3D75		MOVE $EA, R13
5450	A009		BRA $545C		; $0A(R0)

5452	8D54		LBI R13, #$54
5454	0DDD		MLH R13, R13
5456	8D62		LBI R13, #$62
5458	8A3F		LBI R10, #$3F
545A	3D75		MOVE $EA, R13
545C	0AAD		MLH R10, R10
545E	05AE		GETB R10, $5
5460	2074		JMP ($00E8)

5462	0203		INC2 R2, R0
5464	F093		BRA $53D2		; -> -$94(R0)

5466	8D54		LBI R13, #$54
5468	0DDD		MLH R13, R13
546A	8D78		LBI R13, #$78
546C	3D75		MOVE $EA, R13
546E	8A33		LBI R10, #$33
5470	0AAD		MLH R10, R10
5472	05AE		GETB R10, $5
5474	8601		LBI R6, #$01
5476	2074		JMP ($00E8)

5478	0203		INC2 R2, R0
547A	F0A9		BRA $53D2		; -> -$AA(R0)

547C	8D54		LBI R13, #$54
547E	0DDD		MLH R13, R13
5480	8D90		LBI R13, #$90
5482	3D75		MOVE $EA, R13
5484	B410		SET R4, #$10
5486	01BC		MHL R1, R11
5488	B180		SET R1, #$80
548A	0B1D		MLH R11, R1
548C	8601		LBI R6, #$01
548E	2074		JMP ($00E8)

5490	8601		LBI R6, #$01
5492	2074		JMP ($00E8)

5494	0AAC		MHL R10, R10
5496	05AE		GETB R10, $5
5498	8E0C		LBI R14, #$0C
549A	8180		LBI R1, #$80
549C	C51F		SNBSH R5, R1
549E	0AE7		XOR R10, R14
54A0	0EA5		AND R14, R10
54A2	00E8		ADD R0, R14
54A4	1593		CTRL $5, #$93
54A6	0024		RET R2

54A8	1597		CTRL $5, #$97
54AA	0024		RET R2

54AC	159B		CTRL $5, #$9B
54AE	0024		RET R2

54B0	159F		CTRL $5, #$9F
54B2	0024		RET R2

54B4	0203		INC2 R2, R0
54B6	F03D		BRA $547A		; -> -$3E(R0)

54B8	8D54		LBI R13, #$54
54BA	0DDD		MLH R13, R13
54BC	8DCA		LBI R13, #$CA
54BE	3D75		MOVE $EA, R13
54C0	8A20		LBI R10, #$20
54C2	0AAD		MLH R10, R10
54C4	05AE		GETB R10, $5
54C6	8601		LBI R6, #$01
54C8	2074		JMP ($00E8)

54CA	0203		INC2 R2, R0
54CC	F053		BRA $547A		; -> -$54(R0)

54CE	B410		SET R4, #$10
54D0	8D54		LBI R13, #$54
54D2	0DDD		MLH R13, R13
54D4	8DE2		LBI R13, #$E2
54D6	3D75		MOVE $EA, R13
54D8	8A28		LBI R10, #$28
54DA	0AAD		MLH R10, R10
54DC	05AE		GETB R10, $5
54DE	8601		LBI R6, #$01
54E0	2074		JMP ($00E8)

54E2	8D54		LBI R13, #$54
54E4	0DDD		MLH R13, R13
54E6	8DF4		LBI R13, #$F4
54E8	3D75		MOVE $EA, R13
54EA	8A31		LBI R10, #$31
54EC	0AAD		MLH R10, R10
54EE	05AE		GETB R10, $5
54F0	8601		LBI R6, #$01
54F2	2074		JMP ($00E8)

54F4	8D55		LBI R13, #$55
54F6	0DDD		MLH R13, R13
54F8	8D06		LBI R13, #$06
54FA	3D75		MOVE $EA, R13
54FC	8A2C		LBI R10, #$2C
54FE	0AAD		MLH R10, R10
5500	05AE		GETB R10, $5
5502	8601		LBI R6, #$01
5504	2074		JMP ($00E8)

5506	8D55		LBI R13, #$55
5508	0DDD		MLH R13, R13
550A	8D12		LBI R13, #$12
550C	3D75		MOVE $EA, R13
550E	8601		LBI R6, #$01
5510	2074		JMP ($00E8)

5512	8D55		LBI R13, #$55
5514	0DDD		MLH R13, R13
5516	8D24		LBI R13, #$24
5518	3D75		MOVE $EA, R13
551A	8A22		LBI R10, #$22
551C	0AAD		MLH R10, R10
551E	05AE		GETB R10, $5
5520	8601		LBI R6, #$01
5522	2074		JMP ($00E8)

5524	01BC		MHL R1, R11
5526	B180		SET R1, #$80
5528	0B1D		MLH R11, R1
552A	8601		LBI R6, #$01
552C	2074		JMP ($00E8)

552E	0203		INC2 R2, R0
5530	F0B7		BRA $547A		; -> -$B8(R0)

5532	9410		CLR R4, #$10
5534	8601		LBI R6, #$01
5536	8180		LBI R1, #$80
5538	C41E		SNBC R4, R1
553A	A009		BRA $5546		; $0A(R0)

553C	8A6F		LBI R10, #$6F
553E	0AAD		MLH R10, R10
5540	05AE		GETB R10, $5
5542	8A3F		LBI R10, #$3F
5544	A007		BRA $554E		; $08(R0)

5546	8A3F		LBI R10, #$3F
5548	0AAD		MLH R10, R10
554A	05AE		GETB R10, $5
554C	8A6F		LBI R10, #$6F
554E	15D8		CTRL $5, #$D8
5550	0AAD		MLH R10, R10
5552	05AE		GETB R10, $5
5554	8D55		LBI R13, #$55
5556	0DDD		MLH R13, R13
5558	8D60		LBI R13, #$60
555A	3D75		MOVE $EA, R13
555C	2074		JMP ($00E8)

555E	F0CB		BRA $5494		; -> -$CC(R0)

5560	0203		INC2 R2, R0
5562	F033		BRA $5530		; -> -$34(R0)

5564	8A49		LBI R10, #$49
5566	0AAD		MLH R10, R10
5568	05AE		GETB R10, $5
556A	8601		LBI R6, #$01
556C	8D55		LBI R13, #$55
556E	0DDD		MLH R13, R13
5570	8D76		LBI R13, #$76
5572	3D75		MOVE $EA, R13
5574	2074		JMP ($00E8)

5576	0203		INC2 R2, R0
5578	F049		BRA $5530		; -> -$4A(R0)

557A	8120		LBI R1, #$20
557C	C415		SBS R4, R1
557E	A031		BRA $55B2		; $32(R0)

5580	2D4A		MOVE R13, $94
5582	3D48		MOVE $90, R13
5584	224B		MOVE R2, $96
5586	3249		MOVE $92, R2
5588	8140		LBI R1, #$40
558A	CB17		SBSH R11, R1
558C	A015		BRA $55A4		; $16(R0)

558E	AD02		ADD R13, #$03
5590	A202		ADD R2, #$03
5592	3D7B		MOVE $F6, R13
5594	8104		LBI R1, #$04
5596	C416		SBC R4, R1
5598	A005		BRA $55A0		; $06(R0)

559A	FD05		SUB R13, #$06
559C	F205		SUB R2, #$06
559E	327B		MOVE $F6, R2
55A0	324B		MOVE $96, R2
55A2	3D4A		MOVE $94, R13
55A4	01BC		MHL R1, R11
55A6	9144		CLR R1, #$44
55A8	0B1D		MLH R11, R1
55AA	2D4F		MOVE R13, $9E
55AC	3D4D		MOVE $9A, R13
55AE	2D4E		MOVE R13, $9C
55B0	3D4C		MOVE $98, R13
55B2	2D7A		MOVE R13, $F4
55B4	3D79		MOVE $F2, R13
55B6	2D7B		MOVE R13, $F6
55B8	3D7A		MOVE $F4, R13
55BA	8D77		LBI R13, #$77
55BC	0DDD		MLH R13, R13
55BE	3D7B		MOVE $F6, R13
55C0	2145		MOVE R1, $8A
55C2	8D08		LBI R13, #$08
55C4	04D5		AND R4, R13
55C6	0146		OR R1, R4
55C8	041C		MHL R4, R1
55CA	B402		SET R4, #$02
55CC	014D		MLH R1, R4
55CE	0414		MOVE R4, R1
55D0	2D46		MOVE R13, $8C
55D2	3D45		MOVE $8A, R13
55D4	8104		LBI R1, #$04
55D6	0D17		XOR R13, R1
55D8	3D46		MOVE $8C, R13
55DA	2D79		MOVE R13, $F2
55DC	8177		LBI R1, #$77
55DE	CD12		SE R13, R1
55E0	A017		BRA $55FA		; $18(R0)

55E2	0DDC		MHL R13, R13
55E4	CD12		SE R13, R1
55E6	A011		BRA $55FA		; $12(R0)

55E8	8D56		LBI R13, #$56
55EA	0DDD		MLH R13, R13
55EC	8D6E		LBI R13, #$6E
55EE	3D75		MOVE $EA, R13
55F0	860B		LBI R6, #$0B
55F2	8140		LBI R1, #$40
55F4	C41D		SNBS R4, R1
55F6	A01D		BRA $5616		; $1E(R0)

55F8	2074		JMP ($00E8)

55FA	8608		LBI R6, #$08
55FC	8180		LBI R1, #$80
55FE	C416		SBC R4, R1
5600	8616		LBI R6, #$16
5602	8D53		LBI R13, #$53
5604	0DDD		MLH R13, R13
5606	8DF0		LBI R13, #$F0
5608	3D75		MOVE $EA, R13
560A	8102		LBI R1, #$02
560C	C415		SBS R4, R1
560E	2074		JMP ($00E8)

5610	2550		MOVE R5, $A0
5612	8504		LBI R5, #$04
5614	A001		BRA $5618		; $02(R0)

5616	2542		MOVE R5, $84
5618	8180		LBI R1, #$80
561A	1560		CTRL $5, #$60
561C	C517		SBSH R5, R1
561E	15E0		CTRL $5, #$E0
5620	8102		LBI R1, #$02
5622	CA15		SBS R10, R1
5624	A041		BRA $5668		; $42(R0)

5626	8104		LBI R1, #$04
5628	C41F		SNBSH R4, R1
562A	2074		JMP ($00E8)

562C	0AAC		MHL R10, R10
562E	05AE		GETB R10, $5
5630	8E0C		LBI R14, #$0C
5632	0AE5		AND R10, R14
5634	0EB5		AND R14, R11
5636	CAE2		SE R10, R14
5638	A009		BRA $5644		; $0A(R0)

563A	8180		LBI R1, #$80
563C	F500		SUB R5, #$01
563E	C517		SBSH R5, R1
5640	A501		ADD R5, #$02
5642	A00F		BRA $5654		; $10(R0)

5644	810C		LBI R1, #$0C
5646	0E17		XOR R14, R1
5648	CEA2		SE R14, R10
564A	A007		BRA $5654		; $08(R0)

564C	A500		ADD R5, #$01
564E	8180		LBI R1, #$80
5650	C517		SBSH R5, R1
5652	F501		SUB R5, #$02
5654	0203		INC2 R2, R0
5656	F0F9		BRA $555E		; -> -$FA(R0)

5658	1590		CTRL $5, #$90
565A	0D4C		MHL R13, R4
565C	1591		CTRL $5, #$91
565E	BD24		SET R13, #$24
5660	04DD		MLH R4, R13
5662	2D50		MOVE R13, $A0
5664	3D43		MOVE $86, R13
5666	2074		JMP ($00E8)

5668	8F00		LBI R15, #$00
566A	3140		MOVE $80, R1
566C	A099		BRA $5708		; $9A(R0)

566E	1520		CTRL $5, #$20
5670	8140		LBI R1, #$40
5672	C41E		SNBC R4, R1
5674	A015		BRA $568C		; $16(R0)

5676	0D4C		MHL R13, R4
5678	9D02		CLR R13, #$02
567A	04DD		MLH R4, R13
567C	2178		MOVE R1, $F0
567E	C10B		SNZ R1
5680	A003		BRA $5686		; $04(R0)

5682	2678		MOVE R6, $F0
5684	2074		JMP ($00E8)

5686	BD20		SET R13, #$20
5688	04DD		MLH R4, R13
568A	2074		JMP ($00E8)

568C	1521		CTRL $5, #$21
568E	2C63		MOVE R12, $C6
5690	9C9C		CLR R12, #$9C
5692	1551		CTRL $5, #$51
5694	3C63		MOVE $C6, R12
5696	1561		CTRL $5, #$61
5698	0203		INC2 R2, R0
569A	A06D		BRA $570A		; $6E(R0)

569C	1552		CTRL $5, #$52
569E	0004		NOP
56A0	1522		CTRL $5, #$22
56A2	0004		NOP
56A4	1562		CTRL $5, #$62
56A6	0004		NOP
56A8	1512		CTRL $5, #$12
56AA	F00F		BRA $569C		; -> -$10(R0)

56AC	1511		CTRL $5, #$11
56AE	0D4C		MHL R13, R4
56B0	9D20		CLR R13, #$20
56B2	04DD		MLH R4, R13
56B4	8104		LBI R1, #$04
56B6	CD15		SBS R13, R1
56B8	A043		BRA $56FE		; $44(R0)

56BA	F500		SUB R5, #$01
56BC	9D20		CLR R13, #$20
56BE	04DD		MLH R4, R13
56C0	0D5C		MHL R13, R5
56C2	9D80		CLR R13, #$80
56C4	CD03		SZ R13
56C6	A005		BRA $56CE		; $06(R0)

56C8	8101		LBI R1, #$01
56CA	C51A		SNE R5, R1
56CC	A007		BRA $56D6		; $08(R0)

56CE	1591		CTRL $5, #$91
56D0	0203		INC2 R2, R0
56D2	F07D		BRA $5656		; -> -$7E(R0)

56D4	A027		BRA $56FE		; $28(R0)

56D6	8180		LBI R1, #$80
56D8	0D5C		MHL R13, R5
56DA	0D17		XOR R13, R1
56DC	05DD		MLH R5, R13
56DE	8601		LBI R6, #$01
56E0	3678		MOVE $F0, R6
56E2	8A10		LBI R10, #$10
56E4	0AAD		MLH R10, R10
56E6	05AE		GETB R10, $5
56E8	8A49		LBI R10, #$49
56EA	15D8		CTRL $5, #$D8
56EC	0004		NOP
56EE	15D1		CTRL $5, #$D1
56F0	0AAD		MLH R10, R10
56F2	05AE		GETB R10, $5
56F4	0203		INC2 R2, R0
56F6	F0A1		BRA $5656		; -> -$A2(R0)

56F8	8180		LBI R1, #$80
56FA	0D17		XOR R13, R1
56FC	05DD		MLH R5, R13
56FE	1512		CTRL $5, #$12
5700	8152		LBI R1, #$52
5702	011D		MLH R1, R1
5704	81AE		LBI R1, #$AE
5706	0014		RET R1

5708	A0DD		BRA $57E8		; $DE(R0)

570A	0D34		MOVE R13, R3
570C	AD0F		ADD R13, #$10
570E	DCD8		MOVE R12, (R13)
5710	9C10		CLR R12, #$10
5712	5CD8		MOVE (R13), R12
5714	2D52		MOVE R13, $A4
5716	0CDC		MHL R12, R13
5718	9C02		CLR R12, #$02
571A	0DCD		MLH R13, R12
571C	9D08		CLR R13, #$08
571E	3D52		MOVE $A4, R13
5720	0024		RET R2

5722	8180		LBI R1, #$80
5724	CB17		SBSH R11, R1
5726	A009		BRA $5732		; $0A(R0)

5728	0BAC		MHL R11, R10
572A	05BE		GETB R11, $5
572C	8101		LBI R1, #$01
572E	CB16		SBC R11, R1
5730	A069		BRA $579C		; $6A(R0)

5732	2D64		MOVE R13, $C8
5734	0CA4		MOVE R12, R10
5736	81E0		LBI R1, #$E0
5738	0C15		AND R12, R1
573A	2965		MOVE R9, $CA
573C	CC9A		SNE R12, R9
573E	A08F		BRA $57D0		; $90(R0)

5740	0998		ADD R9, R9
5742	C90B		SNZ R9
5744	8920		LBI R9, #$20
5746	C9C2		SE R9, R12
5748	A00B		BRA $5756		; $0C(R0)

574A	AD00		ADD R13, #$01
574C	3D64		MOVE $C8, R13
574E	8104		LBI R1, #$04
5750	C416		SBC R4, R1
5752	A07B		BRA $57D0		; $7C(R0)

5754	A009		BRA $5760		; $0A(R0)

5756	FD00		SUB R13, #$01
5758	3D64		MOVE $C8, R13
575A	8104		LBI R1, #$04
575C	C415		SBS R4, R1
575E	A06F		BRA $57D0		; $70(R0)

5760	8180		LBI R1, #$80
5762	CB17		SBSH R11, R1
5764	A00D		BRA $5774		; $0E(R0)

5766	0BAC		MHL R11, R10
5768	05BE		GETB R11, $5
576A	8101		LBI R1, #$01
576C	CB16		SBC R11, R1
576E	A02B		BRA $579C		; $2C(R0)

5770	8905		LBI R9, #$05
5772	A007		BRA $577C		; $08(R0)

5774	8110		LBI R1, #$10
5776	C415		SBS R4, R1
5778	A00B		BRA $5786		; $0C(R0)

577A	8906		LBI R9, #$06
577C	2D44		MOVE R13, $88
577E	AD00		ADD R13, #$01
5780	3D44		MOVE $88, R13
5782	CD91		SLT R13, R9
5784	A05D		BRA $57E4		; $5E(R0)

5786	2150		MOVE R1, $A0
5788	3143		MOVE $86, R1
578A	0C1D		MLH R12, R1
578C	3C65		MOVE $CA, R12
578E	8120		LBI R1, #$20
5790	CB1F		SNBSH R11, R1
5792	A055		BRA $57EA		; $56(R0)

5794	0BAC		MHL R11, R10
5796	05BE		GETB R11, $5
5798	8101		LBI R1, #$01
579A	CB16		SBC R11, R1
579C	A0F5		BRA $5894		; $F6(R0)

579E	8103		LBI R1, #$03
57A0	2D63		MOVE R13, $C6
57A2	CD16		SBC R13, R1
57A4	A011		BRA $57B8		; $12(R0)

57A6	2D64		MOVE R13, $C8
57A8	01DC		MHL R1, R13
57AA	C10C		SNS R1
57AC	A009		BRA $57B8		; $0A(R0)

57AE	C103		SZ R1
57B0	A0AF		BRA $5862		; $B0(R0)

57B2	8101		LBI R1, #$01
57B4	CD11		SLT R13, R1
57B6	A0A9		BRA $5862		; $AA(R0)

57B8	8101		LBI R1, #$01
57BA	CA15		SBS R10, R1
57BC	A045		BRA $5804		; $46(R0)

57BE	8108		LBI R1, #$08
57C0	C41D		SNBS R4, R1
57C2	A09D		BRA $5862		; $9E(R0)

57C4	B408		SET R4, #$08
57C6	2D63		MOVE R13, $C6
57C8	8102		LBI R1, #$02
57CA	CD15		SBS R13, R1
57CC	A093		BRA $5862		; $94(R0)

57CE	A021		BRA $57F2		; $22(R0)

57D0	8110		LBI R1, #$10
57D2	C415		SBS R4, R1
57D4	F04F		BRA $5786		; -> -$50(R0)

57D6	8108		LBI R1, #$08
57D8	C416		SBC R4, R1
57DA	F055		BRA $5786		; -> -$56(R0)

57DC	8F18		LBI R15, #$18
57DE	A001		BRA $57E2		; $02(R0)

57E0	8F28		LBI R15, #$28
57E2	A001		BRA $57E6		; $02(R0)

57E4	8F24		LBI R15, #$24
57E6	3140		MOVE $80, R1
57E8	A0D5		BRA $58C0		; $D6(R0)

57EA	01BC		MHL R1, R11
57EC	9128		CLR R1, #$28
57EE	0B1D		MLH R11, R1
57F0	2074		JMP ($00E8)

57F2	8DFF		LBI R13, #$FF
57F4	0DDD		MLH R13, R13
57F6	8DFC		LBI R13, #$FC
57F8	3D64		MOVE $C8, R13
57FA	2D63		MOVE R13, $C6
57FC	BD01		SET R13, #$01
57FE	9D02		CLR R13, #$02
5800	3D63		MOVE $C6, R13
5802	A05D		BRA $5862		; $5E(R0)

5804	8180		LBI R1, #$80
5806	CA15		SBS R10, R1
5808	A057		BRA $5862		; $58(R0)

580A	8108		LBI R1, #$08
580C	C415		SBS R4, R1
580E	A051		BRA $5862		; $52(R0)

5810	9408		CLR R4, #$08
5812	2D63		MOVE R13, $C6
5814	8101		LBI R1, #$01
5816	CD16		SBC R13, R1
5818	A03B		BRA $5856		; $3C(R0)

581A	2D64		MOVE R13, $C8
581C	01DC		MHL R1, R13
581E	0D16		OR R13, R1
5820	CD0B		SNZ R13
5822	A031		BRA $5856		; $32(R0)

5824	81FF		LBI R1, #$FF
5826	2D64		MOVE R13, $C8
5828	CD1A		SNE R13, R1
582A	A005		BRA $5832		; $06(R0)

582C	81FE		LBI R1, #$FE
582E	CD12		SE R13, R1
5830	A007		BRA $583A		; $08(R0)

5832	81FF		LBI R1, #$FF
5834	0DDC		MHL R13, R13
5836	CD1A		SNE R13, R1
5838	A01B		BRA $5856		; $1C(R0)

583A	81D4		LBI R1, #$D4
583C	2D79		MOVE R13, $F2
583E	CD12		SE R13, R1
5840	A005		BRA $5848		; $06(R0)

5842	0DDC		MHL R13, R13
5844	CD0C		SNS R13
5846	A00D		BRA $5856		; $0E(R0)

5848	81D4		LBI R1, #$D4
584A	2D7A		MOVE R13, $F4
584C	CD12		SE R13, R1
584E	F06F		BRA $57E0		; -> -$70(R0)

5850	0DDC		MHL R13, R13
5852	CD04		SS R13
5854	F075		BRA $57E0		; -> -$76(R0)

5856	8DFF		LBI R13, #$FF
5858	0DDD		MLH R13, R13
585A	3D64		MOVE $C8, R13
585C	2D63		MOVE R13, $C6
585E	9D03		CLR R13, #$03
5860	3D63		MOVE $C6, R13
5862	0BAC		MHL R11, R10
5864	05BE		GETB R11, $5
5866	8101		LBI R1, #$01
5868	CB16		SBC R11, R1
586A	A027		BRA $5894		; $28(R0)

586C	2179		MOVE R1, $F2
586E	2D64		MOVE R13, $C8
5870	CD12		SE R13, R1
5872	A017		BRA $588C		; $18(R0)

5874	011C		MHL R1, R1
5876	0DDC		MHL R13, R13
5878	CD12		SE R13, R1
587A	A00F		BRA $588C		; $10(R0)

587C	8D55		LBI R13, #$55
587E	0DDD		MLH R13, R13
5880	8D2E		LBI R13, #$2E
5882	3D75		MOVE $EA, R13
5884	0DBC		MHL R13, R11
5886	9D80		CLR R13, #$80
5888	0BDD		MLH R11, R13
588A	9410		CLR R4, #$10
588C	0BAC		MHL R11, R10
588E	05BE		GETB R11, $5
5890	8101		LBI R1, #$01
5892	CB16		SBC R11, R1
5894	A0F5		BRA $598C		; $F6(R0)

5896	8120		LBI R1, #$20
5898	C415		SBS R4, R1
589A	A0FD		BRA $599A		; $FE(R0)

589C	2F64		MOVE R15, $C8
589E	0DFC		MHL R13, R15
58A0	8110		LBI R1, #$10
58A2	CB17		SBSH R11, R1
58A4	A02F		BRA $58D6		; $30(R0)

58A6	8104		LBI R1, #$04
58A8	C416		SBC R4, R1
58AA	A015		BRA $58C2		; $16(R0)

58AC	2E49		MOVE R14, $92
58AE	0CEC		MHL R12, R14
58B0	CDC2		SE R13, R12
58B2	A04B		BRA $5900		; $4C(R0)

58B4	CFE2		SE R15, R14
58B6	A047		BRA $5900		; $48(R0)

58B8	01BC		MHL R1, R11
58BA	9110		CLR R1, #$10
58BC	0B1D		MLH R11, R1
58BE	A03F		BRA $5900		; $40(R0)

58C0	A0AF		BRA $5972		; $B0(R0)

58C2	2E48		MOVE R14, $90
58C4	0CEC		MHL R12, R14
58C6	CDC2		SE R13, R12
58C8	A075		BRA $5940		; $76(R0)

58CA	CFE2		SE R15, R14
58CC	A071		BRA $5940		; $72(R0)

58CE	01BC		MHL R1, R11
58D0	9110		CLR R1, #$10
58D2	0B1D		MLH R11, R1
58D4	A069		BRA $5940		; $6A(R0)

58D6	8104		LBI R1, #$04
58D8	C416		SBC R4, R1
58DA	A03F		BRA $591C		; $40(R0)

58DC	2E48		MOVE R14, $90
58DE	0CEC		MHL R12, R14
58E0	CDC2		SE R13, R12
58E2	A0DB		BRA $59C0		; $DC(R0)

58E4	CFE2		SE R15, R14
58E6	A0D7		BRA $59C0		; $D8(R0)

58E8	2E49		MOVE R14, $92
58EA	0CEC		MHL R12, R14
58EC	CDC2		SE R13, R12
58EE	A003		BRA $58F4		; $04(R0)

58F0	CEFA		SNE R14, R15
58F2	A005		BRA $58FA		; $06(R0)

58F4	01BC		MHL R1, R11
58F6	B110		SET R1, #$10
58F8	0B1D		MLH R11, R1
58FA	284C		MOVE R8, $98
58FC	2F4D		MOVE R15, $9A
58FE	A007		BRA $5908		; $08(R0)

5900	A700		ADD R7, #$01
5902	2140		MOVE R1, $80
5904	C712		SE R7, R1
5906	A03D		BRA $5946		; $3E(R0)

5908	2750		MOVE R7, $A0
590A	0BAC		MHL R11, R10
590C	05BE		GETB R11, $5
590E	8101		LBI R1, #$01
5910	CB16		SBC R11, R1
5912	A077		BRA $598C		; $78(R0)

5914	0203		INC2 R2, R0
5916	A0EF		BRA $5A08		; $F0(R0)

5918	A800		ADD R8, #$01
591A	A029		BRA $5946		; $2A(R0)

591C	2E49		MOVE R14, $92
591E	0CEC		MHL R12, R14
5920	CDC2		SE R13, R12
5922	A09B		BRA $59C0		; $9C(R0)

5924	CEF2		SE R14, R15
5926	A097		BRA $59C0		; $98(R0)

5928	2E48		MOVE R14, $90
592A	0CEC		MHL R12, R14
592C	CDC2		SE R13, R12
592E	A003		BRA $5934		; $04(R0)

5930	CEFA		SNE R14, R15
5932	A005		BRA $593A		; $06(R0)

5934	01BC		MHL R1, R11
5936	B110		SET R1, #$10
5938	0B1D		MLH R11, R1
593A	284D		MOVE R8, $9A
593C	2F4C		MOVE R15, $98
593E	A083		BRA $59C4		; $84(R0)

5940	C70B		SNZ R7
5942	A07F		BRA $59C4		; $80(R0)

5944	F700		SUB R7, #$01
5946	0BAC		MHL R11, R10
5948	05BE		GETB R11, $5
594A	8101		LBI R1, #$01
594C	CB16		SBC R11, R1
594E	A03B		BRA $598C		; $3C(R0)

5950	8103		LBI R1, #$03
5952	C41E		SNBC R4, R1
5954	A025		BRA $597C		; $26(R0)

5956	8102		LBI R1, #$02
5958	C415		SBS R4, R1
595A	A021		BRA $597E		; $22(R0)

595C	2950		MOVE R9, $A0
595E	8101		LBI R1, #$01
5960	C417		SBSH R4, R1
5962	A019		BRA $597E		; $1A(R0)

5964	81F8		LBI R1, #$F8
5966	C716		SBC R7, R1
5968	A013		BRA $597E		; $14(R0)

596A	8101		LBI R1, #$01
596C	C716		SBC R7, R1
596E	8905		LBI R9, #$05
5970	A00B		BRA $597E		; $0C(R0)

5972	1500		CTRL $5, #$00
5974	8150		LBI R1, #$50
5976	011D		MLH R1, R1
5978	81A8		LBI R1, #$A8
597A	0014		RET R1

597C	0974		MOVE R9, R7
597E	8159		LBI R1, #$59
5980	011D		MLH R1, R1
5982	8198		LBI R1, #$98
5984	0998		ADD R9, R9
5986	0998		ADD R9, R9
5988	0198		ADD R1, R9
598A	0014		RET R1

598C	3174		MOVE $E8, R1
598E	1552		CTRL $5, #$52
5990	8153		LBI R1, #$53
5992	011D		MLH R1, R1
5994	8112		LBI R1, #$12
5996	0014		RET R1

5998	1560		CTRL $5, #$60
599A	A03D		BRA $59DA		; $3E(R0)

599C	15EC		CTRL $5, #$EC
599E	A039		BRA $59DA		; $3A(R0)

59A0	156C		CTRL $5, #$6C
59A2	A035		BRA $59DA		; $36(R0)

59A4	15E4		CTRL $5, #$E4
59A6	A031		BRA $59DA		; $32(R0)

59A8	1564		CTRL $5, #$64
59AA	A02D		BRA $59DA		; $2E(R0)

59AC	15E8		CTRL $5, #$E8
59AE	A029		BRA $59DA		; $2A(R0)

59B0	1568		CTRL $5, #$68
59B2	A025		BRA $59DA		; $26(R0)

59B4	15E0		CTRL $5, #$E0
59B6	A021		BRA $59DA		; $22(R0)

59B8	1560		CTRL $5, #$60
59BA	A01D		BRA $59DA		; $1E(R0)

59BC	1560		CTRL $5, #$60
59BE	A019		BRA $59DA		; $1A(R0)

59C0	1554		CTRL $5, #$54
59C2	A015		BRA $59DA		; $16(R0)

59C4	2740		MOVE R7, $80
59C6	F700		SUB R7, #$01
59C8	0BAC		MHL R11, R10
59CA	05BE		GETB R11, $5
59CC	8101		LBI R1, #$01
59CE	CB16		SBC R11, R1
59D0	F045		BRA $598C		; -> -$46(R0)

59D2	0203		INC2 R2, R0
59D4	A031		BRA $5A08		; $32(R0)

59D6	F800		SUB R8, #$01
59D8	F093		BRA $5946		; -> -$94(R0)

59DA	1522		CTRL $5, #$22
59DC	8152		LBI R1, #$52
59DE	011D		MLH R1, R1
59E0	81AE		LBI R1, #$AE
59E2	0014		RET R1

59E4	0DFC		MHL R13, R15
59E6	0CEC		MHL R12, R14
59E8	8180		LBI R1, #$80
59EA	CD16		SBC R13, R1
59EC	A011		BRA $5A00		; $12(R0)

59EE	CC16		SBC R12, R1
59F0	0024		RET R2

59F2	CCD0		SLE R12, R13
59F4	A005		BRA $59FC		; $06(R0)

59F6	CDC2		SE R13, R12
59F8	0024		RET R2

59FA	CEF0		SLE R14, R15
59FC	A201		ADD R2, #$02
59FE	0024		RET R2

5A00	8180		LBI R1, #$80
5A02	CC15		SBS R12, R1
5A04	F009		BRA $59FC		; -> -$0A(R0)

5A06	F00D		BRA $59FA		; -> -$0E(R0)

5A08	3277		MOVE $EE, R2
5A0A	8101		LBI R1, #$01
5A0C	C416		SBC R4, R1
5A0E	A049		BRA $5A5A		; $4A(R0)

5A10	8102		LBI R1, #$02
5A12	C416		SBC R4, R1
5A14	A01D		BRA $5A34		; $1E(R0)

5A16	0203		INC2 R2, R0
5A18	A0CF		BRA $5AEA		; $D0(R0)

5A1A	0004		NOP
5A1C	0BAC		MHL R11, R10
5A1E	05BE		GETB R11, $5
5A20	8101		LBI R1, #$01
5A22	CB16		SBC R11, R1
5A24	F099		BRA $598C		; -> -$9A(R0)

5A26	15D4		CTRL $5, #$D4
5A28	8100		LBI R1, #$00
5A2A	011D		MLH R1, R1
5A2C	8158		LBI R1, #$58
5A2E	A100		ADD R1, #$01
5A30	4518		PUTB $5, (R1)
5A32	2077		JMP ($00EE)

5A34	0203		INC2 R2, R0
5A36	A0B1		BRA $5AEA		; $B2(R0)

5A38	0004		NOP
5A3A	0203		INC2 R2, R0
5A3C	A0F5		BRA $5B34		; $F6(R0)

5A3E	A00D		BRA $5A4E		; $0E(R0)

5A40	2C50		MOVE R12, $A0
5A42	09C4		MOVE R9, R12
5A44	014C		MHL R1, R4
5A46	9101		CLR R1, #$01
5A48	041D		MLH R4, R1
5A4A	F031		BRA $5A1A		; -> -$32(R0)

5A4C	F0DB		BRA $5972		; -> -$DC(R0)

5A4E	2C50		MOVE R12, $A0
5A50	8C00		LBI R12, #$00
5A52	014C		MHL R1, R4
5A54	B101		SET R1, #$01
5A56	041D		MLH R4, R1
5A58	F03F		BRA $5A1A		; -> -$40(R0)

5A5A	8144		LBI R1, #$44
5A5C	0DBC		MHL R13, R11
5A5E	CD16		SBC R13, R1
5A60	A06D		BRA $5AD0		; $6E(R0)

5A62	2D7A		MOVE R13, $F4
5A64	8177		LBI R1, #$77
5A66	CD12		SE R13, R1
5A68	A005		BRA $5A70		; $06(R0)

5A6A	0DDC		MHL R13, R13
5A6C	CD1A		SNE R13, R1
5A6E	A00B		BRA $5A7C		; $0C(R0)

5A70	0203		INC2 R2, R0
5A72	A027		BRA $5A9C		; $28(R0)

5A74	A005		BRA $5A7C		; $06(R0)

5A76	8101		LBI R1, #$01
5A78	C815		SBS R8, R1
5A7A	F03B		BRA $5A40		; -> -$3C(R0)

5A7C	0BAC		MHL R11, R10
5A7E	05BE		GETB R11, $5
5A80	8101		LBI R1, #$01
5A82	CB16		SBC R11, R1
5A84	F0F9		BRA $598C		; -> -$FA(R0)

5A86	2C50		MOVE R12, $A0
5A88	6C88		MOVB R12, (R8)
5A8A	09C4		MOVE R9, R12
5A8C	E0CC		SHR R12
5A8E	E0CC		SHR R12
5A90	0998		ADD R9, R9
5A92	99F9		CLR R9, #$F9
5A94	A900		ADD R9, #$01
5A96	2150		MOVE R1, $A0
5A98	7188		MOVB (R8), R1
5A9A	F081		BRA $5A1A		; -> -$82(R0)

5A9C	3276		MOVE $EC, R2
5A9E	0BAC		MHL R11, R10
5AA0	05BE		GETB R11, $5
5AA2	8101		LBI R1, #$01
5AA4	CB16		SBC R11, R1
5AA6	F023		BRA $5A84		; -> -$24(R0)

5AA8	2F4F		MOVE R15, $9E
5AAA	0E84		MOVE R14, R8
5AAC	0203		INC2 R2, R0
5AAE	A0F3		BRA $5BA4		; $F4(R0)

5AB0	A001		BRA $5AB4		; $02(R0)

5AB2	2076		JMP ($00EC)

5AB4	0FE4		MOVE R15, R14
5AB6	2E4E		MOVE R14, $9C
5AB8	0203		INC2 R2, R0
5ABA	A0E7		BRA $5BA4		; $E8(R0)

5ABC	A001		BRA $5AC0		; $02(R0)

5ABE	2076		JMP ($00EC)

5AC0	0BAC		MHL R11, R10
5AC2	05BE		GETB R11, $5
5AC4	8101		LBI R1, #$01
5AC6	CB16		SBC R11, R1
5AC8	F045		BRA $5A84		; -> -$46(R0)

5ACA	2276		MOVE R2, $EC
5ACC	A201		ADD R2, #$02
5ACE	0024		RET R2

5AD0	0203		INC2 R2, R0
5AD2	F037		BRA $5A9C		; -> -$38(R0)

5AD4	F059		BRA $5A7C		; -> -$5A(R0)

5AD6	0E6C		MHL R14, R6
5AD8	AE00		ADD R14, #$01
5ADA	9EFC		CLR R14, #$FC
5ADC	06ED		MLH R6, R14
5ADE	8103		LBI R1, #$03
5AE0	CE12		SE R14, R1
5AE2	F0A3		BRA $5A40		; -> -$A4(R0)

5AE4	8E00		LBI R14, #$00
5AE6	06ED		MLH R6, R14
5AE8	F06D		BRA $5A7C		; -> -$6E(R0)

5AEA	6C88		MOVB R12, (R8)
5AEC	8101		LBI R1, #$01
5AEE	C416		SBC R4, R1
5AF0	A01D		BRA $5B10		; $1E(R0)

5AF2	8140		LBI R1, #$40
5AF4	CC18		SGT R12, R1
5AF6	A011		BRA $5B0A		; $12(R0)

5AF8	CC04		SS R12
5AFA	0024		RET R2

5AFC	0C4C		MHL R12, R4
5AFE	8108		LBI R1, #$08
5B00	0C17		XOR R12, R1
5B02	04CD		MLH R4, R12
5B04	8110		LBI R1, #$10
5B06	CC16		SBC R12, R1
5B08	A00B		BRA $5B16		; $0C(R0)

5B0A	8C40		LBI R12, #$40
5B0C	A201		ADD R2, #$02
5B0E	0024		RET R2

5B10	CC03		SZ R12
5B12	0024		RET R2

5B14	F009		BRA $5B0C		; -> -$0A(R0)

5B16	C8F2		SE R8, R15
5B18	A007		BRA $5B22		; $08(R0)

5B1A	018C		MHL R1, R8
5B1C	0CFC		MHL R12, R15
5B1E	CC1A		SNE R12, R1
5B20	F017		BRA $5B0A		; -> -$18(R0)

5B22	A800		ADD R8, #$01
5B24	8104		LBI R1, #$04
5B26	C416		SBC R4, R1
5B28	F801		SUB R8, #$02
5B2A	6C88		MOVB R12, (R8)
5B2C	CC04		SS R12
5B2E	F045		BRA $5AEA		; -> -$46(R0)

5B30	8F40		LBI R15, #$40
5B32	F0E7		BRA $5A4C		; -> -$E8(R0)

5B34	8101		LBI R1, #$01
5B36	C416		SBC R4, R1
5B38	A053		BRA $5B8E		; $54(R0)

5B3A	816D		LBI R1, #$6D
5B3C	CC1A		SNE R12, R1
5B3E	0024		RET R2

5B40	2151		MOVE R1, $A2
5B42	011D		MLH R1, R1
5B44	8120		LBI R1, #$20
5B46	C11F		SNBSH R1, R1
5B48	A039		BRA $5B84		; $3A(R0)

5B4A	8140		LBI R1, #$40
5B4C	CC1A		SNE R12, R1
5B4E	0023		INC2 R0, R2
5B50	CC18		SGT R12, R1
5B52	A02F		BRA $5B84		; $30(R0)

5B54	8174		LBI R1, #$74
5B56	CC11		SLT R12, R1
5B58	A029		BRA $5B84		; $2A(R0)

5B5A	814A		LBI R1, #$4A
5B5C	CC19		SGE R12, R1
5B5E	0024		RET R2

5B60	8150		LBI R1, #$50
5B62	CC18		SGT R12, R1
5B64	A01D		BRA $5B84		; $1E(R0)

5B66	815A		LBI R1, #$5A
5B68	CC19		SGE R12, R1
5B6A	0024		RET R2

5B6C	8161		LBI R1, #$61
5B6E	CC18		SGT R12, R1
5B70	A011		BRA $5B84		; $12(R0)

5B72	816A		LBI R1, #$6A
5B74	CC19		SGE R12, R1
5B76	0024		RET R2

5B78	8170		LBI R1, #$70
5B7A	CC1A		SNE R12, R1
5B7C	0024		RET R2

5B7E	8173		LBI R1, #$73
5B80	CC1A		SNE R12, R1
5B82	0024		RET R2

5B84	094C		MHL R9, R4
5B86	8108		LBI R1, #$08
5B88	C916		SBC R9, R1
5B8A	0024		RET R2

5B8C	0023		INC2 R0, R2
5B8E	0624		MOVE R6, R2
5B90	0CCD		MLH R12, R12
5B92	292B		MOVE R9, $56
5B94	8140		LBI R1, #$40
5B96	C91F		SNBSH R9, R1
5B98	A0A1		BRA $5C3C		; $A2(R0)

5B9A	8104		LBI R1, #$04
5B9C	C91F		SNBSH R9, R1
5B9E	A09B		BRA $5C3C		; $9C(R0)

5BA0	AE08		ADD R14, #$09
5BA2	0203		INC2 R2, R0
5BA4	A0BB		BRA $5C62		; $BC(R0)

5BA6	A001		BRA $5BAA		; $02(R0)

5BA8	A025		BRA $5BD0		; $26(R0)

5BAA	0264		MOVE R2, R6
5BAC	06E2		INC R6, R14
5BAE	066D		MLH R6, R6
5BB0	0783		INC2 R7, R8
5BB2	0E84		MOVE R14, R8
5BB4	0CCC		MHL R12, R12
5BB6	6971		MOVB R9, (R7)++
5BB8	0C95		AND R12, R9
5BBA	C762		SE R7, R6
5BBC	F007		BRA $5BB6		; -> -$08(R0)

5BBE	CC0D		SNBS R12, R0
5BC0	A013		BRA $5BD6		; $14(R0)

5BC2	292B		MOVE R9, $56
5BC4	019C		MHL R1, R9
5BC6	B105		SET R1, #$05
5BC8	091D		MLH R9, R1
5BCA	392B		MOVE $56, R9
5BCC	066C		MHL R6, R6
5BCE	A005		BRA $5BD6		; $06(R0)

5BD0	0264		MOVE R2, R6
5BD2	06F2		INC R6, R15
5BD4	0E84		MOVE R14, R8
5BD6	2950		MOVE R9, $A0
5BD8	0C9C		MHL R12, R9
5BDA	69E0		MOVB R9, (R14)+
5BDC	C903		SZ R9
5BDE	A005		BRA $5BE6		; $06(R0)

5BE0	CE62		SE R14, R6
5BE2	F009		BRA $5BDA		; -> -$0A(R0)

5BE4	A01B		BRA $5C02		; $1C(R0)

5BE6	8101		LBI R1, #$01
5BE8	C915		SBS R9, R1
5BEA	A007		BRA $5BF4		; $08(R0)

5BEC	AC00		ADD R12, #$01
5BEE	8119		LBI R1, #$19
5BF0	CC11		SLT R12, R1
5BF2	A003		BRA $5BF8		; $04(R0)

5BF4	E09C		SHR R9
5BF6	F01B		BRA $5BDC		; -> -$1C(R0)

5BF8	292B		MOVE R9, $56
5BFA	019C		MHL R1, R9
5BFC	B141		SET R1, #$41
5BFE	091D		MLH R9, R1
5C00	392B		MOVE $56, R9
5C02	0E84		MOVE R14, R8
5C04	0CCC		MHL R12, R12
5C06	01F4		MOVE R1, R15
5C08	C812		SE R8, R1
5C0A	A007		BRA $5C14		; $08(R0)

5C0C	01FC		MHL R1, R15
5C0E	098C		MHL R9, R8
5C10	C91A		SNE R9, R1
5C12	0023		INC2 R0, R2
5C14	09E4		MOVE R9, R14
5C16	A900		ADD R9, #$01
5C18	6998		MOVB R9, (R9)
5C1A	09C5		AND R9, R12
5C1C	C90B		SNZ R9
5C1E	A009		BRA $5C2A		; $0A(R0)

5C20	292B		MOVE R9, $56
5C22	019C		MHL R1, R9
5C24	B103		SET R1, #$03
5C26	091D		MLH R9, R1
5C28	392B		MOVE $56, R9
5C2A	292B		MOVE R9, $56
5C2C	8101		LBI R1, #$01
5C2E	C917		SBSH R9, R1
5C30	0023		INC2 R0, R2
5C32	019C		MHL R1, R9
5C34	9101		CLR R1, #$01
5C36	091D		MLH R9, R1
5C38	392B		MOVE $56, R9
5C3A	0024		RET R2

5C3C	07F4		MOVE R7, R15
5C3E	FE08		SUB R14, #$09
5C40	0FE4		MOVE R15, R14
5C42	2E4C		MOVE R14, $98
5C44	0203		INC2 R2, R0
5C46	A019		BRA $5C62		; $1A(R0)

5C48	A007		BRA $5C52		; $08(R0)

5C4A	0264		MOVE R2, R6
5C4C	0682		INC R6, R8
5C4E	0F74		MOVE R15, R7
5C50	F07B		BRA $5BD6		; -> -$7C(R0)

5C52	0264		MOVE R2, R6
5C54	0EF4		MOVE R14, R15
5C56	0F74		MOVE R15, R7
5C58	0683		INC2 R6, R8
5C5A	07E2		INC R7, R14
5C5C	0182		INC R1, R8
5C5E	061D		MLH R6, R1
5C60	F0AD		BRA $5BB4		; -> -$AE(R0)

5C62	09FC		MHL R9, R15
5C64	0CEC		MHL R12, R14
5C66	C9C0		SLE R9, R12
5C68	A005		BRA $5C70		; $06(R0)

5C6A	C9CA		SNE R9, R12
5C6C	CEF0		SLE R14, R15
5C6E	A201		ADD R2, #$02
5C70	0024		RET R2
; ----

5C72..	0000		dw 0
5FDC
; ----

; Setup routine

5FDE	8105		LBI R1, #$05
5FE0	011D		MLH R1, R1
5FE2	8103		LBI R1, #$03
5FE4	31E2		MOVE $1C4, R1		; $1C4 <- $0503

			; Put address of printer I/O supervisor routine
			; into vector table (entry for system device 5)
5FE6	814A		LBI R1, #$4A
5FE8	011D		MLH R1, R1
5FEA	8100		LBI R1, #$00		; $4A00
5FEC	246C		MOVE R4, $D8
5FEE	A413		ADD R4, #$14
5FF0	5148		MOVE (R4), R1

			; Setup system variable for I/O supervisor
5FF2	8140		LBI R1, #$40
5FF4	011D		MLH R1, R1
5FF6	8100		LBI R1, #$00
5FF8	3157		MOVE $AE, R1

			; Return to caller
5FFA	0824		MOVE R8, R2
5FFC	2056		JMP ($00AC)

			; Entry point of setup routine
5FFE	F021		BRA $5FDE

; **********************************************************************
; *** END OF ROS PART 3
; **********************************************************************

; **********************************************************************
; *** BEGIN OF ROS PART 4
; **********************************************************************

; ***************************
; Device F (Tape) I/O Routine
; ***************************

6000	3269		MOVE $D2, R2		; Save R2
6002	1F40		CTRL $F, #$40		; Reset tape adapter

6004	2853		MOVE R8, $A6
6006	0203		INC2 R2, R0
6008	2056		JMP ($00AC)		; Test device
600A	A047		BRA $6054		; Device error

600C	0E34		MOVE R14, R3
600E	AE0F		ADD R14, #$10		; IOCB_Stat1
6010	85E2		LBI R5, #$E2
6012	055D		MLH R5, R5
6014	8584		LBI R5, #$84
6016	55E8		MOVE (R14), R5		; IOCB_Stat1 <- $E284
6018	2862		MOVE R8, $C4
601A	0203		INC2 R2, R0
601C	2056		JMP ($00AC)
601E	A033		BRA $6054		; Error

6020	0531		DEC R5, R3
6022	3540		MOVE $80, R5

6024	2E40		MOVE R14, $80
6026	AE04		ADD R14, #$05
6028	D5E8		MOVE R5, (R14)		; IOCB_BA
602A	F500		SUB R5, #$01
602C	3542		MOVE $84, R5

602E	2E40		MOVE R14, $80
6030	AE0A		ADD R14, #$0B
6032	D5E8		MOVE R5, (R14)		; IOCB_WA
6034	0F54		MOVE R15, R5
6036	F500		SUB R5, #$01
6038	3541		MOVE $82, R5
603A	AF25		ADD R15, #$26

603C	2E40		MOVE R14, $80
603E	AE00		ADD R14, #$01
6040	65E8		MOVB R5, (R14)		; IOCB_DA
6042	810E		LBI R1, #$0E
6044	C152		SE R1, R5
6046	A013		BRA $605C		; Error, not device E

6048	2E40		MOVE R14, $80
604A	AE02		ADD R14, #$03		; IOCB_Cmd
604C	65E8		MOVB R5, (R14)
604E	C50B		SNZ R5
6050	A0FB		BRA $614E		; Sense
6052	A00F		BRA $6064		; Other command
; ---

			; Exit
6054	8161		LBI R1, #$61
6056	011D		MLH R1, R1
6058	81AE		LBI R1, #$AE
605A	0014		RET R1			; JMP $61AE
; ---

			; Error 02
605C	8161		LBI R1, #$61
605E	011D		MLH R1, R1
6060	8198		LBI R1, #$98
6062	0014		RET R1			; JMP $6198
; ---

			; Command other than Sense
6064	2E40		MOVE R14, $80
6066	AE0A		ADD R14, #$0B		; IOCB_WA
6068	D5E8		MOVE R5, (R14)
606A	055C		MHL R5, R5
606C	C50B		SNZ R5
606E	F013		BRA $605C		; Error, no WA specified

6070	8561		LBI R5, #$61
6072	055D		MLH R5, R5
6074	8550		LBI R5, #$50		; R5 <- $6150
6076	354D		MOVE $9A, R5

6078	857B		LBI R5, #$7B
607A	055D		MLH R5, R5
607C	851A		LBI R5, #$1A		; R5 <- $7B1A
607E	354E		MOVE $9C, R5

6080	2E41		MOVE R14, $82
6082	AE10		ADD R14, #$11
6084	D5E8		MOVE R5, (R14)		; IOCB_WA+$10
6086	3549		MOVE $92, R5

			; CLR 3FFF
6088	2149		MOVE R1, $92
608A	91FF		CLR R1, #$FF
608C	0E1C		MHL R14, R1
608E	9E3F		CLR R14, #$3F
6090	01ED		MLH R1, R14
6092	3149		MOVE $92, R1

			; Save several IOCB values
6094	2E41		MOVE R14, $82
6096	AE02		ADD R14, #$03
6098	D5E8		MOVE R5, (R14)
609A	3576		MOVE $EC, R5		; IOCB_WA+2
609C	AE01		ADD R14, #$02
609E	D5E8		MOVE R5, (R14)
60A0	3577		MOVE $EE, R5		; IOCB_WA+4
60A2	AE03		ADD R14, #$04
60A4	D5E8		MOVE R5, (R14)
60A6	3578		MOVE $F0, R5		; IOCB_WA+8
60A8	AE01		ADD R14, #$02
60AA	D5E8		MOVE R5, (R14)
60AC	3579		MOVE $F2, R5		; IOCB_WA+A
60AE	AE09		ADD R14, #$0A
60B0	D5E8		MOVE R5, (R14)
60B2	357A		MOVE $F4, R5		; IOCB_WA+14
60B4	AE03		ADD R14, #$04
60B6	D5E8		MOVE R5, (R14)
60B8	357B		MOVE $F6, R5		; IOCB_WA+18
60BA	2E40		MOVE R14, $80
60BC	AE08		ADD R14, #$09
60BE	D5E8		MOVE R5, (R14)
60C0	3574		MOVE $E8, R5		; IOCB_CI1
60C2	AE03		ADD R14, #$04
60C4	D5E8		MOVE R5, (R14)
60C6	3575		MOVE $EA, R5		; IOCB_Ret

			; Call I/O switch
60C8	8161		LBI R1, #$61
60CA	011D		MLH R1, R1
60CC	81B4		LBI R1, #$B4
60CE	304B		MOVE $96, R0		; save return address
60D0	204D		JMP ($009A)

			; Restore IOCB
60D2	2576		MOVE R5, $EC
60D4	2E41		MOVE R14, $82
60D6	AE02		ADD R14, #$03
60D8	55E8		MOVE (R14), R5		; IOCB_WA+2
60DA	AE01		ADD R14, #$02
60DC	2577		MOVE R5, $EE
60DE	55E8		MOVE (R14), R5		; IOCB_WA+4
60E0	AE03		ADD R14, #$04
60E2	2578		MOVE R5, $F0
60E4	55E8		MOVE (R14), R5		; IOCB_WA+8
60E6	AE01		ADD R14, #$02
60E8	2579		MOVE R5, $F2
60EA	55E8		MOVE (R14), R5		; IOCB_WA+A
60EC	AE09		ADD R14, #$0A
60EE	257A		MOVE R5, $F4
60F0	55E8		MOVE (R14), R5		; IOCB_WA+14
60F2	AE03		ADD R14, #$04
60F4	257B		MOVE R5, $F6
60F6	55E8		MOVE (R14), R5		; IOCB_WA+18
60F8	2574		MOVE R5, $E8
60FA	2E40		MOVE R14, $80
60FC	AE08		ADD R14, #$09
60FE	55E8		MOVE (R14), R5		; IOCB_CI1
6100	AE03		ADD R14, #$04
6102	2575		MOVE R5, $EA
6104	55E8		MOVE (R14), R5		; IOCB_Ret

			; Test for error 02
6106	2E40		MOVE R14, $80
6108	AE0C		ADD R14, #$0D
610A	D5E8		MOVE R5, (R14)		; IOCB_Ret
610C	81F2		LBI R1, #$F2
610E	C152		SE R1, R5
6110	A009		BRA $611C		; $0A(R0)
6112	055C		MHL R5, R5
6114	81F0		LBI R1, #$F0
6116	C152		SE R1, R5
6118	A001		BRA $611C		; $02(R0)
611A	A00B		BRA $6128		; $0C(R0)

			; No error 02
611C	2E40		MOVE R14, $80
611E	AE02		ADD R14, #$03
6120	65E8		MOVB R5, (R14)		; IOCB_Cmd
6122	2E41		MOVE R14, $82
6124	AE0E		ADD R14, #$0F
6126	55E8		MOVE (R14), R5		; Save last command in WA

			; CLR 0200
6128	2149		MOVE R1, $92
612A	9100		CLR R1, #$00
612C	0E1C		MHL R14, R1
612E	9E02		CLR R14, #$02
6130	01ED		MLH R1, R14
6132	3149		MOVE $92, R1

			; Store copy of IOCB_WA+10 back in IOCB_WA+10
6134	2549		MOVE R5, $92
6136	2E41		MOVE R14, $82
6138	AE10		ADD R14, #$11
613A	55E8		MOVE (R14), R5

			; Reset system flags
613C	2552		MOVE R5, $A4
613E	015C		MHL R1, R5
6140	9102		CLR R1, #$02		; clear I/O active
6142	051D		MLH R5, R1
6144	9508		CLR R5, #$08		; ?
6146	3552		MOVE $A4, R5

			; Return to caller
6148	2269		MOVE R2, $D2
614A	0824		MOVE R8, R2
614C	2056		JMP ($00AC)
; ----------------------------------------------------------------------

614E	A00B		BRA $615C		; $0C(R0)
; ----------------------------------------------------------------------

6150	314C		MOVE $98, R1

6152	214B		MOVE R1, $96		; return address
6154	AF01		ADD R15, #$02
6156	A101		ADD R1, #$02
6158	51F8		MOVE (R15), R1

615A	204C		JMP ($0098)		; jump to desired routine
; ----------------------------------------------------------------------

			; Tape Sense

615C	1EFF		CTRL $E, #$FF
615E	0E5E		GETB R5, $E

6160	8540		LBI R5, #$40
6162	EE5F		STAT R5, $E
6164	3547		MOVE $8E, R5		; Tape status byte

6166	9593		CLR R5, #$93
6168	8104		LBI R1, #$04
616A	C512		SE R5, R1
616C	A031		BRA $61A0		; LED or erase defective

			; Setup tape IOCB

616E	8502		LBI R5, #$02
6170	055D		MLH R5, R5
6172	8500		LBI R5, #$00		; R5 <- $0200
6174	2E40		MOVE R14, $80
6176	AE06		ADD R14, #$07		; IOCB_BS
6178	55E8		MOVE (R14), R5

617A	8500		LBI R5, #$00
617C	055D		MLH R5, R5
617E	853A		LBI R5, #$3A		; R5 <- $003A
6180	2E40		MOVE R14, $80
6182	AE08		ADD R14, #$09		; IOCB_CI1
6184	55E8		MOVE (R14), R5

6186	85E2		LBI R5, #$E2
6188	055D		MLH R5, R5
618A	8584		LBI R5, #$84		; R5 <- $E284
618C	2E40		MOVE R14, $80
618E	AE10		ADD R14, #$11		; IOCB_Stat1
6190	55E8		MOVE (R14), R5

6192	2269		MOVE R2, $D2		; Restore R2
6194	0824		MOVE R8, R2
6196	2056		JMP ($00AC)		; Exit
; ----------

			; Error 02
6198	85F0		LBI R5, #$F0
619A	055D		MLH R5, R5
619C	85F2		LBI R5, #$F2
619E	A005		BRA $61A6		; $06(R0)

			; Error 13
61A0	85F1		LBI R5, #$F1
61A2	055D		MLH R5, R5
61A4	85F3		LBI R5, #$F3

61A6	2E40		MOVE R14, $80
61A8	AE0C		ADD R14, #$0D
61AA	55E8		MOVE (R14), R5
61AC	3048		MOVE $90, R0

61AE	2269		MOVE R2, $D2		; Restore R2
61B0	0824		MOVE R8, R2
61B2	2056		JMP ($00AC)		; Exit
; ----------------------------------------------------------------------

			; Set processor flags
61B4	2552		MOVE R5, $A4
61B6	015C		MHL R1, R5
61B8	B102		SET R1, #$02		; set I/O active
61BA	051D		MLH R5, R1
61BC	9520		CLR R5, #$20		; level 2 ROS
61BE	B508		SET R5, #$08
61C0	8108		LBI R1, #$08
61C2	C517		SBSH R5, R1
61C4	A00D		BRA $61D4		; no ATTN

			; SET 0200 - ATTN pressed
61C6	2149		MOVE R1, $92
61C8	B100		SET R1, #$00
61CA	0E1C		MHL R14, R1
61CC	BE02		SET R14, #$02
61CE	01ED		MLH R1, R14
61D0	3149		MOVE $92, R1

61D2	1446		CTRL $4, #$46

61D4	3552		MOVE $A4, R5
61D6	8200		LBI R2, #$00
61D8	022D		MLH R2, R2
61DA	82A5		LBI R2, #$A5
61DC	4028		PUTB $0, (R2)

			; Check flags whether ATTN should be ignored
61DE	2E40		MOVE R14, $80
61E0	AE03		ADD R14, #$04
61E2	65E8		MOVB R5, (R14)		; IOCB_Flags
61E4	8180		LBI R1, #$80
61E6	C51E		SNBC R5, R1
61E8	A00B		BRA $61F6

			; SET 0100 - ignore ATTN
61EA	2149		MOVE R1, $92
61EC	B100		SET R1, #$00
61EE	0E1C		MHL R14, R1
61F0	BE01		SET R14, #$01
61F2	01ED		MLH R1, R14
61F4	3149		MOVE $92, R1

61F6	2E40		MOVE R14, $80
61F8	AE02		ADD R14, #$03
61FA	65E8		MOVB R5, (R14)		; IOCB_Cmd
61FC	810D		LBI R1, #$0D
61FE	C510		SLE R5, R1
6200	A0DB		BRA $62DE		; error 02

			; Command 00..0D
6202	F500		SUB R5, #$01
6204	0558		ADD R5, R5

			; Check previous command and fail if it was
			; Translate Only (or anything not strictly
			; tape related)
6206	2E41		MOVE R14, $82
6208	AE0E		ADD R14, #$0F
620A	D6E8		MOVE R6, (R14)		; get previous command
620C	810B		LBI R1, #$0B
620E	C610		SLE R6, R1
6210	A0CB		BRA $62DE		; error 02
6212	0668		ADD R6, R6

			; Command switch
6214	0058		ADD R0, R5
6216	A013		BRA $622C		; Read
6218	A02B		BRA $6246		; Write
621A	A029		BRA $6246		; Write Last
621C	A041		BRA $6260		; Find
621E	A041		BRA $6262		; Mark
6220	A059		BRA $627C		; Initialize and Mark
6222	A065		BRA $628A		; Rewind
6224	A065		BRA $628C		; Forward Space Record
6226	A07D		BRA $62A6		; Backward Space Record
6228	A095		BRA $62C0		; Find Next Header
622A	A095		BRA $62C2		; Write Header

			; Previous commands allowed for Read
622C	0068		ADD R0, R6
622E	A0AD		BRA $62DE		; error 02
6230	A0C3		BRA $62F6		; Read
6232	A0C1		BRA $62F6		; Write
6234	A0BF		BRA $62F6		; Write Last
6236	A0BD		BRA $62F6		; Find
6238	A0A3		BRA $62DE		; error 02
623A	A0A1		BRA $62DE		; error 02
623C	A09F		BRA $62DE		; error 02
623E	A0B5		BRA $62F6		; Forward Space Record
6240	A0B3		BRA $62F6		; Backward Space Record
6242	A0B1		BRA $62F6		; Find Next Header
6244	A097		BRA $62DE		; error 02

			; Previous commands allowed for Write/Write Last
6246	0068		ADD R0, R6
6248	A093		BRA $62DE		; error 02
624A	A09D		BRA $62EA		; Read
624C	A09B		BRA $62EA		; Write
624E	A099		BRA $62EA		; Write Last
6250	A097		BRA $62EA		; Find
6252	A089		BRA $62DE		; error 02
6254	A087		BRA $62DE		; error 02
6256	A085		BRA $62DE		; error 02
6258	A08F		BRA $62EA		; Forward Space Record
625A	A08D		BRA $62EA		; Backward Space Record
625C	A08B		BRA $62EA		; Find Next Header
625E	A089		BRA $62EA		; Write Header

			; Find
6260	A0DB		BRA $633E		; $DC(R0)

			; Previous commands allowed for Mark
6262	0068		ADD R0, R6
6264	A077		BRA $62DE		; error 02
6266	A075		BRA $62DE		; error 02
6268	A073		BRA $62DE		; error 02
626A	A071		BRA $62DE		; error 02
626C	A07B		BRA $62EA		; Find
626E	A079		BRA $62EA		; Mark
6270	A077		BRA $62EA		; Initialize and Mark
6272	A069		BRA $62DE		; error 02
6274	A067		BRA $62DE		; error 02
6276	A065		BRA $62DE		; error 02
6278	A06F		BRA $62EA		; Find Next Header
627A	A061		BRA $62DE		; error 02

			; Initialize and Mark
627C	8540		LBI R5, #$40
627E	EE5F		STAT R5, $E
6280	3547		MOVE $8E, R5
6282	8115		LBI R1, #$15
6284	C512		SE R5, R1
6286	A05B		BRA $62E4		; error 05
6288	A0B3		BRA $633E		; $B4(R0)

			; Rewind
628A	A0B1		BRA $633E		; $B2(R0)

			; Previous commands allowed for Forward Space Record
628C	0068		ADD R0, R6
628E	A04D		BRA $62DE		; error 02
6290	A063		BRA $62F6		; Read
6292	A049		BRA $62DE		; error 02
6294	A047		BRA $62DE		; error 02
6296	A05D		BRA $62F6		; Find
6298	A043		BRA $62DE		; error 02
629A	A041		BRA $62DE		; error 02
629C	A03F		BRA $62DE		; error 02
629E	A055		BRA $62F6		; Forward Space Record
62A0	A03B		BRA $62DE		; error 02
62A2	A051		BRA $62F6		; Find Next Header
62A4	A04F		BRA $62F6		; Write Header

			; Previous commands allowed for Backward Space Record
62A6	0068		ADD R0, R6
62A8	A033		BRA $62DE		; error 02
62AA	A049		BRA $62F6		; Read
62AC	A047		BRA $62F6		; Write
62AE	A045		BRA $62F6		; Write Last
62B0	A02B		BRA $62DE		; error 02
62B2	A029		BRA $62DE		; error 02
62B4	A027		BRA $62DE		; error 02
62B6	A025		BRA $62DE		; error 02
62B8	A03B		BRA $62F6		; Forward Space Record
62BA	A039		BRA $62F6		; Backward Space Record
62BC	A01F		BRA $62DE		; error 02
62BE	A01D		BRA $62DE		; error 02

			; Find Next Header
62C0	A07B		BRA $633E		; $7C(R0)

			; Previous commands allowed for Write Header
62C2	0068		ADD R0, R6
62C4	A017		BRA $62DE		; error 02
62C6	A015		BRA $62DE		; error 02
62C8	A013		BRA $62DE		; error 02
62CA	A011		BRA $62DE		; error 02
62CC	A01B		BRA $62EA		; Find
62CE	A00D		BRA $62DE		; error 02
62D0	A00B		BRA $62DE		; error 02
62D2	A009		BRA $62DE		; error 02
62D4	A007		BRA $62DE		; error 02
62D6	A005		BRA $62DE		; error 02
62D8	A00F		BRA $62EA		; Find Next Header
62DA	A001		BRA $62DE		; error 02
62DC	0004		NOP
; ----------------------------------------------------------------------

			; Error 02
			; Invalid command or sequence
62DE	8102		LBI R1, #$02
62E0	3048		MOVE $90, R0
62E2	204E		JMP ($009C)

			; Error 05
			; Cartridge not inserted
62E4	8100		LBI R1, #$00
62E6	3048		MOVE $90, R0
62E8	204E		JMP ($009C)
; ----------------------------------------------------------------------

			; Entry for: Write / Write Last / Mark / Write Header

			; Check drive and cartridge
62EA	8540		LBI R5, #$40
62EC	EE5F		STAT R5, $E
62EE	3547		MOVE $8E, R5
62F0	8115		LBI R1, #$15
62F2	C512		SE R5, R1
62F4	F011		BRA $62E4		; error 05

			; Entry for: Read / Forward Space Record /
			; Backward Space Record

62F6	2676		MOVE R6, $EC		; current file number
62F8	016C		MHL R1, R6
62FA	0166		OR R1, R6
62FC	C10B		SNZ R1
62FE	F021		BRA $62DE		; error 02

6300	2E40		MOVE R14, $80
6302	AE02		ADD R14, #$03
6304	65E8		MOVB R5, (R14)		; IOCB_Cmd
6306	2679		MOVE R6, $F2
6308	0558		ADD R5, R5
630A	0058		ADD R0, R5

630C	0000		HALT			; Sense
630E	A013		BRA $6324		; Read
6310	A011		BRA $6324		; Write
6312	A00F		BRA $6324		; Write Last
6314	0000		HALT			; Find
6316	A025		BRA $633E		; Mark
6318	0000		HALT			; Initialize and Mark
631A	0000		HALT			; Rewind
631C	A017		BRA $6336		; Forward Space Record
631E	A015		BRA $6336		; Backward Space Record
6320	0000		HALT			; Find Next Header
6322	A015		BRA $633A		; Write Header

			; Check if IOCB_BS is $0200
6324	2E40		MOVE R14, $80
6326	AE06		ADD R14, #$07
6328	D5E8		MOVE R5, (R14)		; IOCB_BS
632A	C503		SZ R5
632C	F04F		BRA $62DE		; error 02
632E	8E02		LBI R14, #$02
6330	055C		MHL R5, R5
6332	C5E2		SE R5, R14
6334	F057		BRA $62DE		; error 02

			; Check file number
6336	C60B		SNZ R6
6338	F05B		BRA $62DE		; error 02
633A	C60C		SNS R6
633C	A0AB		BRA $63EA		; error 11

			; Entry for: Find / Rewind / Find Next Header /
			; Initialize and Mark

633E	2E40		MOVE R14, $80
6340	AE02		ADD R14, #$03		; IOCB_Cmd
6342	65E8		MOVB R5, (R14)
6344	F500		SUB R5, #$01
6346	E05F		SWAP R5
6348	E05D		ROR R5
634A	0654		MOVE R6, R5
634C	E06D		ROR R6
634E	0568		ADD R5, R6
6350	0058		ADD R0, R5

			; Read
6352	8163		LBI R1, #$63
6354	011D		MLH R1, R1
6356	81F0		LBI R1, #$F0
6358	304B		MOVE $96, R0
635A	204D		JMP ($009A)
635C	A079		BRA $63D8		; $7A(R0)

			; Write
635E	8164		LBI R1, #$64
6360	011D		MLH R1, R1
6362	8154		LBI R1, #$54
6364	304B		MOVE $96, R0
6366	204D		JMP ($009A)
6368	A06D		BRA $63D8		; $6E(R0)

			; Write Last
636A	8164		LBI R1, #$64
636C	011D		MLH R1, R1
636E	8154		LBI R1, #$54
6370	304B		MOVE $96, R0
6372	204D		JMP ($009A)
6374	A061		BRA $63D8		; $62(R0)

			; Find
6376	8165		LBI R1, #$65
6378	011D		MLH R1, R1
637A	813C		LBI R1, #$3C
637C	304B		MOVE $96, R0
637E	204D		JMP ($009A)
6380	A055		BRA $63D8		; $56(R0)

			; Mark
6382	8165		LBI R1, #$65
6384	011D		MLH R1, R1
6386	8168		LBI R1, #$68
6388	304B		MOVE $96, R0
638A	204D		JMP ($009A)
638C	D0F5		JMP (R15)-

			; Initialize and Mark
638E	8165		LBI R1, #$65
6390	011D		MLH R1, R1
6392	8168		LBI R1, #$68
6394	304B		MOVE $96, R0
6396	204D		JMP ($009A)
6398	D0F5		JMP (R15)-

			; Rewind
639A	8167		LBI R1, #$67
639C	011D		MLH R1, R1
639E	81A4		LBI R1, #$A4
63A0	304B		MOVE $96, R0
63A2	204D		JMP ($009A)
63A4	D0F5		JMP (R15)-

			; Forward Space Record
63A6	8167		LBI R1, #$67
63A8	011D		MLH R1, R1
63AA	81B6		LBI R1, #$B6
63AC	304B		MOVE $96, R0
63AE	204D		JMP ($009A)
63B0	A025		BRA $63D8		; $26(R0)

			; Backward Space Record
63B2	8167		LBI R1, #$67
63B4	011D		MLH R1, R1
63B6	81DC		LBI R1, #$DC
63B8	304B		MOVE $96, R0
63BA	204D		JMP ($009A)
63BC	A019		BRA $63D8		; $1A(R0)

			; Find Next Header
63BE	8168		LBI R1, #$68
63C0	011D		MLH R1, R1
63C2	810E		LBI R1, #$0E
63C4	304B		MOVE $96, R0
63C6	204D		JMP ($009A)
63C8	A00D		BRA $63D8		; $0E(R0)

			; Write Header
63CA	8168		LBI R1, #$68
63CC	011D		MLH R1, R1
63CE	8148		LBI R1, #$48
63D0	304B		MOVE $96, R0
63D2	204D		JMP ($009A)
63D4	A001		BRA $63D8		; $02(R0)

63D6	0004		NOP

			; Handle end of tape
63D8	8171		LBI R1, #$71
63DA	011D		MLH R1, R1
63DC	818A		LBI R1, #$8A
63DE	304B		MOVE $96, R0
63E0	204D		JMP ($009A)
63E2	D0F5		JMP (R15)-

			; Clear file number and return
63E4	2550		MOVE R5, $A0
63E6	3576		MOVE $EC, R5
63E8	D0F5		JMP (R15)-
; ----------------------------------------------------------------------

			; Error 11
63EA	810B		LBI R1, #$0B
63EC	3048		MOVE $90, R0
63EE	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Read
;

63F0	8169		LBI R1, #$69
63F2	011D		MLH R1, R1
63F4	810C		LBI R1, #$0C
63F6	304B		MOVE $96, R0
63F8	204D		JMP ($009A)
63FA	D0F5		JMP (R15)-		; Error return

			; CLR 0040 - read data into buffer
63FC	2149		MOVE R1, $92
63FE	9140		CLR R1, #$40
6400	0E1C		MHL R14, R1
6402	9E00		CLR R14, #$00
6404	01ED		MLH R1, R14
6406	3149		MOVE $92, R1

			; Read one file block
6408	816B		LBI R1, #$6B
640A	011D		MLH R1, R1
640C	8132		LBI R1, #$32
640E	304B		MOVE $96, R0
6410	204D		JMP ($009A)
6412	D0F5		JMP (R15)-		; Error return

			; Check data record ID byte
6414	2544		MOVE R5, $88
6416	8142		LBI R1, #$42		; EOD?
6418	C15A		SNE R1, R5
641A	A017		BRA $6434		; yes

641C	8124		LBI R1, #$24		; Bad Record?
641E	C152		SE R1, R5
6420	A029		BRA $644C		; no, return

			; Bad Record, check if it should be skipped
6422	2E40		MOVE R14, $80
6424	AE03		ADD R14, #$04
6426	65E8		MOVB R5, (R14)		; IOCB_Flags
6428	8108		LBI R1, #$08
642A	C515		SBS R5, R1
642C	F025		BRA $6408		; yes, skip

			; Error 07
			; CRC error
642E	8107		LBI R1, #$07
6430	3048		MOVE $90, R0
6432	204E		JMP ($009C)

			; End of Data
6434	816E		LBI R1, #$6E
6436	011D		MLH R1, R1
6438	810E		LBI R1, #$0E
643A	304B		MOVE $96, R0
643C	204D		JMP ($009A)
643E	D0F5		JMP (R15)-

			; Error 09
			; End of Data
6440	2577		MOVE R5, $EE
6442	F500		SUB R5, #$01
6444	3574		MOVE $E8, R5
6446	8109		LBI R1, #$09
6448	3048		MOVE $90, R0
644A	204E		JMP ($009C)

			; Return
644C	2577		MOVE R5, $EE
644E	F500		SUB R5, #$01
6450	3574		MOVE $E8, R5
6452	D0F5		JMP (R15)-

; ----------------------------------------------------------------------
;
; Write / Write Last
;

			; Position tape
6454	8169		LBI R1, #$69
6456	011D		MLH R1, R1
6458	810C		LBI R1, #$0C
645A	304B		MOVE $96, R0
645C	204D		JMP ($009A)
645E	D0F5		JMP (R15)-

			; Record ID byte
6460	8518		LBI R5, #$18		; data record
6462	3545		MOVE $8A, R5

			; Write file block
6464	816C		LBI R1, #$6C
6466	011D		MLH R1, R1
6468	817A		LBI R1, #$7A
646A	304B		MOVE $96, R0
646C	204D		JMP ($009A)
646E	D0F5		JMP (R15)-		; general error
6470	A021		BRA $6494		; OK

			; Write error

			; Record ID
6472	8524		LBI R5, #$24		; bad record
6474	3545		MOVE $8A, R5

			; Write file block
6476	816C		LBI R1, #$6C
6478	011D		MLH R1, R1
647A	817A		LBI R1, #$7A
647C	304B		MOVE $96, R0
647E	204D		JMP ($009A)
6480	D0F5		JMP (R15)-		; general error
6482	A001		BRA $6486		; OK
6484	A0AF		BRA $6536		; error 07

			; Record ID successfully changed to 'bad'

			; Skip bad blocks?			
6486	2E40		MOVE R14, $80
6488	AE03		ADD R14, #$04		; IOCB_Flags
648A	65E8		MOVB R5, (R14)
648C	8108		LBI R1, #$08
648E	C516		SBC R5, R1
6490	A0A3		BRA $6536		; no, error 07
6492	F03F		BRA $6454		; yes, write data to next block

			; Tape block successfully written without error

			; Store last tape block number as result
			; in IOCB_CI1
6494	2577		MOVE R5, $EE
6496	F500		SUB R5, #$01
6498	3574		MOVE $E8, R5

			; Update EOD if block written was pas previous EOD
649A	0754		MOVE R7, R5
649C	2E41		MOVE R14, $82
649E	AE06		ADD R14, #$07
64A0	D6E8		MOVE R6, (R14)		; EOD
64A2	0659		SUB R6, R5
64A4	056C		MHL R5, R6
64A6	066D		MLH R6, R6
64A8	065C		MHL R6, R5
64AA	0569		SUB R5, R6
64AC	066C		MHL R6, R6
64AE	065D		MLH R6, R5
64B0	8180		LBI R1, #$80
64B2	C617		SBSH R6, R1
64B4	A005		BRA $64BC
64B6	2E41		MOVE R14, $82
64B8	AE06		ADD R14, #$07
64BA	57E8		MOVE (R14), R7

			; Was command a 'Write Last' ?
64BC	2E40		MOVE R14, $80
64BE	AE02		ADD R14, #$03		; IOCB_Cmd
64C0	65E8		MOVB R5, (R14)
64C2	8103		LBI R1, #$03		; Write Last
64C4	C152		SE R1, R5
64C6	D0F5		JMP (R15)-		; no, return

			; Update EOD to last written block number
64C8	2577		MOVE R5, $EE
64CA	F500		SUB R5, #$01
64CC	2E41		MOVE R14, $82
64CE	AE06		ADD R14, #$07
64D0	55E8		MOVE (R14), R5

64D2	2578		MOVE R5, $F0		; marked file size
64D4	0154		MOVE R1, R5
64D6	0518		ADD R5, R1
64D8	015C		MHL R1, R5
64DA	011A		ADDH R1, R1
64DC	051D		MLH R5, R1

64DE	2677		MOVE R6, $EE
64E0	0569		SUB R5, R6
64E2	065C		MHL R6, R5
64E4	055D		MLH R5, R5
64E6	056C		MHL R5, R6
64E8	0659		SUB R6, R5
64EA	055C		MHL R5, R5
64EC	056D		MLH R5, R6
64EE	8180		LBI R1, #$80
64F0	C51F		SNBSH R5, R1
64F2	D0F5		JMP (R15)-		; file completely filled

			; Record ID byte
64F4	8542		LBI R5, #$42		; last data block
64F6	3545		MOVE $8A, R5

			; Write file block (again, now with updated ID)
64F8	816C		LBI R1, #$6C
64FA	011D		MLH R1, R1
64FC	817A		LBI R1, #$7A
64FE	304B		MOVE $96, R0
6500	204D		JMP ($009A)
6502	D0F5		JMP (R15)-		; general error
6504	A021		BRA $6528		; OK

			; Write error, mark block as bad

			; Record ID byte
6506	8524		LBI R5, #$24		; bad record
6508	3545		MOVE $8A, R5

			; Write file block
650A	816C		LBI R1, #$6C
650C	011D		MLH R1, R1
650E	817A		LBI R1, #$7A
6510	304B		MOVE $96, R0
6512	204D		JMP ($009A)
6514	D0F5		JMP (R15)-		; general error
6516	A001		BRA $651A		; OK
6518	A01B		BRA $6536		; very bad... error 07

			; Record ID successfully changed to 'bad'

			; Skip bad blocks?			
651A	2E40		MOVE R14, $80
651C	AE03		ADD R14, #$04
651E	65E8		MOVB R5, (R14)
6520	8108		LBI R1, #$08
6522	C516		SBC R5, R1
6524	A00F		BRA $6536		; no, error 07
6526	F05F		BRA $64C8		; yes, write data to next block

			; Write Last succeeded without error

			; Backspace one file block and return
6528	816E		LBI R1, #$6E
652A	011D		MLH R1, R1
652C	810E		LBI R1, #$0E
652E	304B		MOVE $96, R0
6530	204D		JMP ($009A)
6532	D0F5		JMP (R15)-
6534	D0F5		JMP (R15)-

			; Error 07
6536	8107		LBI R1, #$07
6538	3048		MOVE $90, R0
653A	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Find
;

653C	2574		MOVE R5, $E8		; IOCB_CI1
653E	015C		MHL R1, R5
6540	0156		OR R1, R5
6542	C10B		SNZ R1			; file number <> 0 ?
6544	A01B		BRA $6562		; no, error 02

6546	8180		LBI R1, #$80
6548	C51F		SNBSH R5, R1		; file number positive?
654A	A015		BRA $6562		; no, error 02

654C	2574		MOVE R5, $E8
654E	2E41		MOVE R14, $82
6550	AE00		ADD R14, #$01		; IOCB_WA
6552	55E8		MOVE (R14), R5		; store file number in WA

6554	8169		LBI R1, #$69
6556	011D		MLH R1, R1
6558	81D6		LBI R1, #$D6
655A	304B		MOVE $96, R0
655C	204D		JMP ($009A)
655E	D0F5		JMP (R15)-
6560	D0F5		JMP (R15)-

			; Error 02
6562	8102		LBI R1, #$02
6564	3048		MOVE $90, R0
6566	204E		JMP ($009C)
; ----------------------------------------------------------------------
;
; Mark / Initialize and Mark
;

			; SET 0100
6568	2149		MOVE R1, $92
656A	B100		SET R1, #$00
656C	0E1C		MHL R14, R1
656E	BE01		SET R14, #$01
6570	01ED		MLH R1, R14
6572	3149		MOVE $92, R1

			; Clear tape buffer
6574	816B		LBI R1, #$6B
6576	011D		MLH R1, R1
6578	8116		LBI R1, #$16
657A	304B		MOVE $96, R0
657C	204D		JMP ($009A)

657E	2550		MOVE R5, $A0
6580	357B		MOVE $F6, R5

6582	2574		MOVE R5, $E8
6584	015C		MHL R1, R5
6586	0156		OR R1, R5
6588	C10B		SNZ R1
658A	A005		BRA $6592
658C	065C		MHL R6, R5
658E	963F		CLR R6, #$3F
6590	C603		SZ R6
6592	A0DF		BRA $6674		; error 02
6594	3578		MOVE $F0, R5

6596	2E40		MOVE R14, $80
6598	AE0E		ADD R14, #$0F
659A	D5E8		MOVE R5, (R14)		; IOCB_CI2
659C	015C		MHL R1, R5
659E	0156		OR R1, R5
65A0	C10B		SNZ R1
65A2	A0CF		BRA $6674		; error 02
65A4	8180		LBI R1, #$80
65A6	C51F		SNBSH R5, R1
65A8	A0C9		BRA $6674		; error 02

65AA	2E40		MOVE R14, $80
65AC	AE02		ADD R14, #$03
65AE	67E8		MOVB R7, (R14)		; IOCB_Cmd
65B0	8106		LBI R1, #$06
65B2	C17A		SNE R1, R7
65B4	A011		BRA $65C8		; Initialize and Mark

			; Mark
65B6	2676		MOVE R6, $EC
65B8	0568		ADD R5, R6
65BA	065C		MHL R6, R5
65BC	066A		ADDH R6, R6
65BE	056D		MLH R5, R6
65C0	8180		LBI R1, #$80
65C2	C51F		SNBSH R5, R1
65C4	A0AD		BRA $6674		; error 02
65C6	A047		BRA $6610		; $48(R0)

			; Initialize and Mark
			; SET 0010
65C8	2149		MOVE R1, $92
65CA	B110		SET R1, #$10
65CC	0E1C		MHL R14, R1
65CE	BE00		SET R14, #$00
65D0	01ED		MLH R1, R14
65D2	3149		MOVE $92, R1

65D4	8171		LBI R1, #$71
65D6	011D		MLH R1, R1
65D8	8146		LBI R1, #$46
65DA	304B		MOVE $96, R0
65DC	204D		JMP ($009A)
65DE	D0F5		JMP (R15)-

65E0	2550		MOVE R5, $A0
65E2	3577		MOVE $EE, R5

65E4	8500		LBI R5, #$00
65E6	055D		MLH R5, R5
65E8	8501		LBI R5, #$01
65EA	3576		MOVE $EC, R5

			; Record type
65EC	8581		LBI R5, #$81		; header record
65EE	3543		MOVE $86, R5
65F0	3545		MOVE $8A, R5

			; Write tape record
65F2	8170		LBI R1, #$70
65F4	011D		MLH R1, R1
65F6	81FA		LBI R1, #$FA
65F8	304B		MOVE $96, R0
65FA	204D		JMP ($009A)
65FC	A009		BRA $6608		; $0A(R0)

65FE	8500		LBI R5, #$00
6600	055D		MLH R5, R5
6602	8501		LBI R5, #$01
6604	3577		MOVE $EE, R5
6606	A007		BRA $6610		; $08(R0)

6608	8167		LBI R1, #$67
660A	011D		MLH R1, R1
660C	8186		LBI R1, #$86
660E	0014		RET R1

6610	816A		LBI R1, #$6A
6612	011D		MLH R1, R1
6614	8174		LBI R1, #$74
6616	304B		MOVE $96, R0
6618	204D		JMP ($009A)
661A	A05D		BRA $667A		; $5E(R0)

661C	257B		MOVE R5, $F6
661E	2E40		MOVE R14, $80
6620	AE0E		ADD R14, #$0F
6622	D6E8		MOVE R6, (R14)
6624	0569		SUB R5, R6
6626	065C		MHL R6, R5
6628	055D		MLH R5, R5
662A	056C		MHL R5, R6
662C	0659		SUB R6, R5
662E	055C		MHL R5, R5
6630	056D		MLH R5, R6
6632	015C		MHL R1, R5
6634	0156		OR R1, R5
6636	C103		SZ R1
6638	F029		BRA $6610		; -> -$2A(R0)

663A	816E		LBI R1, #$6E
663C	011D		MLH R1, R1
663E	810E		LBI R1, #$0E
6640	304B		MOVE $96, R0
6642	204D		JMP ($009A)
6644	A033		BRA $667A		; $34(R0)

6646	85FF		LBI R5, #$FF
6648	2E42		MOVE R14, $84
664A	AE00		ADD R14, #$01
664C	75E8		MOVB (R14), R5
664E	3579		MOVE $F2, R5

6650	2576		MOVE R5, $EC
6652	2E42		MOVE R14, $84
6654	AE01		ADD R14, #$02
6656	015C		MHL R1, R5
6658	71E0		MOVB (R14)+, R1
665A	75E4		MOVB (R14)-, R5

665C	8581		LBI R5, #$81
665E	3545		MOVE $8A, R5

6660	816C		LBI R1, #$6C
6662	011D		MLH R1, R1
6664	817A		LBI R1, #$7A
6666	304B		MOVE $96, R0
6668	204D		JMP ($009A)
666A	A00D		BRA $667A		; $0E(R0)
666C	D0F5		JMP (R15)-

			; Error 07
666E	8107		LBI R1, #$07
6670	3048		MOVE $90, R0
6672	204E		JMP ($009C)

			; Error 02
6674	8102		LBI R1, #$02
6676	3048		MOVE $90, R0
6678	204E		JMP ($009C)

			; CLR 0010
667A	2149		MOVE R1, $92
667C	9110		CLR R1, #$10
667E	0E1C		MHL R14, R1
6680	9E00		CLR R14, #$00
6682	01ED		MLH R1, R14
6684	3149		MOVE $92, R1

6686	8171		LBI R1, #$71
6688	011D		MLH R1, R1
668A	818A		LBI R1, #$8A
668C	304B		MOVE $96, R0
668E	204D		JMP ($009A)
6690	D0F5		JMP (R15)-

6692	2550		MOVE R5, $A0
6694	3575		MOVE $EA, R5

6696	2577		MOVE R5, $EE
6698	F501		SUB R5, #$02
669A	8180		LBI R1, #$80
669C	C51F		SNBSH R5, R1
669E	A03D		BRA $66DE		; $3E(R0)

66A0	F502		SUB R5, #$03
66A2	8180		LBI R1, #$80
66A4	C51F		SNBSH R5, R1
66A6	A081		BRA $672A		; $82(R0)

66A8	A501		ADD R5, #$02
66AA	0654		MOVE R6, R5
66AC	967F		CLR R6, #$7F
66AE	016C		MHL R1, R6
66B0	0166		OR R1, R6
66B2	C103		SZ R1
66B4	F501		SUB R5, #$02
66B6	065C		MHL R6, R5
66B8	E05D		ROR R5
66BA	E06D		ROR R6
66BC	0764		MOVE R7, R6
66BE	9580		CLR R5, #$80
66C0	9680		CLR R6, #$80
66C2	977F		CLR R7, #$7F
66C4	0576		OR R5, R7
66C6	056D		MLH R5, R6
66C8	3574		MOVE $E8, R5

66CA	257B		MOVE R5, $F6
66CC	A500		ADD R5, #$01
66CE	2E40		MOVE R14, $80
66D0	AE0E		ADD R14, #$0F
66D2	55E8		MOVE (R14), R5

66D4	2576		MOVE R5, $EC
66D6	2E41		MOVE R14, $82
66D8	AE00		ADD R14, #$01
66DA	55E8		MOVE (R14), R5
66DC	A02D		BRA $670C		; $2E(R0)

66DE	257B		MOVE R5, $F6
66E0	015C		MHL R1, R5
66E2	0156		OR R1, R5
66E4	C10B		SNZ R1
66E6	A041		BRA $672A		; $42(R0)

66E8	2578		MOVE R5, $F0
66EA	F500		SUB R5, #$01
66EC	0654		MOVE R6, R5
66EE	963F		CLR R6, #$3F
66F0	016C		MHL R1, R6
66F2	0166		OR R1, R6
66F4	C103		SZ R1
66F6	F500		SUB R5, #$01
66F8	3574		MOVE $E8, R5
66FA	257B		MOVE R5, $F6
66FC	2E40		MOVE R14, $80
66FE	AE0E		ADD R14, #$0F
6700	55E8		MOVE (R14), R5

6702	2576		MOVE R5, $EC
6704	F500		SUB R5, #$01
6706	2E41		MOVE R14, $82
6708	AE00		ADD R14, #$01
670A	55E8		MOVE (R14), R5

670C	8169		LBI R1, #$69
670E	011D		MLH R1, R1
6710	81D6		LBI R1, #$D6
6712	304B		MOVE $96, R0
6714	204D		JMP ($009A)
6716	A06D		BRA $6786		; $6E(R0)

6718	2574		MOVE R5, $E8
671A	3578		MOVE $F0, R5

671C	816A		LBI R1, #$6A
671E	011D		MLH R1, R1
6720	8174		LBI R1, #$74
6722	304B		MOVE $96, R0
6724	204D		JMP ($009A)
6726	A05D		BRA $6786		; $5E(R0)
6728	A01B		BRA $6746		; $1C(R0)

672A	257B		MOVE R5, $F6
672C	2E40		MOVE R14, $80
672E	AE0E		ADD R14, #$0F
6730	55E8		MOVE (R14), R5

6732	2576		MOVE R5, $EC
6734	2E41		MOVE R14, $82
6736	AE00		ADD R14, #$01
6738	55E8		MOVE (R14), R5

673A	8169		LBI R1, #$69
673C	011D		MLH R1, R1
673E	81D6		LBI R1, #$D6
6740	304B		MOVE $96, R0
6742	204D		JMP ($009A)
6744	A03F		BRA $6786		; $40(R0)

6746	816E		LBI R1, #$6E
6748	011D		MLH R1, R1
674A	810E		LBI R1, #$0E
674C	304B		MOVE $96, R0
674E	204D		JMP ($009A)
6750	A033		BRA $6786		; $34(R0)

6752	85FF		LBI R5, #$FF
6754	2E42		MOVE R14, $84
6756	AE00		ADD R14, #$01
6758	75E8		MOVB (R14), R5
675A	3579		MOVE $F2, R5

675C	2576		MOVE R5, $EC
675E	2E42		MOVE R14, $84
6760	AE01		ADD R14, #$02
6762	015C		MHL R1, R5
6764	71E0		MOVB (R14)+, R1
6766	75E4		MOVB (R14)-, R5

6768	8581		LBI R5, #$81
676A	3545		MOVE $8A, R5

676C	816C		LBI R1, #$6C
676E	011D		MLH R1, R1
6770	817A		LBI R1, #$7A
6772	304B		MOVE $96, R0
6774	204D		JMP ($009A)
6776	A00D		BRA $6786		; OK
6778	A005		BRA $6780		; error 12

			; Error 07
677A	8107		LBI R1, #$07
677C	3048		MOVE $90, R0
677E	204E		JMP ($009C)

			; Error 12
6780	810C		LBI R1, #$0C
6782	3048		MOVE $90, R0
6784	204E		JMP ($009C)

			; CLR 0010
6786	2149		MOVE R1, $92
6788	9110		CLR R1, #$10
678A	0E1C		MHL R14, R1
678C	9E00		CLR R14, #$00
678E	01ED		MLH R1, R14
6790	3149		MOVE $92, R1

6792	8171		LBI R1, #$71
6794	011D		MLH R1, R1
6796	818A		LBI R1, #$8A
6798	304B		MOVE $96, R0
679A	204D		JMP ($009A)
679C	D0F5		JMP (R15)-

			; Error 03
679E	8103		LBI R1, #$03
67A0	3048		MOVE $90, R0
67A2	204E		JMP ($009C)

67A4	2550		MOVE R5, $A0
67A6	3576		MOVE $EC, R5

67A8	8171		LBI R1, #$71
67AA	011D		MLH R1, R1
67AC	8146		LBI R1, #$46
67AE	304B		MOVE $96, R0
67B0	204D		JMP ($009A)
67B2	D0F5		JMP (R15)-
67B4	D0F5		JMP (R15)-
; ----------------------------------------------------------------------

			; SET 0040
67B6	2149		MOVE R1, $92
67B8	B140		SET R1, #$40
67BA	0E1C		MHL R14, R1
67BC	BE00		SET R14, #$00
67BE	01ED		MLH R1, R14
67C0	3149		MOVE $92, R1

67C2	2E40		MOVE R14, $80
67C4	AE03		ADD R14, #$04
67C6	65E8		MOVB R5, (R14)
67C8	8108		LBI R1, #$08
67CA	C516		SBC R5, R1
67CC	A007		BRA $67D6		; error 02

67CE	8164		LBI R1, #$64
67D0	011D		MLH R1, R1
67D2	8108		LBI R1, #$08
67D4	0014		RET R1

			; Error 02
67D6	8102		LBI R1, #$02
67D8	3048		MOVE $90, R0
67DA	204E		JMP ($009C)
; ----------------------------------------------------------------------

67DC	2E40		MOVE R14, $80
67DE	AE03		ADD R14, #$04
67E0	65E8		MOVB R5, (R14)
67E2	8108		LBI R1, #$08
67E4	C516		SBC R5, R1
67E6	A019		BRA $6802		; error 02

67E8	2577		MOVE R5, $EE
67EA	F500		SUB R5, #$01
67EC	015C		MHL R1, R5
67EE	0156		OR R1, R5
67F0	C10B		SNZ R1
67F2	A013		BRA $6808		; error 10

67F4	816E		LBI R1, #$6E
67F6	011D		MLH R1, R1
67F8	810E		LBI R1, #$0E
67FA	304B		MOVE $96, R0
67FC	204D		JMP ($009A)
67FE	D0F5		JMP (R15)-
6800	D0F5		JMP (R15)-

			; Error 02
6802	8102		LBI R1, #$02
6804	3048		MOVE $90, R0
6806	204E		JMP ($009C)

			; Error 10
6808	810A		LBI R1, #$0A
680A	3048		MOVE $90, R0
680C	204E		JMP ($009C)
; ----------------------------------------------------------------------

680E	2576		MOVE R5, $EC
6810	015C		MHL R1, R5
6812	0156		OR R1, R5
6814	C103		SZ R1
6816	A00F		BRA $6828		; $10(R0)

6818	8170		LBI R1, #$70
681A	011D		MLH R1, R1
681C	81C6		LBI R1, #$C6
681E	304B		MOVE $96, R0
6820	204D		JMP ($009A)
6822	A011		BRA $6836		; $12(R0)

6824	2550		MOVE R5, $A0
6826	3579		MOVE $F2, R5

6828	816E		LBI R1, #$6E
682A	011D		MLH R1, R1
682C	818E		LBI R1, #$8E
682E	304B		MOVE $96, R0
6830	204D		JMP ($009A)
6832	D0F5		JMP (R15)-
6834	D0F5		JMP (R15)-

6836	8171		LBI R1, #$71
6838	011D		MLH R1, R1
683A	818A		LBI R1, #$8A
683C	304B		MOVE $96, R0
683E	204D		JMP ($009A)
6840	D0F5		JMP (R15)-

6842	2550		MOVE R5, $A0
6844	3575		MOVE $EA, R5
6846	F01F		BRA $6828		; -> -$20(R0)
; ----------------------------------------------------------------------

6848	2E42		MOVE R14, $84
684A	AE06		ADD R14, #$07
684C	61E0		MOVB R1, (R14)+
684E	65E4		MOVB R5, (R14)-
6850	051D		MLH R5, R1
6852	8180		LBI R1, #$80
6854	C51F		SNBSH R5, R1
6856	A0AD		BRA $6906		; error 02

6858	2678		MOVE R6, $F0
685A	0164		MOVE R1, R6
685C	0618		ADD R6, R1
685E	016C		MHL R1, R6
6860	011A		ADDH R1, R1
6862	061D		MLH R6, R1
6864	0154		MOVE R1, R5
6866	0619		SUB R6, R1
6868	016C		MHL R1, R6
686A	066D		MLH R6, R6
686C	061C		MHL R6, R1
686E	0169		SUB R1, R6
6870	066C		MHL R6, R6
6872	061D		MLH R6, R1
6874	8180		LBI R1, #$80
6876	C61F		SNBSH R6, R1
6878	A08B		BRA $6906		; error 02

687A	2E41		MOVE R14, $82
687C	AE0C		ADD R14, #$0D
687E	D5E8		MOVE R5, (R14)
6880	C503		SZ R5
6882	A01B		BRA $68A0		; $1C(R0)

6884	2E42		MOVE R14, $84
6886	AE05		ADD R14, #$06
6888	65E8		MOVB R5, (R14)
688A	C50B		SNZ R5
688C	A011		BRA $68A0		; $12(R0)

688E	2E42		MOVE R14, $84
6890	AE06		ADD R14, #$07
6892	61E0		MOVB R1, (R14)+
6894	65E4		MOVB R5, (R14)-
6896	051D		MLH R5, R1
6898	015C		MHL R1, R5
689A	0156		OR R1, R5
689C	C103		SZ R1
689E	A065		BRA $6906		; error 02

68A0	2E42		MOVE R14, $84
68A2	AE00		ADD R14, #$01
68A4	65E8		MOVB R5, (R14)
68A6	3579		MOVE $F2, R5

68A8	2E42		MOVE R14, $84
68AA	AE06		ADD R14, #$07
68AC	61E0		MOVB R1, (R14)+
68AE	65E4		MOVB R5, (R14)-
68B0	051D		MLH R5, R1
68B2	2E41		MOVE R14, $82
68B4	AE06		ADD R14, #$07
68B6	55E8		MOVE (R14), R5

68B8	2E42		MOVE R14, $84
68BA	AE05		ADD R14, #$06
68BC	65E8		MOVB R5, (R14)
68BE	2E41		MOVE R14, $82
68C0	AE0C		ADD R14, #$0D
68C2	55E8		MOVE (R14), R5

68C4	2576		MOVE R5, $EC
68C6	2E42		MOVE R14, $84
68C8	AE01		ADD R14, #$02
68CA	015C		MHL R1, R5
68CC	71E0		MOVB (R14)+, R1
68CE	75E4		MOVB (R14)-, R5

68D0	2578		MOVE R5, $F0
68D2	2E42		MOVE R14, $84
68D4	AE03		ADD R14, #$04
68D6	015C		MHL R1, R5
68D8	71E0		MOVB (R14)+, R1
68DA	75E4		MOVB (R14)-, R5

68DC	816E		LBI R1, #$6E
68DE	011D		MLH R1, R1
68E0	810E		LBI R1, #$0E
68E2	304B		MOVE $96, R0
68E4	204D		JMP ($009A)
68E6	D0F5		JMP (R15)-

68E8	8581		LBI R5, #$81
68EA	3545		MOVE $8A, R5

68EC	816C		LBI R1, #$6C
68EE	011D		MLH R1, R1
68F0	817A		LBI R1, #$7A
68F2	304B		MOVE $96, R0
68F4	204D		JMP ($009A)
68F6	D0F5		JMP (R15)-		; return
68F8	A005		BRA $6900		; return

			; Error 07
68FA	8107		LBI R1, #$07
68FC	3048		MOVE $90, R0
68FE	204E		JMP ($009C)

			; Return
6900	2550		MOVE R5, $A0
6902	3574		MOVE $E8, R5
6904	D0F5		JMP (R15)-

			; Error 02
6906	8102		LBI R1, #$02
6908	3048		MOVE $90, R0
690A	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Position tape at desired file block
;

690C	2E40		MOVE R14, $80
690E	AE03		ADD R14, #$04		; IOCB_Flags
6910	65E8		MOVB R5, (R14)
6912	8108		LBI R1, #$08
6914	C516		SBC R5, R1
6916	A017		BRA $6930		; skip bad records

			; Is it a read?
6918	2E40		MOVE R14, $80
691A	AE02		ADD R14, #$03
691C	65E8		MOVB R5, (R14)		; IOCB_Cmd
691E	8101		LBI R1, #$01
6920	C15A		SNE R1, R5
6922	A0A1		BRA $69C6		; yes, return

			; No, check for sequence rel. indicator
6924	2E41		MOVE R14, $82
6926	AE0C		ADD R14, #$0D
6928	D5E8		MOVE R5, (R14)
692A	C503		SZ R5
692C	A09B		BRA $69CA		; set, error 02
692E	A095		BRA $69C6		; not set, return

			; Skip bad records

			; Is it a read?
6930	2E40		MOVE R14, $80
6932	AE02		ADD R14, #$03
6934	65E8		MOVB R5, (R14)		; IOCB_Cmd
6936	8101		LBI R1, #$01
6938	C15A		SNE R1, R5
693A	A009		BRA $6946		; yes

			; No, check for sequence rel. indicator
693C	2E41		MOVE R14, $82
693E	AE0C		ADD R14, #$0D
6940	D5E8		MOVE R5, (R14)
6942	C50B		SNZ R5
6944	A083		BRA $69CA		; not set, error 02

			; Check requested tape block number
6946	2574		MOVE R5, $E8
6948	8180		LBI R1, #$80
694A	C51F		SNBSH R5, R1
694C	A07B		BRA $69CA		; negative, error 02

			; Check if request is past EOD
694E	2E41		MOVE R14, $82
6950	AE06		ADD R14, #$07
6952	D6E8		MOVE R6, (R14)		; EOD
6954	0569		SUB R5, R6
6956	065C		MHL R6, R5
6958	055D		MLH R5, R5
695A	056C		MHL R5, R6
695C	0659		SUB R6, R5
695E	055C		MHL R5, R5
6960	056D		MLH R5, R6
6962	8180		LBI R1, #$80
6964	C51F		SNBSH R5, R1
6966	A013		BRA $697C		; past EOD

			; Is it a read?
6968	2E40		MOVE R14, $80
696A	AE02		ADD R14, #$03
696C	66E8		MOVB R6, (R14)
696E	8101		LBI R1, #$01
6970	C16A		SNE R1, R6
6972	A05B		BRA $69D0		; yes

			; No, then operation must be at EOD
6974	015C		MHL R1, R5
6976	0156		OR R1, R5
6978	C103		SZ R1
697A	A04D		BRA $69CA		; error 02

			; Check if requested block equal to current block
697C	2574		MOVE R5, $E8
697E	A500		ADD R5, #$01
6980	2677		MOVE R6, $EE		; current block number
6982	0569		SUB R5, R6
6984	065C		MHL R6, R5
6986	055D		MLH R5, R5
6988	056C		MHL R5, R6
698A	0659		SUB R6, R5
698C	055C		MHL R5, R5
698E	056D		MLH R5, R6

6990	015C		MHL R1, R5
6992	0156		OR R1, R5
6994	C10B		SNZ R1
6996	A02D		BRA $69C6		; equal, return
6998	8180		LBI R1, #$80
699A	C51F		SNBSH R5, R1
699C	A019		BRA $69B8		; less than, backspace

			; Greater than, forward space
			; SET 0040 - don't store in buffer
699E	2149		MOVE R1, $92
69A0	B140		SET R1, #$40
69A2	0E1C		MHL R14, R1
69A4	BE00		SET R14, #$00
69A6	01ED		MLH R1, R14
69A8	3149		MOVE $92, R1

			; Read file block
69AA	816B		LBI R1, #$6B
69AC	011D		MLH R1, R1
69AE	8132		LBI R1, #$32
69B0	304B		MOVE $96, R0
69B2	204D		JMP ($009A)
69B4	D0F5		JMP (R15)-
69B6	F03B		BRA $697C		; loop

			; Backspace one file block
69B8	816E		LBI R1, #$6E
69BA	011D		MLH R1, R1
69BC	810E		LBI R1, #$0E
69BE	304B		MOVE $96, R0
69C0	204D		JMP ($009A)
69C2	D0F5		JMP (R15)-
69C4	F049		BRA $697C		; loop

			; Return
69C6	D1F5		MOVE R1, (R15)-
69C8	0013		INC2 R0, R1
; ----------------------------------------------------------------------

			; Error 02
			; Invalid command or sequence
69CA	8102		LBI R1, #$02
69CC	3048		MOVE $90, R0
69CE	204E		JMP ($009C)

			; Error 09
			; End of Data
69D0	8109		LBI R1, #$09
69D2	3048		MOVE $90, R0
69D4	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Find
;

			; Preset retry counter
69D6	2551		MOVE R5, $A2
69D8	8180		LBI R1, #$80
69DA	C517		SBSH R5, R1
69DC	A003		BRA $69E2
69DE	8502		LBI R5, #$02
69E0	A001		BRA $69E4
69E2	8507		LBI R5, #$07
69E4	2E41		MOVE R14, $82
69E6	AE12		ADD R14, #$13
69E8	55E8		MOVE (R14), R5

			; Check current file number (i.e. position of tape)
69EA	2676		MOVE R6, $EC
69EC	016C		MHL R1, R6
69EE	0166		OR R1, R6
69F0	C103		SZ R1
69F2	A007		BRA $69FC

			; Not set, set it to file counter
69F4	2E41		MOVE R14, $82
69F6	AE00		ADD R14, #$01
69F8	D5E8		MOVE R5, (R14)
69FA	3576		MOVE $EC, R5		; file counter

			; file counter > file number ?
69FC	2E41		MOVE R14, $82
69FE	AE00		ADD R14, #$01
6A00	D5E8		MOVE R5, (R14)
6A02	2676		MOVE R6, $EC
6A04	0659		SUB R6, R5
6A06	056C		MHL R5, R6
6A08	066D		MLH R6, R6
6A0A	065C		MHL R6, R5
6A0C	0569		SUB R5, R6
6A0E	066C		MHL R6, R6
6A10	065D		MLH R6, R5
6A12	8180		LBI R1, #$80
6A14	C617		SBSH R6, R1
6A16	A043		BRA $6A5C		; no, past BOF

			; Find next file
6A18	816E		LBI R1, #$6E
6A1A	011D		MLH R1, R1
6A1C	818E		LBI R1, #$8E
6A1E	304B		MOVE $96, R0
6A20	204D		JMP ($009A)
6A22	D0F5		JMP (R15)-

			; Compare file counter with file number
6A24	2E41		MOVE R14, $82
6A26	AE00		ADD R14, #$01
6A28	D5E8		MOVE R5, (R14)
6A2A	2676		MOVE R6, $EC
6A2C	0659		SUB R6, R5
6A2E	056C		MHL R5, R6
6A30	066D		MLH R6, R6
6A32	065C		MHL R6, R5
6A34	0569		SUB R5, R6
6A36	066C		MHL R6, R6
6A38	065D		MLH R6, R5

6A3A	016C		MHL R1, R6
6A3C	0166		OR R1, R6
6A3E	C10B		SNZ R1
6A40	A02D		BRA $6A70		; equal, file found

6A42	8180		LBI R1, #$80
6A44	C61F		SNBSH R6, R1
6A46	F04B		BRA $69FC		; loop

			; Retry
6A48	2E41		MOVE R14, $82
6A4A	AE12		ADD R14, #$13
6A4C	D5E8		MOVE R5, (R14)
6A4E	F500		SUB R5, #$01
6A50	55E8		MOVE (R14), R5
6A52	C503		SZ R5
6A54	F059		BRA $69FC		; loop

			; Error 08
			; Records or files out of sequence
6A56	8108		LBI R1, #$08
6A58	3048		MOVE $90, R0
6A5A	204E		JMP ($009C)

			; Find previous file
6A5C	816F		LBI R1, #$6F
6A5E	011D		MLH R1, R1
6A60	8192		LBI R1, #$92
6A62	304B		MOVE $96, R0
6A64	204D		JMP ($009A)
6A66	D0F5		JMP (R15)-

			; Decrement file counter
6A68	2576		MOVE R5, $EC
6A6A	F500		SUB R5, #$01
6A6C	3576		MOVE $EC, R5
6A6E	F073		BRA $69FC		; loop

			; Return
6A70	D1F5		MOVE R1, (R15)-
6A72	0013		INC2 R0, R1
; ----------------------------------------------------------------------

			; Copy file number to header
6A74	2576		MOVE R5, $EC		; file number
6A76	2E42		MOVE R14, $84
6A78	AE01		ADD R14, #$02
6A7A	015C		MHL R1, R5
6A7C	71E0		MOVB (R14)+, R1
6A7E	75E4		MOVB (R14)-, R5

			; Copy marked size to header
6A80	2578		MOVE R5, $F0		; marked size of file
6A82	2E42		MOVE R14, $84
6A84	AE03		ADD R14, #$04
6A86	015C		MHL R1, R5
6A88	71E0		MOVB (R14)+, R1
6A8A	75E4		MOVB (R14)-, R5

6A8C	816E		LBI R1, #$6E
6A8E	011D		MLH R1, R1
6A90	810E		LBI R1, #$0E
6A92	304B		MOVE $96, R0
6A94	204D		JMP ($009A)
6A96	D0F5		JMP (R15)-

6A98	8581		LBI R5, #$81
6A9A	3545		MOVE $8A, R5

6A9C	816C		LBI R1, #$6C
6A9E	011D		MLH R1, R1
6AA0	817A		LBI R1, #$7A
6AA2	304B		MOVE $96, R0
6AA4	204D		JMP ($009A)
6AA6	D0F5		JMP (R15)-
6AA8	A001		BRA $6AAC		; $02(R0)
6AAA	A063		BRA $6B10		; error 07

6AAC	8518		LBI R5, #$18
6AAE	3543		MOVE $86, R5
6AB0	3545		MOVE $8A, R5

6AB2	8170		LBI R1, #$70
6AB4	011D		MLH R1, R1
6AB6	81FA		LBI R1, #$FA
6AB8	304B		MOVE $96, R0
6ABA	204D		JMP ($009A)
6ABC	D0F5		JMP (R15)-

6ABE	2577		MOVE R5, $EE
6AC0	A500		ADD R5, #$01
6AC2	3577		MOVE $EE, R5
6AC4	2678		MOVE R6, $F0
6AC6	0164		MOVE R1, R6
6AC8	0618		ADD R6, R1
6ACA	016C		MHL R1, R6
6ACC	011A		ADDH R1, R1
6ACE	061D		MLH R6, R1
6AD0	0659		SUB R6, R5
6AD2	056C		MHL R5, R6
6AD4	066D		MLH R6, R6
6AD6	065C		MHL R6, R5
6AD8	0569		SUB R5, R6
6ADA	066C		MHL R6, R6
6ADC	065D		MLH R6, R5
6ADE	8180		LBI R1, #$80
6AE0	C617		SBSH R6, R1
6AE2	F031		BRA $6AB2		; -> -$32(R0)

6AE4	2550		MOVE R5, $A0
6AE6	3577		MOVE $EE, R5

6AE8	8581		LBI R5, #$81
6AEA	3543		MOVE $86, R5
6AEC	3545		MOVE $8A, R5

6AEE	257B		MOVE R5, $F6
6AF0	A500		ADD R5, #$01
6AF2	357B		MOVE $F6, R5

6AF4	2576		MOVE R5, $EC
6AF6	A500		ADD R5, #$01
6AF8	3576		MOVE $EC, R5

6AFA	8170		LBI R1, #$70
6AFC	011D		MLH R1, R1
6AFE	81FA		LBI R1, #$FA
6B00	304B		MOVE $96, R0
6B02	204D		JMP ($009A)
6B04	D0F5		JMP (R15)-

6B06	2577		MOVE R5, $EE
6B08	A500		ADD R5, #$01
6B0A	3577		MOVE $EE, R5

			; Return
6B0C	D1F5		MOVE R1, (R15)-
6B0E	0013		INC2 R0, R1

			; Error 07
6B10	8107		LBI R1, #$07
6B12	3048		MOVE $90, R0
6B14	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Clear tape buffer
;

			; Fill IOCB_BA with zeroes
6B16	2E40		MOVE R14, $80
6B18	AE04		ADD R14, #$05
6B1A	D2E8		MOVE R2, (R14)		; IOCB_BA
6B1C	8B02		LBI R11, #$02
6B1E	0BBD		MLH R11, R11
6B20	8B00		LBI R11, #$00		; 512 bytes
6B22	2550		MOVE R5, $A0		; zero
6B24	7520		MOVB (R2)+, R5
6B26	FB00		SUB R11, #$01
6B28	01BC		MHL R1, R11
6B2A	01B6		OR R1, R11
6B2C	C103		SZ R1
6B2E	F00B		BRA $6B24		; loop

			; Return
6B30	D0F5		JMP (R15)-

; ----------------------------------------------------------------------
;
; Read one file block
;

			; Preset retry counter
			; The high byte is used to find the correct record,
			; the low byte when reading the record
6B32	2551		MOVE R5, $A2
6B34	8180		LBI R1, #$80
6B36	C517		SBSH R5, R1
6B38	A007		BRA $6B42
6B3A	8501		LBI R5, #$01
6B3C	055D		MLH R5, R5
6B3E	8501		LBI R5, #$01
6B40	A005		BRA $6B48
6B42	8507		LBI R5, #$07
6B44	055D		MLH R5, R5
6B46	850A		LBI R5, #$0A
6B48	357A		MOVE $F4, R5

6B4A	2578		MOVE R5, $F0		; marked file size [KB]
6B4C	0154		MOVE R1, R5
6B4E	0518		ADD R5, R1
6B50	015C		MHL R1, R5
6B52	011A		ADDH R1, R1
6B54	051D		MLH R5, R1		; size in tape blocks [ 512 b.]

			; Compare file size with current block number
6B56	2677		MOVE R6, $EE		; current tape block
6B58	0569		SUB R5, R6
6B5A	065C		MHL R6, R5
6B5C	055D		MLH R5, R5
6B5E	056C		MHL R5, R6
6B60	0659		SUB R6, R5
6B62	055C		MHL R5, R5
6B64	056D		MLH R5, R6
6B66	8180		LBI R1, #$80
6B68	C517		SBSH R5, R1
6B6A	A007		BRA $6B74		; greater or equal, OK

			; Less than, error 10 (end of file)
6B6C	816C		LBI R1, #$6C
6B6E	011D		MLH R1, R1
6B70	8162		LBI R1, #$62
6B72	0014		RET R1

			; Read tape block
6B74	8170		LBI R1, #$70
6B76	011D		MLH R1, R1
6B78	8120		LBI R1, #$20
6B7A	304B		MOVE $96, R0
6B7C	204D		JMP ($009A)
6B7E	D0F5		JMP (R15)-

			; TST 0004 - format record error?
6B80	2E49		MOVE R14, $92
6B82	9EFB		CLR R14, #$FB
6B84	CE03		SZ R14
6B86	A005		BRA $6B8E		; yes, retry
6B88	0EEC		MHL R14, R14
6B8A	9EFF		CLR R14, #$FF
6B8C	CE03		SZ R14
6B8E	A041		BRA $6BD2

			; TST 0002 - wrong record number?
6B90	2E49		MOVE R14, $92
6B92	9EFD		CLR R14, #$FD
6B94	CE03		SZ R14
6B96	A005		BRA $6B9E		; yes, find correct one
6B98	0EEC		MHL R14, R14
6B9A	9EFF		CLR R14, #$FF
6B9C	CE03		SZ R14
6B9E	A049		BRA $6BEA

			; Bad Record?
6BA0	2544		MOVE R5, $88
6BA2	8124		LBI R1, #$24
6BA4	C15A		SNE R1, R5
6BA6	A01F		BRA $6BC8		; yes, return

			; TST 0040 - verify only?
6BA8	2E49		MOVE R14, $92
6BAA	9EBF		CLR R14, #$BF
6BAC	CE03		SZ R14
6BAE	A005		BRA $6BB6		; yes, return
6BB0	0EEC		MHL R14, R14
6BB2	9EFF		CLR R14, #$FF
6BB4	CE03		SZ R14
6BB6	A00F		BRA $6BC8

			; TST 0001 - error?
6BB8	2E49		MOVE R14, $92
6BBA	9EFE		CLR R14, #$FE
6BBC	CE03		SZ R14
6BBE	A005		BRA $6BC6		; yes, retry
6BC0	0EEC		MHL R14, R14
6BC2	9EFF		CLR R14, #$FF
6BC4	CE03		SZ R14
6BC6	A009		BRA $6BD2

			; Return
6BC8	2577		MOVE R5, $EE
6BCA	A500		ADD R5, #$01
6BCC	3577		MOVE $EE, R5
6BCE	D1F5		MOVE R1, (R15)-
6BD0	0013		INC2 R0, R1

			; Retry
6BD2	257A		MOVE R5, $F4
6BD4	F500		SUB R5, #$01
6BD6	357A		MOVE $F4, R5
6BD8	C50B		SNZ R5
6BDA	A08B		BRA $6C68		; error 07

			; Find previous format record
6BDC	8170		LBI R1, #$70
6BDE	011D		MLH R1, R1
6BE0	81C6		LBI R1, #$C6
6BE2	304B		MOVE $96, R0
6BE4	204D		JMP ($009A)
6BE6	D0F5		JMP (R15)-
6BE8	F09F		BRA $6B4A		; jump back

			; Wrong record, try to find correct one
			
			; Decrement 'locate' retry counter
6BEA	257A		MOVE R5, $F4
6BEC	F5FF		SUB R5, #$100
6BEE	357A		MOVE $F4, R5
6BF0	055C		MHL R5, R5
6BF2	C50B		SNZ R5
6BF4	A07D		BRA $6C74		; error 08

6BF6	2577		MOVE R5, $EE		; current file block number
6BF8	015C		MHL R1, R5
6BFA	0156		OR R1, R5
6BFC	C10B		SNZ R1
6BFE	A03D		BRA $6C3E		; zero

6C00	2646		MOVE R6, $8C		; actual tape record number
6C02	016C		MHL R1, R6
6C04	0166		OR R1, R6
6C06	C10B		SNZ R1
6C08	A045		BRA $6C50		; zero

6C0A	0569		SUB R5, R6
6C0C	065C		MHL R6, R5
6C0E	055D		MLH R5, R5
6C10	056C		MHL R5, R6
6C12	0659		SUB R6, R5
6C14	055C		MHL R5, R5
6C16	056D		MLH R5, R6
6C18	8180		LBI R1, #$80
6C1A	C517		SBSH R5, R1
6C1C	F0D3		BRA $6B4A		; OK, try with next block

			; We're behind the desired block number, backspace

			; Find previous format record...
6C1E	8170		LBI R1, #$70
6C20	011D		MLH R1, R1
6C22	81C6		LBI R1, #$C6
6C24	304B		MOVE $96, R0
6C26	204D		JMP ($009A)
6C28	D0F5		JMP (R15)-

			; ...and a second time
6C2A	8170		LBI R1, #$70
6C2C	011D		MLH R1, R1
6C2E	81C6		LBI R1, #$C6
6C30	304B		MOVE $96, R0
6C32	204D		JMP ($009A)
6C34	D0F5		JMP (R15)-

			; OK, now try this block
6C36	816B		LBI R1, #$6B
6C38	011D		MLH R1, R1
6C3A	814A		LBI R1, #$4A
6C3C	0014		RET R1

			; Current file block is zero
6C3E	2546		MOVE R5, $8C
6C40	F501		SUB R5, #$02
6C42	8180		LBI R1, #$80
6C44	C51F		SNBSH R5, R1
6C46	F029		BRA $6C1E		; backspace

			; Try this block
6C48	816B		LBI R1, #$6B
6C4A	011D		MLH R1, R1
6C4C	814A		LBI R1, #$4A
6C4E	0014		RET R1

			; Current tape record number is zero
6C50	2577		MOVE R5, $EE
6C52	F501		SUB R5, #$02
6C54	8180		LBI R1, #$80
6C56	C517		SBSH R5, R1
6C58	F03B		BRA $6C1E		; backspace

			; Try this block
6C5A	816B		LBI R1, #$6B
6C5C	011D		MLH R1, R1
6C5E	814A		LBI R1, #$4A
6C60	0014		RET R1

			; Error 10
			; End of File
6C62	810A		LBI R1, #$0A
6C64	3048		MOVE $90, R0
6C66	204E		JMP ($009C)

			; Error 07
			; CRC error
6C68	2577		MOVE R5, $EE
6C6A	A500		ADD R5, #$01
6C6C	3577		MOVE $EE, R5
6C6E	8107		LBI R1, #$07
6C70	3048		MOVE $90, R0
6C72	204E		JMP ($009C)

			; Error 08
			; Records or Files out of Sequence
6C74	8108		LBI R1, #$08
6C76	3048		MOVE $90, R0
6C78	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Write one file block
;

			; Preset retry counter
			; The high byte is used to find the correct record,
			; the low byte when reading the record
6C7A	2551		MOVE R5, $A2
6C7C	8180		LBI R1, #$80
6C7E	C517		SBSH R5, R1
6C80	A007		BRA $6C8A
6C82	8501		LBI R5, #$01
6C84	055D		MLH R5, R5
6C86	8501		LBI R5, #$01
6C88	A005		BRA $6C90
6C8A	8507		LBI R5, #$07
6C8C	055D		MLH R5, R5
6C8E	850A		LBI R5, #$0A
6C90	357A		MOVE $F4, R5

6C92	2578		MOVE R5, $F0		; marked file size [KB]
6C94	0154		MOVE R1, R5
6C96	0518		ADD R5, R1
6C98	015C		MHL R1, R5
6C9A	011A		ADDH R1, R1
6C9C	051D		MLH R5, R1		; size in tape blocks [ 512 b.]

			; Compare file size with current block number
6C9E	2677		MOVE R6, $EE
6CA0	0569		SUB R5, R6
6CA2	065C		MHL R6, R5
6CA4	055D		MLH R5, R5
6CA6	056C		MHL R5, R6
6CA8	0659		SUB R6, R5
6CAA	055C		MHL R5, R5
6CAC	056D		MLH R5, R6
6CAE	8180		LBI R1, #$80
6CB0	C517		SBSH R5, R1
6CB2	A007		BRA $6CBC		; greater or equal, OK

			; Less than, error 10 (end of file)
6CB4	816D		LBI R1, #$6D
6CB6	011D		MLH R1, R1
6CB8	81F0		LBI R1, #$F0
6CBA	0014		RET R1

			; Write tape block
6CBC	8170		LBI R1, #$70
6CBE	011D		MLH R1, R1
6CC0	8160		LBI R1, #$60
6CC2	304B		MOVE $96, R0
6CC4	204D		JMP ($009A)
6CC6	D0F5		JMP (R15)-

			; TST 0004 - format record error?
6CC8	2E49		MOVE R14, $92
6CCA	9EFB		CLR R14, #$FB
6CCC	CE03		SZ R14
6CCE	A005		BRA $6CD6		; yes, retry
6CD0	0EEC		MHL R14, R14
6CD2	9EFF		CLR R14, #$FF
6CD4	CE03		SZ R14
6CD6	A07F		BRA $6D58

			; TST 0002 - wrong record number?
6CD8	2E49		MOVE R14, $92
6CDA	9EFD		CLR R14, #$FD
6CDC	CE03		SZ R14
6CDE	A005		BRA $6CE6		; yes, find correct one
6CE0	0EEC		MHL R14, R14
6CE2	9EFF		CLR R14, #$FF
6CE4	CE03		SZ R14
6CE6	A087		BRA $6D70

			; Find previous format record
6CE8	8170		LBI R1, #$70
6CEA	011D		MLH R1, R1
6CEC	81C6		LBI R1, #$C6
6CEE	304B		MOVE $96, R0
6CF0	204D		JMP ($009A)
6CF2	D0F5		JMP (R15)-

			; SET 0040 - verify only
6CF4	2149		MOVE R1, $92
6CF6	B140		SET R1, #$40
6CF8	0E1C		MHL R14, R1
6CFA	BE00		SET R14, #$00
6CFC	01ED		MLH R1, R14
6CFE	3149		MOVE $92, R1

			; Verify tape block just written
6D00	8170		LBI R1, #$70
6D02	011D		MLH R1, R1
6D04	8120		LBI R1, #$20
6D06	304B		MOVE $96, R0
6D08	204D		JMP ($009A)
6D0A	D0F5		JMP (R15)-

			; TST 0004 - format record error?
6D0C	2E49		MOVE R14, $92
6D0E	9EFB		CLR R14, #$FB
6D10	CE03		SZ R14
6D12	A005		BRA $6D1A		; yes, retru
6D14	0EEC		MHL R14, R14
6D16	9EFF		CLR R14, #$FF
6D18	CE03		SZ R14
6D1A	A03B		BRA $6D58

			; TST 0002 - wrong record number?
6D1C	2E49		MOVE R14, $92
6D1E	9EFD		CLR R14, #$FD
6D20	CE03		SZ R14
6D22	A005		BRA $6D2A		; yes, find correct one
6D24	0EEC		MHL R14, R14
6D26	9EFF		CLR R14, #$FF
6D28	CE03		SZ R14
6D2A	A043		BRA $6D70

			; Bad header record?
6D2C	2545		MOVE R5, $8A
6D2E	8124		LBI R1, #$24
6D30	C152		SE R1, R5
6D32	A009		BRA $6D3E		; no

			; Yes, then data record must also be marked bad
6D34	2544		MOVE R5, $88
6D36	8124		LBI R1, #$24
6D38	C15A		SNE R1, R5
6D3A	A011		BRA $6D4E		; equal
6D3C	A019		BRA $6D58		; not equal, retry

			; TST 0001 - error?
6D3E	2E49		MOVE R14, $92
6D40	9EFE		CLR R14, #$FE
6D42	CE03		SZ R14
6D44	A005		BRA $6D4C		; yes, retry
6D46	0EEC		MHL R14, R14
6D48	9EFF		CLR R14, #$FF
6D4A	CE03		SZ R14
6D4C	A009		BRA $6D58

			; Increment current block number
6D4E	2577		MOVE R5, $EE
6D50	A500		ADD R5, #$01
6D52	3577		MOVE $EE, R5

			; Return
6D54	D1F5		MOVE R1, (R15)-
6D56	0013		INC2 R0, R1

			; Decrement retry counter
6D58	257A		MOVE R5, $F4
6D5A	F500		SUB R5, #$01
6D5C	357A		MOVE $F4, R5
6D5E	C50B		SNZ R5
6D60	A093		BRA $6DF6		; retries failed

			; Find previous format record
6D62	8170		LBI R1, #$70
6D64	011D		MLH R1, R1
6D66	81C6		LBI R1, #$C6
6D68	304B		MOVE $96, R0
6D6A	204D		JMP ($009A)
6D6C	D0F5		JMP (R15)-
6D6E	F0DD		BRA $6C92		; jump back

			; Wrong record, try to find correct one
			
			; Decrement 'locate' retry counter
6D70	257A		MOVE R5, $F4
6D72	F5FF		SUB R5, #$100
6D74	357A		MOVE $F4, R5
6D76	055C		MHL R5, R5
6D78	C50B		SNZ R5
6D7A	A08B		BRA $6E08		; error 08

6D7C	2577		MOVE R5, $EE		; current file block number
6D7E	015C		MHL R1, R5
6D80	0156		OR R1, R5
6D82	C10B		SNZ R1
6D84	A045		BRA $6DCC		; zero

6D86	2646		MOVE R6, $8C		; actual tape record number
6D88	016C		MHL R1, R6
6D8A	0166		OR R1, R6
6D8C	C10B		SNZ R1
6D8E	A04D		BRA $6DDE		; zero

6D90	0569		SUB R5, R6
6D92	065C		MHL R6, R5
6D94	055D		MLH R5, R5
6D96	056C		MHL R5, R6
6D98	0659		SUB R6, R5
6D9A	055C		MHL R5, R5
6D9C	056D		MLH R5, R6
6D9E	8180		LBI R1, #$80
6DA0	C51F		SNBSH R5, R1
6DA2	A007		BRA $6DAC		; past block, backspace

			; Ok, try this block
6DA4	816C		LBI R1, #$6C
6DA6	011D		MLH R1, R1
6DA8	8192		LBI R1, #$92
6DAA	0014		RET R1

			; Find previous format record...
6DAC	8170		LBI R1, #$70
6DAE	011D		MLH R1, R1
6DB0	81C6		LBI R1, #$C6
6DB2	304B		MOVE $96, R0
6DB4	204D		JMP ($009A)
6DB6	D0F5		JMP (R15)-

			; ...and a second time
6DB8	8170		LBI R1, #$70
6DBA	011D		MLH R1, R1
6DBC	81C6		LBI R1, #$C6
6DBE	304B		MOVE $96, R0
6DC0	204D		JMP ($009A)
6DC2	D0F5		JMP (R15)-

			; OK, now try this block
6DC4	816C		LBI R1, #$6C
6DC6	011D		MLH R1, R1
6DC8	8192		LBI R1, #$92
6DCA	0014		RET R1

6DCC	2546		MOVE R5, $8C
6DCE	F501		SUB R5, #$02
6DD0	8180		LBI R1, #$80
6DD2	C51F		SNBSH R5, R1
6DD4	F029		BRA $6DAC

			; Try this block
6DD6	816C		LBI R1, #$6C
6DD8	011D		MLH R1, R1
6DDA	8192		LBI R1, #$92
6DDC	0014		RET R1

6DDE	2577		MOVE R5, $EE
6DE0	F501		SUB R5, #$02
6DE2	8180		LBI R1, #$80
6DE4	C517		SBSH R5, R1
6DE6	F03B		BRA $6DAC

			; Try this block
6DE8	816C		LBI R1, #$6C
6DEA	011D		MLH R1, R1
6DEC	8192		LBI R1, #$92
6DEE	0014		RET R1

			; Error 10
			; End of File
6DF0	810A		LBI R1, #$0A
6DF2	3048		MOVE $90, R0
6DF4	204E		JMP ($009C)

			; Find previous format record
6DF6	8170		LBI R1, #$70
6DF8	011D		MLH R1, R1
6DFA	81C6		LBI R1, #$C6
6DFC	304B		MOVE $96, R0
6DFE	204D		JMP ($009A)
6E00	D0F5		JMP (R15)-

			; Return
6E02	D1F5		MOVE R1, (R15)-
6E04	A103		ADD R1, #$04
6E06	0014		RET R1

			; Error 08
			; Records or Files out of Sequence
6E08	8108		LBI R1, #$08
6E0A	3048		MOVE $90, R0
6E0C	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Backspace one record in a file unless at BOF
;

			; Preset retry counter
6E0E	2551		MOVE R5, $A2
6E10	8180		LBI R1, #$80
6E12	C517		SBSH R5, R1
6E14	A003		BRA $6E1A
6E16	8501		LBI R5, #$01
6E18	A001		BRA $6E1C
6E1A	850A		LBI R5, #$0A
6E1C	357A		MOVE $F4, R5

			; SET 0040 - don't read into buffer
6E1E	2149		MOVE R1, $92
6E20	B140		SET R1, #$40
6E22	0E1C		MHL R14, R1
6E24	BE00		SET R14, #$00
6E26	01ED		MLH R1, R14
6E28	3149		MOVE $92, R1

			; Find previous format record
6E2A	8170		LBI R1, #$70
6E2C	011D		MLH R1, R1
6E2E	81C6		LBI R1, #$C6
6E30	304B		MOVE $96, R0
6E32	204D		JMP ($009A)
6E34	D0F5		JMP (R15)-

			; TST 0004 - format record error?
6E36	2E49		MOVE R14, $92
6E38	9EFB		CLR R14, #$FB
6E3A	CE03		SZ R14
6E3C	A005		BRA $6E44		; yes, retry
6E3E	0EEC		MHL R14, R14
6E40	9EFF		CLR R14, #$FF
6E42	CE03		SZ R14
6E44	A029		BRA $6E70

			; Was it a header record?
6E46	2543		MOVE R5, $86
6E48	8181		LBI R1, #$81
6E4A	C152		SE R1, R5
6E4C	A017		BRA $6E66		; no, return

			; Yes
6E4E	2577		MOVE R5, $EE		; current tape block
6E50	F500		SUB R5, #$01
6E52	015C		MHL R1, R5
6E54	0156		OR R1, R5
6E56	C10B		SNZ R1
6E58	A00B		BRA $6E66		; BOF, return

			; Read tape block
6E5A	8170		LBI R1, #$70
6E5C	011D		MLH R1, R1
6E5E	8120		LBI R1, #$20
6E60	304B		MOVE $96, R0
6E62	204D		JMP ($009A)
6E64	D0F5		JMP (R15)-

			; Decrement tape block number
6E66	2577		MOVE R5, $EE
6E68	F500		SUB R5, #$01
6E6A	3577		MOVE $EE, R5

			; Return
6E6C	D1F5		MOVE R1, (R15)-
6E6E	0013		INC2 R0, R1

			; Decrement retry counter...
6E70	257A		MOVE R5, $F4
6E72	F500		SUB R5, #$01
6E74	357A		MOVE $F4, R5
6E76	C50B		SNZ R5
6E78	A00D		BRA $6E88		; error 07

			; ...and retry
6E7A	8170		LBI R1, #$70
6E7C	011D		MLH R1, R1
6E7E	8120		LBI R1, #$20
6E80	304B		MOVE $96, R0
6E82	204D		JMP ($009A)
6E84	D0F5		JMP (R15)-
6E86	F05D		BRA $6E2A

			; Error 07
			; CRC error
6E88	8107		LBI R1, #$07
6E8A	3048		MOVE $90, R0
6E8C	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Find next file
;

6E8E	2576		MOVE R5, $EC		; current file number
6E90	015C		MHL R1, R5
6E92	0156		OR R1, R5
6E94	C10B		SNZ R1
6E96	A00B		BRA $6EA4		; no current file
6E98	8180		LBI R1, #$80
6E9A	C51F		SNBSH R5, R1
6E9C	A005		BRA $6EA4		; no current file

			; Check last header record file type
6E9E	2579		MOVE R5, $F2
6EA0	C50C		SNS R5
6EA2	A0B9		BRA $6F5E		; error 11

			; OK, not at end of marked tape
			; Preset retry counter
6EA4	2551		MOVE R5, $A2
6EA6	8180		LBI R1, #$80
6EA8	C517		SBSH R5, R1
6EAA	A003		BRA $6EB0
6EAC	8501		LBI R5, #$01
6EAE	A001		BRA $6EB2
6EB0	850A		LBI R5, #$0A
6EB2	357A		MOVE $F4, R5

			; CLR 0040 - Read into buffer
6EB4	2149		MOVE R1, $92
6EB6	9140		CLR R1, #$40
6EB8	0E1C		MHL R14, R1
6EBA	9E00		CLR R14, #$00
6EBC	01ED		MLH R1, R14
6EBE	3149		MOVE $92, R1

			; TST 0100 - ignore ATTN?
6EC0	2E49		MOVE R14, $92
6EC2	9EFF		CLR R14, #$FF
6EC4	CE03		SZ R14
6EC6	A005		BRA $6ECE
6EC8	0EEC		MHL R14, R14
6ECA	9EFE		CLR R14, #$FE
6ECC	CE03		SZ R14
6ECE	A007		BRA $6ED8

			; Check ATTN flag
6ED0	2552		MOVE R5, $A4
6ED2	8180		LBI R1, #$80
6ED4	C51F		SNBSH R5, R1
6ED6	A0B3		BRA $6F8C		; ATTN pressed, error 01

			; Read tape header
6ED8	8170		LBI R1, #$70
6EDA	011D		MLH R1, R1
6EDC	8120		LBI R1, #$20
6EDE	304B		MOVE $96, R0
6EE0	204D		JMP ($009A)
6EE2	D0F5		JMP (R15)-

			; TST 0004 - record type error?
6EE4	2E49		MOVE R14, $92
6EE6	9EFB		CLR R14, #$FB
6EE8	CE03		SZ R14
6EEA	A005		BRA $6EF2		; yes, retry
6EEC	0EEC		MHL R14, R14
6EEE	9EFF		CLR R14, #$FF
6EF0	CE03		SZ R14
6EF2	A079		BRA $6F6E

			; Check format record type
6EF4	2543		MOVE R5, $86
6EF6	8181		LBI R1, #$81
6EF8	C152		SE R1, R5
6EFA	A067		BRA $6F64		; not a header record

			; Header record, check data record type
6EFC	2546		MOVE R5, $8C
6EFE	015C		MHL R1, R5
6F00	0156		OR R1, R5
6F02	C103		SZ R1
6F04	A067		BRA $6F6E

			; TST 0001 - error?
6F06	2E49		MOVE R14, $92
6F08	9EFE		CLR R14, #$FE
6F0A	CE03		SZ R14
6F0C	A005		BRA $6F14		; yes, retry
6F0E	0EEC		MHL R14, R14
6F10	9EFF		CLR R14, #$FF
6F12	CE03		SZ R14
6F14	A057		BRA $6F6E

			; File type from header record
6F16	2E42		MOVE R14, $84
6F18	AE00		ADD R14, #$01
6F1A	65E8		MOVB R5, (R14)
6F1C	3579		MOVE $F2, R5

			; File number from header record
6F1E	2E42		MOVE R14, $84
6F20	AE01		ADD R14, #$02
6F22	61E0		MOVB R1, (R14)+
6F24	65E4		MOVB R5, (R14)-
6F26	051D		MLH R5, R1
6F28	3576		MOVE $EC, R5

			; Marked file size from header record
6F2A	2E42		MOVE R14, $84
6F2C	AE03		ADD R14, #$04
6F2E	61E0		MOVB R1, (R14)+
6F30	65E4		MOVB R5, (R14)-
6F32	051D		MLH R5, R1
6F34	3578		MOVE $F0, R5

			; Sequence relocate indicator
6F36	2E42		MOVE R14, $84
6F38	AE05		ADD R14, #$06
6F3A	65E8		MOVB R5, (R14)
6F3C	2E41		MOVE R14, $82
6F3E	AE0C		ADD R14, #$0D
6F40	55E8		MOVE (R14), R5

			; EOD (number of used tape blocks)
6F42	2E42		MOVE R14, $84
6F44	AE06		ADD R14, #$07
6F46	61E0		MOVB R1, (R14)+
6F48	65E4		MOVB R5, (R14)-
6F4A	051D		MLH R5, R1
6F4C	2E41		MOVE R14, $82
6F4E	AE06		ADD R14, #$07
6F50	55E8		MOVE (R14), R5

			; Preset current record number
6F52	8500		LBI R5, #$00
6F54	055D		MLH R5, R5
6F56	8501		LBI R5, #$01
6F58	3577		MOVE $EE, R5

			; Return
6F5A	D1F5		MOVE R1, (R15)-
6F5C	0013		INC2 R0, R1

			; Error 11
			; Specified file number cannot be found
6F5E	810B		LBI R1, #$0B
6F60	3048		MOVE $90, R0
6F62	204E		JMP ($009C)

			; Record was not a header
6F64	2546		MOVE R5, $8C
6F66	015C		MHL R1, R5
6F68	0156		OR R1, R5
6F6A	C103		SZ R1
6F6C	F0DF		BRA $6E8E		; loop

			; Retry
6F6E	257A		MOVE R5, $F4
6F70	F500		SUB R5, #$01
6F72	357A		MOVE $F4, R5
6F74	C50B		SNZ R5
6F76	A00D		BRA $6F86		; error 07

			; Find previous format record
6F78	8170		LBI R1, #$70
6F7A	011D		MLH R1, R1
6F7C	81C6		LBI R1, #$C6
6F7E	304B		MOVE $96, R0
6F80	204D		JMP ($009A)
6F82	D0F5		JMP (R15)-
6F84	F0C5		BRA $6EC0		; loop

			; Error 07
			; CRC error
6F86	8107		LBI R1, #$07
6F88	3048		MOVE $90, R0
6F8A	204E		JMP ($009C)

			; Error 01
6F8C	8101		LBI R1, #$01
6F8E	3048		MOVE $90, R0
6F90	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Find previous file
;

			; Preset retry counter
6F92	2551		MOVE R5, $A2
6F94	8180		LBI R1, #$80
6F96	C517		SBSH R5, R1
6F98	A003		BRA $6F9E
6F9A	8501		LBI R5, #$01
6F9C	A001		BRA $6FA0
6F9E	850A		LBI R5, #$0A
6FA0	357A		MOVE $F4, R5

			; TST 0100 - ignore ATTN?
6FA2	2E49		MOVE R14, $92
6FA4	9EFF		CLR R14, #$FF
6FA6	CE03		SZ R14
6FA8	A005		BRA $6FB0
6FAA	0EEC		MHL R14, R14
6FAC	9EFE		CLR R14, #$FE
6FAE	CE03		SZ R14
6FB0	A007		BRA $6FBA		; yes

			; Check ATTN flag
6FB2	2552		MOVE R5, $A4
6FB4	8180		LBI R1, #$80
6FB6	C51F		SNBSH R5, R1
6FB8	A05F		BRA $701A		; ATTN pressed, error 01

			; Find previous format record
6FBA	8170		LBI R1, #$70
6FBC	011D		MLH R1, R1
6FBE	81C6		LBI R1, #$C6
6FC0	304B		MOVE $96, R0
6FC2	204D		JMP ($009A)
6FC4	A037		BRA $6FFE		; error

			; TST 0004 - record type error?
6FC6	2E49		MOVE R14, $92
6FC8	9EFB		CLR R14, #$FB
6FCA	CE03		SZ R14
6FCC	A005		BRA $6FD4		; yes, retry
6FCE	0EEC		MHL R14, R14
6FD0	9EFF		CLR R14, #$FF
6FD2	CE03		SZ R14
6FD4	A00F		BRA $6FE6

			; Check format record type
6FD6	2543		MOVE R5, $86
6FD8	8181		LBI R1, #$81
6FDA	C152		SE R1, R5
6FDC	F04B		BRA $6F92		; not a header record

			; Clear file type (unknown)
6FDE	2550		MOVE R5, $A0
6FE0	3579		MOVE $F2, R5

			; Return
6FE2	D1F5		MOVE R1, (R15)-
6FE4	0013		INC2 R0, R1

			; Retry
6FE6	257A		MOVE R5, $F4
6FE8	F500		SUB R5, #$01
6FEA	357A		MOVE $F4, R5
6FEC	C50B		SNZ R5
6FEE	A023		BRA $7014		; error 07

			; Read tape header
6FF0	8170		LBI R1, #$70
6FF2	011D		MLH R1, R1
6FF4	8120		LBI R1, #$20
6FF6	304B		MOVE $96, R0
6FF8	204D		JMP ($009A)
6FFA	A001		BRA $6FFE		; error
6FFC	F05B		BRA $6FA2		; try again

			; Handle BOT/EOT
6FFE	8171		LBI R1, #$71
7000	011D		MLH R1, R1
7002	818A		LBI R1, #$8A
7004	304B		MOVE $96, R0
7006	204D		JMP ($009A)
7008	D0F5		JMP (R15)-		; error

			; Clear return code and file number
700A	2550		MOVE R5, $A0
700C	3575		MOVE $EA, R5
700E	3576		MOVE $EC, R5

			; Return
7010	D1F5		MOVE R1, (R15)-
7012	0013		INC2 R0, R1

			; Error 07
7014	8107		LBI R1, #$07
7016	3048		MOVE $90, R0
7018	204E		JMP ($009C)

			; Error 01
701A	8101		LBI R1, #$01
701C	3048		MOVE $90, R0
701E	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Read tape block (header or data record; forward)
;

			; CLR 0038 - don't erase, check status
7020	2149		MOVE R1, $92
7022	9138		CLR R1, #$38
7024	0E1C		MHL R14, R1
7026	9E00		CLR R14, #$00
7028	01ED		MLH R1, R14
702A	3149		MOVE $92, R1

			; Start forward tape motion
702C	8173		LBI R1, #$73
702E	011D		MLH R1, R1
7030	8160		LBI R1, #$60
7032	304B		MOVE $96, R0
7034	204D		JMP ($009A)
7036	D0F5		JMP (R15)-

			; Read format record
7038	8175		LBI R1, #$75
703A	011D		MLH R1, R1
703C	810A		LBI R1, #$0A
703E	304B		MOVE $96, R0
7040	204D		JMP ($009A)
7042	D0F5		JMP (R15)-

			; Read data record
7044	8176		LBI R1, #$76
7046	011D		MLH R1, R1
7048	81BA		LBI R1, #$BA
704A	304B		MOVE $96, R0
704C	204D		JMP ($009A)
704E	D0F5		JMP (R15)-

			; Stop tape
7050	8174		LBI R1, #$74
7052	011D		MLH R1, R1
7054	8186		LBI R1, #$86
7056	304B		MOVE $96, R0
7058	204D		JMP ($009A)
705A	D0F5		JMP (R15)-

			; Return
705C	D1F5		MOVE R1, (R15)-
705E	0013		INC2 R0, R1
; ----------------------------------------------------------------------


			; Calculate CRC of buffer
7060	8174		LBI R1, #$74
7062	011D		MLH R1, R1
7064	81D2		LBI R1, #$D2
7066	304B		MOVE $96, R0
7068	204D		JMP ($009A)

			; SET 0020
706A	2149		MOVE R1, $92
706C	B120		SET R1, #$20
706E	0E1C		MHL R14, R1
7070	BE00		SET R14, #$00
7072	01ED		MLH R1, R14
7074	3149		MOVE $92, R1

			; CLR 0018
7076	2149		MOVE R1, $92
7078	9118		CLR R1, #$18
707A	0E1C		MHL R14, R1
707C	9E00		CLR R14, #$00
707E	01ED		MLH R1, R14
7080	3149		MOVE $92, R1

			; Start forward tape motion
7082	8173		LBI R1, #$73
7084	011D		MLH R1, R1
7086	8160		LBI R1, #$60
7088	304B		MOVE $96, R0
708A	204D		JMP ($009A)
708C	D0F5		JMP (R15)-

			; Read format record
708E	8175		LBI R1, #$75
7090	011D		MLH R1, R1
7092	810A		LBI R1, #$0A
7094	304B		MOVE $96, R0
7096	204D		JMP ($009A)
7098	D0F5		JMP (R15)-

			; TST 0006 - record error (e.g. wrong record)?
709A	2E49		MOVE R14, $92
709C	9EF9		CLR R14, #$F9
709E	CE03		SZ R14
70A0	A005		BRA $70A8		; yes
70A2	0EEC		MHL R14, R14
70A4	9EFF		CLR R14, #$FF
70A6	CE03		SZ R14
70A8	A00B		BRA $70B6

70AA	8178		LBI R1, #$78
70AC	011D		MLH R1, R1
70AE	8180		LBI R1, #$80
70B0	304B		MOVE $96, R0
70B2	204D		JMP ($009A)
70B4	D0F5		JMP (R15)-

			; Stop tape
70B6	8174		LBI R1, #$74
70B8	011D		MLH R1, R1
70BA	8186		LBI R1, #$86
70BC	304B		MOVE $96, R0
70BE	204D		JMP ($009A)
70C0	D0F5		JMP (R15)-

			; Return
70C2	D1F5		MOVE R1, (R15)-
70C4	0013		INC2 R0, R1

; ----------------------------------------------------------------------
;
; Find previous format record
;

			; CLR 0038 - don't erase, check status
70C6	2149		MOVE R1, $92
70C8	9138		CLR R1, #$38
70CA	0E1C		MHL R14, R1
70CC	9E00		CLR R14, #$00
70CE	01ED		MLH R1, R14
70D0	3149		MOVE $92, R1

			; Start reverse tape motion
70D2	8174		LBI R1, #$74
70D4	011D		MLH R1, R1
70D6	8118		LBI R1, #$18
70D8	304B		MOVE $96, R0
70DA	204D		JMP ($009A)
70DC	D0F5		JMP (R15)-

			; Read format record
70DE	8175		LBI R1, #$75
70E0	011D		MLH R1, R1
70E2	810A		LBI R1, #$0A
70E4	304B		MOVE $96, R0
70E6	204D		JMP ($009A)
70E8	D0F5		JMP (R15)-

			; Stop tape
70EA	8174		LBI R1, #$74
70EC	011D		MLH R1, R1
70EE	8186		LBI R1, #$86
70F0	304B		MOVE $96, R0
70F2	204D		JMP ($009A)
70F4	D0F5		JMP (R15)-

			; Return
70F6	D1F5		MOVE R1, (R15)-
70F8	0013		INC2 R0, R1

; ----------------------------------------------------------------------
;
; Write one tape block (format and data record)
;

			; SET 0030 - erase
70FA	2149		MOVE R1, $92
70FC	B130		SET R1, #$30
70FE	0E1C		MHL R14, R1
7100	BE00		SET R14, #$00
7102	01ED		MLH R1, R14
7104	3149		MOVE $92, R1

			; CLR 0008
7106	2149		MOVE R1, $92
7108	9108		CLR R1, #$08
710A	0E1C		MHL R14, R1
710C	9E00		CLR R14, #$00
710E	01ED		MLH R1, R14
7110	3149		MOVE $92, R1

			; Start tape
7112	8173		LBI R1, #$73
7114	011D		MLH R1, R1
7116	8160		LBI R1, #$60
7118	304B		MOVE $96, R0
711A	204D		JMP ($009A)
711C	D0F5		JMP (R15)-

			; Write format record
711E	8178		LBI R1, #$78
7120	011D		MLH R1, R1
7122	8102		LBI R1, #$02
7124	304B		MOVE $96, R0
7126	204D		JMP ($009A)
7128	D0F5		JMP (R15)-

			; Write data record
712A	8178		LBI R1, #$78
712C	011D		MLH R1, R1
712E	8180		LBI R1, #$80
7130	304B		MOVE $96, R0
7132	204D		JMP ($009A)
7134	D0F5		JMP (R15)-

			; Stop tape
7136	8174		LBI R1, #$74
7138	011D		MLH R1, R1
713A	8186		LBI R1, #$86
713C	304B		MOVE $96, R0
713E	204D		JMP ($009A)
7140	D0F5		JMP (R15)-

			; Return
7142	D1F5		MOVE R1, (R15)-
7144	0013		INC2 R0, R1
; ----------------------------------------------------------------------

			; CLR 00A0
7146	2149		MOVE R1, $92
7148	91A0		CLR R1, #$A0
714A	0E1C		MHL R14, R1
714C	9E00		CLR R14, #$00
714E	01ED		MLH R1, R14
7150	3149		MOVE $92, R1

			; SET 0008
7152	2149		MOVE R1, $92
7154	B108		SET R1, #$08
7156	0E1C		MHL R14, R1
7158	BE00		SET R14, #$00
715A	01ED		MLH R1, R14
715C	3149		MOVE $92, R1

			; Start reverse tape motion
715E	8174		LBI R1, #$74
7160	011D		MLH R1, R1
7162	8118		LBI R1, #$18
7164	304B		MOVE $96, R0
7166	204D		JMP ($009A)
7168	A009		BRA $7174		; $0A(R0)

716A	8172		LBI R1, #$72
716C	011D		MLH R1, R1
716E	81E2		LBI R1, #$E2
7170	304B		MOVE $96, R0
7172	204D		JMP ($009A)

			; Handle BOT/EOT
7174	8171		LBI R1, #$71
7176	011D		MLH R1, R1
7178	818A		LBI R1, #$8A
717A	304B		MOVE $96, R0
717C	204D		JMP ($009A)
717E	D0F5		JMP (R15)-		; error

			; Clear return code and file number
7180	2550		MOVE R5, $A0
7182	3575		MOVE $EA, R5
7184	3576		MOVE $EC, R5

			; Return
7186	D1F5		MOVE R1, (R15)-
7188	0013		INC2 R0, R1

; ----------------------------------------------------------------------
;
; Handle physical end of tape (which may be a BOT or EOT)
;

			; Preset retry counter
718A	2551		MOVE R5, $A2
718C	8180		LBI R1, #$80
718E	C517		SBSH R5, R1
7190	A003		BRA $7196
7192	8502		LBI R5, #$02
7194	A001		BRA $7198
7196	8504		LBI R5, #$04
7198	357A		MOVE $F4, R5

			; Check for 'physical end of tape' error
719A	2575		MOVE R5, $EA
719C	86F1		LBI R6, #$F1
719E	066D		MLH R6, R6
71A0	86F2		LBI R6, #$F2		; compare with '12'
71A2	0569		SUB R5, R6
71A4	065C		MHL R6, R5
71A6	055D		MLH R5, R5
71A8	056C		MHL R5, R6
71AA	0659		SUB R6, R5
71AC	055C		MHL R5, R5
71AE	056D		MLH R5, R6
71B0	015C		MHL R1, R5
71B2	0156		OR R1, R5
71B4	C103		SZ R1
71B6	D0F5		JMP (R15)-		; not end of tape, return

			; SET 0080 - physical end of tape
71B8	2149		MOVE R1, $92
71BA	B180		SET R1, #$80
71BC	0E1C		MHL R14, R1
71BE	BE00		SET R14, #$00
71C0	01ED		MLH R1, R14
71C2	3149		MOVE $92, R1

			; Decrement retry counter
71C4	257A		MOVE R5, $F4
71C6	F500		SUB R5, #$01
71C8	357A		MOVE $F4, R5
71CA	C503		SZ R5
71CC	A007		BRA $71D6		; retry

			; Error 03
			; Status error
71CE	8172		LBI R1, #$72
71D0	011D		MLH R1, R1
71D2	81DC		LBI R1, #$DC
71D4	0014		RET R1
; ----

			; TST 1000
71D6	2E49		MOVE R14, $92
71D8	9EFF		CLR R14, #$FF
71DA	CE03		SZ R14
71DC	A005		BRA $71E4
71DE	0EEC		MHL R14, R14
71E0	9EEF		CLR R14, #$EF
71E2	CE03		SZ R14
71E4	A0BF		BRA $72A6

			; TST 8000 - forward tape motion ?
71E6	2E49		MOVE R14, $92
71E8	9EFF		CLR R14, #$FF
71EA	CE03		SZ R14
71EC	A005		BRA $71F4
71EE	0EEC		MHL R14, R14
71F0	9E7F		CLR R14, #$7F
71F2	CE03		SZ R14
71F4	A095		BRA $728C		; yes

			; CLR 3000 - clear BOT and EOT
71F6	2149		MOVE R1, $92
71F8	9100		CLR R1, #$00
71FA	0E1C		MHL R14, R1
71FC	9E30		CLR R14, #$30
71FE	01ED		MLH R1, R14
7200	3149		MOVE $92, R1

			; Start forward tape motion
7202	8173		LBI R1, #$73
7204	011D		MLH R1, R1
7206	8160		LBI R1, #$60
7208	304B		MOVE $96, R0
720A	204D		JMP ($009A)
720C	A009		BRA $7218		; error

720E	8172		LBI R1, #$72
7210	011D		MLH R1, R1
7212	81E2		LBI R1, #$E2
7214	304B		MOVE $96, R0
7216	204D		JMP ($009A)

			; Check for 'physical end of tape' error
7218	2575		MOVE R5, $EA
721A	86F1		LBI R6, #$F1
721C	066D		MLH R6, R6
721E	86F2		LBI R6, #$F2
7220	0569		SUB R5, R6
7222	065C		MHL R6, R5
7224	055D		MLH R5, R5
7226	056C		MHL R5, R6
7228	0659		SUB R6, R5
722A	055C		MHL R5, R5
722C	056D		MLH R5, R6
722E	015C		MHL R1, R5
7230	0156		OR R1, R5
7232	C103		SZ R1
7234	D0F5		JMP (R15)-

			; TST 1000 - BOT?
7236	2E49		MOVE R14, $92
7238	9EFF		CLR R14, #$FF
723A	CE03		SZ R14
723C	A005		BRA $7244
723E	0EEC		MHL R14, R14
7240	9EEF		CLR R14, #$EF
7242	CE03		SZ R14
7244	F0AB		BRA $719A		; yes

			; TST 4000 - backward tape motion?
7246	2E49		MOVE R14, $92
7248	9EFF		CLR R14, #$FF
724A	CE03		SZ R14
724C	A007		BRA $7256
724E	0EEC		MHL R14, R14
7250	9EBF		CLR R14, #$BF
7252	CE0B		SNZ R14
7254	A025		BRA $727C		; no

			; Start backward tape motion
7256	8174		LBI R1, #$74
7258	011D		MLH R1, R1
725A	8118		LBI R1, #$18
725C	304B		MOVE $96, R0
725E	204D		JMP ($009A)
7260	F049		BRA $7218		; error

			; Delay 20000
7262	8E4E		LBI R14, #$4E
7264	0EED		MLH R14, R14
7266	8E20		LBI R14, #$20
7268	FE00		SUB R14, #$01
726A	8180		LBI R1, #$80
726C	CE17		SBSH R14, R1
726E	F007		BRA $7268

			; Stop tape
7270	8174		LBI R1, #$74
7272	011D		MLH R1, R1
7274	8186		LBI R1, #$86
7276	304B		MOVE $96, R0
7278	204D		JMP ($009A)
727A	F063		BRA $7218		; error

			; CLR 2080 - clear end of tape and EOT flag
727C	2149		MOVE R1, $92
727E	9180		CLR R1, #$80
7280	0E1C		MHL R14, R1
7282	9E20		CLR R14, #$20
7284	01ED		MLH R1, R14
7286	3149		MOVE $92, R1

			; Return
7288	D1F5		MOVE R1, (R15)-
728A	0013		INC2 R0, R1

			; CLR 3000 - clear BOT and EOT flags
728C	2149		MOVE R1, $92
728E	9100		CLR R1, #$00
7290	0E1C		MHL R14, R1
7292	9E30		CLR R14, #$30
7294	01ED		MLH R1, R14
7296	3149		MOVE $92, R1

			; Start backward tape motion
7298	8174		LBI R1, #$74
729A	011D		MLH R1, R1
729C	8118		LBI R1, #$18
729E	304B		MOVE $96, R0
72A0	204D		JMP ($009A)
72A2	F08B		BRA $7218		; -> -$8C(R0)
72A4	F097		BRA $720E		; -> -$98(R0)
; ----

72A6	2E41		MOVE R14, $82
72A8	AE16		ADD R14, #$17
72AA	5FE8		MOVE (R14), R15

			; Reset tape adapter and reselect tape
72AC	2340		MOVE R3, $80
72AE	A300		ADD R3, #$01
72B0	1F40		CTRL $F, #$40		; reset tape adapter
72B2	2853		MOVE R8, $A6
72B4	0203		INC2 R2, R0
72B6	2056		JMP ($00AC)
72B8	A017		BRA $72D2		; I/O error

72BA	2E41		MOVE R14, $82
72BC	AE16		ADD R14, #$17
72BE	DFE8		MOVE R15, (R14)

			; TST 2000 - EOT?
72C0	2E49		MOVE R14, $92
72C2	9EFF		CLR R14, #$FF
72C4	CE03		SZ R14
72C6	A007		BRA $72D0
72C8	0EEC		MHL R14, R14
72CA	9EDF		CLR R14, #$DF
72CC	CE0B		SNZ R14
72CE	F043		BRA $728C		; no, then BOT
72D0	F0DB		BRA $71F6		; yes

			; Error
72D2	2E41		MOVE R14, $82
72D4	AE16		ADD R14, #$17
72D6	DFE8		MOVE R15, (R14)
72D8	3048		MOVE $90, R0
72DA	D0F5		JMP (R15)-

			; Error 03
			; Status error
72DC	8103		LBI R1, #$03
72DE	3048		MOVE $90, R0
72E0	204E		JMP ($009C)
; ----------------------------------------------------------------------

			; Timeout value $487FFF
72E2	8B00		LBI R11, #$00
72E4	0BBD		MLH R11, R11
72E6	8B90		LBI R11, #$90
72E8	8C7F		LBI R12, #$7F
72EA	0CCD		MLH R12, R12
72EC	8CFF		LBI R12, #$FF

			; TST 8190
72EE	2E49		MOVE R14, $92
72F0	9E6F		CLR R14, #$6F
72F2	CE03		SZ R14
72F4	A005		BRA $72FC		; $06(R0)
72F6	0EEC		MHL R14, R14
72F8	9E7E		CLR R14, #$7E
72FA	CE03		SZ R14
72FC	A007		BRA $7306		; $08(R0)

72FE	2552		MOVE R5, $A4
7300	8180		LBI R1, #$80
7302	C51F		SNBSH R5, R1
7304	A023		BRA $732A		; error 01

			; Check status
7306	8540		LBI R5, #$40
7308	EE5F		STAT R5, $E
730A	3547		MOVE $8E, R5
730C	950A		CLR R5, #$0A
730E	8135		LBI R1, #$35
7310	C512		SE R5, R1
7312	A01B		BRA $7330		; OK

			; Decrement timeout value
7314	FC00		SUB R12, #$01
7316	8180		LBI R1, #$80
7318	CC17		SBSH R12, R1
731A	F02D		BRA $72EE		; loop
731C	FB00		SUB R11, #$01
731E	8180		LBI R1, #$80
7320	CB17		SBSH R11, R1
7322	F03B		BRA $72E8		; loop

			; Error 04
7324	8104		LBI R1, #$04
7326	3048		MOVE $90, R0
7328	204E		JMP ($009C)

			; Error 01
732A	8101		LBI R1, #$01
732C	3048		MOVE $90, R0
732E	204E		JMP ($009C)

			; TST 8000
7330	2E49		MOVE R14, $92
7332	9EFF		CLR R14, #$FF
7334	CE03		SZ R14
7336	A007		BRA $7340		; $08(R0)
7338	0EEC		MHL R14, R14
733A	9E7F		CLR R14, #$7F
733C	CE0B		SNZ R14
733E	A019		BRA $735A		; $1A(R0)

			; TST 0010
7340	2E49		MOVE R14, $92
7342	9EEF		CLR R14, #$EF
7344	CE03		SZ R14
7346	A007		BRA $7350		; $08(R0)
7348	0EEC		MHL R14, R14
734A	9EFF		CLR R14, #$FF
734C	CE0B		SNZ R14
734E	A009		BRA $735A		; $0A(R0)

7350	3048		MOVE $90, R0
7352	817B		LBI R1, #$7B
7354	011D		MLH R1, R1
7356	813E		LBI R1, #$3E
7358	0014		RET R1

735A	8100		LBI R1, #$00
735C	3048		MOVE $90, R0
735E	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Start forward tape motion
;

			; TST 8000 - was forward tape motion?
7360	2E49		MOVE R14, $92
7362	9EFF		CLR R14, #$FF
7364	CE03		SZ R14
7366	A005		BRA $736E
7368	0EEC		MHL R14, R14
736A	9E7F		CLR R14, #$7F
736C	CE03		SZ R14
736E	A00D		BRA $737E

			; No, delay 12000
7370	8E2E		LBI R14, #$2E
7372	0EED		MLH R14, R14
7374	8EE0		LBI R14, #$E0
7376	FE00		SUB R14, #$01
7378	8180		LBI R1, #$80
737A	CE17		SBSH R14, R1
737C	F007		BRA $7376

			; TST 0010 - erase?
737E	2E49		MOVE R14, $92
7380	9EEF		CLR R14, #$EF
7382	CE03		SZ R14
7384	A007		BRA $738E
7386	0EEC		MHL R14, R14
7388	9EFF		CLR R14, #$FF
738A	CE0B		SNZ R14
738C	A02B		BRA $73BA		; not erase, read

			; Check status
738E	8540		LBI R5, #$40
7390	EE5F		STAT R5, $E
7392	3547		MOVE $8E, R5
7394	9508		CLR R5, #$08		; mask out 'Erase on'
7396	8115		LBI R1, #$15		; tape stopped?
7398	C512		SE R5, R1
739A	A075		BRA $7412		; no, error

			; Erase forward both tracks
739C	1E13		CTRL $E, #$13		; fwd erase ch0+1

			; CLR 4000 - clear backward motion flag
739E	2149		MOVE R1, $92
73A0	9100		CLR R1, #$00
73A2	0E1C		MHL R14, R1
73A4	9E40		CLR R14, #$40
73A6	01ED		MLH R1, R14
73A8	3149		MOVE $92, R1

			; SET 8000 - set forward motion flag
73AA	2149		MOVE R1, $92
73AC	B100		SET R1, #$00
73AE	0E1C		MHL R14, R1
73B0	BE80		SET R14, #$80
73B2	01ED		MLH R1, R14
73B4	3149		MOVE $92, R1

			; Return
73B6	D1F5		MOVE R1, (R15)-
73B8	0013		INC2 R0, R1
; ----

			; Check Status
73BA	8540		LBI R5, #$40
73BC	EE5F		STAT R5, $E
73BE	3547		MOVE $8E, R5
73C0	9502		CLR R5, #$02		; mask out 'Write Protected'
73C2	8115		LBI R1, #$15		; tape stopped?
73C4	C512		SE R5, R1
73C6	A049		BRA $7412		; no, error

			; Forward read data track
73C8	1E3F		CTRL $E, #$3F		; fwd read ch1

			; CLR 4000 - clear backward motion flag
73CA	2149		MOVE R1, $92
73CC	9100		CLR R1, #$00
73CE	0E1C		MHL R14, R1
73D0	9E40		CLR R14, #$40
73D2	01ED		MLH R1, R14
73D4	3149		MOVE $92, R1

			; SET 8000 - set forward motion flag
73D6	2149		MOVE R1, $92
73D8	B100		SET R1, #$00
73DA	0E1C		MHL R14, R1
73DC	BE80		SET R14, #$80
73DE	01ED		MLH R1, R14
73E0	3149		MOVE $92, R1

			; TST 0008
73E2	2E49		MOVE R14, $92
73E4	9EF7		CLR R14, #$F7
73E6	CE03		SZ R14
73E8	A005		BRA $73F0		; $06(R0)
73EA	0EEC		MHL R14, R14
73EC	9EFF		CLR R14, #$FF
73EE	CE03		SZ R14
73F0	A01B		BRA $740E		; return

			; Delay 5000
73F2	8E13		LBI R14, #$13
73F4	0EED		MLH R14, R14
73F6	8E88		LBI R14, #$88
73F8	FE00		SUB R14, #$01
73FA	8180		LBI R1, #$80
73FC	CE17		SBSH R14, R1
73FE	F007		BRA $73F8		; -> -$08(R0)

			; Check status
7400	8540		LBI R5, #$40
7402	EE5F		STAT R5, $E
7404	3547		MOVE $8E, R5
7406	9502		CLR R5, #$02		; mask out 'Write Protected'
7408	8135		LBI R1, #$35		; tape running?
740A	C512		SE R5, R1
740C	A003		BRA $7412		; no, error

			; Return
740E	D1F5		MOVE R1, (R15)-
7410	0013		INC2 R0, R1

			; Error
7412	8100		LBI R1, #$00
7414	3048		MOVE $90, R0
7416	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Start reverse tape motion
;

			; TST 4000
7418	2E49		MOVE R14, $92
741A	9EFF		CLR R14, #$FF
741C	CE03		SZ R14
741E	A005		BRA $7426		; $06(R0)
7420	0EEC		MHL R14, R14
7422	9EBF		CLR R14, #$BF
7424	CE03		SZ R14
7426	A00D		BRA $7436		; tape running backwards

			; Delay 12000
7428	8E2E		LBI R14, #$2E
742A	0EED		MLH R14, R14
742C	8EE0		LBI R14, #$E0
742E	FE00		SUB R14, #$01
7430	8180		LBI R1, #$80
7432	CE17		SBSH R14, R1
7434	F007		BRA $742E		; -> -$08(R0)

			; Check status
7436	8540		LBI R5, #$40
7438	EE5F		STAT R5, $E
743A	3547		MOVE $8E, R5
743C	950A		CLR R5, #$0A
743E	8115		LBI R1, #$15		; tape stopped and OK?
7440	C512		SE R5, R1
7442	A03B		BRA $7480		; no, error

			; Rewind
7444	1E7F		CTRL $E, #$7F		; read rev. ch0

			; TST 0008
7446	2E49		MOVE R14, $92
7448	9EF7		CLR R14, #$F7
744A	CE03		SZ R14
744C	A005		BRA $7454		; $06(R0)
744E	0EEC		MHL R14, R14
7450	9EFF		CLR R14, #$FF
7452	CE03		SZ R14
7454	A00D		BRA $7464		; $0E(R0)

			; Delay 5000
7456	8E13		LBI R14, #$13
7458	0EED		MLH R14, R14
745A	8E88		LBI R14, #$88
745C	FE00		SUB R14, #$01
745E	8180		LBI R1, #$80
7460	CE17		SBSH R14, R1
7462	F007		BRA $745C		; -> -$08(R0)

			; CLR 8000
7464	2149		MOVE R1, $92
7466	9100		CLR R1, #$00
7468	0E1C		MHL R14, R1
746A	9E80		CLR R14, #$80
746C	01ED		MLH R1, R14
746E	3149		MOVE $92, R1

			; SET 4000
7470	2149		MOVE R1, $92
7472	B100		SET R1, #$00
7474	0E1C		MHL R14, R1
7476	BE40		SET R14, #$40
7478	01ED		MLH R1, R14
747A	3149		MOVE $92, R1

			; Return
747C	D1F5		MOVE R1, (R15)-
747E	0013		INC2 R0, R1

			; Error
7480	8100		LBI R1, #$00
7482	3048		MOVE $90, R0
7484	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Stop tape
;

			; TST 4000 - backward tape motion?
7486	2E49		MOVE R14, $92
7488	9EFF		CLR R14, #$FF
748A	CE03		SZ R14
748C	A007		BRA $7496
748E	0EEC		MHL R14, R14
7490	9EBF		CLR R14, #$BF
7492	CE0B		SNZ R14
7494	A00D		BRA $74A4		; no

			; Yes, delay 3000
7496	8E0B		LBI R14, #$0B
7498	0EED		MLH R14, R14
749A	8EB8		LBI R14, #$B8
749C	FE00		SUB R14, #$01
749E	8180		LBI R1, #$80
74A0	CE17		SBSH R14, R1
74A2	F007		BRA $749C		; -> -$08(R0)

			; TST 0010 - erase both tracks?
74A4	2E49		MOVE R14, $92
74A6	9EEF		CLR R14, #$EF
74A8	CE03		SZ R14
74AA	A007		BRA $74B4		; yes
74AC	0EEC		MHL R14, R14
74AE	9EFF		CLR R14, #$FF
74B0	CE0B		SNZ R14
74B2	A011		BRA $74C6

			; Check status
74B4	8540		LBI R5, #$40
74B6	EE5F		STAT R5, $E
74B8	3547		MOVE $8E, R5
74BA	813D		LBI R1, #$3D
74BC	C512		SE R5, R1		; tape running/erase/not BOT?
74BE	A00B		BRA $74CC		; no, error

74C0	1EF3		CTRL $E, #$F3		; tape stop, erase 0+1 on (?)
74C2	D1F5		MOVE R1, (R15)-
74C4	0013		INC2 R0, R1		; return

74C6	1EFF		CTRL $E, #$FF		; full stop
74C8	D1F5		MOVE R1, (R15)-
74CA	0013		INC2 R0, R1		; return

			; Error
74CC	8100		LBI R1, #$00
74CE	3048		MOVE $90, R0
74D0	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Calculate CRC
;

			; Preset CRC
74D2	86FF		LBI R6, #$FF
74D4	066D		MLH R6, R6
74D6	86FF		LBI R6, #$FF

			; Address of buffer
74D8	2E40		MOVE R14, $80
74DA	AE04		ADD R14, #$05
74DC	D2E8		MOVE R2, (R14)

			; Size
74DE	8B02		LBI R11, #$02
74E0	0BBD		MLH R11, R11
74E2	8B00		LBI R11, #$00

			; Calculate first CRC byte
74E4	2545		MOVE R5, $8A		; record type
74E6	8179		LBI R1, #$79
74E8	011D		MLH R1, R1
74EA	811C		LBI R1, #$1C
74EC	304B		MOVE $96, R0
74EE	204D		JMP ($009A)

			; Get next byte from buffer and calculate new CRC
74F0	6520		MOVB R5, (R2)+
74F2	8179		LBI R1, #$79
74F4	011D		MLH R1, R1
74F6	811C		LBI R1, #$1C
74F8	304B		MOVE $96, R0
74FA	204D		JMP ($009A)

			; Loop until done
74FC	FB00		SUB R11, #$01
74FE	01BC		MHL R1, R11
7500	01B6		OR R1, R11
7502	C103		SZ R1
7504	F015		BRA $74F0		; loop

			; Return
7506	364F		MOVE $9E, R6		; store CRC
7508	D0F5		JMP (R15)-

; ----------------------------------------------------------------------
;
; Read format record (either direciton)
;

			; Preset level 2 registers
750A	8579		LBI R5, #$79
750C	055D		MLH R5, R5
750E	854E		LBI R5, #$4E
7510	3520		MOVE $40, R5		; R0L2

7512	8510		LBI R5, #$10
7514	055D		MLH R5, R5
7516	8550		LBI R5, #$50		; 
7518	352B		MOVE $56, R5		; R11L2

751A	8535		LBI R5, #$35		; tape status to monitor
751C	3526		MOVE $4C, R5		; R6L0

751E	85E7		LBI R5, #$E7		; sync byte
7520	3527		MOVE $4E, R5		; R7L2

7522	8580		LBI R5, #$80
7524	3528		MOVE $50, R5		; R8L0

7526	8502		LBI R5, #$02
7528	3529		MOVE $52, R5		; R9L2

752A	8500		LBI R5, #$00
752C	055D		MLH R5, R5
752E	8553		LBI R5, #$53		; Address of Lo(R9L2)
7530	3522		MOVE $44, R5		; R2L2

7532	2550		MOVE R5, $A0
7534	352A		MOVE $54, R5		; R10L2

			; CLR 0006 - clear error flags
7536	2149		MOVE R1, $92
7538	9106		CLR R1, #$06
753A	0E1C		MHL R14, R1
753C	9E00		CLR R14, #$00
753E	01ED		MLH R1, R14
7540	3149		MOVE $92, R1

			; Check tape status
7542	8540		LBI R5, #$40
7544	EE5F		STAT R5, $E
7546	3547		MOVE $8E, R5
7548	9502		CLR R5, #$02
754A	8135		LBI R1, #$35		; tape running?
754C	C512		SE R5, R1
754E	A001		BRA $7552		; no, error
7550	A007		BRA $755A		; yes

7552	8176		LBI R1, #$76
7554	011D		MLH R1, R1
7556	81B4		LBI R1, #$B4
7558	0014		RET R1

			; Change to bit mode
755A	8522		LBI R5, #$22
755C	8200		LBI R2, #$00
755E	022D		MLH R2, R2
7560	820B		LBI R2, #$0B		; Lo(R5L0)
7562	4E28		PUTB $E, (R2)

			; Turn off display
7564	106F		CTRL $0, #$6F

			; TST 8000 - forward tape motion?
7566	2E49		MOVE R14, $92
7568	9EFF		CLR R14, #$FF
756A	CE03		SZ R14
756C	A007		BRA $7576
756E	0EEC		MHL R14, R14
7570	9E7F		CLR R14, #$7F
7572	CE0B		SNZ R14
7574	A005		BRA $757C		; reverse

			; Find start of a format record
			
			; Read fwd format track
7576	0E5E		GETB R5, $E
7578	1E1E		CTRL $E, #$1E		; read fwd ch0 IRQ
757A	A003		BRA $7580

			; Read rev format track
757C	0E5E		GETB R5, $E
757E	1E5E		CTRL $E, #$5E		; read rev ch0 IRQ

			; Timeout value 00D000
7580	8B00		LBI R11, #$00
7582	0BBD		MLH R11, R11
7584	8BD0		LBI R11, #$D0
7586	2C50		MOVE R12, $A0

			; Wait for first data byte (record type)
7588	8177		LBI R1, #$77
758A	011D		MLH R1, R1
758C	81CA		LBI R1, #$CA
758E	304B		MOVE $96, R0
7590	204D		JMP ($009A)
7592	D0F5		JMP (R15)-

			; Store record type
7594	3543		MOVE $86, R5

			; Check for header record or data record
7596	8181		LBI R1, #$81		; header record?
7598	C15A		SNE R1, R5
759A	A011		BRA $75AE		; yes
759C	8118		LBI R1, #$18		; data record
759E	C15A		SNE R1, R5
75A0	A00B		BRA $75AE		; yes

			; Record is neither header nor data
			; SET 0004
75A2	2149		MOVE R1, $92
75A4	B104		SET R1, #$04
75A6	0E1C		MHL R14, R1
75A8	BE00		SET R14, #$00
75AA	01ED		MLH R1, R14
75AC	3149		MOVE $92, R1

			; Wait for second data byte
75AE	8177		LBI R1, #$77
75B0	011D		MLH R1, R1
75B2	81CA		LBI R1, #$CA
75B4	304B		MOVE $96, R0
75B6	204D		JMP ($009A)
75B8	D0F5		JMP (R15)-

			; Store record number high byte
75BA	3546		MOVE $8C, R5

			; Wait for third data byte
75BC	8177		LBI R1, #$77
75BE	011D		MLH R1, R1
75C0	81CA		LBI R1, #$CA
75C2	304B		MOVE $96, R0
75C4	204D		JMP ($009A)
75C6	D0F5		JMP (R15)-

			; Store complete record number
75C8	2646		MOVE R6, $8C
75CA	056D		MLH R5, R6
75CC	3546		MOVE $8C, R5

			; Check for correct record number
75CE	2677		MOVE R6, $EE
75D0	0569		SUB R5, R6
75D2	065C		MHL R6, R5
75D4	055D		MLH R5, R5
75D6	056C		MHL R5, R6
75D8	0659		SUB R6, R5
75DA	055C		MHL R5, R5
75DC	056D		MLH R5, R6
75DE	015C		MHL R1, R5
75E0	0156		OR R1, R5
75E2	C10B		SNZ R1
75E4	A00D		BRA $75F4		; record found

			; Wrong record number
			; SET 0002
75E6	2149		MOVE R1, $92
75E8	B102		SET R1, #$02
75EA	0E1C		MHL R14, R1
75EC	BE00		SET R14, #$00
75EE	01ED		MLH R1, R14
75F0	3149		MOVE $92, R1
75F2	A01D		BRA $7612		; $1E(R0)

			; TST 0020 - erase data track
75F4	2E49		MOVE R14, $92
75F6	9EDF		CLR R14, #$DF
75F8	CE03		SZ R14
75FA	A007		BRA $7604		; $08(R0)
75FC	0EEC		MHL R14, R14
75FE	9EFF		CLR R14, #$FF
7600	CE0B		SNZ R14
7602	A00D		BRA $7612		; $0E(R0)

			; Check status
7604	8540		LBI R5, #$40
7606	EE5F		STAT R5, $E
7608	3547		MOVE $8E, R5
760A	8135		LBI R1, #$35
760C	C512		SE R5, R1		; tape running?
760E	A0A3		BRA $76B4		; no, error

			; Read format/erase data track
7610	1E1A		CTRL $E, #$1A		; fwd read ch0/erase ch1 IRQ

			; Read 27 bytes (zeroes)
7612	8A00		LBI R10, #$00
7614	0AAD		MLH R10, R10
7616	8A1A		LBI R10, #$1A

7618	8177		LBI R1, #$77
761A	011D		MLH R1, R1
761C	81CA		LBI R1, #$CA
761E	304B		MOVE $96, R0
7620	204D		JMP ($009A)		; wait for next data byte
7622	D0F5		JMP (R15)-

7624	FA00		SUB R10, #$01		; decrement counter
7626	8180		LBI R1, #$80
7628	CA17		SBSH R10, R1
762A	F013		BRA $7618		; loop

			; Find second sync byte at end of format record

762C	8500		LBI R5, #$00
762E	055D		MLH R5, R5
7630	8520		LBI R5, #$20
7632	352B		MOVE $56, R5		; R11L2

7634	8579		LBI R5, #$79
7636	055D		MLH R5, R5
7638	8586		LBI R5, #$86
763A	3520		MOVE $40, R5		; R0L2

			; Change to bit mode
763C	8522		LBI R5, #$22
763E	8200		LBI R2, #$00
7640	022D		MLH R2, R2
7642	820B		LBI R2, #$0B
7644	4E28		PUTB $E, (R2)

			; Wait for data byte
7646	8177		LBI R1, #$77
7648	011D		MLH R1, R1
764A	81CA		LBI R1, #$CA
764C	304B		MOVE $96, R0
764E	204D		JMP ($009A)
7650	D0F5		JMP (R15)-

7652	81E7		LBI R1, #$E7
7654	C15A		SNE R1, R5		; sync byte?
7656	A00D		BRA $7666		; yes

			; Not sync byte, set format record error flag
			; SET 0004
7658	2149		MOVE R1, $92
765A	B104		SET R1, #$04
765C	0E1C		MHL R14, R1
765E	BE00		SET R14, #$00
7660	01ED		MLH R1, R14
7662	3149		MOVE $92, R1
7664	A031		BRA $7698		; $32(R0)

			; Sync byte found
			; TST 0020
7666	2E49		MOVE R14, $92
7668	9EDF		CLR R14, #$DF
766A	CE03		SZ R14
766C	A007		BRA $7676		; $08(R0)
766E	0EEC		MHL R14, R14
7670	9EFF		CLR R14, #$FF
7672	CE0B		SNZ R14
7674	A021		BRA $7698		; $22(R0)

			; TST 4006 - backward or error?
7676	2E49		MOVE R14, $92
7678	9EF9		CLR R14, #$F9
767A	CE03		SZ R14
767C	A005		BRA $7684		; yes
767E	0EEC		MHL R14, R14
7680	9EBF		CLR R14, #$BF
7682	CE03		SZ R14
7684	A011		BRA $7698		; yes

			; Check status
7686	8540		LBI R5, #$40
7688	EE5F		STAT R5, $E
768A	3547		MOVE $8E, R5
768C	813D		LBI R1, #$3D
768E	C512		SE R5, R1		; tape running/erase/not BOT?
7690	A021		BRA $76B4		; no, error

			; Return
7692	1E3B		CTRL $E, #$3B		; read fwd ch1/erase ch1, no IRQ
7694	D1F5		MOVE R1, (R15)-
7696	0013		INC2 R0, R1

			; TST 4000 - backward tape motion?
7698	2E49		MOVE R14, $92
769A	9EFF		CLR R14, #$FF
769C	CE03		SZ R14
769E	A005		BRA $76A6
76A0	0EEC		MHL R14, R14
76A2	9EBF		CLR R14, #$BF
76A4	CE03		SZ R14
76A6	A005		BRA $76AE		; backward

			; Return
76A8	1E3F		CTRL $E, #$3F		; read fwd ch1
76AA	D1F5		MOVE R1, (R15)-
76AC	0013		INC2 R0, R1

			; Return
76AE	1E7F		CTRL $E, #$7F		; read rev ch1
76B0	D1F5		MOVE R1, (R15)-
76B2	0013		INC2 R0, R1

			; Error
76B4	8100		LBI R1, #$00
76B6	3048		MOVE $90, R0
76B8	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Read data record
;

			; Setup registers for level 2
76BA	8579		LBI R5, #$79
76BC	055D		MLH R5, R5
76BE	85AE		LBI R5, #$AE
76C0	3520		MOVE $40, R5		; R0L2

76C2	8500		LBI R5, #$00
76C4	055D		MLH R5, R5
76C6	8540		LBI R5, #$40
76C8	352B		MOVE $56, R5		; R11L2

76CA	8535		LBI R5, #$35
76CC	3526		MOVE $4C, R5		; R6L2

76CE	85E7		LBI R5, #$E7
76D0	3527		MOVE $4E, R5		; R7L2

76D2	8580		LBI R5, #$80
76D4	3528		MOVE $50, R5		; R8L2

76D6	8502		LBI R5, #$02
76D8	3529		MOVE $52, R5		; R9L2

76DA	8500		LBI R5, #$00
76DC	055D		MLH R5, R5
76DE	8553		LBI R5, #$53
76E0	3522		MOVE $44, R5		; R2L2

76E2	2550		MOVE R5, $A0
76E4	352A		MOVE $54, R5		; R10L2

			; Clear CRC error flag
			; CLR 0001
76E6	2149		MOVE R1, $92
76E8	9101		CLR R1, #$01
76EA	0E1C		MHL R14, R1
76EC	9E00		CLR R14, #$00
76EE	01ED		MLH R1, R14
76F0	3149		MOVE $92, R1

			; Check status
76F2	8540		LBI R5, #$40
76F4	EE5F		STAT R5, $E
76F6	3547		MOVE $8E, R5
76F8	9502		CLR R5, #$02
76FA	8135		LBI R1, #$35
76FC	C512		SE R5, R1
76FE	A0C3		BRA $77C4		; error

			; Change to bit mode
7700	8522		LBI R5, #$22
7702	8200		LBI R2, #$00
7704	022D		MLH R2, R2
7706	820B		LBI R2, #$0B
7708	4E28		PUTB $E, (R2)

			; Enable read interrupts
770A	0E5E		GETB R5, $E
770C	1E3E		CTRL $E, #$3E		; read fwd ch1 irq

			; Timeout 30000
770E	8B75		LBI R11, #$75
7710	0BBD		MLH R11, R11
7712	8B30		LBI R11, #$30

			; Buffer address
7714	2E40		MOVE R14, $80
7716	AE04		ADD R14, #$05
7718	D2E8		MOVE R2, (R14)

			; Buffer size: 512 bytes
771A	8A02		LBI R10, #$02
771C	0AAD		MLH R10, R10
771E	8A00		LBI R10, #$00

			; CRC preset
7720	86FF		LBI R6, #$FF
7722	066D		MLH R6, R6
7724	86FF		LBI R6, #$FF

			; Wait for first byte (record type)
7726	8177		LBI R1, #$77
7728	011D		MLH R1, R1
772A	81CA		LBI R1, #$CA
772C	304B		MOVE $96, R0
772E	204D		JMP ($009A)
7730	D0F5		JMP (R15)-

			; Check for error (noteably a timeout)
			; TST 0001
7732	2E49		MOVE R14, $92
7734	9EFE		CLR R14, #$FE
7736	CE03		SZ R14
7738	A005		BRA $7740
773A	0EEC		MHL R14, R14
773C	9EFF		CLR R14, #$FF
773E	CE03		SZ R14
7740	A07B		BRA $77BE		; read error, return

			; Store record type
7742	3544		MOVE $88, R5

			; Calculate initial CRC
7744	8179		LBI R1, #$79
7746	011D		MLH R1, R1
7748	811C		LBI R1, #$1C
774A	304B		MOVE $96, R0
774C	204D		JMP ($009A)

			; Wait for next byte
774E	8177		LBI R1, #$77
7750	011D		MLH R1, R1
7752	81CA		LBI R1, #$CA
7754	304B		MOVE $96, R0
7756	204D		JMP ($009A)
7758	D0F5		JMP (R15)-

			; TST 0040 - verify?
775A	2E49		MOVE R14, $92
775C	9EBF		CLR R14, #$BF
775E	CE03		SZ R14
7760	A007		BRA $776A		; yes, don't store data byte
7762	0EEC		MHL R14, R14
7764	9EFF		CLR R14, #$FF
7766	CE0B		SNZ R14

			; Store byte read
7768	7520		MOVB (R2)+, R5

			; Calculate CRC
776A	8179		LBI R1, #$79
776C	011D		MLH R1, R1
776E	811C		LBI R1, #$1C
7770	304B		MOVE $96, R0
7772	204D		JMP ($009A)

			; Loop until entire buffer read
7774	FA00		SUB R10, #$01
7776	01AC		MHL R1, R10
7778	01A6		OR R1, R10
777A	C103		SZ R1
777C	F02F		BRA $774E		; loop

			; Wait for next byte
777E	8177		LBI R1, #$77
7780	011D		MLH R1, R1
7782	81CA		LBI R1, #$CA
7784	304B		MOVE $96, R0
7786	204D		JMP ($009A)
7788	D0F5		JMP (R15)-

			; Calculate CRC
778A	8179		LBI R1, #$79
778C	011D		MLH R1, R1
778E	811C		LBI R1, #$1C
7790	304B		MOVE $96, R0
7792	204D		JMP ($009A)

			; Wait for next byte
7794	8177		LBI R1, #$77
7796	011D		MLH R1, R1
7798	81CA		LBI R1, #$CA
779A	304B		MOVE $96, R0
779C	204D		JMP ($009A)
779E	D0F5		JMP (R15)-

			; Calculate CRC
77A0	8179		LBI R1, #$79
77A2	011D		MLH R1, R1
77A4	811C		LBI R1, #$1C
77A6	304B		MOVE $96, R0
77A8	204D		JMP ($009A)

			; Check CRC
77AA	016C		MHL R1, R6
77AC	0166		OR R1, R6
77AE	C10B		SNZ R1
77B0	A00B		BRA $77BE		; OK, return

			; CRC error
			; SET 0001
77B2	2149		MOVE R1, $92
77B4	B101		SET R1, #$01
77B6	0E1C		MHL R14, R1
77B8	BE00		SET R14, #$00
77BA	01ED		MLH R1, R14
77BC	3149		MOVE $92, R1

			; Return
77BE	1E3F		CTRL $E, #$3F		; keep tape running
77C0	D1F5		MOVE R1, (R15)-
77C2	0013		INC2 R0, R1

			; Error
77C4	8100		LBI R1, #$00
77C6	3048		MOVE $90, R0
77C8	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Wait for a data byte from tape or timeout
;
; Parameters:
;  R11/R12 - timeout counter
; Result:
;  R5 - Data byte from tape

			; Check status
77CA	8540		LBI R5, #$40
77CC	EE5F		STAT R5, $E
77CE	3547		MOVE $8E, R5
77D0	950A		CLR R5, #$0A
77D2	8135		LBI R1, #$35
77D4	C512		SE R5, R1		; tape running?
77D6	A023		BRA $77FC		; no, error

77D8	252A		MOVE R5, $54		; check ISR flag (R10L2)
77DA	C50B		SNZ R5
77DC	A009		BRA $77E8

			; Byte found, return
77DE	2525		MOVE R5, $4A		; get byte (R5L2)
77E0	8100		LBI R1, #$00
77E2	312A		MOVE $54, R1		; clear ISR flag
77E4	D1F5		MOVE R1, (R15)-
77E6	0013		INC2 R0, R1

			; Decrement timeout counter and loop
77E8	FC00		SUB R12, #$01
77EA	CC03		SZ R12
77EC	F023		BRA $77CA		; loop
77EE	FB00		SUB R11, #$01
77F0	8180		LBI R1, #$80
77F2	CB17		SBSH R11, R1
77F4	F02B		BRA $77CA		; loop

			; Error 04
77F6	8104		LBI R1, #$04
77F8	3048		MOVE $90, R0
77FA	204E		JMP ($009C)

77FC	8100		LBI R1, #$00
77FE	3048		MOVE $90, R0
7800	204E		JMP ($009C)

; ----------------------------------------------------------------------
;
; Write a format (channel 0) record to tape
;

7802	857A		LBI R5, #$7A
7804	055D		MLH R5, R5
7806	851A		LBI R5, #$1A
7808	3520		MOVE $40, R5		; R0L2

780A	853D		LBI R5, #$3D		; tape status to monitor
780C	3526		MOVE $4C, R5		; R6L2

780E	2577		MOVE R5, $EE		; record number
7810	3527		MOVE $4E, R5		; R7L2

7812	8580		LBI R5, #$80		; test byte count for sign bit
7814	3528		MOVE $50, R5		; R8L2

7816	8502		LBI R5, #$02		; first transition
7818	3529		MOVE $52, R5		; R9L2

781A	8500		LBI R5, #$00
781C	055D		MLH R5, R5
781E	854A		LBI R5, #$4A		; address if Hi(R5L2)
7820	3522		MOVE $44, R5		; R2L2

7822	8500		LBI R5, #$00
7824	055D		MLH R5, R5
7826	85F9		LBI R5, #$F9		; byte count (249 bytes)
7828	352B		MOVE $56, R5		; R11L2

782A	8500		LBI R5, #$00
782C	055D		MLH R5, R5
782E	85AA		LBI R5, #$AA		; first byte SHL 1
7830	3525		MOVE $4A, R5		; R5L2

7832	8507		LBI R5, #$07		; bit count - 1
7834	352C		MOVE $58, R5		; R12L2

			; Check status
7836	0E1E		GETB R1, $E
7838	8540		LBI R5, #$40
783A	EE5F		STAT R5, $E
783C	3547		MOVE $8E, R5
783E	813D		LBI R1, #$3D
7840	C512		SE R5, R1
7842	A035		BRA $787A		; $36(R0)

7844	8200		LBI R2, #$00
7846	022D		MLH R2, R2
7848	824A		LBI R2, #$4A
784A	4E28		PUTB $E, (R2)
784C	106F		CTRL $0, #$6F
784E	1443		CTRL $4, #$43
7850	1E22		CTRL $E, #$22		; write fwd ch0/erase ch0+1

			; Timeout value 12000
7852	8B2E		LBI R11, #$2E
7854	0BBD		MLH R11, R11
7856	8BE0		LBI R11, #$E0

			; Check status
7858	8540		LBI R5, #$40
785A	EE5F		STAT R5, $E
785C	2628		MOVE R6, $50		; R8L2
785E	C60B		SNZ R6			; has ISR finished its work?
7860	A013		BRA $7876		; yes, return
7862	813D		LBI R1, #$3D
7864	C512		SE R5, R1
7866	A011		BRA $787A		; error

			; Decrement timeout value
7868	FB00		SUB R11, #$01
786A	8180		LBI R1, #$80
786C	CB17		SBSH R11, R1
786E	F017		BRA $7858		; loop

			; Error 04
7870	8104		LBI R1, #$04
7872	3048		MOVE $90, R0
7874	204E		JMP ($009C)

			; Return
7876	D1F5		MOVE R1, (R15)-
7878	0013		INC2 R0, R1

			; Error
787A	8100		LBI R1, #$00
787C	3048		MOVE $90, R0
787E	204E		JMP ($009C)
; ----------------------------------------------------------------------
;
; Write a data track (channel 1) record to tape
;

7880	857A		LBI R5, #$7A
7882	055D		MLH R5, R5
7884	85F4		LBI R5, #$F4
7886	3520		MOVE $40, R5		; R0L2

7888	853D		LBI R5, #$3D
788A	3526		MOVE $4C, R5		; R6L2

788C	8580		LBI R5, #$80
788E	3528		MOVE $50, R5		; R8L2

7890	8502		LBI R5, #$02
7892	3529		MOVE $52, R5		; R9L2

7894	8500		LBI R5, #$00
7896	055D		MLH R5, R5
7898	854A		LBI R5, #$4A
789A	3522		MOVE $44, R5		; R2L2

789C	8501		LBI R5, #$01
789E	055D		MLH R5, R5
78A0	85FF		LBI R5, #$FF
78A2	352B		MOVE $56, R5		; R11L2

78A4	2E40		MOVE R14, $80
78A6	AE04		ADD R14, #$05
78A8	D5E8		MOVE R5, (R14)
78AA	3523		MOVE $46, R5		; R3L2

78AC	857A		LBI R5, #$7A
78AE	055D		MLH R5, R5
78B0	858E		LBI R5, #$8E
78B2	3524		MOVE $48, R5		; R4L2

78B4	2550		MOVE R5, $A0
78B6	3525		MOVE $4A, R5		; R5L2

78B8	8507		LBI R5, #$07
78BA	352C		MOVE $58, R5		; R12L2

			; Check status
78BC	0E1E		GETB R1, $E
78BE	8540		LBI R5, #$40
78C0	EE5F		STAT R5, $E
78C2	3547		MOVE $8E, R5
78C4	813D		LBI R1, #$3D
78C6	C512		SE R5, R1
78C8	A04B		BRA $7916		; $4C(R0)

78CA	8200		LBI R2, #$00
78CC	022D		MLH R2, R2
78CE	824A		LBI R2, #$4A

			; TST 0010
78D0	2E49		MOVE R14, $92
78D2	9EEF		CLR R14, #$EF
78D4	CE03		SZ R14
78D6	A005		BRA $78DE		; $06(R0)
78D8	0EEC		MHL R14, R14
78DA	9EFF		CLR R14, #$FF
78DC	CE03		SZ R14
78DE	A007		BRA $78E8		; $08(R0)

78E0	4E28		PUTB $E, (R2)
78E2	1443		CTRL $4, #$43
78E4	1E0A		CTRL $E, #$0A		; write fwd ch1/erase ch1 irq
78E6	A005		BRA $78EE		; $06(R0)

78E8	4E28		PUTB $E, (R2)
78EA	1443		CTRL $4, #$43
78EC	1E02		CTRL $E, #$02		; write fwd ch1/erase ch0+1 irq

			; Timeout value 12000
78EE	8B2E		LBI R11, #$2E
78F0	0BBD		MLH R11, R11
78F2	8BE0		LBI R11, #$E0

			; Check status
78F4	8540		LBI R5, #$40
78F6	EE5F		STAT R5, $E
78F8	2628		MOVE R6, $50
78FA	C60B		SNZ R6
78FC	A013		BRA $7912		; return
78FE	813D		LBI R1, #$3D
7900	C512		SE R5, R1
7902	A011		BRA $7916		; error

			; Decrement timeout value
7904	FB00		SUB R11, #$01
7906	8180		LBI R1, #$80
7908	CB17		SBSH R11, R1
790A	F017		BRA $78F4		; loop

			; Error 04
790C	8104		LBI R1, #$04
790E	3048		MOVE $90, R0
7910	204E		JMP ($009C)

			; Return
7912	D1F5		MOVE R1, (R15)-
7914	0013		INC2 R0, R1

			; Error
7916	8100		LBI R1, #$00
7918	3048		MOVE $90, R0
791A	204E		JMP ($009C)

; ----------------------------------------------------------------------

791C	076C		MHL R7, R6
791E	0757		XOR R7, R5
7920	0174		MOVE R1, R7
7922	0874		MOVE R8, R7
7924	E08F		SWAP R8
7926	0787		XOR R7, R8
7928	970F		CLR R7, #$0F
792A	0767		XOR R7, R6
792C	0614		MOVE R6, R1
792E	98F0		CLR R8, #$F0
7930	0687		XOR R6, R8
7932	E01E		ROR3 R1
7934	0814		MOVE R8, R1
7936	98E0		CLR R8, #$E0
7938	0787		XOR R7, R8
793A	911F		CLR R1, #$1F
793C	0617		XOR R6, R1
793E	E08F		SWAP R8
7940	0184		MOVE R1, R8
7942	981F		CLR R8, #$1F
7944	0687		XOR R6, R8
7946	91FE		CLR R1, #$FE
7948	0717		XOR R7, R1
794A	067D		MLH R6, R7

794C	D0F5		JMP (R15)-

; ----------------------------------------------------------------------
;
; Interrupt 2 routine
; Read mode
;
			; We're in bit mode here...

			; Wait for 0 byte

			; Check status
794E	8540		LBI R5, #$40
7950	EE5F		STAT R5, $E
7952	950A		CLR R5, #$0A
7954	C562		SE R5, R6
7956	A0AD		BRA $7A06

			; Status OK, read data latch
7958	8580		LBI R5, #$80
795A	EE5F		STAT R5, $E
795C	C50B		SNZ R5
795E	A021		BRA $7982		; 0 byte found

7960	FB00		SUB R11, #$01
7962	CB8F		SNBSH R11, R8
7964	A03B		BRA $79A2		; timeout

7966	0E5E		GETB R5, $E		; reset interrupt 2
7968	F01B		BRA $794E		; loop

			; Wait for sync byte $E7
			
			; Check status
796A	8540		LBI R5, #$40
796C	EE5F		STAT R5, $E
796E	950A		CLR R5, #$0A
7970	C562		SE R5, R6
7972	A091		BRA $7A06

			; Status OK, read data latch
7974	8580		LBI R5, #$80
7976	EE5F		STAT R5, $E
7978	C57A		SNE R5, R7
797A	A069		BRA $79E6		; sync byte found

797C	FB00		SUB R11, #$01
797E	CB8F		SNBSH R11, R8
7980	A01F		BRA $79A2		; timeout

7982	0E5E		GETB R5, $E
7984	F01B		BRA $796A		; loop

; ----------------------------------------------------------------------
;
; Interrupt routine to wait for trailing sync byte in format record
;

			; Reset interruot
7986	0E5E		GETB R5, $E

			; Check status
7988	8540		LBI R5, #$40
798A	EE5F		STAT R5, $E
798C	950A		CLR R5, #$0A
798E	C562		SE R5, R6
7990	A073		BRA $7A06		; error

			; Synchronize to sync byte
7992	8580		LBI R5, #$80
7994	EE5F		STAT R5, $E
7996	C57A		SNE R5, R7
7998	A065		BRA $7A00		; sync byte found

799A	FB00		SUB R11, #$01
799C	CB8F		SNBSH R11, R8
799E	A05F		BRA $7A00		; timeout
79A0	F01B		BRA $7986		; loop

; ----------------------------------------------------------------------

			; Error 04
79A2	8604		LBI R6, #$04
79A4	3048		MOVE $90, R0

79A6	817C		LBI R1, #$7C
79A8	011D		MLH R1, R1
79AA	8184		LBI R1, #$84
79AC	0014		RET R1

; ----------------------------------------------------------------------
;
; Interrupt 2 routine
; Read data track
;

			; Check status
79AE	8540		LBI R5, #$40
79B0	EE5F		STAT R5, $E
79B2	950A		CLR R5, #$0A
79B4	C562		SE R5, R6
79B6	A04D		BRA $7A06		; error

			; Read data latch, loop until non-zero
79B8	8580		LBI R5, #$80
79BA	EE5F		STAT R5, $E
79BC	C50B		SNZ R5
79BE	A021		BRA $79E2		; zero found

79C0	FB00		SUB R11, #$01
79C2	CB8F		SNBSH R11, R8
79C4	A02D		BRA $79F4		; timeout

79C6	0E5E		GETB R5, $E		; reset interrupt
79C8	F01B		BRA $79AE		; loop

			; Check status
79CA	8540		LBI R5, #$40
79CC	EE5F		STAT R5, $E
79CE	950A		CLR R5, #$0A
79D0	C562		SE R5, R6
79D2	A031		BRA $7A06		; error

			; Read data latch, loop until match
79D4	8580		LBI R5, #$80
79D6	EE5F		STAT R5, $E
79D8	C57A		SNE R5, R7
79DA	A009		BRA $79E6		; sync byte found

79DC	FB00		SUB R11, #$01
79DE	CB8F		SNBSH R11, R8
79E0	A011		BRA $79F4		; timeout

79E2	0E5E		GETB R5, $E		; reset interrupt
79E4	F01B		BRA $79CA		; loop

; ----------------------------------------------------------------------
;
; Byte mode read interrupt routine (for either track)
;

			; Synchronized, change to byte mode
79E6	4E28		PUTB $E, (R2)

			; Reset interrupt (wait for byte to arrive)
79E8	0E1E		GETB R1, $E

			; Get data byte
79EA	0004		NOP
79EC	8580		LBI R5, #$80
79EE	EE5F		STAT R5, $E

79F0	8AFF		LBI R10, #$FF		; set flag
79F2	F00B		BRA $79E8		; loop

; ----------------------------------------------------------------------

			; SET 0001
79F4	2149		MOVE R1, $92
79F6	B101		SET R1, #$01
79F8	0E1C		MHL R14, R1
79FA	BE00		SET R14, #$00
79FC	01ED		MLH R1, R14
79FE	3149		MOVE $92, R1

			; Bit/Byte read loop
7A00	8AFF		LBI R10, #$FF		; set flag
7A02	0E1E		GETB R1, $E		; clear interrupt
7A04	F005		BRA $7A00		; loop
; ----------------------------------------------------------------------

7A06	3547		MOVE $8E, R5
7A08	8600		LBI R6, #$00
7A0A	3048		MOVE $90, R0
7A0C	817C		LBI R1, #$7C
7A0E	011D		MLH R1, R1
7A10	8184		LBI R1, #$84
7A12	0014		RET R1

; ----------------------------------------------------------------------
;
; Interrupt 2 routine to write a format record
;

			; 1. Write bit pattern $55

7A14	8555		LBI R5, #$55		; bit pattern
7A16	8C08		LBI R12, #$08		; bit count

7A18	0E1E		GETB R1, $E		; reset interrupt

			; Check status
7A1A	8E40		LBI R14, #$40
7A1C	EEEF		STAT R14, $E
7A1E	CE62		SE R14, R6
7A20	A0E7		BRA $7B0A		; error

			; Write bit
7A22	059D		MLH R5, R9
7A24	0558		ADD R5, R5
7A26	4E28		PUTB $E, (R2)

			; Decrement bit count
7A28	FC00		SUB R12, #$01
7A2A	CC03		SZ R12
7A2C	F015		BRA $7A18		; bit loop

			; Decrement byte count
7A2E	FB00		SUB R11, #$01
7A30	CB87		SBSH R11, R8
7A32	F01F		BRA $7A14		; byte loop

			; 2. Write format record data

7A34	0403		INC2 R4, R0
7A36	A0B7		BRA $7AF0		; write 00

7A38	0403		INC2 R4, R0
7A3A	A0B3		BRA $7AF0		; write 00

7A3C	85E7		LBI R5, #$E7
7A3E	0403		INC2 R4, R0
7A40	A0AD		BRA $7AF0		; write E7 (sync. byte)

7A42	2543		MOVE R5, $86
7A44	0403		INC2 R4, R0
7A46	A0A7		BRA $7AF0		; write record ID

7A48	057C		MHL R5, R7
7A4A	0403		INC2 R4, R0
7A4C	A0A1		BRA $7AF0		; write Hi(record number)

7A4E	0574		MOVE R5, R7
7A50	0403		INC2 R4, R0
7A52	A09B		BRA $7AF0		; write Lo(record number)

			; 3. Write 29 zeroes
			
7A54	8B1D		LBI R11, #$1D		; 29 bytes
7A56	8C08		LBI R12, #$08		; bit count
7A58	0E1E		GETB R1, $E
7A5A	8E40		LBI R14, #$40
7A5C	EEEF		STAT R14, $E
7A5E	CE62		SE R14, R6
7A60	A0A7		BRA $7B0A		; error

			; Write bit
7A62	059D		MLH R5, R9
7A64	0558		ADD R5, R5
7A66	4E28		PUTB $E, (R2)

7A68	FC00		SUB R12, #$01
7A6A	CC03		SZ R12
7A6C	F015		BRA $7A58		; bit loop

7A6E	FB00		SUB R11, #$01
7A70	CB03		SZ R11
7A72	F01D		BRA $7A56		; byte loop

			; 4. Write data in reverse order

7A74	2543		MOVE R5, $86
7A76	0403		INC2 R4, R0
7A78	A075		BRA $7AF0		; write record ID

7A7A	85E7		LBI R5, #$E7
7A7C	0403		INC2 R4, R0
7A7E	A06F		BRA $7AF0		; write E7 (sync. byte)

7A80	0403		INC2 R4, R0
7A82	A06B		BRA $7AF0		; write 00

7A84	0403		INC2 R4, R0
7A86	A067		BRA $7AF0		; write 00

7A88	0E1E		GETB R1, $E		; reset interrupt

			; Done, clear flag and disable interrupt
			
7A8A	8800		LBI R8, #$00		; done
7A8C	1E13		CTRL $E, #$13		; keep erasing ch0+1, dis. IRQ

; ----------------------------------------------------------------------
;
; Interrupt 2 routine to write a data record
;

			; Write zero
7A8E	0403		INC2 R4, R0
7A90	A05D		BRA $7AF0

			; Write sync byte
7A92	85E7		LBI R5, #$E7
7A94	0403		INC2 R4, R0
7A96	A057		BRA $7AF0

			; Write record type
7A98	2545		MOVE R5, $8A
7A9A	0403		INC2 R4, R0
7A9C	A051		BRA $7AF0

			; Write data data buffer
7A9E	6530		MOVB R5, (R3)+		; get next byte from buffer
7AA0	8C08		LBI R12, #$08		; bit count
7AA2	0E1E		GETB R1, $E
7AA4	8E40		LBI R14, #$40
7AA6	EEEF		STAT R14, $E
7AA8	CE62		SE R14, R6
7AAA	A05D		BRA $7B0A		; error
7AAC	059D		MLH R5, R9
7AAE	0558		ADD R5, R5
7AB0	4E28		PUTB $E, (R2)
7AB2	FC00		SUB R12, #$01
7AB4	CC03		SZ R12
7AB6	F015		BRA $7AA2		; bit loop
7AB8	FB00		SUB R11, #$01
7ABA	CB87		SBSH R11, R8
7ABC	F01F		BRA $7A9E		; byte loop

			; Write high byte of CRC
7ABE	254F		MOVE R5, $9E
7AC0	055C		MHL R5, R5
7AC2	0403		INC2 R4, R0
7AC4	A029		BRA $7AF0

			; Write low byte of CRC
7AC6	254F		MOVE R5, $9E
7AC8	0403		INC2 R4, R0
7ACA	A023		BRA $7AF0

			; Write zero
7ACC	0403		INC2 R4, R0
7ACE	A01F		BRA $7AF0

			; Write zero
7AD0	0403		INC2 R4, R0
7AD2	A01B		BRA $7AF0

			; TST 0010
7AD4	2E49		MOVE R14, $92
7AD6	9EEF		CLR R14, #$EF
7AD8	CE03		SZ R14
7ADA	A005		BRA $7AE2
7ADC	0EEC		MHL R14, R14
7ADE	9EFF		CLR R14, #$FF
7AE0	CE03		SZ R14
7AE2	A005		BRA $7AEA

7AE4	0E1E		GETB R1, $E		; reset interrupt
7AE6	8800		LBI R8, #$00		; done
7AE8	1E3F		CTRL $E, #$3F		; fwd read, dis. IRQ

7AEA	0E1E		GETB R1, $E		; reset interrupt
7AEC	8800		LBI R8, #$00		; done
7AEE	1E13		CTRL $E, #$13		; keep erasing ch0+1, dis. IRQ

; ----------------------------------------------------------------------
;
; Interrupt 2 helper routine
; Write byte in R5 to current tape channel
;

7AF0	8C08		LBI R12, #$08		; bit count
7AF2	0E1E		GETB R1, $E		; reset interrupt

			; Check status
7AF4	8E40		LBI R14, #$40
7AF6	EEEF		STAT R14, $E
7AF8	CE62		SE R14, R6
7AFA	A00D		BRA $7B0A		; error

7AFC	059D		MLH R5, R9
7AFE	0558		ADD R5, R5
7B00	4E28		PUTB $E, (R2)

			; Decrement bit count
7B02	FC00		SUB R12, #$01
7B04	CC03		SZ R12
7B06	F015		BRA $7AF2		; bit loop

			; Return
7B08	0044		RET R4

; ----------------------------------------------------------------------

			; Error
7B0A	3E47		MOVE $8E, R14		; save tape status

7B0C	05E4		MOVE R5, R14
7B0E	8600		LBI R6, #$00
7B10	3048		MOVE $90, R0

7B12	817C		LBI R1, #$7C
7B14	011D		MLH R1, R1
7B16	8182		LBI R1, #$82
7B18	0014		RET R1

; ----------------------------------------------------------------------

			; Error code routine
			
7B1A	1EFF		CTRL $E, #$FF
7B1C	0118		ADD R1, R1
7B1E	0018		ADD R0, R1
7B20	A01B		BRA $7B3E		; $1C(R0)
7B22	A03B		BRA $7B60		; $3C(R0)
7B24	A061		BRA $7B88		; error 02
7B26	A067		BRA $7B90		; error 03
7B28	A06D		BRA $7B98		; error 04
7B2A	0000		HALT
7B2C	0000		HALT
7B2E	A083		BRA $7BB4		; error 07
7B30	A089		BRA $7BBC		; error 08
7B32	A08F		BRA $7BC4		; error 09
7B34	A095		BRA $7BCC		; error 10
7B36	A09B		BRA $7BD4		; error 11
7B38	A0A1		BRA $7BDC		; error 12
7B3A	0000		HALT
7B3C	0000		HALT

7B3E	8110		LBI R1, #$10		; cartridge in place?
7B40	C51E		SNBC R5, R1
7B42	A00B		BRA $7B50		; no

7B44	8101		LBI R1, #$01		; beginning of tape?
7B46	C51E		SNBC R5, R1
7B48	A09B		BRA $7BE6		; yes

7B4A	8180		LBI R1, #$80		; end of tape?
7B4C	C516		SBC R5, R1
7B4E	A095		BRA $7BE6		; yes

7B50	1EFF		CTRL $E, #$FF		; stop all
7B52	8110		LBI R1, #$10		; cartridge in place?
7B54	C51E		SNBC R5, R1
7B56	A047		BRA $7BA0		; no, error 05

7B58	8102		LBI R1, #$02		; file protected?
7B5A	C516		SBC R5, R1
7B5C	A04D		BRA $7BAC		; yes, error 06
7B5E	A02F		BRA $7B90		; no, error 03

			; Delay 12000
7B60	8E2E		LBI R14, #$2E
7B62	0EED		MLH R14, R14
7B64	8EE0		LBI R14, #$E0
7B66	FE00		SUB R14, #$01
7B68	8180		LBI R1, #$80
7B6A	CE17		SBSH R14, R1
7B6C	F007		BRA $7B66

7B6E	8540		LBI R5, #$40
7B70	EE5F		STAT R5, $E
7B72	3547		MOVE $8E, R5
7B74	9502		CLR R5, #$02
7B76	8115		LBI R1, #$15		; tape stopped?
7B78	C512		SE R5, R1
7B7A	A003		BRA $7B80		; no

			; Tape stopped, this is OK (why?!?)
7B7C	2550		MOVE R5, $A0
7B7E	A061		BRA $7BE2		; return

7B80	9502		CLR R5, #$02
7B82	8100		LBI R1, #$00
7B84	3048		MOVE $90, R0
7B86	204E		JMP ($009C)

			; Error 02
7B88	85F0		LBI R5, #$F0
7B8A	055D		MLH R5, R5
7B8C	85F2		LBI R5, #$F2
7B8E	A051		BRA $7BE2		; $52(R0)

			; Error 03
7B90	85F0		LBI R5, #$F0
7B92	055D		MLH R5, R5
7B94	85F3		LBI R5, #$F3
7B96	A049		BRA $7BE2		; $4A(R0)

			; Error 04
7B98	85F0		LBI R5, #$F0
7B9A	055D		MLH R5, R5
7B9C	85F4		LBI R5, #$F4
7B9E	A041		BRA $7BE2		; $42(R0)

			; Error 05
7BA0	2550		MOVE R5, $A0
7BA2	3576		MOVE $EC, R5
7BA4	85F0		LBI R5, #$F0
7BA6	055D		MLH R5, R5
7BA8	85F5		LBI R5, #$F5
7BAA	A035		BRA $7BE2		; $36(R0)

			; Error 06
7BAC	85F0		LBI R5, #$F0
7BAE	055D		MLH R5, R5
7BB0	85F6		LBI R5, #$F6
7BB2	A02D		BRA $7BE2		; $2E(R0)

			; Error 07
7BB4	85F0		LBI R5, #$F0
7BB6	055D		MLH R5, R5
7BB8	85F7		LBI R5, #$F7
7BBA	A025		BRA $7BE2		; $26(R0)

			; Error 08
7BBC	85F0		LBI R5, #$F0
7BBE	055D		MLH R5, R5
7BC0	85F8		LBI R5, #$F8
7BC2	A01D		BRA $7BE2		; $1E(R0)

			; Error 09
7BC4	85F0		LBI R5, #$F0
7BC6	055D		MLH R5, R5
7BC8	85F9		LBI R5, #$F9
7BCA	A015		BRA $7BE2		; $16(R0)

			; Error 10
7BCC	85F1		LBI R5, #$F1
7BCE	055D		MLH R5, R5
7BD0	85F0		LBI R5, #$F0
7BD2	A00D		BRA $7BE2		; $0E(R0)

			; Error 11
7BD4	85F1		LBI R5, #$F1
7BD6	055D		MLH R5, R5
7BD8	85F1		LBI R5, #$F1
7BDA	A005		BRA $7BE2		; $06(R0)

			; Error 12
7BDC	85F1		LBI R5, #$F1
7BDE	055D		MLH R5, R5
7BE0	85F2		LBI R5, #$F2

			; Return
7BE2	3575		MOVE $EA, R5		; store code in IOCB_Ret
7BE4	D0F5		JMP (R15)-

; ----------------------------------------------------------------------

7BE6	8101		LBI R1, #$01
7BE8	C516		SBC R5, R1
7BEA	A00B		BRA $7BF8		; $0C(R0)

			; SET 2000
7BEC	2149		MOVE R1, $92
7BEE	B100		SET R1, #$00
7BF0	0E1C		MHL R14, R1
7BF2	BE20		SET R14, #$20
7BF4	01ED		MLH R1, R14
7BF6	3149		MOVE $92, R1

7BF8	8180		LBI R1, #$80
7BFA	C51E		SNBC R5, R1
7BFC	A00B		BRA $7C0A

			; SET 1000
7BFE	2149		MOVE R1, $92
7C00	B100		SET R1, #$00
7C02	0E1C		MHL R14, R1
7C04	BE10		SET R14, #$10
7C06	01ED		MLH R1, R14
7C08	3149		MOVE $92, R1

			; TST 8090
7C0A	2E49		MOVE R14, $92
7C0C	9E6F		CLR R14, #$6F
7C0E	CE03		SZ R14
7C10	A005		BRA $7C18		; $06(R0)
7C12	0EEC		MHL R14, R14
7C14	9E7F		CLR R14, #$7F
7C16	CE03		SZ R14
7C18	A00F		BRA $7C2A		; $10(R0)

			; Delay 12000
7C1A	8E2E		LBI R14, #$2E
7C1C	0EED		MLH R14, R14
7C1E	8EE0		LBI R14, #$E0
7C20	FE00		SUB R14, #$01
7C22	8180		LBI R1, #$80
7C24	CE17		SBSH R14, R1
7C26	F007		BRA $7C20		; -> -$08(R0)
7C28	A00D		BRA $7C38		; $0E(R0)

			; Delay 5000
7C2A	8E13		LBI R14, #$13
7C2C	0EED		MLH R14, R14
7C2E	8E88		LBI R14, #$88
7C30	FE00		SUB R14, #$01
7C32	8180		LBI R1, #$80
7C34	CE17		SBSH R14, R1
7C36	F007		BRA $7C30		; -> -$08(R0)

			; Check status
			; [now this really looks like the output from
			;  a macro expansion...]
7C38	8540		LBI R5, #$40
7C3A	EE5F		STAT R5, $E
7C3C	3547		MOVE $8E, R5
7C3E	8100		LBI R1, #$00
7C40	C512		SE R5, R1
7C42	0004		NOP
7C44	8101		LBI R1, #$01
7C46	C516		SBC R5, R1
7C48	A00B		BRA $7C56		; $0C(R0)

			; SET 2000
7C4A	2149		MOVE R1, $92
7C4C	B100		SET R1, #$00
7C4E	0E1C		MHL R14, R1
7C50	BE20		SET R14, #$20
7C52	01ED		MLH R1, R14
7C54	3149		MOVE $92, R1

7C56	8180		LBI R1, #$80
7C58	C51E		SNBC R5, R1
7C5A	A00B		BRA $7C68		; $0C(R0)

			; SET 1000
7C5C	2149		MOVE R1, $92
7C5E	B100		SET R1, #$00
7C60	0E1C		MHL R14, R1
7C62	BE10		SET R14, #$10
7C64	01ED		MLH R1, R14
7C66	3149		MOVE $92, R1

			; CMP 8x9x
7C68	2E49		MOVE R14, $92
7C6A	9E6F		CLR R14, #$6F
7C6C	8190		LBI R1, #$90
7C6E	CE15		SBS R14, R1
7C70	A007		BRA $7C7A		; $08(R0)
7C72	8180		LBI R1, #$80
7C74	0EEC		MHL R14, R14
7C76	9E7F		CLR R14, #$7F
7C78	CE15		SBS R14, R1
7C7A	A001		BRA $7C7E		; $02(R0)

7C7C	1EF3		CTRL $E, #$F3

7C7E	0E5E		GETB R5, $E
7C80	F0A5		BRA $7BDC		; error 12

; ----------------------------------------------------------------------
;
; Error exit for interrupt routines
;

7C82	0EEE		GETB R14, $E		; reset interrupt

7C84	3601		MOVE $02, R6		; R1L0
7C86	3505		MOVE $0A, R5		; R5L0
7C88	214E		MOVE R1, $9C
7C8A	3100		MOVE $00, R1		; R0L0
7C8C	1EFF		CTRL $E, #$FF		; stop all

; ----------------------------------------------------------------------

7C8E	0000		HALT
...
7EFF	0000		HALT

; ***************************
; Device E (Tape) I/O Routine
; ***************************

7F00	216C		MOVE R1, $D8		; Vector table for I/O routines
7F02	A13B		ADD R1, #$3C		; Vector to device F
7F04	D718		MOVE R7, (R1)
7F06	0F33		INC2 R15, R3
7F08	6EF0		MOVB R14, (R15)+	; IOCB_Cmd
7F0A	6DF6		MOVB R13, (R15)---	; IOCB_Flags
7F0C	CE0B		SNZ R14
7F0E	A00B		BRA $7F1C		; "Sense" command

7F10	8C30		LBI R12, #$30

7F12	8103		LBI R1, #$03
7F14	CE10		SLE R14, R1		; Read or Write ?
7F16	A007		BRA $7F20		; No

7F18	CDC6		SBC R13, R12
7F1A	A02B		BRA $7F48		; Bit 2 or 3 set

7F1C	2807		MOVE R8, $0E		; R7L0, contains vector
7F1E	2056		JMP ($00AC)		; Do I/O and return to caller
; ----------

			; Commands other than Read or Write

7F20	81FD		LBI R1, #$FD		; Is it "Translate only" ?
7F22	CE12		SE R14, R1
7F24	F009		BRA $7F1C		; No, do I/O

			; Translate only

7F26	CDC6		SBC R13, R12
7F28	A00D		BRA $7F38		; Bit 2 or 3 set

			; Bit 2 and 3 clear -> error
			
7F2A	8CF0		LBI R12, #$F0
7F2C	0CCD		MLH R12, R12
7F2E	8CF2		LBI R12, #$F2
7F30	AF0B		ADD R15, #$0C		; IOCB_Ret
7F32	5CF8		MOVE (R15), R12		; Error 02
7F34	0824		MOVE R8, R2
7F36	2056		JMP ($00AC)		; Return to caller
; ----------

7F38	8A00		LBI R10, #$00		; Tape code -> EBCDIC
7F3A	8110		LBI R1, #$10
7F3C	CD15		SBS R13, R1		; Is bit 3 set ?
7F3E	8AFF		LBI R10, #$FF		; Yes: EBCDIC -> tape code

7F40	0803		INC2 R8, R0
7F42	A04F		BRA $7F94		; Convert

7F44	0824		MOVE R8, R2
7F46	2056		JMP ($00AC)		; Return to caller
; ----------

7F48	8101		LBI R1, #$01
7F4A	CE18		SGT R14, R1		; Write ?
7F4C	A00B		BRA $7F5A		; No

			; Write: Convert buffer first

7F4E	8A00		LBI R10, #$00
7F50	8110		LBI R1, #$10
7F52	CD15		SBS R13, R1
7F54	8AFF		LBI R10, #$FF
7F56	0803		INC2 R8, R0
7F58	A039		BRA $7F94		; Convert

			; Do I/O (read or write)
			
7F5A	326A		MOVE $D4, R2		; Save R2
7F5C	2807		MOVE R8, $0E		; R7L0 contains I/O vector
7F5E	0203		INC2 R2, R0
7F60	2056		JMP ($00AC)		; Do I/O
7F62	226A		MOVE R2, $D4		; Restore R2

7F64	0F33		INC2 R15, R3
7F66	6EF0		MOVB R14, (R15)+	; IOCB_Cmd
7F68	6DF6		MOVB R13, (R15)---	; IOCB_Flags

7F6A	8AFF		LBI R10, #$FF
7F6C	8120		LBI R1, #$20
7F6E	CD15		SBS R13, R1		; Bit 2 set ?
7F70	8A00		LBI R10, #$00

7F72	8101		LBI R1, #$01
7F74	CE1A		SNE R14, R1		; Read ?
7F76	A013		BRA $7F8C		; Yes, convert after read

			; Write

7F78	AF0B		ADD R15, #$0C
7F7A	DCF8		MOVE R12, (R15)		; Get IOCB_Ret
7F7C	CC03		SZ R12			; Error occured ?
7F7E	A003		BRA $7F84		; Yes

7F80	0824		MOVE R8, R2		; No
7F82	2056		JMP ($00AC)		; Return to caller
; ----------

7F84	8AFF		LBI R10, #$FF
7F86	8110		LBI R1, #$10
7F88	CD15		SBS R13, R1
7F8A	8A00		LBI R10, #$00

7F8C	0803		INC2 R8, R0
7F8E	A003		BRA $7F94		; Convert

7F90	0824		MOVE R8, R2
7F92	2056		JMP ($00AC)		; Return to caller

; ******************************
; Tape buffer conversion routine
; ******************************

7F94	0F34		MOVE R15, R3
7F96	AF03		ADD R15, #$04
7F98	DEF1		MOVE R14, (R15)+	; IOCB_BA
7F9A	DDF8		MOVE R13, (R15)		; IOCB_BS
7F9C	8F0B		LBI R15, #$0B
7F9E	0FFD		MLH R15, R15
7FA0	8FF2		LBI R15, #$F2		; R15 <- $0BF2 (word address!)
7FA2	2C50		MOVE R12, $A0
7FA4	8C1E		LBI R12, #$1E		; Address of R15L0
7FA6	1102		CTRL $1, #$02		; Select Common ROS
7FA8	41C0		PUTB $1, (R12)+		; Hi(Address)
7FAA	41C4		PUTB $1, (R12)-		; Lo(Address)
7FAC	F000		BRA $7FAD		; Delay jump

			; Get word address of conversion code table

7FAE	01BE		GETB R11, $1		; Get Hi-byte
7FB0	0BBD		MLH R11, R11
7FB2	0004		NOP
7FB4	01BE		GETB R11, $1		; Get Lo-byte

7FB6	0FB4		MOVE R15, R11
7FB8	69E8		MOVB R9, (R14)		; Get character from buffer
7FBA	0F98		ADD R15, R9
7FBC	41C0		PUTB $1, (R12)+
7FBE	41C4		PUTB $1, (R12)-
7FC0	F000		BRA $7FC1		; Delay jump

7FC2	019E		GETB R9, $1		; Get converted character
7FC4	0004		NOP
7FC6	CA03		SZ R10			; Which conversion direction ?
7FC8	019E		GETB R9, $1		; Get other character

7FCA	79E0		MOVB (R14)+, R9		; Put converted character back

7FCC	FD00		SUB R13, #$01
7FCE	01DC		MHL R1, R13
7FD0	01D6		OR R1, R13
7FD2	C103		SZ R1
7FD4	F01F		BRA $7FB6		; Loop over all characters

7FD6	0084		RET R8			; Return to caller
; ----------

7FD8	0000		HALT
7FDA	0000		HALT
7FDC	0000		HALT
; ----------

; **********************************
; Setup routine for I/O vector table
; for tape device E and F
; **********************************

7FDE	8102		LBI R1, #$02
7FE0	011D		MLH R1, R1
7FE2	8104		LBI R1, #$04
7FE4	31E3		MOVE $1C6, R1		; $01C6 <- $0204

7FE6	817F		LBI R1, #$7F
7FE8	011D		MLH R1, R1
7FEA	8100		LBI R1, #$00		; R1 <- Address of dev. E rout.
7FEC	246C		MOVE R4, $D8
7FEE	A437		ADD R4, #$38
7FF0	5143		MOVE (R4)++, R1		; Set vector for device E

7FF2	8160		LBI R1, #$60
7FF4	011D		MLH R1, R1
7FF6	8100		LBI R1, #$00		; R1 <- Address of dev. F rout.
7FF8	5148		MOVE (R4), R1		; Set vector for device F

7FFA	0824		MOVE R8, R2
7FFC	2056		JMP ($00AC)		; Return to caller

7FFE	F021		BRA $7FDE		; Entry point for above routine

; **********************************************************************
; *** END OF ROS PART 4
; **********************************************************************
